{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/作为异世界的系统/schema.ts","src://tavern_helper_template/src/作为异世界的系统/脚本/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","import { z } from 'zod';\n\nexport const Schema = z.object({\n  世界: z.object({\n    当前时间: z.coerce.string(),\n    当前地点: z.coerce.string(),\n  }),\n\n  主角: z.object({\n    姓名: z.coerce.string(),\n    性别: z.coerce.string(),\n    年龄: z.union([z.coerce.number(), z.literal('待初始化')]),\n    外貌: z.object({\n      描述: z.coerce.string(),\n      主角评价: z.coerce.string(),\n    }),\n    能力面板: z.object({\n      力量: z\n        .object({\n          数值: z.union([z.union([z.coerce.number(), z.literal('待初始化')]), z.literal('待初始化')]),\n          主角评价: z.coerce.string(),\n        })\n        .describe('体能与攻击能力，决定近战输出与负重'),\n      敏捷: z\n        .object({\n          数值: z.union([z.coerce.number(), z.literal('待初始化')]),\n          主角评价: z.coerce.string(),\n        })\n        .describe('移动、闪避与反应速度，影响先手与命中'),\n      体质: z\n        .object({\n          数值: z.union([z.coerce.number(), z.literal('待初始化')]),\n          主角评价: z.coerce.string(),\n        })\n        .describe('生命力与耐久度，决定抗性与恢复速度'),\n      感知: z\n        .object({\n          数值: z.union([z.coerce.number(), z.literal('待初始化')]),\n          主角评价: z.coerce.string(),\n        })\n        .describe('观察与洞察能力，影响侦查与魔力控制'),\n      意志: z\n        .object({\n          数值: z.union([z.coerce.number(), z.literal('待初始化')]),\n          主角评价: z.coerce.string(),\n        })\n        .describe('精神力与抗干扰能力，决定技能稳定性'),\n      魅力: z\n        .object({\n          数值: z.union([z.coerce.number(), z.literal('待初始化')]),\n          主角评价: z.coerce.string(),\n        })\n        .describe('影响交涉、统御与社交反馈的综合指标'),\n    }),\n    装备栏: z.object({\n      主手: z.object({\n        装备: z.coerce.string(),\n        主角评价: z.coerce.string(),\n      }),\n      副手: z.object({\n        装备: z.coerce.string(),\n        主角评价: z.coerce.string(),\n      }),\n      防具: z.object({\n        装备: z.coerce.string(),\n        主角评价: z.coerce.string(),\n      }),\n      饰品: z.object({\n        装备: z.coerce.string(),\n        主角评价: z.coerce.string(),\n      }),\n    }),\n    物品栏: z.record(\n      z.coerce.string<string | number>().describe('物品名'),\n      z.object({\n        描述: z.coerce.string(),\n        主角评价: z.coerce.string(),\n      }),\n    ),\n    持有能力: z.record(\n      z.coerce.string<string | number>().describe('物品名'),\n      z.object({\n        描述: z.coerce.string(),\n        主角评价: z.coerce.string(),\n      }),\n    ),\n    当前状态: z.record(\n      z.coerce.string<string | number>().describe('状态名'),\n      z.object({\n        类型: z.enum(['增益', '减益']),\n        持续时间: z.union([z.literal('永久'), z.coerce.string()]),\n        触发条件: z.coerce.string(),\n        描述: z.coerce.string(),\n        主角评价: z.coerce.string(),\n      }),\n    ),\n  }),\n\n  系统状态: z.object({\n    可用积分: z.union([z.coerce.number(), z.literal('待初始化')]),\n    对主角可见形象: z.coerce.string(),\n    玩家ID: z.coerce.string(),\n  }),\n\n  商品列表: z.record(\n    z.coerce.string<string | number>().describe('商品名'),\n    z.object({\n      描述: z.coerce.string(),\n      主角评价: z.coerce.string(),\n      积分价格: z.union([z.coerce.number(), z.literal('待初始化')]),\n    }),\n  ),\n\n  任务列表: z.record(\n    z.coerce.string<string | number>().describe('任务名'),\n    z.object({\n      类型: z.enum(['主线', '支线', '每日', '临危受命']),\n      说明: z.coerce.string(),\n      目标: z.coerce.string(),\n      奖励: z.coerce.string(),\n      惩罚: z.coerce.string(),\n    }),\n  ),\n});\nexport type Schema = z.output<typeof Schema>;\nexport const TASK_TYPES = ['主线', '支线', '每日', '临危受命'] as const;\n","import { Schema } from '../schema';\nfunction trimQuotesAndBackslashes(string) {\n    return string.replace(/^[\\\\\"'` ]*(.*?)[\\\\\"'` ]*$/, '$1');\n}\nfunction parseCommandValue(string) {\n    const trimmed = string.trim();\n    if (trimmed === 'true') {\n        return true;\n    }\n    if (trimmed === 'false') {\n        return false;\n    }\n    if (trimmed === 'null') {\n        return null;\n    }\n    if (trimmed === 'undefined') {\n        return undefined;\n    }\n    try {\n        return JSON.parse(trimmed);\n    }\n    catch (e) {\n        if ((trimmed.startsWith('{') && trimmed.endsWith('}')) || (trimmed.startsWith('[') && trimmed.endsWith(']'))) {\n            try {\n                const result = new Function(`return ${trimmed};`)();\n                if (_.isObject(result) || Array.isArray(result)) {\n                    return result;\n                }\n            }\n            catch (err) {\n                // 如果解析失败，说明它可能是一个未加引号的字符串或数学表达式，继续往下走\n            }\n        }\n    }\n    try {\n        return YAML.parse(trimmed);\n    }\n    catch (e) {\n        /** empty */\n    }\n    return trimQuotesAndBackslashes(string);\n}\n$(async () => {\n    await waitGlobalInitialized('Mvu');\n    eventOn(Mvu.events.COMMAND_PARSED, (variables, commands) => {\n        for (const command of commands) {\n            const new_data = klona(variables.stat_data);\n            const path = trimQuotesAndBackslashes(command.args[0]);\n            switch (command.type) {\n                case 'set': {\n                    if (command.args.length === 3) {\n                        command.args.splice(1, 1);\n                    }\n                    _.set(new_data, path, parseCommandValue(command.args[1]));\n                    break;\n                }\n                case 'insert': {\n                    const collection = _.get(new_data, path);\n                    const is_array = _.isArray(collection);\n                    const is_object = _.isPlainObject(collection);\n                    if (!is_array && !is_object) {\n                        continue;\n                    }\n                    const value = parseCommandValue(command.args.at(-1));\n                    if (command.args.length === 2) {\n                        if (is_array) {\n                            collection.push(value);\n                        }\n                        else {\n                            _.assign(collection, value);\n                        }\n                    }\n                    else {\n                        const key_or_index = parseCommandValue(command.args[1]);\n                        if (is_array) {\n                            collection.splice(key_or_index, 0, value);\n                        }\n                        else {\n                            collection[String(key_or_index)] = value;\n                        }\n                    }\n                    break;\n                }\n                case 'delete': {\n                    _.unset(new_data, command.args);\n                    break;\n                }\n            }\n            const result = Schema.safeParse(new_data);\n            if (result.success) {\n                variables.stat_data = result.data;\n            }\n        }\n        commands.length = 0;\n    });\n});\n"],"names":["z","Schema","object","coerce","string","union","number","literal","describe","record","enum","trimQuotesAndBackslashes","replace","parseCommandValue","trimmed","trim","JSON","parse","e","startsWith","endsWith","result","Function","_","isObject","Array","isArray","err","YAML","$","async","waitGlobalInitialized","eventOn","Mvu","events","COMMAND_PARSED","variables","commands","command","new_data","stat_data","path","args","type","length","splice","set","collection","get","is_array","is_object","isPlainObject","value","at","push","assign","key_or_index","String","unset","safeParse","success","data"],"sourceRoot":""}