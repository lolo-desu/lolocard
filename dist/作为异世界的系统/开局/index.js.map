{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/external var \"$\"","src://tavern_helper_template/external var \"Vue\"","webpack://tavern_helper_template/./src/作为异世界的系统/开局/components/FieldGroupCard.vue?6225","webpack://tavern_helper_template/src/作为异世界的系统/开局/components/FieldGroupCard.vue?80b6","src://tavern_helper_template/src/作为异世界的系统/开局/fieldSchema.ts","src://tavern_helper_template/src/作为异世界的系统/开局/composables/useOpeningPanel.ts","webpack://tavern_helper_template/./src/作为异世界的系统/开局/App.vue?bb7f","webpack://tavern_helper_template/src/作为异世界的系统/开局/App.vue?9eaa","src://tavern_helper_template/src/作为异世界的系统/开局/index.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = $;","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { defineComponent as _defineComponent } from 'vue';\nimport { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, createTextVNode as _createTextVNode, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = { class: \"field-card\" };\nconst _hoisted_2 = { class: \"field-card__header\" };\nconst _hoisted_3 = { key: 0 };\nconst _hoisted_4 = { class: \"field-card__badge\" };\nconst _hoisted_5 = { class: \"field-card__label\" };\nconst _hoisted_6 = { key: 0 };\nconst _hoisted_7 = [\"type\", \"value\", \"placeholder\", \"min\", \"max\", \"onInput\"];\nconst _hoisted_8 = [\"value\", \"placeholder\", \"onInput\"];\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'FieldGroupCard',\n    props: {\n        group: {},\n        formState: {}\n    },\n    emits: [\"update:field\"],\n    setup(__props, { emit: __emit }) {\n        const emit = __emit;\n        function onInput(path, value) {\n            emit('update:field', path, value);\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"section\", _hoisted_1, [\n                _createElementVNode(\"header\", _hoisted_2, [\n                    _createElementVNode(\"div\", null, [\n                        _createElementVNode(\"h2\", null, _toDisplayString(__props.group.title), 1 /* TEXT */),\n                        (__props.group.description)\n                            ? (_openBlock(), _createElementBlock(\"p\", _hoisted_3, _toDisplayString(__props.group.description), 1 /* TEXT */))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _createElementVNode(\"span\", _hoisted_4, \"共 \" + _toDisplayString(__props.group.fields.length) + \" 项\", 1 /* TEXT */)\n                ]),\n                _createElementVNode(\"div\", {\n                    class: \"field-card__grid\",\n                    style: _normalizeStyle({ gridTemplateColumns: `repeat(${__props.group.columns ?? 1}, minmax(0, 1fr))` })\n                }, [\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(__props.group.fields, (field) => {\n                        return (_openBlock(), _createElementBlock(\"label\", {\n                            key: field.path,\n                            class: \"field-card__item\"\n                        }, [\n                            _createElementVNode(\"span\", _hoisted_5, [\n                                _createTextVNode(_toDisplayString(field.label) + \" \", 1 /* TEXT */),\n                                (field.note)\n                                    ? (_openBlock(), _createElementBlock(\"small\", _hoisted_6, _toDisplayString(field.note), 1 /* TEXT */))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]),\n                            (field.type !== 'textarea')\n                                ? (_openBlock(), _createElementBlock(\"input\", {\n                                    key: 0,\n                                    type: field.type === 'number' ? 'number' : 'text',\n                                    value: __props.formState[field.path] ?? '',\n                                    placeholder: field.placeholder,\n                                    min: field.type === 'number' ? field.min ?? 0 : undefined,\n                                    max: field.type === 'number' ? field.max ?? undefined : undefined,\n                                    onInput: ($event) => (onInput(field.path, $event.target.value))\n                                }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_7))\n                                : (_openBlock(), _createElementBlock(\"textarea\", {\n                                    key: 1,\n                                    value: __props.formState[field.path] ?? '',\n                                    placeholder: field.placeholder,\n                                    rows: \"3\",\n                                    onInput: ($event) => (onInput(field.path, $event.target.value))\n                                }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_8))\n                        ]));\n                    }), 128 /* KEYED_FRAGMENT */))\n                ], 4 /* STYLE */)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./FieldGroupCard.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./FieldGroupCard.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./FieldGroupCard.vue?vue&type=style&index=0&id=4a7ec898&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-4a7ec898\"]])\n\nexport default __exports__","export type FieldType = 'text' | 'textarea' | 'number';\n\nexport interface FieldConfig {\n  path: string;\n  label: string;\n  placeholder?: string;\n  type?: FieldType;\n  min?: number;\n  max?: number;\n  note?: string;\n  sync?: boolean;\n}\n\nexport interface FieldGroup {\n  key: string;\n  title: string;\n  description?: string;\n  columns?: number;\n  fields: FieldConfig[];\n}\n\nconst baseGroups: FieldGroup[] = [\n  {\n    key: 'system',\n    title: '系统配置',\n    description: '',\n    columns: 1,\n    fields: [\n      {\n        path: '系统状态.对主角可见形象',\n        label: '系统形象',\n        placeholder: '示例: 光翼向导',\n      },\n      {\n        path: '系统状态.玩家ID',\n        label: '玩家 ID',\n        placeholder: '示例: {{user}}',\n      },\n    ],\n  },\n  {\n    key: 'hero-basic',\n    title: '主角身份',\n    description: '',\n    columns: 1,\n    fields: [\n      {\n        path: '主角.姓名',\n        label: '姓名',\n        placeholder: '示例: 埃利欧特',\n      },\n      {\n        path: '主角.性别',\n        label: '性别',\n        placeholder: '男 / 女 / 其他',\n      },\n      {\n        path: '主角.年龄',\n        label: '年龄',\n        placeholder: '数字或描述',\n      },\n      {\n        path: '主角.人设',\n        label: '人设',\n        placeholder: '一句话概述角色气质、目标等',\n        type: 'textarea',\n        sync: false,\n      },\n    ],\n  },\n];\n\nexport const fieldGroups: FieldGroup[] = baseGroups;\n","import { computed, reactive, ref } from 'vue';\nimport get from 'lodash/get';\nimport set from 'lodash/set';\nimport { klona } from 'klona';\nimport type { FieldConfig, FieldGroup } from '../fieldSchema';\n\ntype FormState = Record<string, string>;\n\nconst trimValue = (value: string | undefined) => (value ?? '').trim();\n\nexport function useOpeningPanel(groups: FieldGroup[]) {\n  const messageId = ref<number | null>(null);\n  const isReady = ref(false);\n  const isSubmitting = ref(false);\n  const errorMessage = ref('');\n  const confirmation = ref('');\n\n  const formState = reactive<FormState>({});\n  const fieldList = groups.flatMap((group) => group.fields);\n  const syncedFields = fieldList.filter((field) => field.sync !== false);\n  const messageOnlyFields = fieldList.filter((field) => field.sync === false);\n\n  const pendingEmptyFields = computed(() =>\n    syncedFields.filter((field) => trimValue(formState[field.path]) === '')\n  );\n\n  const pendingEmptyPaths = computed(() =>\n    pendingEmptyFields.value.map((field) => field.path)\n  );\n\n  const canSubmit = computed(() => isReady.value && !isSubmitting.value);\n\n  const initialized = initialize();\n\n  function readField(field: FieldConfig, statData: Record<string, unknown>) {\n    const raw = get(statData, field.path);\n    if (raw === undefined || raw === null || raw === '待初始化') {\n      return '';\n    }\n    return String(raw);\n  }\n\n  function parseFieldValue(field: FieldConfig, value: string) {\n    if (field.type === 'number') {\n      const numeric = Number(value);\n      if (Number.isFinite(numeric)) {\n        return numeric;\n      }\n      return undefined;\n    }\n\n    return value;\n  }\n\n  async function initialize() {\n    try {\n      await waitGlobalInitialized('Mvu');\n      messageId.value = getCurrentMessageId();\n      const data = Mvu.getMvuData({ type: 'message', message_id: messageId.value });\n      fieldList.forEach((field) => {\n        if (field.sync === false) {\n          formState[field.path] = '';\n          return;\n        }\n        formState[field.path] = readField(field, data.stat_data);\n      });\n      isReady.value = true;\n      return data;\n    } catch (error) {\n      errorMessage.value = error instanceof Error ? error.message : '加载界面失败';\n      return null;\n    }\n  }\n\n  async function handleSubmit() {\n    if (!canSubmit.value || !messageId.value) {\n      return;\n    }\n\n    isSubmitting.value = true;\n    errorMessage.value = '';\n    confirmation.value = '';\n\n    try {\n      const current = await initialized;\n      if (!current) {\n        throw new Error('变量未准备好, 请稍后重试');\n      }\n\n      const nextData = klona(current);\n      syncedFields.forEach((field) => {\n        const value = trimValue(formState[field.path]);\n        if (value !== '') {\n          const parsed = parseFieldValue(field, value);\n          if (parsed !== undefined) {\n            set(nextData.stat_data, field.path, parsed);\n          }\n        }\n      });\n\n      await Mvu.replaceMvuData(nextData, { type: 'message', message_id: messageId.value });\n\n      const payloadLines: string[] = [];\n      messageOnlyFields.forEach((field) => {\n        const value = trimValue(formState[field.path]);\n        if (value) {\n          payloadLines.push(`${field.label}: ${value}`);\n        }\n      });\n\n      payloadLines.push(\n        ...pendingEmptyFields.value.map((field) => `${field.path}: [未填写]`)\n      );\n      payloadLines.push('/初始化角色/');\n\n      const payload = payloadLines.join('\\n');\n      await createChatMessages([{ role: 'user', content: payload }]);\n\n      confirmation.value = '已提交, 请等待系统初始化';\n    } catch (error) {\n      errorMessage.value =\n        error instanceof Error ? error.message : '提交失败, 请稍后重试';\n    } finally {\n      isSubmitting.value = false;\n    }\n  }\n\n  return {\n    formState,\n    isReady,\n    isSubmitting,\n    errorMessage,\n    confirmation,\n    pendingEmptyPaths,\n    pendingEmptyFields,\n    canSubmit,\n    handleSubmit,\n  };\n}\n","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, unref as _unref, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode } from \"vue\";\nconst _hoisted_1 = { class: \"opening-panel\" };\nconst _hoisted_2 = { class: \"panel-grid\" };\nconst _hoisted_3 = { class: \"panel-footer\" };\nconst _hoisted_4 = { class: \"panel-footer__messages\" };\nconst _hoisted_5 = {\n    key: 0,\n    class: \"feedback feedback--error\"\n};\nconst _hoisted_6 = {\n    key: 1,\n    class: \"feedback feedback--success\"\n};\nconst _hoisted_7 = [\"disabled\"];\nimport FieldGroupCard from './components/FieldGroupCard.vue';\nimport { fieldGroups } from './fieldSchema';\nimport { useOpeningPanel } from './composables/useOpeningPanel';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const { formState, isReady, isSubmitting, errorMessage, confirmation, canSubmit, handleSubmit, } = useOpeningPanel(fieldGroups);\n        function updateField(path, value) {\n            formState[path] = value;\n        }\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _cache[1] || (_cache[1] = _createElementVNode(\"header\", { class: \"opening-panel__hero\" }, [\n                    _createElementVNode(\"h1\", null, \"开局设定\")\n                ], -1 /* CACHED */)),\n                _createElementVNode(\"div\", _hoisted_2, [\n                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(fieldGroups), (group) => {\n                        return (_openBlock(), _createBlock(FieldGroupCard, {\n                            key: group.key,\n                            group: group,\n                            \"form-state\": _unref(formState),\n                            \"onUpdate:field\": updateField\n                        }, null, 8 /* PROPS */, [\"group\", \"form-state\"]));\n                    }), 128 /* KEYED_FRAGMENT */))\n                ]),\n                _createElementVNode(\"footer\", _hoisted_3, [\n                    _createElementVNode(\"div\", _hoisted_4, [\n                        (_unref(errorMessage))\n                            ? (_openBlock(), _createElementBlock(\"p\", _hoisted_5, _toDisplayString(_unref(errorMessage)), 1 /* TEXT */))\n                            : _createCommentVNode(\"v-if\", true),\n                        (_unref(confirmation))\n                            ? (_openBlock(), _createElementBlock(\"p\", _hoisted_6, _toDisplayString(_unref(confirmation)), 1 /* TEXT */))\n                            : _createCommentVNode(\"v-if\", true)\n                    ]),\n                    _createElementVNode(\"button\", {\n                        disabled: !_unref(canSubmit),\n                        onClick: _cache[0] || (_cache[0] =\n                            //@ts-ignore\n                            (...args) => (_unref(handleSubmit) && _unref(handleSubmit)(...args)))\n                    }, _toDisplayString(_unref(isSubmitting) ? '提交中...' : '开始游戏'), 9 /* TEXT, PROPS */, _hoisted_7)\n                ])\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=149e00b6&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.24_typescript@6.0.0-dev.20250807__webpack@5.102.1/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-149e00b6\"]])\n\nexport default __exports__","import $ from 'jquery';\nimport { createApp, type App as VueApp } from 'vue';\nimport App from './App.vue';\nimport './index.scss';\n\nlet vueApp: VueApp<Element> | null = null;\n\n$(() => {\n  vueApp = createApp(App);\n  vueApp.mount('#app');\n});\n\n$(window).on('pagehide', () => {\n  if (vueApp) {\n    vueApp.unmount();\n    vueApp = null;\n  }\n});\n"],"names":["exports","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","n","getter","__esModule","d","a","definition","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","$","Vue","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","__name","group","formState","emits","setup","__props","emit","__emit","onInput","path","value","_ctx","_cache","title","description","fields","length","style","gridTemplateColumns","columns","field","label","note","type","placeholder","min","max","$event","rows","fieldGroups","sync","trimValue","trim","useOpeningPanel","groups","messageId","ref","isReady","isSubmitting","errorMessage","confirmation","reactive","fieldList","flatMap","syncedFields","filter","messageOnlyFields","pendingEmptyFields","computed","pendingEmptyPaths","map","canSubmit","initialized","async","waitGlobalInitialized","getCurrentMessageId","data","Mvu","getMvuData","message_id","forEach","statData","raw","String","readField","stat_data","error","Error","message","initialize","handleSubmit","current","nextData","parsed","numeric","Number","isFinite","parseFieldValue","replaceMvuData","payloadLines","push","payload","join","createChatMessages","role","content","updateField","FieldGroupCard","disabled","onClick","args","vueApp","createApp","App","mount","window","on","unmount"],"sourceRoot":""}