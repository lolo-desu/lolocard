var e={48:()=>{function e(e){$('#range_block_openai :input').prop('disabled',e),$('#openai_settings > div:first-child :input').prop('disabled',e),$('#stream_toggle').prop('disabled',!1),$('#openai_show_thoughts').prop('disabled',!1)}$(()=>{e(!0)}),$(window).on('unload',()=>e(!1))},53:()=>{eventOn(tavern_events.MESSAGE_UPDATED,e=>{toastr.error(`è°è®©ä½ åŠ¨æˆ‘ç¬¬ ${e} æ¥¼æ¶ˆæ¯çš„ğŸ˜¡`,'å¹²ä»€ä¹ˆ!')})},810:()=>{$(()=>{toastr.success('ä½ å·²ç»æˆåŠŸåŠ è½½ç¤ºä¾‹è„šæœ¬!','æ­å–œä½ !')}),$(window).on('unload',()=>{toastr.info('ä½ å·²ç»å¸è½½ç¤ºä¾‹è„šæœ¬!','å†è§!')})}},t={};function o(n){var a=t[n];if(void 0!==a)return a.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}o(810);const n='é…’é¦†åŠ©æ‰‹ç¼–å†™ç¤ºä¾‹',a=/```\S*\s*<roleplay_options>(.*)<\/roleplay_options>\s*```/is;var r,s;async function i(e){const t=getChatMessages(e)[0].message.match(a);if(!t)return;const o=s.extract_roleplay_options_element(t[1]),n=retrieveDisplayedMessage(e),r=n.find('.roleplay_options, pre:contains("<roleplay_options>")');r.length>0&&(r.remove(),n.append(o))}async function l(){$('#chat').children('.mes[is_user=\'false\'][is_system=\'false\']').each((e,t)=>{i(Number(t.getAttribute('mesid')))})}function p(){const e=$('.mes[is_user="false"][is_system="false"]').last().find('.roleplay_options_content').map((e,t)=>$(t).text().trim()).toArray();triggerSlash(`/send ${0===e.length?'ç»§ç»­æ¨è¿›':_.sample(e)} || /trigger`)}!function(e){const t={input_mode:'ç›´æ¥å‘é€'};e.update=async function(){const o=e.option;return e.option=await async function(){const e=_.merge({},...(await getLorebookEntries(n)).filter(e=>e.comment.startsWith('è®¾ç½®-')&&e.enabled).map(e=>{const t=e.comment.replace('è®¾ç½®-','');return{[t]:e.content}})),o=t;return _.has(e,'ç›´æ¥å‘é€')?o.input_mode='ç›´æ¥å‘é€':_.has(e,'è¦†ç›–è¾“å…¥')?o.input_mode='è¦†ç›–è¾“å…¥':_.has(e,'å°¾é™„è¾“å…¥')&&(o.input_mode='å°¾é™„è¾“å…¥'),o}(),!_.isEqual(e.option,o)}}(r||(r={})),function(e){let t;e.update=async function(){const e=t;return t=await async function(){const e=(await getLorebookEntries(n)).filter(e=>e.comment.startsWith('æ ·å¼-')&&e.enabled);return 0===e.length?'<style>.roleplay_options_back{background:linear-gradient(160deg, rgba(45, 45, 45, 0.75), rgba(35, 35, 35, 0.85));border-radius:14px;box-shadow:0 10px 28px rgba(0,0,0,.15),0 3px 10px rgba(0,0,0,.12);padding:16px 18px;display:flex;flex-direction:column;gap:10px;border:1px solid hsla(0,0%,100%,.06);max-width:100%;margin:20px 0}.roleplay_options_title{font-size:.94em;font-weight:600;color:#f0f0f0;padding-right:12px;letter-spacing:.02em;text-align:left;margin-bottom:4px}.roleplay_options_content{font-size:.94em;line-height:1.55;color:#c6c6c6;font-weight:normal;transition:color .25s ease;text-align:left;flex:1;letter-spacing:.015em;overflow-wrap:anywhere}.roleplay_options_content:not(:empty):not(.short-content)~.roleplay_options_title{width:100%;margin-bottom:8px;border-bottom:1px solid hsla(0,0%,100%,.08);padding-bottom:6px}.roleplay_options_content.short-content{flex:1}.roleplay_options_hr{display:none}.roleplay_options_item{position:relative;background:rgba(50,50,50,.65);border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.1);padding:14px 16px;cursor:default;border:1px solid hsla(0,0%,100%,.04);transition:all .25s cubic-bezier(0.25, 0.8, 0.25, 1);overflow:hidden;display:flex;flex-wrap:wrap;align-items:flex-start;z-index:1;margin:2px 0;color:#d8d8d8;font-weight:400;line-height:1.5}.roleplay_options_item::after{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg, rgba(90, 90, 90, 0.06) 0%, transparent 70%);opacity:0;transition:opacity .3s ease;z-index:-1}.roleplay_options_item:before{content:"";position:absolute;top:0;left:0;width:3px;height:100%;background:linear-gradient(to bottom, rgba(160, 160, 160, 0.6), rgba(180, 180, 180, 0.3));transform:scaleY(0);transform-origin:top;transition:transform .3s cubic-bezier(0.4, 0, 0.2, 1)}.last_mes .roleplay_options_item{cursor:pointer}.last_mes .roleplay_options_item:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,.15);background:rgba(58,58,58,.75);border-color:rgba(200,200,200,.12)}.last_mes .roleplay_options_item:hover::after{opacity:1}.last_mes .roleplay_options_item:hover .roleplay_options_content{color:#e2e2e2}.last_mes .roleplay_options_item:active{transform:translateY(-1px);box-shadow:0 3px 8px rgba(0,0,0,.12)}.last_mes .roleplay_options_item:hover:before{transform:scaleY(1)}@media(max-width: 768px){.roleplay_options_back{padding:14px;gap:8px}.roleplay_options_item{padding:12px 14px}.roleplay_options_title{font-size:.9em;padding-right:10px}.roleplay_options_content{font-size:.9em;line-height:1.5}}@media(prefers-reduced-motion: reduce){.roleplay_options_item{transition:none}.roleplay_options_item::before,.roleplay_options_item::after{transition:none}.roleplay_options_content,.roleplay_options_title{transition:none}}</style>':e[0].content}(),!_.isEqual(t,e)},e.extract_roleplay_options_element=function(e){const o=$('<div class="roleplay_options">');return o.append(t),o.append($('<div class="roleplay_options_back">').append([...e.matchAll(/(.+?)[:ï¼š]\s*(.+)/gm)].map(e=>({title:e[1],content:e[2].replace(/^\$\{(.+)\}$/,'$1').replace(/^ã€Œ(.+)ã€$/,'$1')})).map(({title:e,content:t})=>$('<div class="roleplay_options_item" tabindex="1">').on('click',function(){!async function(e){if(e.parents('.last_mes').length>0){const t=e.find('.roleplay_options_content').text().trim();if('ç›´æ¥å‘é€'===r.option.input_mode)triggerSlash(`/send ${t} || /trigger`);else if('è¦†ç›–è¾“å…¥'===r.option.input_mode)triggerSlash(`/setinput ${t}`);else if('å°¾é™„è¾“å…¥'===r.option.input_mode){const e=$('#send_textarea').val();$('#send_textarea').val([e,t].join('\n')||'')[0].dispatchEvent(new Event('input',{bubbles:!0}))}}}($(this))}).append(`<span class="roleplay_options_title"><strong>${e}</strong></span>`).append('<hr class="roleplay_options_hr">').append(`<span class="roleplay_options_content">${t}</span>`)))),o}}(s||(s={})),$(async()=>{await errorCatched(r.update)(),await errorCatched(s.update)(),await l(),eventOn(tavern_events.CHAT_CHANGED,errorCatched(l)),eventOn(tavern_events.CHARACTER_MESSAGE_RENDERED,errorCatched(i)),eventOn(tavern_events.MESSAGE_UPDATED,errorCatched(i)),eventOn(tavern_events.MESSAGE_SWIPED,errorCatched(i)),eventOn(tavern_events.MESSAGE_DELETED,()=>setTimeout(errorCatched(l),1e3)),eventOn(tavern_events.WORLDINFO_UPDATED,errorCatched(async e=>{e===n&&(await r.update()||await s.update())&&await l()}))});let c=null;function d(){null!==c&&(setTimeout(p,_.get(getVariables({type:'global'}),[n,'è‡ªåŠ¨æ¨è¿›å‘é€é—´éš”'],3e3)),++c,c===_.get(getVariables({type:'global'}),[n,'è‡ªåŠ¨æ¨è¿›å¾ªç¯æ¬¡æ•°'],-1)&&g())}function g(){eventRemoveListener(tavern_events.CHARACTER_MESSAGE_RENDERED,d),c=null,toastr.success('å·²åœæ­¢è‡ªåŠ¨æ¨è¿›',n)}$(async()=>{eventOnButton('è®¾ç½®å¾ªç¯æ¬¡æ•°',async()=>{const e=Number(await SillyTavern.callGenericPopup('è®¾ç½®å¾ªç¯æ¬¡æ•° (-1 ä¸ºç›´åˆ°æŒ‰ä¸‹ \'åœæ­¢è‡ªåŠ¨æ¨è¿›\')',SillyTavern.POPUP_TYPE.INPUT,_.get(getVariables({type:'global'}),[n,'è‡ªåŠ¨æ¨è¿›å¾ªç¯æ¬¡æ•°'],'-1')));-1!==e&&e<=0?toastr.error('å¾ªç¯æ¬¡æ•°è¦ä¹ˆæ˜¯ -1, è¦ä¹ˆæ˜¯å¤§äº 0 çš„æ•´æ•°'):(insertOrAssignVariables({[n]:{è‡ªåŠ¨æ¨è¿›å¾ªç¯æ¬¡æ•°:e}},{type:'global'}),-1===e?toastr.success('å·²è®¾ç½®æ¨è¿›æ¬¡æ•°ä¸º -1, å³ç›´åˆ°æŒ‰ä¸‹ "åœæ­¢è‡ªåŠ¨æ¨è¿›" æ‰ä¼šåœæ­¢',n):toastr.success(`å·²è®¾ç½®æ¨è¿›æ¬¡æ•°ä¸º ${e} æ¬¡`,n))}),eventOnButton('è®¾ç½®å‘é€é—´éš”',async()=>{const e=Number(await SillyTavern.callGenericPopup('è®¾ç½®å‘é€é—´éš” (å•ä½: æ¯«ç§’)',SillyTavern.POPUP_TYPE.INPUT,_.get(getVariables({type:'global'}),[n,'è‡ªåŠ¨æ¨è¿›å‘é€é—´éš”'],'3000')));e<=0?toastr.error('å‘é€é—´éš”å¿…é¡»å¤§äº 0'):(insertOrAssignVariables({[n]:{è‡ªåŠ¨æ¨è¿›å‘é€é—´éš”:e}},{type:'global'}),toastr.success(`å·²è®¾ç½®å‘é€é—´éš”ä¸º ${e} æ¯«ç§’`,n))}),eventOnButton('å¯åŠ¨è‡ªåŠ¨æ¨è¿›',()=>{null===c?(c=0,d(),eventOn(tavern_events.CHARACTER_MESSAGE_RENDERED,d),toastr.success('å·²å¼€å¯è‡ªåŠ¨æ¨è¿›',n)):toastr.error('è‡ªåŠ¨æ¨è¿›åœ¨ä¹‹å‰å·²å¼€å¯, è¯·å…ˆåœæ­¢è‡ªåŠ¨æ¨è¿›')}),eventOnButton('åœæ­¢è‡ªåŠ¨æ¨è¿›',g)});o(48),o(53);