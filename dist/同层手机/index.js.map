{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/src//debug-logger.ts","src://tavern_helper_template/src//dialog-manager.ts","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/src//event-manager.ts","src://tavern_helper_template/src//script.ts","src://tavern_helper_template/src//utils.ts","src://tavern_helper_template/src//ai-response-manager.ts","src://tavern_helper_template/src//config-manager.ts","src://tavern_helper_template/src//debug-data.ts","src://tavern_helper_template/src//input-handler.ts","src://tavern_helper_template/src//moments-manager.ts","src://tavern_helper_template/src//theme-editor.ts","src://tavern_helper_template/src//theme-manager.ts","src://tavern_helper_template/src//ui-manager.ts","src://tavern_helper_template/src//ui-renderer.ts","src://tavern_helper_template/src//wallpaper-selector.ts","src://tavern_helper_template/src//wallpaper-controller.ts","src://tavern_helper_template/src//app-controller.ts","src://tavern_helper_template/src//style-manager.ts","src://tavern_helper_template/src//index.ts","src://tavern_helper_template/src//event-handler.ts"],"sourcesContent":["/**\n * \n *  console.log \n */\n\nexport enum LogLevel {\n  DEBUG = 0,\n  INFO = 1,\n  WARN = 2,\n  ERROR = 3,\n}\n\nexport class DebugLogger {\n  private static instance: DebugLogger;\n  private isDevelopment: boolean;\n  private logLevel: LogLevel;\n  private logHistory: Array<{ timestamp: Date; level: LogLevel; module: string; message: string; data?: any }> = [];\n  private maxHistorySize: number = 1000;\n\n  private constructor() {\n    // \n    this.isDevelopment = this.checkDevelopmentMode();\n    this.logLevel = this.isDevelopment ? LogLevel.DEBUG : LogLevel.ERROR;\n  }\n\n  static getInstance(): DebugLogger {\n    if (!DebugLogger.instance) {\n      DebugLogger.instance = new DebugLogger();\n    }\n    return DebugLogger.instance;\n  }\n\n  /**\n   * \n   */\n  private checkDevelopmentMode(): boolean {\n    // \n    return !!(\n      (window as any).BLMX_DEV_MODE ||\n      (window as any).DEBUG ||\n      localStorage.getItem('blmx_debug') === 'true' ||\n      location.hostname === 'localhost' ||\n      location.hostname === '127.0.0.1' ||\n      location.search.includes('debug=true')\n    );\n  }\n\n  /**\n   * \n   */\n  setLogLevel(level: LogLevel): void {\n    this.logLevel = level;\n  }\n\n  /**\n   * /\n   */\n  setDevelopmentMode(enabled: boolean): void {\n    this.isDevelopment = enabled;\n    if (enabled) {\n      localStorage.setItem('blmx_debug', 'true');\n    } else {\n      localStorage.removeItem('blmx_debug');\n    }\n  }\n\n  /**\n   * \n   */\n  private addToHistory(level: LogLevel, module: string, message: string, data?: any): void {\n    this.logHistory.push({\n      timestamp: new Date(),\n      level,\n      module,\n      message,\n      data,\n    });\n\n    // \n    if (this.logHistory.length > this.maxHistorySize) {\n      this.logHistory.shift();\n    }\n  }\n\n  /**\n   * \n   */\n  private formatMessage(module: string, message: string): string {\n    const timestamp = new Date().toISOString().substr(11, 12);\n    return `[${timestamp}] [BLMX:${module}] ${message}`;\n  }\n\n  /**\n   * \n   */\n  debug(module: string, message: string, data?: any): void {\n    if (this.logLevel <= LogLevel.DEBUG && this.isDevelopment) {\n      console.log(this.formatMessage(module, message), data || '');\n      this.addToHistory(LogLevel.DEBUG, module, message, data);\n    }\n  }\n\n  /**\n   * \n   */\n  info(module: string, message: string, data?: any): void {\n    if (this.logLevel <= LogLevel.INFO && this.isDevelopment) {\n      console.info(this.formatMessage(module, message), data || '');\n      this.addToHistory(LogLevel.INFO, module, message, data);\n    }\n  }\n\n  /**\n   * \n   */\n  warn(module: string, message: string, data?: any): void {\n    if (this.logLevel <= LogLevel.WARN) {\n      console.warn(this.formatMessage(module, message), data || '');\n      this.addToHistory(LogLevel.WARN, module, message, data);\n    }\n  }\n\n  /**\n   * \n   */\n  error(module: string, message: string, data?: any): void {\n    console.error(this.formatMessage(module, message), data || '');\n    this.addToHistory(LogLevel.ERROR, module, message, data);\n  }\n\n  /**\n   * \n   */\n  timeStart(module: string, label: string): void {\n    if (this.isDevelopment) {\n      console.time(this.formatMessage(module, label));\n    }\n  }\n\n  /**\n   * \n   */\n  timeEnd(module: string, label: string): void {\n    if (this.isDevelopment) {\n      console.timeEnd(this.formatMessage(module, label));\n    }\n  }\n\n  /**\n   * \n   */\n  groupStart(module: string, title: string): void {\n    if (this.isDevelopment) {\n      console.group(this.formatMessage(module, title));\n    }\n  }\n\n  /**\n   * \n   */\n  groupEnd(): void {\n    if (this.isDevelopment) {\n      console.groupEnd();\n    }\n  }\n\n  /**\n   * \n   */\n  getHistory(filterModule?: string, filterLevel?: LogLevel): typeof this.logHistory {\n    let filtered = this.logHistory;\n\n    if (filterModule) {\n      filtered = filtered.filter(log => log.module === filterModule);\n    }\n\n    if (filterLevel !== undefined) {\n      filtered = filtered.filter(log => log.level >= filterLevel);\n    }\n\n    return filtered;\n  }\n\n  /**\n   * \n   */\n  clearHistory(): void {\n    this.logHistory = [];\n  }\n\n  /**\n   * JSON\n   */\n  exportHistory(): string {\n    return JSON.stringify(this.logHistory, null, 2);\n  }\n\n  /**\n   * \n   */\n  showDebugPanel(): void {\n    if (!this.isDevelopment) {\n      console.warn('');\n      return;\n    }\n\n    console.group(' BLMX ');\n    console.log(':', this.isDevelopment);\n    console.log(':', LogLevel[this.logLevel]);\n    console.log(':', this.logHistory.length);\n    \n    if (this.logHistory.length > 0) {\n      console.log(':');\n      this.logHistory.slice(-10).forEach(log => {\n        const levelIcon = ['', '', '', ''][log.level];\n        console.log(`${levelIcon} [${log.module}] ${log.message}`, log.data || '');\n      });\n    }\n    \n    console.groupEnd();\n  }\n\n  /**\n   * \n   */\n  getStatus(): {\n    isDevelopment: boolean;\n    logLevel: string;\n    historyCount: number;\n  } {\n    return {\n      isDevelopment: this.isDevelopment,\n      logLevel: LogLevel[this.logLevel],\n      historyCount: this.logHistory.length,\n    };\n  }\n}\n\n// \nexport const logger = DebugLogger.getInstance();\n\n// \nif (typeof window !== 'undefined' && logger.getStatus().isDevelopment) {\n  (window as any).blmxLogger = logger;\n}\n","/**\n * \n * alertconfirmprompt\n */\n\n// \ntype DialogType = 'alert' | 'confirm' | 'prompt';\n\n// \ninterface DialogOptions {\n  title?: string;\n  message: string;\n  type: DialogType;\n  inputType?: string;\n  inputPlaceholder?: string;\n  inputValue?: string;\n  confirmText?: string;\n  cancelText?: string;\n  className?: string;\n}\n\nexport class DialogManager {\n  private static instance: DialogManager;\n  private activeDialog: HTMLElement | null = null;\n  private activeOverlay: HTMLElement | null = null;\n\n  private constructor() {\n    // \n  }\n\n  /**\n   * \n   */\n  public static getInstance(): DialogManager {\n    if (!DialogManager.instance) {\n      DialogManager.instance = new DialogManager();\n    }\n    return DialogManager.instance;\n  }\n\n  /**\n   * HTML\n   */\n  private escapeHtml(text: string): string {\n    return $('<div>').text(text).html();\n  }\n\n  /**\n   *  - \n   */\n  private async safeShowDialog<T>(dialogFunction: () => Promise<T>): Promise<T> {\n    // \n    this.forceCleanupDialogs();\n\n    return await dialogFunction();\n  }\n\n  /**\n   * \n   */\n  private createBaseDialogElements(dialogClass: string): void {\n    this.activeOverlay = $('<div>').addClass('dialog-overlay mobile-dialog-overlay')[0] as HTMLElement;\n    this.activeDialog = $('<div>').addClass(`dialog ${dialogClass} mobile-dialog`)[0] as HTMLElement;\n  }\n\n  /**\n   * \n   */\n  private appendDialogToPage(): void {\n    if (!this.activeOverlay) return;\n\n    const $phoneScreen = $('.phone-screen');\n    if ($phoneScreen.length) {\n      $phoneScreen.append(this.activeOverlay);\n    } else {\n      // body\n      $('body').append(this.activeOverlay);\n    }\n  }\n\n  /**\n   * checkbox\n   */\n  private initializeCheckboxButtons(): void {\n    if (!this.activeDialog) return;\n\n    $(this.activeDialog)\n      .find('.checkbox-button')\n      .each((_, button) => {\n        const $button = $(button);\n        const $checkbox = $button.find('input[type=\"checkbox\"]');\n        if (!$checkbox.length) return;\n\n        const checkbox = $checkbox[0] as HTMLInputElement;\n\n        // \n        this.updateCheckboxButtonState(button as HTMLElement, checkbox.checked);\n\n        // \n        $button.on('click', e => {\n          e.preventDefault();\n          e.stopPropagation();\n\n          if (checkbox.disabled) return;\n\n          // \n          checkbox.checked = !checkbox.checked;\n          this.updateCheckboxButtonState(button as HTMLElement, checkbox.checked);\n\n          // change - \n          const changeEvent = new Event('change', { bubbles: true });\n          checkbox.dispatchEvent(changeEvent);\n        });\n\n        // \n        $checkbox.on('change', () => {\n          this.updateCheckboxButtonState(button as HTMLElement, checkbox.checked);\n        });\n\n        // \n        $button.attr({\n          role: 'checkbox',\n          tabindex: '0',\n          'aria-checked': checkbox.checked.toString(),\n        });\n      });\n  }\n\n  /**\n   * checkbox\n   */\n  private updateCheckboxButtonState(button: HTMLElement, checked: boolean): void {\n    const $button = $(button);\n    $button.toggleClass('checked', checked);\n    $button.attr('aria-checked', checked.toString());\n  }\n\n  /**\n   * alert\n   */\n  public alert(message: string, title = '', confirmText = ''): Promise<void> {\n    return this.safeShowDialog(() =>\n      this.showDialog({\n        type: 'alert',\n        title,\n        message,\n        confirmText,\n      }),\n    );\n  }\n\n  /**\n   * confirm\n   */\n  public confirm(message: string, title = '', confirmText = '', cancelText = ''): Promise<boolean> {\n    return this.safeShowDialog(\n      () =>\n        this.showDialog({\n          type: 'confirm',\n          title,\n          message,\n          confirmText,\n          cancelText,\n        }) as Promise<boolean>,\n    );\n  }\n\n  /**\n   * prompt\n   */\n  public prompt(\n    message: string,\n    defaultValue = '',\n    title = '',\n    confirmText = '',\n    cancelText = '',\n    inputType = 'text',\n    placeholder = '',\n  ): Promise<string | null> {\n    return this.safeShowDialog(\n      () =>\n        this.showDialog({\n          type: 'prompt',\n          title,\n          message,\n          confirmText,\n          cancelText,\n          inputType,\n          inputValue: defaultValue,\n          inputPlaceholder: placeholder,\n        }) as Promise<string | null>,\n    );\n  }\n\n  /**\n   * \n   */\n  public showScrollableText(content: string, title = '', confirmText = ''): Promise<void> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('scrollable-text-dialog');\n\n          // \n          this.activeDialog!.innerHTML = `\n          <div class=\"dialog-header\">\n            <h3>${title}</h3>\n          </div>\n          <div class=\"dialog-body scrollable-content\">\n            <pre class=\"scrollable-text\">${this.escapeHtml(content)}</pre>\n          </div>\n          <div class=\"dialog-footer\">\n            <button class=\"dialog-button copy-btn\"></button>\n            <button class=\"dialog-button primary-button\">${confirmText}</button>\n          </div>\n        `;\n\n          const $copyBtn = $(this.activeDialog!).find('.copy-btn');\n          const $confirmBtn = $(this.activeDialog!).find('.primary-button');\n\n          const handleCopy = async () => {\n            try {\n              await navigator.clipboard.writeText(content);\n              // \n              const originalText = $copyBtn.text();\n              $copyBtn.text('');\n              setTimeout(() => {\n                $copyBtn.text(originalText);\n              }, 1000);\n            } catch (error) {\n              console.error(':', error);\n              // \n              const $textElement = $(this.activeDialog!).find('.scrollable-text');\n              if ($textElement.length) {\n                const range = document.createRange();\n                range.selectNodeContents($textElement[0]);\n                const selection = window.getSelection();\n                if (selection) {\n                  selection.removeAllRanges();\n                  selection.addRange(range);\n                }\n              }\n            }\n          };\n\n          const handleConfirm = () => {\n            this.closeDialog();\n            resolve();\n          };\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve();\n          };\n\n          $copyBtn.on('click', handleCopy);\n          $confirmBtn.on('click', handleConfirm);\n\n          // ESC\n          $(document).on('keydown.dialog', (e: any) => {\n            if (e.key === 'Escape') {\n              handleCancel();\n              $(document).off('keydown.dialog');\n            }\n          });\n\n          // \n          $(this.activeOverlay!).append(this.activeDialog!);\n          this.appendDialogToPage();\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  private showDialog(options: DialogOptions): Promise<any> {\n    // \n    const { overlay, dialog } = this.createDialogElements(options);\n\n    // \n    this.activeOverlay = overlay;\n    this.activeDialog = dialog;\n\n    // \n    this.appendDialogToPage();\n\n    // \n    if (options.type === 'prompt') {\n      const $inputEl = $(dialog).find('input, textarea');\n      if ($inputEl.length) {\n        setTimeout(() => $inputEl.trigger('focus'), 100);\n      }\n    }\n\n    return new Promise(resolve => {\n      // \n      const confirmButton = dialog.querySelector('.primary-button');\n      if (confirmButton) {\n        confirmButton.addEventListener('click', () => {\n          if (options.type === 'prompt') {\n            const inputEl = dialog.querySelector('input, textarea') as HTMLInputElement;\n            const value = inputEl ? inputEl.value : null;\n            this.closeDialog();\n            resolve(value);\n          } else {\n            this.closeDialog();\n            resolve(options.type === 'confirm' ? true : undefined);\n          }\n        });\n      }\n\n      // \n      const cancelButton = dialog.querySelector('.cancel-button');\n      if (cancelButton) {\n        cancelButton.addEventListener('click', () => {\n          this.closeDialog();\n          resolve(options.type === 'prompt' ? null : false);\n        });\n      }\n\n      // alert\n      if (options.type === 'alert') {\n        overlay.addEventListener('click', e => {\n          if (e.target === overlay) {\n            this.closeDialog();\n            resolve(undefined);\n          }\n        });\n      }\n\n      // \n      const handleKeyDown = (e: KeyboardEvent) => {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          if (options.type === 'prompt') {\n            const inputEl = dialog.querySelector('input, textarea') as HTMLInputElement;\n            const value = inputEl ? inputEl.value : null;\n            this.closeDialog();\n            resolve(value);\n          } else if (options.type === 'confirm') {\n            this.closeDialog();\n            resolve(true);\n          } else {\n            // alert\n            this.closeDialog();\n            resolve(undefined);\n          }\n          document.removeEventListener('keydown', handleKeyDown);\n        } else if (e.key === 'Escape') {\n          e.preventDefault();\n          this.closeDialog();\n          resolve(options.type === 'prompt' ? null : false);\n          document.removeEventListener('keydown', handleKeyDown);\n        }\n      };\n      document.addEventListener('keydown', handleKeyDown);\n    });\n  }\n\n  /**\n   * \n   */\n  private createDialogElements(options: DialogOptions): { overlay: HTMLElement; dialog: HTMLElement } {\n    // \n    const $overlay = $('<div>').addClass('custom-dialog-overlay');\n\n    // \n    const $dialog = $('<div>').addClass(`custom-dialog ${options.className || ''}`);\n\n    // \n    const $header = $('<div>').addClass('dialog-header');\n    const $title = $('<h3>')\n      .addClass('dialog-title')\n      .text(options.title || '');\n    $header.append($title);\n    $dialog.append($header);\n\n    // \n    const $body = $('<div>').addClass('dialog-body');\n\n    // \n    const $message = $('<div>').text(options.message);\n    $body.append($message);\n\n    // prompt\n    if (options.type === 'prompt') {\n      const $inputContainer = $('<div>').addClass('dialog-input-container');\n      const $input = $(options.inputType === 'textarea' ? '<textarea>' : '<input>');\n\n      if (options.inputType !== 'textarea') {\n        $input.attr('type', options.inputType || 'text');\n      }\n\n      if (options.inputValue) {\n        $input.val(options.inputValue);\n      }\n\n      if (options.inputPlaceholder) {\n        $input.attr('placeholder', options.inputPlaceholder);\n      }\n\n      $inputContainer.append($input);\n      $body.append($inputContainer);\n    }\n\n    $dialog.append($body);\n\n    // \n    const $footer = $('<div>').addClass('dialog-footer');\n\n    // \n    if (options.type === 'confirm' || options.type === 'prompt') {\n      const $cancelButton = $('<button>')\n        .addClass('dialog-button cancel-button')\n        .text(options.cancelText || '');\n      $footer.append($cancelButton);\n    }\n\n    const $confirmButton = $('<button>')\n      .addClass('dialog-button primary-button')\n      .text(options.confirmText || '');\n    $footer.append($confirmButton);\n\n    $dialog.append($footer);\n    $overlay.append($dialog);\n\n    return { overlay: $overlay[0], dialog: $dialog[0] };\n  }\n\n  /**\n   * /\n   */\n  public showCommentDialog(): Promise<{ type: 'like' | 'comment'; content?: string } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('comment-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3></h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"comment-text\"></label>\n            <textarea id=\"comment-text\" placeholder=\"...\" rows=\"3\"></textarea>\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-button cancel-btn\"></button>\n          <button class=\"dialog-button like-btn\"></button>\n          <button class=\"dialog-button confirm-btn\"></button>\n        </div>\n      `;\n\n          const $dialog = $(this.activeDialog!);\n          const $cancelBtn = $dialog.find('.cancel-btn');\n          const $likeBtn = $dialog.find('.like-btn');\n          const $confirmBtn = $dialog.find('.confirm-btn');\n          const $commentText = $dialog.find('#comment-text');\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleLike = () => {\n            this.closeDialog();\n            resolve({ type: 'like' });\n          };\n\n          const handleComment = () => {\n            const content = $commentText.val() as string;\n            if (!content) {\n              // alert\n              $commentText.css('borderColor', '#ff4444');\n              $commentText.attr('placeholder', '');\n              $commentText.trigger('focus');\n              return;\n            }\n            this.closeDialog();\n            resolve({ type: 'comment', content });\n          };\n\n          $cancelBtn.on('click', handleCancel);\n          $likeBtn.on('click', handleLike);\n          $confirmBtn.on('click', handleComment);\n\n          // \n          const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Enter' && e.ctrlKey) {\n              // Ctrl+Enter \n              e.preventDefault();\n              handleComment();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            $commentText.trigger('focus');\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  public showTransferDialog(): Promise<{ amount: string; note: string } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('transfer-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3></h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"transfer-amount\"> *</label>\n            <input type=\"number\" id=\"transfer-amount\" placeholder=\"\" step=\"0.01\" min=\"0.01\">\n          </div>\n          <div class=\"form-group\">\n            <label for=\"transfer-note\"></label>\n            <input type=\"text\" id=\"transfer-note\" placeholder=\"\">\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-button cancel-btn\"></button>\n          <button class=\"dialog-button confirm-btn\"></button>\n        </div>\n      `;\n\n          const $dialog = $(this.activeDialog!);\n          const $cancelBtn = $dialog.find('.cancel-btn');\n          const $confirmBtn = $dialog.find('.confirm-btn');\n          const $amountInput = $dialog.find('#transfer-amount');\n          const $noteInput = $dialog.find('#transfer-note');\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            const amount = $amountInput.val() as string;\n            const note = $noteInput.val() as string;\n\n            if (!amount || parseFloat(amount) <= 0) {\n              // alert\n              $amountInput.css('borderColor', '#ff4444');\n              $amountInput.attr('placeholder', '');\n              $amountInput.trigger('focus');\n              return;\n            }\n\n            this.closeDialog();\n            resolve({ amount: parseFloat(amount).toFixed(2), note: note || '' });\n          };\n\n          $cancelBtn.on('click', handleCancel);\n          $confirmBtn.on('click', handleConfirm);\n\n          // \n          $(document).on('keydown.transfer-dialog', (e: any) => {\n            if (e.key === 'Enter') {\n              handleConfirm();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              $(document).off('keydown.transfer-dialog');\n            }\n          });\n\n          // \n          $(this.activeOverlay!).append(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            $amountInput.trigger('focus');\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  public showRedPacketDialog(): Promise<{ amount: string; note: string } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('red-packet-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3> </h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"red-packet-amount\"> *</label>\n            <input type=\"number\" id=\"red-packet-amount\" placeholder=\"\" step=\"0.01\" min=\"0.01\">\n          </div>\n          <div class=\"form-group\">\n            <label for=\"red-packet-note\"></label>\n            <input type=\"text\" id=\"red-packet-note\" placeholder=\"\" value=\"\">\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-button cancel-btn\"></button>\n          <button class=\"dialog-button confirm-btn\"></button>\n        </div>\n      `;\n\n          const $dialog = $(this.activeDialog!);\n          const $cancelBtn = $dialog.find('.cancel-btn');\n          const $confirmBtn = $dialog.find('.confirm-btn');\n          const $amountInput = $dialog.find('#red-packet-amount');\n          const $noteInput = $dialog.find('#red-packet-note');\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            const amount = $amountInput.val() as string;\n            const note = $noteInput.val() as string;\n\n            if (!amount || parseFloat(amount) <= 0) {\n              // alert\n              $amountInput.css('borderColor', '#ff4444');\n              $amountInput.attr('placeholder', '');\n              $amountInput.trigger('focus');\n              return;\n            }\n\n            this.closeDialog();\n            resolve({ amount: parseFloat(amount).toFixed(2), note: note || '' });\n          };\n\n          $cancelBtn.on('click', handleCancel);\n          $confirmBtn.on('click', handleConfirm);\n\n          // \n          $(document).on('keydown.red-packet-dialog', (e: any) => {\n            if (e.key === 'Enter') {\n              handleConfirm();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              $(document).off('keydown.red-packet-dialog');\n            }\n          });\n\n          // \n          $(this.activeOverlay!).append(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            $amountInput.trigger('focus');\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  public showGiftDialog(): Promise<{ name: string; price?: string } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('gift-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3> </h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"gift-name\"> *</label>\n            <input type=\"text\" id=\"gift-name\" placeholder=\"\">\n          </div>\n          <div class=\"form-group\">\n            <label for=\"gift-price\"></label>\n            <input type=\"number\" id=\"gift-price\" placeholder=\"\" step=\"0.01\" min=\"0\">\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-button cancel-btn\"></button>\n          <button class=\"dialog-button confirm-btn\"></button>\n        </div>\n      `;\n\n          const cancelBtn = this.activeDialog!.querySelector('.cancel-btn') as HTMLButtonElement;\n          const confirmBtn = this.activeDialog!.querySelector('.confirm-btn') as HTMLButtonElement;\n          const nameInput = this.activeDialog!.querySelector('#gift-name') as HTMLInputElement;\n          const priceInput = this.activeDialog!.querySelector('#gift-price') as HTMLInputElement;\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            const name = nameInput.value.trim();\n            const price = priceInput.value.trim();\n\n            if (!name) {\n              // alert\n              $(nameInput).css('borderColor', '#ff4444');\n              $(nameInput).attr('placeholder', '');\n              $(nameInput).trigger('focus');\n              return;\n            }\n\n            this.closeDialog();\n            resolve({\n              name,\n              price: price && parseFloat(price) > 0 ? parseFloat(price).toFixed(2) : undefined,\n            });\n          };\n\n          cancelBtn.addEventListener('click', handleCancel);\n          confirmBtn.addEventListener('click', handleConfirm);\n\n          // \n          const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Enter') {\n              handleConfirm();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            $(nameInput).trigger('focus');\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * prompt\n   */\n  public showInputDialog(\n    title: string,\n    label: string,\n    defaultValue: string = '',\n    placeholder: string = '',\n    inputType: 'text' | 'url' | 'email' = 'text',\n  ): Promise<string | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('input-dialog');\n\n          this.activeDialog!.innerHTML = `\n            <div class=\"dialog-header\">\n              <h3>${title}</h3>\n            </div>\n            <div class=\"dialog-body\">\n              <div class=\"form-group\">\n                <label for=\"input-field\">${label}</label>\n                <input type=\"${inputType}\" id=\"input-field\" placeholder=\"${placeholder}\" value=\"${defaultValue}\">\n              </div>\n            </div>\n            <div class=\"dialog-footer\">\n              <button class=\"dialog-button cancel-btn\"></button>\n              <button class=\"dialog-button confirm-btn\"></button>\n            </div>\n          `;\n\n          const $dialog = $(this.activeDialog!);\n          const $cancelBtn = $dialog.find('.cancel-btn');\n          const $confirmBtn = $dialog.find('.confirm-btn');\n          const $inputField = $dialog.find('#input-field');\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            const value = $inputField.val() as string;\n            this.closeDialog();\n            resolve(value);\n          };\n\n          $cancelBtn.on('click', handleCancel);\n          $confirmBtn.on('click', handleConfirm);\n\n          // \n          const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Enter') {\n              handleConfirm();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            $inputField.trigger('focus');\n            if (defaultValue) {\n              $inputField.trigger('select');\n            }\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  public showVoiceDialog(): Promise<{ text: string; duration: number } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('voice-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3> </h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"voice-text\"></label>\n            <textarea id=\"voice-text\" placeholder=\"...\" rows=\"3\"></textarea>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"voice-duration\"></label>\n            <input type=\"number\" id=\"voice-duration\" placeholder=\"\" min=\"1\" max=\"60\" value=\"3\">\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-button cancel-btn\"></button>\n          <button class=\"dialog-button confirm-btn\"></button>\n        </div>\n      `;\n\n          const cancelBtn = this.activeDialog!.querySelector('.cancel-btn') as HTMLButtonElement;\n          const confirmBtn = this.activeDialog!.querySelector('.confirm-btn') as HTMLButtonElement;\n          const textArea = this.activeDialog!.querySelector('#voice-text') as HTMLTextAreaElement;\n          const durationInput = this.activeDialog!.querySelector('#voice-duration') as HTMLInputElement;\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            const text = textArea.value.trim();\n            const durationStr = durationInput.value.trim();\n\n            if (!text) {\n              // alert\n              $(textArea).css('borderColor', '#ff4444');\n              $(textArea).attr('placeholder', '');\n              $(textArea).trigger('focus');\n              return;\n            }\n\n            const duration = parseInt(durationStr, 10);\n            if (!durationStr || isNaN(duration) || duration <= 0 || duration > 60) {\n              // alert\n              $(durationInput).css('borderColor', '#ff4444');\n              $(durationInput).attr('placeholder', '1-60');\n              $(durationInput).trigger('focus');\n              return;\n            }\n\n            this.closeDialog();\n            resolve({ text, duration });\n          };\n\n          cancelBtn.addEventListener('click', handleCancel);\n          confirmBtn.addEventListener('click', handleConfirm);\n\n          // textareaCtrl+Enter\n          const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Enter' && e.ctrlKey) {\n              e.preventDefault();\n              handleConfirm();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            $(textArea).trigger('focus');\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * /\n   */\n  public showReceiveDialog(type: 'gift' | 'transfer', data: any): Promise<'accept' | 'reject' | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('receive-dialog');\n\n          const isGift = type === 'gift';\n          const title = isGift ? '' : '';\n          const icon = isGift ? '' : '';\n\n          let content = '';\n          if (isGift) {\n            content = `\n          <div class=\"receive-content\">\n            <div class=\"receive-icon\">${icon}</div>\n            <div class=\"receive-info\">\n              <div class=\"receive-title\">${data.name}</div>\n              ${data.price ? `<div class=\"receive-price\">${data.price}</div>` : ''}\n              ${data.note ? `<div class=\"receive-note\">${data.note}</div>` : ''}\n            </div>\n          </div>\n        `;\n          } else {\n            content = `\n          <div class=\"receive-content\">\n            <div class=\"receive-icon\">${icon}</div>\n            <div class=\"receive-info\">\n              <div class=\"receive-title\"></div>\n              <div class=\"receive-price\">${data.amount}</div>\n              ${data.note ? `<div class=\"receive-note\">${data.note}</div>` : ''}\n            </div>\n          </div>\n        `;\n          }\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3>${title}</h3>\n        </div>\n        <div class=\"dialog-body\">\n          ${content}\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-button reject-btn\"></button>\n          <button class=\"dialog-button accept-btn\"></button>\n        </div>\n      `;\n\n          const rejectBtn = this.activeDialog!.querySelector('.reject-btn') as HTMLButtonElement;\n          const acceptBtn = this.activeDialog!.querySelector('.accept-btn') as HTMLButtonElement;\n\n          const handleReject = () => {\n            this.closeDialog();\n            resolve('reject');\n          };\n\n          const handleAccept = () => {\n            this.closeDialog();\n            resolve('accept');\n          };\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          rejectBtn.addEventListener('click', handleReject);\n          acceptBtn.addEventListener('click', handleAccept);\n\n          // \n          const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Enter') {\n              // Enter/\n              e.preventDefault();\n              handleAccept();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  public showMomentDialog(defaultTime?: string): Promise<{\n    text: string;\n    image: string;\n    image_type: 'none' | 'url' | 'desc';\n    image_desc: string;\n    date: string;\n    time: string;\n  } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          const currentDate = window.currentGameDate || new Date();\n          const defaultDateTime =\n            defaultTime ||\n            `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1).toString().padStart(2, '0')}-${currentDate\n              .getDate()\n              .toString()\n              .padStart(2, '0')} ${currentDate.getHours().toString().padStart(2, '0')}:${currentDate\n              .getMinutes()\n              .toString()\n              .padStart(2, '0')}`;\n\n          // \n          this.createBaseDialogElements('moment-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3></h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"moment-text\">...</label>\n            <textarea id=\"moment-text\" placeholder=\"...\" rows=\"3\"></textarea>\n          </div>\n\n          <div class=\"form-group\">\n            <label> </label>\n            <div class=\"radio-group\">\n              <label><input type=\"radio\" name=\"image-type\" value=\"desc\" checked> </label>\n              <label><input type=\"radio\" name=\"image-type\" value=\"url\"> </label>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label for=\"image-content\" id=\"image-content-label\"></label>\n            <input type=\"text\" id=\"image-content\" placeholder=\"...\">\n          </div>\n\n          <div class=\"form-group url-desc-group\" style=\"display: none;\">\n            <label for=\"image-desc\">AI</label>\n            <input type=\"text\" id=\"image-desc\" placeholder=\"AI...\">\n          </div>\n\n          <div class=\"form-group\">\n            <label for=\"moment-datetime\"></label>\n            <input type=\"text\" id=\"moment-datetime\" value=\"${defaultDateTime}\" placeholder=\"YYYY-MM-DD HH:MM\">\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-btn dialog-btn-cancel\"></button>\n          <button class=\"dialog-btn dialog-btn-confirm\"></button>\n        </div>\n      `;\n\n          // \n          const imageTypeRadios = this.activeDialog!.querySelectorAll(\n            'input[name=\"image-type\"]',\n          ) as NodeListOf<HTMLInputElement>;\n          const imageContentLabel = this.activeDialog!.querySelector('#image-content-label') as HTMLElement;\n          const imageContentInput = this.activeDialog!.querySelector('#image-content') as HTMLInputElement;\n          const urlDescGroup = this.activeDialog!.querySelector('.url-desc-group') as HTMLElement;\n\n          // checkboxcheckbox\n          this.initializeCheckboxButtons();\n\n          // \n          imageTypeRadios.forEach(radio => {\n            radio.addEventListener('change', () => {\n              const isDesc = radio.value === 'desc';\n              imageContentLabel.textContent = isDesc ? '' : '';\n              imageContentInput.placeholder = isDesc ? '...' : '...';\n              urlDescGroup.style.display = isDesc ? 'none' : 'block';\n            });\n          });\n\n          // \n          const cancelBtn = this.activeDialog!.querySelector('.dialog-btn-cancel') as HTMLElement;\n          const confirmBtn = this.activeDialog!.querySelector('.dialog-btn-confirm') as HTMLElement;\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            // \n            if (!this.activeDialog) {\n              return;\n            }\n\n            const textArea = this.activeDialog!.querySelector('#moment-text') as HTMLTextAreaElement;\n            const imageTypeInput = this.activeDialog!.querySelector(\n              'input[name=\"image-type\"]:checked',\n            ) as HTMLInputElement;\n            const imageContentField = this.activeDialog!.querySelector('#image-content') as HTMLInputElement;\n            const imageDescField = this.activeDialog!.querySelector('#image-desc') as HTMLInputElement;\n            const datetimeInput = this.activeDialog!.querySelector('#moment-datetime') as HTMLInputElement;\n\n            if (!textArea || !datetimeInput) {\n              return;\n            }\n\n            const text = textArea.value;\n            const imageContent = imageContentField ? imageContentField.value.trim() : '';\n            const hasImage = imageContent !== '';\n            const imageType = hasImage && imageTypeInput ? (imageTypeInput.value as 'url' | 'desc') : 'none';\n            const imageDesc = imageType === 'url' && imageDescField ? imageDescField.value.trim() : imageContent;\n            const datetime = datetimeInput.value;\n\n            // \n            if ((!text || text.trim() === '') && (!imageContent || imageContent.trim() === '')) {\n              // alert\n              $(textArea).css('borderColor', '#ff4444');\n              $(textArea).attr('placeholder', '');\n              $(textArea).trigger('focus');\n              return;\n            }\n\n            // \n            const datetimeMatch = datetime.match(/^(\\d{4}-\\d{2}-\\d{2})\\s+(\\d{2}:\\d{2})$/);\n            if (!datetimeMatch) {\n              // alert\n              $(datetimeInput).css('borderColor', '#ff4444');\n              $(datetimeInput).attr('placeholder', 'YYYY-MM-DD HH:MM');\n              $(datetimeInput).trigger('focus');\n              return;\n            }\n\n            this.closeDialog();\n            resolve({\n              text: text.trim(),\n              image: imageContent.trim(),\n              image_type: imageType,\n              image_desc: imageDesc.trim(),\n              date: datetimeMatch[1],\n              time: datetimeMatch[2],\n            });\n          };\n\n          cancelBtn.addEventListener('click', handleCancel);\n          confirmBtn.addEventListener('click', handleConfirm);\n\n          // \n          const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Enter' && e.ctrlKey) {\n              // Ctrl+Enter \n              e.preventDefault();\n              handleConfirm();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            if (this.activeDialog) {\n              const $textArea = $(this.activeDialog).find('#moment-text');\n              if ($textArea.length) {\n                $textArea.trigger('focus');\n              }\n            }\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  public showTimeJumpDialog(defaultTime?: string): Promise<{\n    date: string;\n    time: string;\n    description: string;\n  } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          const currentDate = window.currentGameDate || new Date();\n          const defaultDateTime =\n            defaultTime ||\n            `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1).toString().padStart(2, '0')}-${currentDate\n              .getDate()\n              .toString()\n              .padStart(2, '0')} ${currentDate.getHours().toString().padStart(2, '0')}:${currentDate\n              .getMinutes()\n              .toString()\n              .padStart(2, '0')}`;\n\n          // \n          this.createBaseDialogElements('time-jump-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3></h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"jump-datetime\"></label>\n            <input type=\"text\" id=\"jump-datetime\" value=\"${defaultDateTime}\" placeholder=\"YYYY-MM-DD HH:MM\">\n          </div>\n\n          <div class=\"form-group\">\n            <label for=\"event-description\"> </label>\n            <textarea id=\"event-description\" placeholder=\"...\" rows=\"3\"></textarea>\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-btn dialog-btn-cancel\"></button>\n          <button class=\"dialog-btn dialog-btn-confirm\"></button>\n        </div>\n      `;\n\n          // checkboxcheckbox\n          this.initializeCheckboxButtons();\n\n          // \n          const cancelBtn = this.activeDialog!.querySelector('.dialog-btn-cancel') as HTMLElement;\n          const confirmBtn = this.activeDialog!.querySelector('.dialog-btn-confirm') as HTMLElement;\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            // \n            if (!this.activeDialog) {\n              return;\n            }\n\n            const datetimeInput = this.activeDialog!.querySelector('#jump-datetime') as HTMLInputElement;\n            const descriptionInput = this.activeDialog!.querySelector('#event-description') as HTMLTextAreaElement;\n\n            if (!datetimeInput) {\n              return;\n            }\n\n            const datetime = datetimeInput.value;\n            const description = descriptionInput ? descriptionInput.value.trim() : '';\n\n            // \n            const datetimeMatch = datetime.match(/^(\\d{4}-\\d{2}-\\d{2})\\s+(\\d{2}:\\d{2})$/);\n            if (!datetimeMatch) {\n              // alert\n              $(datetimeInput).css('borderColor', '#ff4444');\n              $(datetimeInput).attr('placeholder', 'YYYY-MM-DD HH:MM');\n              $(datetimeInput).trigger('focus');\n              return;\n            }\n\n            this.closeDialog();\n            resolve({\n              date: datetimeMatch[1],\n              time: datetimeMatch[2],\n              description: description, // \n            });\n          };\n\n          cancelBtn.addEventListener('click', handleCancel);\n          confirmBtn.addEventListener('click', handleConfirm);\n\n          // \n          const handleKeyDown = (e: KeyboardEvent) => {\n            // \n            if (!this.activeDialog) {\n              document.removeEventListener('keydown', handleKeyDown);\n              return;\n            }\n\n            if (e.key === 'Enter') {\n              // Enter\n              e.preventDefault();\n              handleConfirm();\n              document.removeEventListener('keydown', handleKeyDown);\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            if (this.activeDialog) {\n              const $timeInput = $(this.activeDialog).find('#jump-datetime');\n              if ($timeInput.length) {\n                $timeInput.trigger('focus');\n                $timeInput.trigger('select');\n              }\n            }\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  private forceCleanupDialogs(): void {\n    // \n    const $container = $('.phone-screen').length ? $('.phone-screen') : $('body');\n\n    // \n    const selectors = [\n      '[class*=\"dialog-overlay\"]',\n      '[class*=\"dialog\"]',\n      '.custom-dialog-overlay',\n      '.mobile-dialog-overlay',\n      '.custom-dialog',\n      '.mobile-dialog',\n    ];\n\n    selectors.forEach(selector => {\n      $container.find(selector).each((_, element) => {\n        try {\n          $(element).remove();\n        } catch (error) {\n          console.warn(':', error);\n        }\n      });\n    });\n\n    // \n    this.activeDialog = null;\n    this.activeOverlay = null;\n  }\n\n  /**\n   * \n   */\n  private closeDialog(): void {\n    this.forceCleanupDialogs();\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","/**\n * \n * \n */\n\nexport class EventManager {\n  private listeners: Array<() => void> = [];\n  private timers: Set<number> = new Set();\n  private intervals: Set<number> = new Set();\n  private isDestroyed: boolean = false;\n\n  /**\n   * \n   * @param event \n   * @param handler \n   * @returns \n   */\n  addGlobalListener(event: string, handler: Function): () => void {\n    if (this.isDestroyed) {\n      console.warn('[EventManager] ');\n      return () => {};\n    }\n\n    const cleanup = (window as any).eventOn(event, handler);\n    if (cleanup && typeof cleanup === 'function') {\n      this.listeners.push(cleanup);\n      return cleanup;\n    } else {\n      console.warn(`[EventManager]  ${event} `);\n      return () => {};\n    }\n  }\n\n  /**\n   * DOM\n   * @param element DOM\n   * @param event \n   * @param handler \n   * @param options \n   */\n  addDOMListener(\n    element: Element | Window | Document,\n    event: string,\n    handler: EventListener,\n    options?: boolean | AddEventListenerOptions,\n  ): void {\n    if (this.isDestroyed) {\n      console.warn('[EventManager] DOM');\n      return;\n    }\n\n    element.addEventListener(event, handler, options);\n\n    // \n    const cleanup = () => {\n      element.removeEventListener(event, handler, options);\n    };\n\n    this.listeners.push(cleanup);\n  }\n\n  /**\n   * setTimeout\n   * @param callback \n   * @param delay \n   * @returns ID\n   */\n  setTimeout(callback: Function, delay: number): number {\n    if (this.isDestroyed) {\n      console.warn('[EventManager] ');\n      return -1;\n    }\n\n    const timerId = window.setTimeout(() => {\n      this.timers.delete(timerId);\n      try {\n        callback();\n      } catch (error) {\n        console.error('[EventManager] :', error);\n      }\n    }, delay);\n\n    this.timers.add(timerId);\n    return timerId;\n  }\n\n  /**\n   * setInterval\n   * @param callback \n   * @param interval \n   * @returns ID\n   */\n  setInterval(callback: Function, interval: number): number {\n    if (this.isDestroyed) {\n      console.warn('[EventManager] ');\n      return -1;\n    }\n\n    const intervalId = window.setInterval(() => {\n      try {\n        callback();\n      } catch (error) {\n        console.error('[EventManager] :', error);\n      }\n    }, interval);\n\n    this.intervals.add(intervalId);\n    return intervalId;\n  }\n\n  /**\n   * \n   * @param timerId ID\n   */\n  clearTimeout(timerId: number): void {\n    if (this.timers.has(timerId)) {\n      window.clearTimeout(timerId);\n      this.timers.delete(timerId);\n    }\n  }\n\n  /**\n   * \n   * @param intervalId ID\n   */\n  clearInterval(intervalId: number): void {\n    if (this.intervals.has(intervalId)) {\n      window.clearInterval(intervalId);\n      this.intervals.delete(intervalId);\n    }\n  }\n\n  /**\n   * \n   */\n  cleanup(): void {\n    if (this.isDestroyed) {\n      return;\n    }\n\n    // \n    this.listeners.forEach(cleanup => {\n      try {\n        cleanup();\n      } catch (error) {\n        console.error('[EventManager] :', error);\n      }\n    });\n    this.listeners = [];\n\n    // \n    this.timers.forEach(timerId => {\n      window.clearTimeout(timerId);\n    });\n    this.timers.clear();\n\n    // \n    this.intervals.forEach(intervalId => {\n      window.clearInterval(intervalId);\n    });\n    this.intervals.clear();\n\n    this.isDestroyed = true;\n    //console.log('[EventManager] ');\n  }\n\n  /**\n   * \n   */\n  getStatus(): {\n    listenersCount: number;\n    timersCount: number;\n    intervalsCount: number;\n    isDestroyed: boolean;\n  } {\n    return {\n      listenersCount: this.listeners.length,\n      timersCount: this.timers.size,\n      intervalsCount: this.intervals.size,\n      isDestroyed: this.isDestroyed,\n    };\n  }\n\n  /**\n   * \n   */\n  isDestroyed_(): boolean {\n    return this.isDestroyed;\n  }\n}\n\n/**\n * \n * \n */\nexport const globalEventManager = new EventManager();\n\n/**\n * \n */\nif (typeof window !== 'undefined') {\n  window.addEventListener('beforeunload', () => {\n    globalEventManager.cleanup();\n  });\n}\n","export interface TavernHelperBridge {\n  getCharData(): Promise<{ name: string }>;\n  getCharAvatarPath(): Promise<string>;\n  getLastMessageId(): Promise<number | null>;\n  getChatMessages(id: number): Promise<Array<{ message: string }>>;\n  setChatMessage(content: string, id: number, options: { refresh: 'none' }): Promise<void>;\n  generate(options: { user_input: string; should_stream: boolean }): Promise<AsyncGenerator<string, void, unknown>>;\n}\n\n// \ndeclare global {\n  interface Window {\n    currentGameDate: Date;\n  }\n}\n\n// TavernHelper\nexport function getTavernHelper(): TavernHelperBridge {\n  return (window.parent as any).TavernHelper;\n}\n\nexport type Sender = 'me' | 'them';\n\nexport interface BaseLogEntry {\n  recalled?: boolean;\n  recalled_content?: any;\n  recalled_timestamp?: string;\n}\n\nexport interface BaseChatMessage extends BaseLogEntry {\n  id: string;\n  sender: Sender;\n}\n\n// \nexport interface TextMessage extends BaseChatMessage {\n  type: 'message';\n  content: string;\n  isSystemMessage?: boolean; // \n}\n\nexport interface VoiceMessage extends BaseChatMessage {\n  type: 'voice';\n  content: { text: string; duration: number };\n}\n\nexport interface StickerMessage extends BaseChatMessage {\n  type: 'sticker';\n  content: string; // sticker name/label\n  size?: 'small' | 'medium' | 'large'; // Add size option for stickers\n}\n\nexport interface ImageMessage extends BaseChatMessage {\n  type: 'image';\n  content: { type: 'url' | 'desc'; value: string };\n}\n\nexport interface LocationMessage extends BaseChatMessage {\n  type: 'location';\n  content: string;\n}\n\nexport interface TransferMessage extends BaseChatMessage {\n  type: 'transfer';\n  content: string; // JSON string\n  data: {\n    amount: string;\n    note?: string;\n    status: 'sent' | 'accepted' | 'rejected';\n  };\n}\n\nexport interface FileMessage extends BaseChatMessage {\n  type: 'file';\n  content: string; // filename\n}\n\nexport interface GiftMessage extends BaseChatMessage {\n  type: 'gift';\n  content: string; // JSON string\n  data: {\n    name: string;\n    price?: string;\n    status: 'sent' | 'accepted' | 'rejected';\n  };\n}\n\nexport type ChatEntry =\n  | TextMessage\n  | VoiceMessage\n  | StickerMessage\n  | ImageMessage\n  | LocationMessage\n  | TransferMessage\n  | FileMessage\n  | GiftMessage;\n\nexport interface TimeLogEntry extends BaseLogEntry {\n  type: 'time';\n  content: { date: string; time: string };\n  id?: string; // id\n}\n\nexport interface EventLogEntry extends BaseLogEntry {\n  type: 'event';\n  content: { date: string; time: string; description?: string };\n  id?: string; // id\n}\n\nexport type SystemEntry = TimeLogEntry | EventLogEntry;\n\nexport interface MomentEntry extends BaseLogEntry {\n  key: 'USER_MOMENT' | 'CHAR_MOMENT';\n  data: {\n    text: string;\n    image: string;\n    image_type: 'url' | 'desc' | 'none';\n    image_desc?: string;\n    date: string;\n    time: string;\n  };\n}\n\nexport interface CommentEntry extends BaseLogEntry {\n  key: 'USER_COMMENT' | 'CHAR_COMMENT';\n  data: {\n    text: string;\n    target_post_id: number;\n  };\n}\n\nexport interface LikeEntry extends BaseLogEntry {\n  key: 'USER_LIKE' | 'CHAR_LIKE';\n  data: {\n    target_post_id: number;\n  };\n}\n\nexport type MomentRelatedEntry = MomentEntry | CommentEntry | LikeEntry;\n\nexport type LogEntry = ChatEntry | SystemEntry | MomentRelatedEntry;\n\nexport class BLMX_Protocol {\n  public logEntries: LogEntry[] = [];\n  private messageId: number | null = null;\n  private readonly charId: string;\n  private readonly LOG_START_TAG = '===BLMX_LOG_BEGIN===';\n  private readonly LOG_END_TAG = '===BLMX_LOG_END===';\n\n  constructor(charId: string) {\n    this.charId = charId;\n  }\n\n  // ID\n  getCharId(): string {\n    return this.charId;\n  }\n\n  async initialize(): Promise<boolean> {\n    // console.log('[BLMX] Initializing and scanning for chat history...');\n    const lastMessageId = await getTavernHelper().getLastMessageId();\n\n    if (lastMessageId === null) {\n      // console.warn('[BLMX] No messages found. Starting fresh at message ID 0.');\n      this.messageId = 0;\n      this.logEntries = [];\n      await this.persistLogToStorage();\n      return true;\n    }\n\n    let latestUiMessage: { id: number; content: string } | null = null;\n    const previousUiMessages: { id: number; content: string }[] = [];\n\n    for (let i = lastMessageId; i >= 0; i--) {\n      try {\n        const msg = (await getTavernHelper().getChatMessages(i))[0];\n        if (msg && msg.message && msg.message.includes(this.LOG_START_TAG)) {\n          if (!latestUiMessage) {\n            latestUiMessage = { id: i, content: msg.message };\n          } else {\n            previousUiMessages.push({ id: i, content: msg.message });\n          }\n        }\n      } catch (error) {\n        // Ignore errors, likely message not found\n      }\n    }\n\n    if (!latestUiMessage) {\n      // console.log('[BLMX] No UI log found. Creating a new one in the latest message.');\n      this.messageId = lastMessageId;\n      this.logEntries = [];\n      await this.persistLogToStorage();\n      return true;\n    }\n\n    // console.log(`[BLMX] Found latest UI log in message ${latestUiMessage.id}. Consolidating...`);\n    this.messageId = latestUiMessage.id;\n    const consolidatedLogParts: string[] = [];\n\n    const latestLogStartIndex = latestUiMessage.content.indexOf(this.LOG_START_TAG);\n    const latestLogEndIndex = latestUiMessage.content.indexOf(this.LOG_END_TAG);\n    if (latestLogStartIndex !== -1 && latestLogEndIndex !== -1) {\n      const logPart = latestUiMessage.content\n        .slice(latestLogStartIndex + this.LOG_START_TAG.length, latestLogEndIndex)\n        .trim();\n      if (logPart) consolidatedLogParts.push(logPart);\n    }\n\n    for (const prevMsg of previousUiMessages) {\n      const prevLogStartIndex = prevMsg.content.indexOf(this.LOG_START_TAG);\n      const prevLogEndIndex = prevMsg.content.indexOf(this.LOG_END_TAG);\n      if (prevLogStartIndex !== -1 && prevLogEndIndex !== -1) {\n        const logPart = prevMsg.content.slice(prevLogStartIndex + this.LOG_START_TAG.length, prevLogEndIndex).trim();\n        if (logPart) consolidatedLogParts.unshift(logPart);\n\n        const cleanedContent =\n          prevMsg.content.substring(0, prevLogStartIndex) +\n          prevMsg.content.substring(prevLogEndIndex + this.LOG_END_TAG.length);\n        await getTavernHelper().setChatMessage(cleanedContent.trim(), prevMsg.id, { refresh: 'none' });\n        // console.log(`[BLMX] Cleaned and moved UI log from message ${prevMsg.id}.`);\n      }\n    }\n\n    const finalLogString = consolidatedLogParts.join('\\n');\n    this._parseLogFromString(finalLogString);\n\n    await this.persistLogToStorage();\n    // console.log(`[BLMX] Consolidated log saved to message ${this.messageId}.`);\n\n    return true;\n  }\n\n  async persistLogToStorage(): Promise<void> {\n    if (this.messageId === null) {\n      console.warn('[BLMX] Cannot save log, message_id not initialized.'); // \n      return;\n    }\n    try {\n      const logString = this._renderLogToString();\n      const existingMessage = (await getTavernHelper().getChatMessages(this.messageId))[0];\n      const existingContent = existingMessage ? existingMessage.message : '';\n\n      const logStartIndex = existingContent.indexOf(this.LOG_START_TAG);\n      const logEndIndex = existingContent.indexOf(this.LOG_END_TAG);\n\n      const newLogBlock = `${this.LOG_START_TAG}\\n${logString}\\n${this.LOG_END_TAG}`;\n      let fullText: string;\n\n      if (logStartIndex !== -1 && logEndIndex !== -1) {\n        fullText =\n          existingContent.substring(0, logStartIndex) +\n          newLogBlock +\n          existingContent.substring(logEndIndex + this.LOG_END_TAG.length);\n      } else {\n        fullText = existingContent + '\\n' + newLogBlock;\n      }\n\n      await getTavernHelper().setChatMessage(fullText.trim(), this.messageId, { refresh: 'none' });\n    } catch (error) {\n      console.error('Failed to save narrative log to text box:', error);\n    }\n  }\n\n  private _parseLogFromString(logString: string): void {\n    this.logEntries = [];\n    const lines = logString.split('\\n').filter(line => line.trim() !== '');\n\n    lines.forEach(line => {\n      const separatorIndex = line.indexOf(':');\n      if (separatorIndex === -1) return;\n\n      const key = line.substring(0, separatorIndex).trim();\n      const value = line.substring(separatorIndex + 1).trim();\n      try {\n        switch (key) {\n          case 'USER_MOMENT':\n          case 'CHAR_MOMENT':\n          case 'USER_COMMENT':\n          case 'CHAR_COMMENT':\n          case 'USER_LIKE':\n          case 'CHAR_LIKE':\n            try {\n              const data = JSON.parse(value);\n              this.logEntries.push({ key, data } as MomentRelatedEntry);\n            } catch (error) {\n              console.warn('[BLMX] :', value, error);\n            }\n            break;\n          case 'TIME':\n          case 'EVENT_LOG':\n            if (value) {\n              try {\n                const data = JSON.parse(value);\n                // console.log(`[BLMX] ${key}:`, data);\n\n                // \n                if (!data.date || !data.time) {\n                  console.warn(`[BLMX] ${key}:`, data);\n                  // \n                  if (!data.date || !data.time) {\n                    const now = new Date();\n                    if (!data.date) {\n                      data.date = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(\n                        now.getDate(),\n                      ).padStart(2, '0')}`;\n                      // console.log(`[BLMX] ${key}:`, data.date);\n                    }\n                    if (!data.time) {\n                      data.time = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(\n                        2,\n                        '0',\n                      )}`;\n                      // console.log(`[BLMX] ${key}:`, data.time);\n                    }\n                  }\n                }\n\n                const entryType = key === 'TIME' ? 'time' : 'event';\n                const newEntry = { type: entryType, content: data } as SystemEntry;\n                this.logEntries.push(newEntry);\n                // console.log(`[BLMX] ${key}:`, newEntry);\n\n                const timeDate = new Date(`${data.date} ${data.time}`);\n                if (!isNaN(timeDate.getTime())) {\n                  window.currentGameDate = timeDate;\n                  const timeElement = document.getElementById('current-time');\n                  if (timeElement) {\n                    const timeString = `${window.currentGameDate\n                      .getHours()\n                      .toString()\n                      .padStart(2, '0')}:${window.currentGameDate.getMinutes().toString().padStart(2, '0')}`;\n                    timeElement.textContent = timeString;\n                  }\n                }\n              } catch (error) {\n                console.error(`[BLMX] ${key}:`, value, error);\n              }\n            } else {\n              // console.warn(`[BLMX] ${key}`);\n            }\n            break;\n          case 'RECALL': {\n            // console.log('[BLMX] RECALL:', value);\n            try {\n              const recallData = JSON.parse(value);\n              const senderToFind: Sender = recallData.sender === 'USER' ? 'me' : 'them';\n\n              // target_text\n              const targetText = recallData.target_text || recallData['target text'] || recallData.text || '';\n\n              if (!targetText) {\n                console.warn('[BLMX] RECALL:', recallData);\n                break;\n              }\n\n              // \n              const entryToRecall = this.logEntries\n                .slice()\n                .reverse()\n                .find(e => {\n                  // sendercontent\n                  if (!('sender' in e) || e.sender !== senderToFind || !('content' in e)) {\n                    return false;\n                  }\n\n                  // \n                  if (e.content === targetText) {\n                    return true;\n                  }\n\n                  // \n                  const normalizeText = (text: string) =>\n                    typeof text === 'string' ? text.replace(/[^\\w\\u4e00-\\u9fa5]/g, '').toLowerCase() : '';\n\n                  if (typeof e.content === 'string') {\n                    // \n                    if (normalizeText(e.content) === normalizeText(targetText)) {\n                      return true;\n                    }\n                    // \n                    if (e.content.includes(targetText) || targetText.includes(e.content)) {\n                      return true;\n                    }\n                  }\n\n                  // \n                  if (typeof e.content === 'object' && e.content !== null) {\n                    try {\n                      // JSON\n                      if (JSON.stringify(e.content) === targetText) {\n                        return true;\n                      }\n\n                      // text\n                      if ('text' in e.content) {\n                        const voiceText = (e.content as any).text;\n                        if (voiceText === targetText || normalizeText(voiceText) === normalizeText(targetText)) {\n                          return true;\n                        }\n                      }\n                    } catch (err) {\n                      console.warn('[BLMX] :', err);\n                    }\n                  }\n\n                  return false;\n                }) as ChatEntry;\n\n              if (entryToRecall) {\n                // console.log('[BLMX] :', entryToRecall);\n                entryToRecall.recalled = true;\n                entryToRecall.recalled_content = entryToRecall.content;\n                entryToRecall.recalled_timestamp = recallData.timestamp || new Date().toISOString();\n              } else {\n                console.warn('[BLMX] :', {\n                  sender: senderToFind,\n                  target_text: targetText,\n                  recall_data: recallData,\n                });\n              }\n            } catch (error) {\n              console.error('[BLMX] RECALL:', error);\n            }\n            break;\n          }\n          case 'USER':\n          case 'CHAR': {\n            const sender: Sender = key === 'USER' ? 'me' : 'them';\n            const id = `msg-${Date.now()}${Math.random()}-${sender}`;\n\n            const voiceMatch = value.match(/^\\[:\\s*({.*})\\]/);\n            if (voiceMatch) {\n              try {\n                const voiceData = JSON.parse(voiceMatch[1]);\n                this.logEntries.push({ id, type: 'voice', sender, content: voiceData });\n                return;\n              } catch (e) {\n                console.error('Failed to parse voice data:', voiceMatch[1], e);\n                // \n                this.logEntries.push({ id, type: 'voice', sender, content: { text: '', duration: 0 } });\n                return;\n              }\n            }\n\n            const stickerMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            if (stickerMatch) {\n              this.logEntries.push({ id, type: 'sticker', sender, content: stickerMatch[1] });\n              return;\n            }\n\n            const imageMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            if (imageMatch) {\n              try {\n                const imgData = JSON.parse(imageMatch[1]);\n                this.logEntries.push({ id, type: 'image', sender, content: imgData });\n              } catch (e) {\n                this.logEntries.push({\n                  id,\n                  type: 'image',\n                  sender,\n                  content: { type: 'desc', value: imageMatch[1] },\n                });\n              }\n              return;\n            }\n\n            const locationMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            if (locationMatch) {\n              this.logEntries.push({ id, type: 'location', sender, content: locationMatch[1] });\n              return;\n            }\n\n            const transferMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            if (transferMatch) {\n              this.logEntries.push({\n                id,\n                type: 'transfer',\n                sender,\n                content: transferMatch[1],\n                data: (() => {\n                  try {\n                    return JSON.parse(transferMatch[1]);\n                  } catch (e) {\n                    console.error('Failed to parse transfer data:', transferMatch[1], e);\n                    return { amount: 0, message: '' };\n                  }\n                })(),\n              });\n              return;\n            }\n\n            const fileMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            if (fileMatch) {\n              this.logEntries.push({ id, type: 'file', sender, content: fileMatch[1] });\n              return;\n            }\n\n            const giftMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            if (giftMatch) {\n              this.logEntries.push({\n                id,\n                type: 'gift',\n                sender,\n                content: giftMatch[1],\n                data: (() => {\n                  try {\n                    return JSON.parse(giftMatch[1]);\n                  } catch (e) {\n                    console.error('Failed to parse gift data:', giftMatch[1], e);\n                    return { name: '', value: 0 };\n                  }\n                })(),\n              });\n              return;\n            }\n\n            this.logEntries.push({ id, type: 'message', sender, content: value });\n            break;\n          }\n        }\n      } catch (e) {\n        console.error('Failed to parse log line:', line, e);\n      }\n    });\n  }\n\n  private _renderLogToString(): string {\n    const recallCommands: string[] = [];\n    const allEntriesString = this.logEntries\n      .map(e => {\n        if (e.recalled) {\n          const recallData = {\n            sender: 'sender' in e && e.sender === 'me' ? 'USER' : 'CHAR',\n            target_text:\n              typeof e.recalled_content === 'object' && e.recalled_content !== null\n                ? e.recalled_content.text\n                : e.recalled_content,\n            timestamp: e.recalled_timestamp,\n          };\n          if (recallData.target_text) {\n            recallCommands.push(`RECALL: ${JSON.stringify(recallData)}`);\n          }\n        }\n\n        if ('key' in e) {\n          return `${e.key}: ${JSON.stringify(e.data)}`;\n        }\n\n        if ('type' in e) {\n          if (e.type === 'time' || e.type === 'event') {\n            const key = e.type === 'time' ? 'TIME' : 'EVENT_LOG';\n            // console.log(`[BLMX] ${key}:`, e);\n            return `${key}: ${JSON.stringify(e.content)}`;\n          }\n\n          const prefix = e.sender === 'me' ? 'USER' : 'CHAR';\n          let content: string | object = e.content;\n          switch (e.type) {\n            case 'sticker':\n              content = `[: ${e.content}]`;\n              break;\n            case 'voice':\n              content = `[: ${JSON.stringify(e.content)}]`;\n              break;\n            case 'image':\n              content = `[: ${JSON.stringify(e.content)}]`;\n              break;\n            case 'location':\n              content = `[: ${e.content}]`;\n              break;\n            case 'file':\n              content = `[: ${e.content}]`;\n              break;\n            case 'gift':\n              content = `[: ${e.content}]`;\n              break;\n            case 'transfer':\n              content = `[: ${e.content}]`;\n              break;\n          }\n          return `${prefix}: ${content}`;\n        }\n        return ''; // Should not happen for valid entries\n      })\n      .join('\\n');\n\n    return [allEntriesString, ...recallCommands].filter(Boolean).join('\\n');\n  }\n\n  // addEntry - \n  addEntry(entry: LogEntry | null): void {\n    if (entry) {\n      // \n      if ('type' in entry && entry.type === 'sticker') {\n        this.logEntries.push(entry);\n        return;\n      }\n\n      // \n      const isDuplicate = this.logEntries.some(existingEntry => {\n        // \n        if ('key' in entry && 'key' in existingEntry) {\n          if (entry.key === existingEntry.key) {\n            // \n            if (entry.key.includes('_MOMENT')) {\n              const entryData = (entry as MomentEntry).data;\n              const existingData = (existingEntry as MomentEntry).data;\n              return (\n                existingData.text === entryData.text &&\n                existingData.date === entryData.date &&\n                existingData.time === entryData.time\n              );\n            }\n            // ID\n            else if (entry.key.includes('_COMMENT')) {\n              const entryData = (entry as CommentEntry).data;\n              const existingData = (existingEntry as CommentEntry).data;\n              return existingData.text === entryData.text && existingData.target_post_id === entryData.target_post_id;\n            }\n            // ID\n            else if (entry.key.includes('_LIKE')) {\n              const entryData = (entry as LikeEntry).data;\n              const existingData = (existingEntry as LikeEntry).data;\n              return existingData.target_post_id === entryData.target_post_id;\n            }\n          }\n        }\n\n        // \n        if ('type' in entry && 'type' in existingEntry) {\n          // \n          if (entry.type === existingEntry.type) {\n            // IDID\n            if ('id' in entry && 'id' in existingEntry && entry.id === existingEntry.id) {\n              return true;\n            }\n\n            // \n            if (\n              (entry.type === 'message' || entry.type === 'location' || entry.type === 'file') &&\n              'sender' in entry &&\n              'sender' in existingEntry &&\n              'content' in entry &&\n              'content' in existingEntry\n            ) {\n              return (\n                entry.sender === existingEntry.sender && (window as any)._.isEqual(entry.content, existingEntry.content)\n              );\n            }\n\n            // \n            if ((entry.type === 'time' || entry.type === 'event') && 'content' in entry && 'content' in existingEntry) {\n              return (window as any)._.isEqual(entry.content, existingEntry.content);\n            }\n\n            // image, voice, transfer, gift\n            if (\n              'content' in entry &&\n              'content' in existingEntry &&\n              (entry.type === 'image' || entry.type === 'voice' || entry.type === 'transfer' || entry.type === 'gift')\n            ) {\n              return (window as any)._.isEqual(entry.content, existingEntry.content);\n            }\n          }\n        }\n\n        return false;\n      });\n\n      if (isDuplicate) {\n        // console.log(`[BLMX] :`, entry);\n        return; // \n      }\n\n      this.logEntries.push(entry);\n\n      //  - \n      if ('type' in entry && (entry.type === 'time' || entry.type === 'event')) {\n        const data = entry.content;\n        const timeDate = new Date(`${data.date} ${data.time}`);\n        if (!isNaN(timeDate.getTime())) {\n          window.currentGameDate = timeDate;\n          const timeElement = document.getElementById('current-time');\n          if (timeElement) {\n            const timeString = `${window.currentGameDate\n              .getHours()\n              .toString()\n              .padStart(2, '0')}:${window.currentGameDate.getMinutes().toString().padStart(2, '0')}`;\n            timeElement.textContent = timeString;\n          }\n        }\n      }\n    }\n  }\n\n  getContextForAI(): string {\n    return this._renderLogToString();\n  }\n}\n","/**\n * \n * \n */\n\nimport { logger } from './debug-logger';\n\n/**\n * JSON\n * @param jsonString JSON\n * @param defaultValue \n * @returns \n */\nexport function safeJsonParse<T = any>(jsonString: string, defaultValue: T | null = null): T | null {\n  try {\n    return JSON.parse(jsonString);\n  } catch (error) {\n    logger.warn('Utils', 'JSON', { jsonString: jsonString.substring(0, 100), error });\n    return defaultValue;\n  }\n}\n\n/**\n * JSON\n * @param obj \n * @param defaultValue \n * @returns JSON\n */\nexport function safeJsonStringify(obj: any, defaultValue: string = '{}'): string {\n  try {\n    return JSON.stringify(obj);\n  } catch (error) {\n    logger.warn('Utils', 'JSON', { error });\n    return defaultValue;\n  }\n}\n\n/**\n *  - lodashdebounce\n * @param func \n * @param wait \n * @param options lodash debounce\n * @returns \n */\nexport function debounce<T extends (...args: any[]) => any>(\n  func: T,\n  wait: number,\n  options?: { leading?: boolean; trailing?: boolean; maxWait?: number },\n): T {\n  return (window as any)._.debounce(func, wait, options);\n}\n\n/**\n *  - lodashthrottle\n * @param func \n * @param wait \n * @param options lodash throttle\n * @returns \n */\nexport function throttle<T extends (...args: any[]) => any>(\n  func: T,\n  wait: number,\n  options?: { leading?: boolean; trailing?: boolean },\n): T {\n  return (window as any)._.throttle(func, wait, options);\n}\n\n/**\n * \n * @param ms \n * @returns Promise\n */\nexport function delay(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * DOM - jQuery\n * @param selector CSS\n * @param context document\n * @returns jQuery\n */\nexport function $safe(selector: string, context?: Element | Document): JQuery<HTMLElement> {\n  try {\n    return context ? $(selector, context) : $(selector);\n  } catch (error) {\n    logger.warn('Utils', 'jQuery', { selector, error });\n    return $(); // jQuery\n  }\n}\n\n/**\n * DOM\n * @param selector CSS\n * @param context document\n * @returns null\n */\nexport function safeQuerySelector<T extends Element = Element>(\n  selector: string,\n  context: Document | Element = document,\n): T | null {\n  try {\n    return context.querySelector<T>(selector);\n  } catch (error) {\n    logger.warn('Utils', 'DOM', { selector, error });\n    return null;\n  }\n}\n\n/**\n * DOM- jQuery\n * @param selector CSS\n * @param context document\n * @returns \n */\nexport function safeQuerySelectorAll<T extends Element = Element>(\n  selector: string,\n  context: Document | Element = document,\n): T[] {\n  try {\n    const $elements = context ? $(selector, context) : $(selector);\n    return $elements.toArray() as unknown as T[];\n  } catch (error) {\n    logger.warn('Utils', 'DOM', { selector, error });\n    return [];\n  }\n}\n\n/**\n * \n * @param bytes \n * @returns \n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 B';\n\n  const k = 1024;\n  const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\n/**\n * \n * @param timestamp \n * @param format \n * @returns \n */\nexport function formatTimestamp(timestamp: number, format: 'full' | 'time' | 'date' = 'full'): string {\n  const date = new Date(timestamp);\n\n  switch (format) {\n    case 'time':\n      return date.toLocaleTimeString('zh-CN', { hour12: false });\n    case 'date':\n      return date.toLocaleDateString('zh-CN');\n    case 'full':\n    default:\n      return date.toLocaleString('zh-CN', { hour12: false });\n  }\n}\n\n/**\n * ID\n * @param prefix \n * @returns ID\n */\nexport function generateId(prefix: string = 'id'): string {\n  return `${prefix}-${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;\n}\n\n/**\n *  - lodashcloneDeep\n * @param obj \n * @returns \n */\nexport function deepClone<T>(obj: T): T {\n  return (window as any)._.cloneDeep(obj);\n}\n\n/**\n * \n * @returns \n */\nexport function isMobileDevice(): boolean {\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n}\n\n/**\n * \n * @returns \n */\nexport function isTouchDevice(): boolean {\n  return 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n}\n\n/**\n * \n */\nexport const SafeStorage = {\n  /**\n   * \n   * @param key \n   * @param defaultValue \n   * @returns \n   */\n  getItem<T = string>(key: string, defaultValue: T | null = null): T | null {\n    try {\n      const item = localStorage.getItem(key);\n      if (item === null) return defaultValue;\n\n      // JSON\n      try {\n        return JSON.parse(item);\n      } catch {\n        return item as unknown as T;\n      }\n    } catch (error) {\n      logger.warn('Utils', '', { key, error });\n      return defaultValue;\n    }\n  },\n\n  /**\n   * \n   * @param key \n   * @param value \n   * @returns \n   */\n  setItem(key: string, value: any): boolean {\n    try {\n      const serialized = typeof value === 'string' ? value : JSON.stringify(value);\n      localStorage.setItem(key, serialized);\n      return true;\n    } catch (error) {\n      logger.warn('Utils', '', { key, error });\n      return false;\n    }\n  },\n\n  /**\n   * \n   * @param key \n   * @returns \n   */\n  removeItem(key: string): boolean {\n    try {\n      localStorage.removeItem(key);\n      return true;\n    } catch (error) {\n      logger.warn('Utils', '', { key, error });\n      return false;\n    }\n  },\n\n  /**\n   * \n   * @returns \n   */\n  clear(): boolean {\n    try {\n      localStorage.clear();\n      return true;\n    } catch (error) {\n      logger.warn('Utils', '', { error });\n      return false;\n    }\n  },\n};\n\n/**\n * \n */\nexport const ErrorHandler = {\n  /**\n   * \n   * @param fn \n   * @param errorMessage \n   * @returns null\n   */\n  async safeAsync<T>(fn: () => Promise<T>, errorMessage?: string): Promise<T | null> {\n    try {\n      return await fn();\n    } catch (error) {\n      logger.error('ErrorHandler', errorMessage || '', { error });\n      return null;\n    }\n  },\n\n  /**\n   * \n   * @param fn \n   * @param errorMessage \n   * @returns null\n   */\n  safeSync<T>(fn: () => T, errorMessage?: string): T | null {\n    try {\n      return fn();\n    } catch (error) {\n      logger.error('ErrorHandler', errorMessage || '', { error });\n      return null;\n    }\n  },\n};\n","// AI\n// AI\n\nimport { logger } from './debug-logger';\nimport { EventManager } from './event-manager';\nimport { MomentsManager } from './moments-manager';\nimport { BLMX_Protocol, LogEntry, getTavernHelper } from './script';\nimport { IEventHandler } from './types';\nimport { UIRenderer } from './ui-renderer';\nimport { safeJsonParse, safeJsonStringify } from './utils';\n\nexport class AiResponseManager {\n  private blmxManager: BLMX_Protocol;\n  private uiRenderer: UIRenderer;\n  private eventHandler: IEventHandler;\n  private momentsManager: MomentsManager;\n  private eventManager: EventManager;\n\n  private isGenerating: boolean = false;\n  private latestAiRawResponse: string = 'AI';\n  private latestSentPrompt: string = 'AI';\n\n  // \n  private rawAiResponse: string = '';\n  private fullPrompt: string = '';\n\n  constructor(\n    blmxManager: BLMX_Protocol,\n    uiRenderer: UIRenderer,\n    eventHandler: IEventHandler,\n    momentsManager: MomentsManager,\n  ) {\n    this.blmxManager = blmxManager;\n    this.uiRenderer = uiRenderer;\n    this.eventHandler = eventHandler;\n    this.momentsManager = momentsManager;\n    this.eventManager = new EventManager();\n\n    // \n    this.eventManager.addGlobalListener('js_generation_ended', (text: string) => {\n      this.rawAiResponse = text;\n      logger.debug('AiResponseManager', 'AI', { length: text.length });\n    });\n\n    this.eventManager.addGlobalListener('chat_completion_prompt_ready', (event_data: any) => {\n      this.fullPrompt = safeJsonStringify(event_data.chat);\n      logger.debug('AiResponseManager', '', { promptLength: this.fullPrompt.length });\n    });\n  }\n\n  // \n  getIsGenerating(): boolean {\n    return this.isGenerating;\n  }\n\n  // AI - \n  async triggerAiResponse(_immediate: boolean = false): Promise<void> {\n    if (this.isGenerating || !this.blmxManager) return;\n\n    // AppController\n\n    // \n    if ((window as any).BLMX_PROCESSING_AI_RESPONSE) {\n      logger.debug('AiResponseManager', 'AI');\n      return;\n    }\n\n    // \n    (window as any).BLMX_PROCESSING_AI_RESPONSE = true;\n    this.isGenerating = true;\n\n    try {\n      // getContextForAI should now get all necessary context from the main log.\n      let contextForAI = this.blmxManager.getContextForAI();\n\n      contextForAI +=\n        '\\nBLMX_LOGUSERCHAR\\n';\n      this.latestSentPrompt = contextForAI;\n\n      // Clean up 'isNewForAI' flags from the main log after generating context.\n      this.blmxManager.logEntries.forEach(entry => {\n        if ('type' in entry && entry.type === 'image' && 'content' in entry && (entry.content as any).isNewForAI) {\n          (entry.content as any).value = `[]`;\n          delete (entry.content as any).isNewForAI;\n        }\n      });\n\n      // \n      this.eventHandler.setHasPendingNotifications(false);\n\n      const MAX_RETRIES = 2;\n      let attempt = 0;\n      let success = false;\n\n      while (attempt <= MAX_RETRIES && !success) {\n        if (attempt > 0) {\n          logger.warn('AiResponseManager', `AI`, { attempt: attempt + 1, maxRetries: MAX_RETRIES + 1 });\n          await new Promise(resolve => setTimeout(resolve, 1000 * attempt));\n        }\n\n        try {\n          // \n          this.uiRenderer.showGeneratingIndicator();\n\n          const stream = await getTavernHelper().generate({ user_input: contextForAI, should_stream: true });\n          let finalAiResponse = '';\n\n          for await (const chunk of stream) {\n            finalAiResponse += chunk;\n          }\n\n          // \n          this.uiRenderer.hideGeneratingIndicator();\n          this.latestAiRawResponse = finalAiResponse.trim();\n\n          // \n          if (!this.rawAiResponse) {\n            this.rawAiResponse = finalAiResponse.trim();\n            logger.debug('AiResponseManager', 'AI', { length: this.rawAiResponse.length });\n          }\n\n          //  - \n          let processedResponse = finalAiResponse.trim();\n          const len = processedResponse.length;\n\n          // \n          if (len > 0 && len % 2 === 0) {\n            const firstHalf = processedResponse.substring(0, len / 2);\n            const secondHalf = processedResponse.substring(len / 2);\n\n            if (firstHalf === secondHalf && firstHalf.trim() !== '') {\n              logger.warn('AiResponseManager', 'AI');\n              processedResponse = firstHalf;\n            }\n          }\n\n          // \n          const lines = processedResponse.split('\\n').filter(line => line.trim() !== '');\n          if (lines.length > 1) {\n            const uniqueLines = (window as any)._.uniq(lines);\n            // \n            if (uniqueLines.length < lines.length * 0.7) {\n              logger.warn('AiResponseManager', 'AI');\n              processedResponse = uniqueLines.join('\\n');\n            }\n          }\n\n          if (processedResponse.trim()) {\n            // AI\n            success = await this.processAiResponse(processedResponse.trim());\n          }\n        } catch (error) {\n          logger.error('AiResponseManager', `${attempt}`, { attempt, error });\n          this.uiRenderer.hideGeneratingIndicator();\n\n          if (attempt >= MAX_RETRIES) {\n            this.showErrorMessage('AI (F12)');\n          }\n        }\n\n        attempt++;\n      }\n\n      if (!success && attempt > MAX_RETRIES) {\n        console.error(`[BLMX] AI generation failed after ${MAX_RETRIES + 1} attempts (empty response).`);\n        this.showErrorMessage('(AI)');\n        this.latestAiRawResponse = '[AI]';\n      }\n\n      await this.blmxManager.persistLogToStorage();\n\n      // AI\n      this.uiRenderer.refreshAllTimestamps();\n    } catch (error) {\n      console.error('[BLMX] Error in triggerAiResponse:', error);\n    } finally {\n      // \n      this.isGenerating = false;\n      (window as any).BLMX_PROCESSING_AI_RESPONSE = false;\n    }\n  }\n\n  // AI\n  private async processAiResponse(response: string): Promise<boolean> {\n    const entriesForAnimation: LogEntry[] = [];\n    let hasNewCharMoments = false;\n\n    // \n    const processedResponse = response.replace(/^\\s*[[{].*[\\]}]\\s*$/gm, match => {\n      const parsed = safeJsonParse(match.trim());\n      return parsed !== null ? match : '';\n    });\n\n    const responseLines = processedResponse.split('\\n').filter(line => line.trim() !== '');\n    logger.debug('AiResponseManager', 'AI', { lineCount: responseLines.length });\n\n    responseLines.forEach(line => {\n      const separatorIndex = line.indexOf(':');\n      if (separatorIndex === -1) {\n        logger.debug('AiResponseManager', '', { line });\n        return;\n      }\n\n      const key = line.substring(0, separatorIndex).trim();\n      const value = line.substring(separatorIndex + 1).trim();\n      logger.debug('AiResponseManager', '', {\n        key,\n        valuePreview: value.substring(0, 50) + (value.length > 50 ? '...' : ''),\n        valueLength: value.length,\n      });\n\n      if (!key || !value) return;\n\n      try {\n        let newEntry: LogEntry | null = null;\n        // case\n        const id = `ai-${Date.now()}-${Math.random()}`;\n        let voiceMatch: RegExpMatchArray | null = null;\n        let stickerMatch: RegExpMatchArray | null = null;\n        let imageMatch: RegExpMatchArray | null = null;\n        let locationMatch: RegExpMatchArray | null = null;\n        let transferMatch: RegExpMatchArray | null = null;\n        let fileMatch: RegExpMatchArray | null = null;\n        let giftMatch: RegExpMatchArray | null = null;\n\n        switch (key) {\n          case 'CHAR_MOMENT':\n          case 'CHAR_COMMENT':\n          case 'CHAR_LIKE':\n            newEntry = { key, data: safeJsonParse(value) } as any;\n            this.blmxManager.addEntry(newEntry);\n\n            // \n            if (newEntry) {\n              entriesForAnimation.push(newEntry);\n              hasNewCharMoments = true;\n            }\n\n            // \n            if (this.momentsManager) {\n              this.momentsManager.renderMomentsFeed();\n            }\n            break;\n\n          case 'message': {\n            const parsedMessageContent = safeJsonParse(value);\n            newEntry = {\n              id: `ai-${Date.now()}-${Math.random()}`,\n              type: 'message',\n              sender: 'them',\n              content: parsedMessageContent !== null ? parsedMessageContent : value,\n            } as any;\n            this.blmxManager.addEntry(newEntry);\n            if (newEntry) entriesForAnimation.push(newEntry);\n            break;\n          }\n\n          case 'CHAR':\n            // CHAR\n            voiceMatch = value.match(/^\\[:\\s*({.*})\\]/);\n            stickerMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            imageMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            locationMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            transferMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            fileMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            giftMatch = value.match(/^\\[:\\s*(.*)\\]/);\n\n            if (voiceMatch) {\n              const parsedVoiceData = safeJsonParse(voiceMatch[1]);\n              newEntry = {\n                id,\n                type: 'voice',\n                sender: 'them',\n                content: parsedVoiceData || { text: '', duration: 0 },\n              };\n            } else if (stickerMatch) {\n              newEntry = {\n                id,\n                type: 'sticker',\n                sender: 'them',\n                content: stickerMatch[1],\n              };\n            } else if (imageMatch) {\n              const parsedImageData = safeJsonParse(imageMatch[1]);\n              if (parsedImageData !== null) {\n                // JSON\n                newEntry = {\n                  id,\n                  type: 'image',\n                  sender: 'them',\n                  content: parsedImageData,\n                };\n              } else {\n                // \n                newEntry = {\n                  id,\n                  type: 'image',\n                  sender: 'them',\n                  content: { type: 'desc', value: imageMatch[1] },\n                };\n              }\n            } else if (locationMatch) {\n              newEntry = {\n                id,\n                type: 'location',\n                sender: 'them',\n                content: locationMatch[1],\n              };\n            } else if (transferMatch) {\n              try {\n                newEntry = {\n                  id,\n                  type: 'transfer',\n                  sender: 'them',\n                  content: transferMatch[1],\n                  data: safeJsonParse(transferMatch[1]) || { amount: 0, message: '' },\n                } as any;\n              } catch (e) {\n                console.error('Failed to parse transfer data:', transferMatch[1], e);\n              }\n            } else if (fileMatch) {\n              try {\n                newEntry = {\n                  id,\n                  type: 'file',\n                  sender: 'them',\n                  content: fileMatch[1],\n                  data: safeJsonParse(fileMatch[1]) || { name: '', size: 0, url: '' },\n                } as any;\n              } catch (e) {\n                console.error('Failed to parse file data:', fileMatch[1], e);\n              }\n            } else if (giftMatch) {\n              try {\n                newEntry = {\n                  id,\n                  type: 'gift',\n                  sender: 'them',\n                  content: giftMatch[1],\n                  data: safeJsonParse(giftMatch[1]) || { name: '', value: 0 },\n                } as any;\n              } catch (e) {\n                console.error('Failed to parse gift data:', giftMatch[1], e);\n              }\n            } else {\n              // \n              newEntry = {\n                id,\n                type: 'message',\n                sender: 'them',\n                content: value,\n              };\n            }\n\n            if (newEntry) {\n              this.blmxManager.addEntry(newEntry);\n              entriesForAnimation.push(newEntry);\n            }\n            break;\n\n          case 'sticker': {\n            const parsedStickerContent = safeJsonParse(value);\n            newEntry = {\n              id: `ai-sticker-${Date.now()}-${Math.random()}`,\n              type: 'sticker',\n              sender: 'them',\n              content: parsedStickerContent !== null ? parsedStickerContent : value,\n            } as any;\n            this.blmxManager.addEntry(newEntry);\n            if (newEntry) entriesForAnimation.push(newEntry);\n            break;\n          }\n\n          case 'voice':\n            newEntry = {\n              id: `ai-voice-${Date.now()}-${Math.random()}`,\n              type: 'voice',\n              sender: 'them',\n              content: JSON.parse(value),\n            } as any;\n            this.blmxManager.addEntry(newEntry);\n            if (newEntry) entriesForAnimation.push(newEntry);\n            break;\n\n          case 'image':\n            newEntry = {\n              id: `ai-image-${Date.now()}-${Math.random()}`,\n              type: 'image',\n              sender: 'them',\n              content: JSON.parse(value),\n            } as any;\n            this.blmxManager.addEntry(newEntry);\n            if (newEntry) entriesForAnimation.push(newEntry);\n            break;\n\n          case 'location':\n            newEntry = {\n              id: `ai-location-${Date.now()}-${Math.random()}`,\n              type: 'location',\n              sender: 'them',\n              content: JSON.parse(value),\n            } as any;\n            this.blmxManager.addEntry(newEntry);\n            if (newEntry) entriesForAnimation.push(newEntry);\n            break;\n\n          case 'transfer':\n            newEntry = {\n              id: `ai-transfer-${Date.now()}-${Math.random()}`,\n              type: 'transfer',\n              sender: 'them',\n              content: JSON.parse(value),\n            } as any;\n            this.blmxManager.addEntry(newEntry);\n            if (newEntry) entriesForAnimation.push(newEntry);\n            break;\n\n          case 'file':\n            newEntry = {\n              id: `ai-file-${Date.now()}-${Math.random()}`,\n              type: 'file',\n              sender: 'them',\n              content: JSON.parse(value),\n            } as any;\n            this.blmxManager.addEntry(newEntry);\n            if (newEntry) entriesForAnimation.push(newEntry);\n            break;\n\n          case 'gift':\n            newEntry = {\n              id: `ai-gift-${Date.now()}-${Math.random()}`,\n              type: 'gift',\n              sender: 'them',\n              content: JSON.parse(value),\n            } as any;\n            this.blmxManager.addEntry(newEntry);\n            if (newEntry) entriesForAnimation.push(newEntry);\n            break;\n\n          case 'RECALL': {\n            const recallData = safeJsonParse(value);\n            const senderToFind = recallData.sender === 'USER' ? 'me' : 'them';\n            const entryToRecall = this.blmxManager.logEntries\n              .slice()\n              .reverse()\n              .find(\n                e =>\n                  'sender' in e && e.sender === senderToFind && 'content' in e && e.content === recallData.target_text,\n              ) as any;\n\n            if (entryToRecall) {\n              // \"\"\n              entriesForAnimation.push({\n                type: 'recall_instruction',\n                content: {\n                  originalEntry: entryToRecall,\n                  recallTimestamp: recallData.timestamp,\n                },\n              } as any);\n            }\n            break;\n          }\n\n          case 'EVENT_LOG':\n          case 'TIME':\n            newEntry = {\n              type: key === 'TIME' ? 'time' : 'event',\n              content: safeJsonParse(value),\n            } as any;\n            this.blmxManager.addEntry(newEntry);\n            if (newEntry) entriesForAnimation.push(newEntry);\n            break;\n\n          default:\n            logger.warn('AiResponseManager', 'AI', { key });\n        }\n      } catch (error) {\n        console.error(`[BLMX] Error processing AI response line \"${line}\":`, error);\n      }\n    });\n\n    // \n    if (entriesForAnimation.length > 0) {\n      await this.displayAiEntriesSequentially(entriesForAnimation);\n\n      // \n      if (hasNewCharMoments && this.momentsManager) {\n        // \n        const userInMomentsView = $('#moments-view').hasClass('active');\n        if (!userInMomentsView) {\n          this.momentsManager.setMomentNotification(true);\n        } else {\n          // \n          this.momentsManager.setLastMomentViewTimestamp();\n        }\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  // \n  private showErrorMessage(message: string): void {\n    const $errorDiv = $('<div>').addClass('ai-error-message').text(message);\n\n    $('.wechat-body').append($errorDiv);\n\n    setTimeout(() => {\n      $errorDiv.remove();\n    }, 5000);\n  }\n\n  // AI\n  async displayAiEntriesSequentially(entries: LogEntry[]): Promise<void> {\n    // \"\"\n    const messageLikeTypes = ['message', 'sticker', 'voice', 'image', 'location', 'transfer', 'file', 'gift'];\n    for (const entry of entries) {\n      // \n      const entryIndex = this.blmxManager.logEntries.findIndex(log => {\n        // IDID\n        if ('id' in log && 'id' in entry && log.id === entry.id) {\n          return true;\n        }\n\n        // key\n        if ('key' in log && 'key' in entry && log.key === entry.key) {\n          // \n          if (entry.key.includes('_MOMENT')) {\n            return (window as any)._.isEqual((log as any).data, (entry as any).data);\n          }\n\n          // \n          if (entry.key.includes('_LIKE') || entry.key.includes('_COMMENT')) {\n            return (window as any)._.isEqual((log as any).data, (entry as any).data);\n          }\n        }\n\n        // IDTIMEEVENT_LOG\n        if (\n          'type' in log &&\n          'type' in entry &&\n          (log.type === 'time' || log.type === 'event') &&\n          log.type === entry.type &&\n          (window as any)._.isEqual(log.content, (entry as any).content)\n        ) {\n          return true;\n        }\n\n        // \n        if (\n          'type' in log &&\n          'type' in entry &&\n          'sender' in log &&\n          'sender' in entry &&\n          'content' in log &&\n          'content' in entry &&\n          log.type === entry.type &&\n          log.sender === entry.sender\n        ) {\n          // \n          if (typeof log.content === 'string' && typeof (entry as any).content === 'string') {\n            return log.content === (entry as any).content;\n          }\n          // lodash\n          return (window as any)._.isEqual(log.content, (entry as any).content);\n        }\n\n        return false;\n      });\n\n      if (entryIndex !== -1) {\n        logger.debug('AiResponseManager', '', {\n          entryIndex,\n          entryType: 'type' in entry ? entry.type : 'unknown',\n        });\n      }\n\n      // \"\"\n      if ('type' in entry && messageLikeTypes.includes(entry.type)) {\n        // \n        this.uiRenderer.showTypingIndicator();\n\n        const messageText =\n          entry.type === 'message' ? entry.content : entry.type === 'voice' ? (entry.content as any).text : '';\n\n        const delay = this.uiRenderer.calculateTypingDelay(messageText);\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        this.uiRenderer.hideTypingIndicator();\n        this.uiRenderer.renderEntry(entry, entryIndex !== -1 ? entryIndex : undefined, true);\n      } else if ('type' in entry && (entry.type as any) === 'recall_instruction') {\n        // \n        const { originalEntry, recallTimestamp } = (entry as any).content;\n\n        // \n        const entryToUpdate = this.blmxManager.logEntries.find(log => 'id' in log && log.id === originalEntry.id);\n        if (entryToUpdate) {\n          (entryToUpdate as any).recalled = true;\n          (entryToUpdate as any).recalled_content = originalEntry.content;\n          (entryToUpdate as any).recalled_timestamp = recallTimestamp;\n\n          // \n          const recallEntryIndex = this.blmxManager.logEntries.indexOf(entryToUpdate);\n\n          // UIDOM\n          const $elementToReplace = $(`[data-message-id=\"${originalEntry.id}\"]`);\n          if ($elementToReplace.length) {\n            // \n            await new Promise(resolve => setTimeout(resolve, 500));\n            this.uiRenderer.renderRecallNotice(entryToUpdate, $elementToReplace[0] as HTMLElement, recallEntryIndex);\n          }\n        }\n      } else {\n        //  ( EVENT_LOG, TIME)\n        this.uiRenderer.renderEntry(entry, entryIndex !== -1 ? entryIndex : undefined, true);\n      }\n\n      // \n      await new Promise(resolve => setTimeout(resolve, 800));\n    }\n\n    // \n    this.uiRenderer.refreshAllTimestamps();\n  }\n\n  /**\n   * \n   */\n  cleanup(): void {\n    this.eventManager.cleanup();\n  }\n\n  // AI\n  getLatestAiRawResponse(): string {\n    return this.latestAiRawResponse;\n  }\n\n  // \n  getLatestSentPrompt(): string {\n    return this.latestSentPrompt;\n  }\n\n  // AI\n  getRawAiResponse(): string {\n    return this.rawAiResponse;\n  }\n\n  // \n  getFullPrompt(): string {\n    return this.fullPrompt;\n  }\n}\n","// \n// \n\nimport { SafeStorage } from './utils';\n\n// \nexport interface AppConfig {\n  avatars: {\n    user: string;\n    char: string;\n  };\n  names: {\n    user: string;\n    char: string;\n  };\n  charRemark: string;\n  currentCharId: string;\n}\n\n// \nexport interface Sticker {\n  label: string;\n  url: string;\n}\n\n// \nexport const STORAGE_KEYS = {\n  GLOBAL_STICKER: 'blmx_wechat_stickers_global_blmx', // \n  CHAR_STICKER_PREFIX: 'blmx_char_stickers_blmx_', // \n  PHONE_SIZE: 'blmx_phone_size',\n  FULLSCREEN_SIZE: 'blmx_fullscreen_size',\n  STICKER_SIZE: 'blmx_sticker_size',\n  MOMENT_NOTIFICATION: 'blmx_moment_notification',\n  MOMENT_LAST_VIEW: 'blmx_moment_last_view',\n  USER_NAME_PREFIX: 'blmx_user_name_',\n  USER_AVATAR_PREFIX: 'blmx_user_avatar_',\n  CHAR_AVATAR_PREFIX: 'blmx_char_avatar_',\n  CHAR_REMARK_PREFIX: 'blmx_remark_',\n  COVER_PHOTO_PREFIX: 'blmx_cover_photo_',\n  SIGNATURE_PREFIX: 'blmx_signature_',\n  INPUT_PLACEHOLDER_PREFIX: 'blmx_input_placeholder_',\n  LAST_NOTIFIED_VERSION: 'blmx_last_notified_version',\n} as const;\n\n// \nexport const PHONE_SIZES = {\n  default: '48.75rem', // : 48.75rem (780px)\n  medium: '42rem', // : 42rem (672px)\n  small: '36rem', // : 36rem (576px)\n} as const;\n\n// \nexport const FULLSCREEN_SIZES = {\n  default: 100, // 100%\n  large: 130, // 130%\n  xlarge: 160, // 160%\n} as const;\n\n// \nexport class ConfigManager {\n  private config: AppConfig;\n  private defaultGlobalStickers: Sticker[] = [{ label: '', url: 'https://files.catbox.moe/3j0tpc.jpeg' }];\n\n  constructor() {\n    // \n    this.config = {\n      avatars: { user: '', char: '' },\n      names: { user: 'User', char: 'Character' },\n      charRemark: '',\n      currentCharId: '',\n    };\n  }\n\n  // \n  getConfig(): AppConfig {\n    return this.config;\n  }\n\n  // \n  setConfig(config: Partial<AppConfig>): void {\n    this.config = { ...this.config, ...config };\n  }\n\n  // \n  getDisplayName(type: 'user' | 'char'): string {\n    if (type === 'char') {\n      return this.config.charRemark || this.config.names.char;\n    }\n    return this.config.names.user;\n  }\n\n  // \n  updateAvatar(avatarType: 'user' | 'char', newUrl: string): void {\n    this.config.avatars[avatarType] = newUrl;\n    const storageKey =\n      avatarType === 'user'\n        ? `${STORAGE_KEYS.USER_AVATAR_PREFIX}${this.config.currentCharId}`\n        : `${STORAGE_KEYS.CHAR_AVATAR_PREFIX}${this.config.currentCharId}`;\n    localStorage.setItem(storageKey, newUrl);\n  }\n\n  // \n  updateCharRemark(newRemark: string): void {\n    this.config.charRemark = newRemark;\n    localStorage.setItem(`${STORAGE_KEYS.CHAR_REMARK_PREFIX}${this.config.currentCharId}`, newRemark);\n  }\n\n  // \n  updateUserName(newName: string): void {\n    this.config.names.user = newName;\n    localStorage.setItem(`${STORAGE_KEYS.USER_NAME_PREFIX}${this.config.currentCharId}`, newName);\n  }\n\n  // URL - \n  findStickerUrlByName(name: string): string | undefined {\n    // \n    let customGlobalStickers = SafeStorage.getItem<any[]>(STORAGE_KEYS.GLOBAL_STICKER, []) || [];\n    let charStickers =\n      SafeStorage.getItem<any[]>(`${STORAGE_KEYS.CHAR_STICKER_PREFIX}${this.config.currentCharId}`, []) || [];\n\n    // \n    if (customGlobalStickers.length === 0) {\n      const oldGlobalStickers = SafeStorage.getItem<any[]>('blmx_wechat_stickers_global', []) || [];\n      if (oldGlobalStickers.length > 0) {\n        // \n        SafeStorage.setItem(STORAGE_KEYS.GLOBAL_STICKER, oldGlobalStickers);\n        customGlobalStickers = oldGlobalStickers;\n        console.log('[BLMX] ');\n      }\n    }\n\n    if (charStickers.length === 0) {\n      const oldCharStickers = SafeStorage.getItem<any[]>(`blmx_char_stickers_${this.config.currentCharId}`, []) || [];\n      if (oldCharStickers.length > 0) {\n        // \n        SafeStorage.setItem(`${STORAGE_KEYS.CHAR_STICKER_PREFIX}${this.config.currentCharId}`, oldCharStickers);\n        charStickers = oldCharStickers;\n        console.log('[BLMX] ');\n      }\n    }\n\n    const globalStickers = [...this.defaultGlobalStickers, ...customGlobalStickers];\n    return [...globalStickers, ...charStickers].find((s: Sticker) => s.label === name)?.url;\n  }\n\n  // localStorage\n  async loadFromStorage(charData: any): Promise<void> {\n    this.config.currentCharId = charData.name;\n    this.config.names.char = charData.name;\n\n    // \n    this.config.charRemark =\n      localStorage.getItem(`${STORAGE_KEYS.CHAR_REMARK_PREFIX}${this.config.currentCharId}`) || '';\n    this.config.names.user =\n      localStorage.getItem(`${STORAGE_KEYS.USER_NAME_PREFIX}${this.config.currentCharId}`) || 'User';\n    this.config.avatars.user =\n      localStorage.getItem(`${STORAGE_KEYS.USER_AVATAR_PREFIX}${this.config.currentCharId}`) || '';\n\n    // \n    const savedCharAvatar = localStorage.getItem(`${STORAGE_KEYS.CHAR_AVATAR_PREFIX}${this.config.currentCharId}`);\n    if (savedCharAvatar) {\n      this.config.avatars.char = savedCharAvatar;\n    } else {\n      // \n      // \n      this.config.avatars.char = '';\n    }\n  }\n\n  // \n  getMomentNotificationState(): boolean {\n    const notificationState = localStorage.getItem(`${STORAGE_KEYS.MOMENT_NOTIFICATION}_${this.config.currentCharId}`);\n    return notificationState === 'true';\n  }\n\n  // \n  setMomentNotificationState(value: boolean): void {\n    localStorage.setItem(`${STORAGE_KEYS.MOMENT_NOTIFICATION}_${this.config.currentCharId}`, value.toString());\n  }\n\n  // \n  getLastMomentViewTimestamp(): number {\n    const lastView = localStorage.getItem(`${STORAGE_KEYS.MOMENT_LAST_VIEW}_${this.config.currentCharId}`);\n    return lastView ? parseInt(lastView, 10) : 0;\n  }\n\n  // \n  setLastMomentViewTimestamp(timestamp: number): void {\n    localStorage.setItem(`${STORAGE_KEYS.MOMENT_LAST_VIEW}_${this.config.currentCharId}`, timestamp.toString());\n  }\n\n  // \n  getSavedCoverPhoto(): string | null {\n    return localStorage.getItem(`${STORAGE_KEYS.COVER_PHOTO_PREFIX}${this.config.currentCharId}`);\n  }\n\n  // \n  setCoverPhoto(url: string): void {\n    localStorage.setItem(`${STORAGE_KEYS.COVER_PHOTO_PREFIX}${this.config.currentCharId}`, url);\n  }\n\n  // \n  getSavedSignature(): string {\n    return localStorage.getItem(`${STORAGE_KEYS.SIGNATURE_PREFIX}${this.config.currentCharId}`) || '';\n  }\n\n  // \n  setSignature(signature: string): void {\n    localStorage.setItem(`${STORAGE_KEYS.SIGNATURE_PREFIX}${this.config.currentCharId}`, signature);\n  }\n\n  // \n  getSavedInputPlaceholder(): string | null {\n    return localStorage.getItem(`${STORAGE_KEYS.INPUT_PLACEHOLDER_PREFIX}${this.config.currentCharId}`);\n  }\n\n  // \n  setInputPlaceholder(placeholder: string): void {\n    localStorage.setItem(`${STORAGE_KEYS.INPUT_PLACEHOLDER_PREFIX}${this.config.currentCharId}`, placeholder);\n  }\n\n  // \n  getPhoneSize(): 'default' | 'medium' | 'small' {\n    const savedSize = localStorage.getItem(STORAGE_KEYS.PHONE_SIZE) || 'default';\n    return savedSize === 'medium' ? 'medium' : savedSize === 'small' ? 'small' : 'default';\n  }\n\n  // \n  setPhoneSize(size: 'default' | 'medium' | 'small'): void {\n    localStorage.setItem(STORAGE_KEYS.PHONE_SIZE, size);\n  }\n\n  // \n  getFullscreenSize(): number {\n    const savedSize = localStorage.getItem(STORAGE_KEYS.FULLSCREEN_SIZE) || '100';\n    const size = parseInt(savedSize, 10);\n    // \n    return Math.max(50, Math.min(200, size));\n  }\n\n  // \n  setFullscreenSize(size: number): void {\n    // \n    const clampedSize = Math.max(50, Math.min(200, size));\n    localStorage.setItem(STORAGE_KEYS.FULLSCREEN_SIZE, clampedSize.toString());\n  }\n\n  // \n  getStickerSize(): number {\n    const savedSize = localStorage.getItem(STORAGE_KEYS.STICKER_SIZE) || '120';\n    return parseInt(savedSize, 10);\n  }\n\n  // \n  setStickerSize(size: number): void {\n    localStorage.setItem(STORAGE_KEYS.STICKER_SIZE, size.toString());\n  }\n\n  // \n  getLastNotifiedVersion(): string | null {\n    return localStorage.getItem(STORAGE_KEYS.LAST_NOTIFIED_VERSION);\n  }\n\n  // \n  setLastNotifiedVersion(version: string): void {\n    localStorage.setItem(STORAGE_KEYS.LAST_NOTIFIED_VERSION, version);\n  }\n}\n","// debug-data.ts\n// \n// \n\nimport { LogEntry } from './script';\n\n// \nconst getCurrentDate = (): string => {\n  const now = new Date();\n  return `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now\n    .getDate()\n    .toString()\n    .padStart(2, '0')}`;\n};\n\nconst getCurrentTime = (): string => {\n  const now = new Date();\n  return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;\n};\n\n// ID\nconst generateId = (prefix: string): string => {\n  return `${prefix}_${Date.now()}_${Math.floor(Math.random() * 1000)}`;\n};\n\n// \nexport const debugData: LogEntry[] = [\n  // \n  {\n    type: 'time',\n    content: {\n      date: getCurrentDate(),\n      time: getCurrentTime(),\n    },\n  },\n\n  // \n  {\n    type: 'event',\n    content: {\n      date: getCurrentDate(),\n      time: getCurrentTime(),\n      description: '',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('msg'),\n    type: 'message',\n    sender: 'me',\n    content: '',\n  },\n\n  //  - AI\n  {\n    id: generateId('msg'),\n    type: 'message',\n    sender: 'them',\n    content: 'AI',\n  },\n\n  //  - \n  {\n    id: generateId('sticker'),\n    type: 'sticker',\n    sender: 'me',\n    content: '',\n  },\n\n  //  - AI\n  {\n    id: generateId('sticker'),\n    type: 'sticker',\n    sender: 'them',\n    content: '',\n  },\n\n  //  - \n  {\n    id: generateId('img'),\n    type: 'image',\n    sender: 'me',\n    content: {\n      type: 'url',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n    },\n  },\n\n  //  - AI\n  {\n    id: generateId('img'),\n    type: 'image',\n    sender: 'them',\n    content: {\n      type: 'url',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('img'),\n    type: 'image',\n    sender: 'them',\n    content: {\n      type: 'desc',\n      value: '',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('voice'),\n    type: 'voice',\n    sender: 'me',\n    content: {\n      text: '',\n      duration: 5,\n    },\n  },\n\n  //  - AI\n  {\n    id: generateId('voice'),\n    type: 'voice',\n    sender: 'them',\n    content: {\n      text: 'AI',\n      duration: 8,\n    },\n  },\n\n  //  - \n  {\n    id: generateId('loc'),\n    type: 'location',\n    sender: 'me',\n    content: '',\n  },\n\n  //  - AI\n  {\n    id: generateId('loc'),\n    type: 'location',\n    sender: 'them',\n    content: '',\n  },\n\n  //  - \n  {\n    id: generateId('transfer'),\n    type: 'transfer',\n    sender: 'me',\n    content: JSON.stringify({\n      amount: '88.88',\n      note: '',\n      status: 'sent',\n    }),\n    data: {\n      amount: '88.88',\n      note: '',\n      status: 'sent',\n    },\n  },\n\n  //  - AI\n  {\n    id: generateId('transfer'),\n    type: 'transfer',\n    sender: 'them',\n    content: JSON.stringify({\n      amount: '88.88',\n      note: '',\n      status: 'accepted',\n    }),\n    data: {\n      amount: '88.88',\n      note: '',\n      status: 'accepted',\n    },\n  },\n\n  //  - AI\n  {\n    id: generateId('transfer'),\n    type: 'transfer',\n    sender: 'them',\n    content: JSON.stringify({\n      amount: '66.66',\n      note: 'AI',\n      status: 'sent',\n    }),\n    data: {\n      amount: '66.66',\n      note: 'AI',\n      status: 'sent',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('transfer'),\n    type: 'transfer',\n    sender: 'me',\n    content: JSON.stringify({\n      amount: '66.66',\n      note: 'AI',\n      status: 'accepted',\n    }),\n    data: {\n      amount: '66.66',\n      note: 'AI',\n      status: 'accepted',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('gift'),\n    type: 'gift',\n    sender: 'me',\n    content: JSON.stringify({\n      name: '',\n      price: '99.99',\n      status: 'sent',\n    }),\n    data: {\n      name: '',\n      price: '99.99',\n      status: 'sent',\n    },\n  },\n\n  //  - AI\n  {\n    id: generateId('gift'),\n    type: 'gift',\n    sender: 'them',\n    content: JSON.stringify({\n      name: '',\n      status: 'accepted',\n    }),\n    data: {\n      name: '',\n      status: 'accepted',\n    },\n  },\n\n  //  - AI\n  {\n    id: generateId('gift'),\n    type: 'gift',\n    sender: 'them',\n    content: JSON.stringify({\n      name: '',\n      price: '39.99',\n      status: 'sent',\n    }),\n    data: {\n      name: '',\n      price: '39.99',\n      status: 'sent',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('gift'),\n    type: 'gift',\n    sender: 'me',\n    content: JSON.stringify({\n      name: '',\n      status: 'accepted',\n    }),\n    data: {\n      name: '',\n      status: 'accepted',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('file'),\n    type: 'file',\n    sender: 'me',\n    content: '.docx',\n  },\n\n  //  - AI\n  {\n    id: generateId('file'),\n    type: 'file',\n    sender: 'them',\n    content: '.pdf',\n  },\n\n  //  - \n  {\n    key: 'USER_MOMENT',\n    data: {\n      text: '',\n      image: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg',\n      image_type: 'url',\n      date: getCurrentDate(),\n      time: getCurrentTime(),\n    },\n  },\n\n  //  - AI\n  {\n    key: 'CHAR_MOMENT',\n    data: {\n      text: 'AI',\n      image: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      image_type: 'url',\n      date: getCurrentDate(),\n      time: getCurrentTime(),\n    },\n  },\n\n  //  - \n  {\n    key: 'CHAR_MOMENT',\n    data: {\n      text: '',\n      image: '',\n      image_type: 'none',\n      date: getCurrentDate(),\n      time: getCurrentTime(),\n    },\n  },\n\n  //  - \n  {\n    key: 'USER_MOMENT',\n    data: {\n      text: '',\n      image: '',\n      image_type: 'desc',\n      image_desc: '',\n      date: getCurrentDate(),\n      time: getCurrentTime(),\n    },\n  },\n\n  //  - \n  {\n    key: 'USER_COMMENT',\n    data: {\n      text: '',\n      target_post_id: 1,\n    },\n  },\n\n  //  - AI\n  {\n    key: 'CHAR_COMMENT',\n    data: {\n      text: 'AI',\n      target_post_id: 0,\n    },\n  },\n\n  //  - \n  {\n    key: 'USER_LIKE',\n    data: {\n      target_post_id: 1,\n    },\n  },\n\n  //  - AI\n  {\n    key: 'CHAR_LIKE',\n    data: {\n      target_post_id: 0,\n    },\n  },\n\n  // \n  {\n    id: generateId('msg'),\n    type: 'message',\n    sender: 'them',\n    content: '',\n    recalled: true,\n    recalled_content: '',\n    recalled_timestamp: getCurrentTime(),\n  },\n];\n\n//  - \nexport function loadDebugData(blmxManager: any): void {\n  // \n  const isDevelopment = window.location.hostname === 'localhost' || window.location.search.includes('debug=true');\n\n  if (!isDevelopment) {\n    console.log('[DEBUG] ');\n    return;\n  }\n\n  console.log('[DEBUG] ...');\n\n  // \n  const batchSize = 10;\n  let index = 0;\n\n  const addBatch = () => {\n    const batch = debugData.slice(index, index + batchSize);\n    batch.forEach(entry => {\n      blmxManager.addEntry(entry);\n    });\n\n    index += batchSize;\n\n    if (index < debugData.length) {\n      // requestAnimationFrameUI\n      requestAnimationFrame(addBatch);\n    } else {\n      console.log('[DEBUG] ', debugData.length, '');\n    }\n  };\n\n  addBatch();\n}\n\n// \nexport function clearDebugData(blmxManager: any): void {\n  console.log('[DEBUG] ...');\n  blmxManager.logEntries = [];\n  console.log('[DEBUG] ');\n}\n\n// \nexport function addTestEntry(blmxManager: any, entryType: string): void {\n  let entry: any = null;\n\n  switch (entryType) {\n    case 'text-user':\n      entry = {\n        id: generateId('msg'),\n        type: 'message',\n        sender: 'me',\n        content: '',\n      };\n      break;\n    case 'text-char':\n      entry = {\n        id: generateId('msg'),\n        type: 'message',\n        sender: 'them',\n        content: 'AI',\n      };\n      break;\n    case 'sticker-user':\n      entry = {\n        id: generateId('sticker'),\n        type: 'sticker',\n        sender: 'me',\n        content: '',\n      };\n      break;\n    case 'sticker-char':\n      entry = {\n        id: generateId('sticker'),\n        type: 'sticker',\n        sender: 'them',\n        content: '',\n      };\n      break;\n    case 'image-user':\n      entry = {\n        id: generateId('img'),\n        type: 'image',\n        sender: 'me',\n        content: {\n          type: 'url',\n          value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n        },\n      };\n      break;\n    case 'image-char':\n      entry = {\n        id: generateId('img'),\n        type: 'image',\n        sender: 'them',\n        content: {\n          type: 'url',\n          value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n        },\n      };\n      break;\n    case 'voice-user':\n      entry = {\n        id: generateId('voice'),\n        type: 'voice',\n        sender: 'me',\n        content: {\n          text: '',\n          duration: 3,\n        },\n      };\n      break;\n    case 'voice-char':\n      entry = {\n        id: generateId('voice'),\n        type: 'voice',\n        sender: 'them',\n        content: {\n          text: 'AI',\n          duration: 4,\n        },\n      };\n      break;\n    case 'transfer-user':\n      entry = {\n        id: generateId('transfer'),\n        type: 'transfer',\n        sender: 'me',\n        content: JSON.stringify({\n          amount: '88.88',\n          note: '',\n          status: 'sent',\n        }),\n        data: {\n          amount: '88.88',\n          note: '',\n          status: 'sent',\n        },\n      };\n      break;\n    case 'transfer-char':\n      entry = {\n        id: generateId('transfer'),\n        type: 'transfer',\n        sender: 'them',\n        content: JSON.stringify({\n          amount: '66.66',\n          note: 'AI',\n          status: 'sent',\n        }),\n        data: {\n          amount: '66.66',\n          note: 'AI',\n          status: 'sent',\n        },\n      };\n      break;\n    case 'gift-user':\n      entry = {\n        id: generateId('gift'),\n        type: 'gift',\n        sender: 'me',\n        content: JSON.stringify({\n          name: '',\n          price: '99.99',\n          status: 'sent',\n        }),\n        data: {\n          name: '',\n          price: '99.99',\n          status: 'sent',\n        },\n      };\n      break;\n    case 'gift-char':\n      entry = {\n        id: generateId('gift'),\n        type: 'gift',\n        sender: 'them',\n        content: JSON.stringify({\n          name: '',\n          price: '39.99',\n          status: 'sent',\n        }),\n        data: {\n          name: '',\n          price: '39.99',\n          status: 'sent',\n        },\n      };\n      break;\n    case 'moment-user':\n      entry = {\n        key: 'USER_MOMENT',\n        data: {\n          text: '',\n          image: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg',\n          image_type: 'url',\n          date: getCurrentDate(),\n          time: getCurrentTime(),\n        },\n      };\n      break;\n    case 'moment-char':\n      entry = {\n        key: 'CHAR_MOMENT',\n        data: {\n          text: 'AI',\n          image: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n          image_type: 'url',\n          date: getCurrentDate(),\n          time: getCurrentTime(),\n        },\n      };\n      break;\n    case 'event-short':\n      entry = {\n        type: 'event',\n        content: {\n          date: getCurrentDate(),\n          time: getCurrentTime(),\n          description: '',\n        },\n      };\n      break;\n    case 'event-long':\n      entry = {\n        type: 'event',\n        content: {\n          date: getCurrentDate(),\n          time: getCurrentTime(),\n          description:\n            '',\n        },\n      };\n      break;\n    case 'time':\n      entry = {\n        type: 'time',\n        content: {\n          date: getCurrentDate(),\n          time: getCurrentTime(),\n        },\n      };\n      break;\n    default:\n      console.error('[DEBUG] :', entryType);\n      return;\n  }\n\n  if (entry) {\n    blmxManager.addEntry(entry);\n    blmxManager.persistLogToStorage();\n    console.log(`[DEBUG] : ${entryType}`, entry);\n  }\n}\n\n// \nexport function showTestEntryTypes(): void {\n  console.log('[BLMX Debug] :');\n  console.log('- text-user: ');\n  console.log('- text-char: AI');\n  console.log('- sticker-user: ');\n  console.log('- sticker-char: AI');\n  console.log('- image-user: ');\n  console.log('- image-char: AI');\n  console.log('- voice-user: ');\n  console.log('- voice-char: AI');\n  console.log('- transfer-user: ');\n  console.log('- gift-user: ');\n  console.log('- moment-user: ');\n  console.log('- moment-char: AI');\n  console.log('- event-short: ');\n  console.log('- event-long: ');\n  console.log('- time: ');\n}\n\n// \nexport function showDebugInfo(appController: any): void {\n  console.log('[BLMX Debug] :');\n\n  try {\n    // \n    const rawAiResponse = appController.getRawAiResponse ? appController.getRawAiResponse() : '';\n    const fullPrompt = appController.getFullPrompt ? appController.getFullPrompt() : '';\n    const latestAiRawResponse = appController.getLatestAiRawResponse\n      ? appController.getLatestAiRawResponse()\n      : '';\n    const latestSentPrompt = appController.getLatestSentPrompt ? appController.getLatestSentPrompt() : '';\n\n    console.log('- AI:', rawAiResponse);\n    console.log('- :', fullPrompt);\n    console.log('- AI:', latestAiRawResponse);\n    console.log('- AI:', latestSentPrompt);\n  } catch (error) {\n    console.error('[BLMX Debug] :', error);\n  }\n}\n","// \n// \n\nimport { ConfigManager, Sticker } from './config-manager';\nimport { DialogManager } from './dialog-manager';\nimport { LogEntry } from './script';\n\nexport class InputHandler {\n  private configManager: ConfigManager;\n  private onStageAndDisplayEntry: (entry: LogEntry) => void;\n  private onUpdateFooterButtonsState: () => void;\n  private dialogManager: DialogManager;\n\n  constructor(\n    configManager: ConfigManager,\n    onStageAndDisplayEntry: (entry: LogEntry) => void,\n    onUpdateFooterButtonsState: () => void,\n  ) {\n    this.configManager = configManager;\n    this.onStageAndDisplayEntry = onStageAndDisplayEntry;\n    this.onUpdateFooterButtonsState = onUpdateFooterButtonsState;\n    this.dialogManager = DialogManager.getInstance();\n  }\n\n  // \n  async handleTransferAccept(data: any): Promise<void> {\n    const result = await this.dialogManager.showReceiveDialog('transfer', data);\n    if (result === 'accept') {\n      const acceptData = { ...data, status: 'accepted' };\n      this.onStageAndDisplayEntry({\n        type: 'transfer',\n        sender: 'me',\n        content: JSON.stringify(acceptData),\n        data: acceptData,\n        id: `transfer-${Date.now()}`,\n      } as any);\n    } else if (result === 'reject') {\n      const rejectData = { ...data, status: 'rejected' };\n      this.onStageAndDisplayEntry({\n        type: 'transfer',\n        sender: 'me',\n        content: JSON.stringify(rejectData),\n        data: rejectData,\n        id: `transfer-${Date.now()}`,\n      } as any);\n    }\n  }\n\n  // \n  async handleGiftAction(data: any): Promise<void> {\n    const result = await this.dialogManager.showReceiveDialog('gift', data);\n    if (result === 'accept') {\n      const receiptData = { name: data.name, status: 'accepted' };\n      this.onStageAndDisplayEntry({\n        type: 'gift',\n        sender: 'me',\n        content: JSON.stringify(receiptData),\n        data: receiptData,\n        id: `gift-${Date.now()}`,\n      } as any);\n    } else if (result === 'reject') {\n      const receiptData = { name: data.name, status: 'rejected' };\n      this.onStageAndDisplayEntry({\n        type: 'gift',\n        sender: 'me',\n        content: JSON.stringify(receiptData),\n        data: receiptData,\n        id: `gift-${Date.now()}`,\n      } as any);\n    }\n    // \n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendTextMessage(text: string): void {\n    if (!text.trim()) return;\n\n    const messageEntry: LogEntry = {\n      type: 'message',\n      sender: 'me',\n      content: text.trim(),\n      id: `msg-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(messageEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  //  - \n  sendSticker(stickerName: string): void {\n    const stickerUrl = this.configManager.findStickerUrlByName(stickerName);\n    if (!stickerUrl) {\n      console.error(`[BLMX] : ${stickerName}`);\n      return;\n    }\n\n    // \n    const stickerEntry: LogEntry = {\n      type: 'sticker',\n      sender: 'me',\n      content: stickerName, // \n      id: `sticker-${Date.now()}-${Math.random()}`, // ID\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(stickerEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendImage(imageData: { type: 'url' | 'file'; value: string; name?: string }): void {\n    const imageEntry: LogEntry = {\n      type: 'image',\n      sender: 'me',\n      content: imageData,\n      id: `image-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(imageEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendVoiceMessage(voiceData: { text: string; duration?: number }): void {\n    const voiceEntry: LogEntry = {\n      type: 'voice',\n      sender: 'me',\n      content: voiceData,\n      id: `voice-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(voiceEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendLocation(locationData: { name: string; address: string; latitude?: number; longitude?: number }): void {\n    const locationEntry: LogEntry = {\n      type: 'location',\n      sender: 'me',\n      content: locationData,\n      id: `location-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(locationEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendFile(fileData: { name: string; size: number; type: string; url?: string }): void {\n    const fileEntry: LogEntry = {\n      type: 'file',\n      sender: 'me',\n      content: fileData,\n      id: `file-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(fileEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendTransfer(transferData: { amount: number; note?: string }): void {\n    const transferEntry: LogEntry = {\n      type: 'transfer',\n      sender: 'me',\n      content: transferData,\n      id: `transfer-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(transferEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendGift(giftData: { name: string; image?: string; description?: string }): void {\n    const giftEntry: LogEntry = {\n      type: 'gift',\n      sender: 'me',\n      content: giftData,\n      id: `gift-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(giftEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  async handleFileUpload(file: File): Promise<void> {\n    try {\n      if (file.type.startsWith('image/')) {\n        // \n        const reader = new FileReader();\n        reader.onload = e => {\n          const result = e.target?.result as string;\n          this.sendImage({\n            type: 'file',\n            value: result,\n            name: file.name,\n          });\n        };\n        reader.readAsDataURL(file);\n      } else {\n        // \n        this.sendFile({\n          name: file.name,\n          size: file.size,\n          type: file.type,\n        });\n      }\n    } catch (error) {\n      console.error('[BLMX] :', error);\n      const dialogManager = DialogManager.getInstance();\n      await dialogManager.alert('', '');\n    }\n  }\n\n  // URL\n  async handleImageUrl(url: string): Promise<void> {\n    if (!url.trim()) return;\n\n    // URL\n    try {\n      new URL(url);\n      this.sendImage({\n        type: 'url',\n        value: url.trim(),\n      });\n    } catch (error) {\n      const dialogManager = DialogManager.getInstance();\n      await dialogManager.alert('URL', 'URL');\n    }\n  }\n\n  // \n  async handleVoiceRecording(): Promise<void> {\n    try {\n      const dialogManager = DialogManager.getInstance();\n\n      // \n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n        await dialogManager.alert('', '');\n        return;\n      }\n\n      // \n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\n      //  MediaRecorder API\n      // \n      const text = await dialogManager.prompt(':', '', '');\n      if (text) {\n        this.sendVoiceMessage({\n          text: text.trim(),\n          duration: Math.floor(Math.random() * 30) + 5, // 5-35\n        });\n      }\n\n      // \n      stream.getTracks().forEach(track => track.stop());\n    } catch (error) {\n      console.error('[BLMX] :', error);\n      const dialogManager = DialogManager.getInstance();\n      await dialogManager.alert('', '');\n    }\n  }\n\n  // \n  handleLocationShare(): void {\n    // \n    if (!navigator.geolocation) {\n      alert('');\n      return;\n    }\n\n    navigator.geolocation.getCurrentPosition(\n      position => {\n        const { latitude, longitude } = position.coords;\n        const locationName = prompt(':') || '';\n        const address = prompt(':') || `: ${latitude.toFixed(6)}, : ${longitude.toFixed(6)}`;\n\n        this.sendLocation({\n          name: locationName,\n          address: address,\n          latitude: latitude,\n          longitude: longitude,\n        });\n      },\n      error => {\n        console.error('[BLMX] :', error);\n        // \n        const locationName = prompt(':');\n        const address = prompt(':');\n\n        if (locationName && address) {\n          this.sendLocation({\n            name: locationName,\n            address: address,\n          });\n        }\n      },\n    );\n  }\n\n  // \n  handleTransferSend(): void {\n    const amountStr = prompt(':');\n    if (!amountStr) return;\n\n    const amount = parseFloat(amountStr);\n    if (isNaN(amount) || amount <= 0) {\n      alert('');\n      return;\n    }\n\n    const note = prompt(':') || '';\n\n    this.sendTransfer({\n      amount: amount,\n      note: note,\n    });\n  }\n\n  // \n  handleGiftSend(): void {\n    const giftName = prompt(':');\n    if (!giftName) return;\n\n    const giftImage = prompt('URL:') || '';\n    const description = prompt(':') || '';\n\n    this.sendGift({\n      name: giftName,\n      image: giftImage,\n      description: description,\n    });\n  }\n\n  //  - \n  getStickerList(): Sticker[] {\n    // \n    let globalStickers = JSON.parse(localStorage.getItem('blmx_wechat_stickers_global_blmx') || '[]');\n    let charStickers = JSON.parse(\n      localStorage.getItem(`blmx_char_stickers_blmx_${this.configManager.getConfig().currentCharId}`) || '[]',\n    );\n\n    // \n    if (globalStickers.length === 0) {\n      const oldGlobalStickers = JSON.parse(localStorage.getItem('blmx_wechat_stickers_global') || '[]');\n      if (oldGlobalStickers.length > 0) {\n        globalStickers = oldGlobalStickers;\n      }\n    }\n\n    if (charStickers.length === 0) {\n      const oldCharStickers = JSON.parse(\n        localStorage.getItem(`blmx_char_stickers_${this.configManager.getConfig().currentCharId}`) || '[]',\n      );\n      if (oldCharStickers.length > 0) {\n        charStickers = oldCharStickers;\n      }\n    }\n\n    return [...globalStickers, ...charStickers];\n  }\n\n  // \n  searchStickers(query: string): Sticker[] {\n    const stickers = this.getStickerList();\n    if (!query.trim()) return stickers;\n\n    const searchTerm = query.toLowerCase();\n    return stickers.filter(sticker => sticker.label.toLowerCase().includes(searchTerm));\n  }\n\n  // \n  clearInput(): void {\n    const inputElement = document.getElementById('wechat-input-field') as HTMLInputElement;\n    if (inputElement) {\n      inputElement.value = '';\n      this.onUpdateFooterButtonsState();\n    }\n  }\n\n  // \n  focusInput(): void {\n    const inputElement = document.getElementById('wechat-input-field') as HTMLInputElement;\n    if (inputElement) {\n      inputElement.focus();\n    }\n  }\n\n  // \n  getInputText(): string {\n    const inputElement = document.getElementById('wechat-input-field') as HTMLInputElement;\n    return inputElement ? inputElement.value : '';\n  }\n\n  // \n  setInputText(text: string): void {\n    const inputElement = document.getElementById('wechat-input-field') as HTMLInputElement;\n    if (inputElement) {\n      inputElement.value = text;\n      this.onUpdateFooterButtonsState();\n    }\n  }\n}\n","// \n// \n\nimport { ConfigManager } from './config-manager';\nimport { BLMX_Protocol, LogEntry, MomentEntry } from './script';\nimport { UIRenderer } from './ui-renderer';\n\n// Allow use of lodash as global\n// @ts-ignore\ndeclare const _: any;\n\nexport class MomentsManager {\n  private blmxManager: BLMX_Protocol;\n  private configManager: ConfigManager;\n  private uiRenderer: UIRenderer;\n  private hasMomentNotification: boolean = false;\n\n  constructor(blmxManager: BLMX_Protocol, configManager: ConfigManager, uiRenderer: UIRenderer) {\n    this.blmxManager = blmxManager;\n    this.configManager = configManager;\n    this.uiRenderer = uiRenderer;\n\n    // \n    this.hasMomentNotification = this.configManager.getMomentNotificationState();\n  }\n\n  // \n  renderMomentsFeed(): void {\n    if (!this.blmxManager || !this.uiRenderer) return;\n\n    const logEntries = this.blmxManager.logEntries;\n    const avatars = this.configManager.getConfig().avatars;\n\n    // jQuery\n    const $momentsFeedList = $('#moments-feed-list');\n    if (!$momentsFeedList.length) return;\n\n    // \n    const isCurrentlyInMomentsView = this.isInMomentsView();\n    if (isCurrentlyInMomentsView) {\n      this.setLastMomentViewTimestamp();\n      // \n      this.setMomentNotification(false);\n    }\n\n    $momentsFeedList.empty();\n\n    // lodash\n    const posts: Record<number, any> = {};\n    const momentPostLogIndices = _.reduce(\n      logEntries,\n      (result: number[], entry: LogEntry, index: number) => {\n        if ('key' in entry && entry.key.includes('_MOMENT')) {\n          result.push(index);\n        }\n        return result;\n      },\n      [],\n    );\n\n    // \n    _.forEach(momentPostLogIndices, (logIndex: number) => {\n      const entry = logEntries[logIndex];\n      posts[logIndex] = { ...entry, likes: [], comments: [], id: logIndex };\n    });\n\n    // CHAR\n    let hasNewCharMoments = false;\n    const lastViewTimestamp = this.getLastMomentViewTimestamp();\n    const userInMomentsView = this.isInMomentsView();\n\n    // \n    _.forEach(logEntries, (entry: LogEntry, index: number) => {\n      if ('key' in entry && (entry.key.includes('_LIKE') || entry.key.includes('_COMMENT'))) {\n        // target_post_id\n        const targetPostAbsoluteIndex = momentPostLogIndices[parseInt((entry as any).data.target_post_id, 10)];\n        const targetPost = posts[targetPostAbsoluteIndex];\n\n        if (targetPost) {\n          if (entry.key.includes('_LIKE')) {\n            const likerName = entry.key.startsWith('USER') ? this.getDisplayName('user') : this.getDisplayName('char');\n            if (!_.some(targetPost.likes, (l: any) => l.name === likerName)) {\n              targetPost.likes.push({ key: entry.key, name: likerName, originalLogIndex: index });\n\n              // CHAR\n              if (entry.key.startsWith('CHAR') && !userInMomentsView) {\n                // \n                // \n                const isNewActivity = index > lastViewTimestamp;\n                if (isNewActivity) {\n                  hasNewCharMoments = true;\n                }\n              }\n            }\n          } else {\n            targetPost.comments.push({ ...entry, originalLogIndex: index });\n\n            // CHAR\n            if (entry.key.startsWith('CHAR') && !userInMomentsView) {\n              // \n              const isNewActivity = index > lastViewTimestamp;\n              if (isNewActivity) {\n                hasNewCharMoments = true;\n              }\n            }\n          }\n        } else {\n          console.warn(\n            `[BLMX] Could not find target post for interaction. target_post_id: ${\n              (entry as any).data.target_post_id\n            }, available posts: ${Object.keys(posts).join(', ')}`,\n            entry,\n          );\n        }\n      }\n\n      // CHAR\n      if ('key' in entry && entry.key === 'CHAR_MOMENT') {\n        // \n        const isNewMoment = index > lastViewTimestamp;\n\n        // \n        if (isNewMoment && !userInMomentsView) {\n          hasNewCharMoments = true;\n        }\n      }\n    });\n\n    //  - \n    if (!userInMomentsView) {\n      this.setMomentNotification(hasNewCharMoments);\n      // console.log('[BLMX] :', {\n      //   hasNewCharMoments,\n      //   lastViewIndex: this.getLastMomentViewTimestamp(),\n      //   currentLogLength: this.blmxManager.logEntries.length,\n      //   userInMomentsView,\n      // });\n    }\n\n    // \n    _.chain(posts)\n      .values()\n      .reverse()\n      .forEach((post: any) => {\n        const fromUser = post.key.startsWith('USER');\n        const authorName = fromUser ? this.getDisplayName('user') : this.getDisplayName('char');\n        const authorAvatar = fromUser ? avatars.user : avatars.char;\n\n        const $li = $('<li>').addClass('moment-post').attr('data-post-id', post.id);\n\n        const momentSequenceId = momentPostLogIndices.indexOf(post.id);\n        $li.attr('data-moment-sequence-id', String(momentSequenceId));\n\n        // moment-idmomentSequenceId\n        // \n        $li.attr('data-moment-id', String(momentSequenceId));\n\n        // HTML\n        let mediaHtml = '';\n        if (post.data.image_type === 'url' && post.data.image) {\n          mediaHtml = `<img src=\"${post.data.image}\" class=\"post-media-image\" />`;\n        } else if (post.data.image_type === 'desc' && post.data.image) {\n          mediaHtml = `<div class=\"image-desc-content\"><div class=\"text-wrapper\">${post.data.image}</div></div>`;\n        }\n\n        // HTML\n        let interactionsHtml = '';\n        if (post.likes.length > 0 || post.comments.length > 0) {\n          const likersHtml =\n            post.likes.length > 0\n              ? `<div class=\"likes-section\"><i class=\"fas fa-heart\"></i> ${_.map(\n                  post.likes,\n                  (l: any) => `<span class=\"liker-name\">${l.name}</span>`,\n                ).join(', ')}</div>`\n              : '';\n\n          const commentsHtml =\n            post.comments.length > 0\n              ? `<ul class=\"comments-section\">${_.map(\n                  post.comments,\n                  (c: any) =>\n                    `<li><span class=\"comment-author\">${\n                      c.key.startsWith('USER') ? this.getDisplayName('user') : this.getDisplayName('char')\n                    }</span>: ${c.data.text}</li>`,\n                ).join('')}</ul>`\n              : '';\n\n          interactionsHtml = `<div class=\"post-interactions\">${likersHtml}${commentsHtml}</div>`;\n        }\n\n        // \n        const displayTime = this.formatMomentTime(post.data.date, post.data.time);\n        const deleteBtnHtml = `<span class=\"delete-moment-btn\" title=\"\"></span>`;\n\n        $li.html(`<img src=\"${authorAvatar}\" class=\"post-author-avatar\" />\n                 <div class=\"post-details\">\n                     <span class=\"post-author-name\">${authorName}</span>\n                     <p class=\"post-content\">${post.data.text || ''}</p>\n                     <div class=\"post-media\">${mediaHtml}</div>\n                     <div class=\"post-meta\">\n                         <div class=\"post-meta-left\">\n                             <span class=\"timestamp\">${displayTime}</span>\n                             ${deleteBtnHtml}\n                         </div>\n                         <div class=\"post-actions\">\n                             <span class=\"comment-button\" title=\"/\"><i class=\"fas fa-comment-dots\"></i></span>\n                         </div>\n                     </div>\n                     ${interactionsHtml}\n                 </div>`);\n\n        $momentsFeedList.append($li);\n      })\n      .value();\n\n    // \n    const savedCoverPhoto = this.configManager.getSavedCoverPhoto();\n    if (savedCoverPhoto) {\n      $('#moments-cover-photo').attr('src', savedCoverPhoto);\n    }\n  }\n\n  // \n  private formatMomentTime(dateString: string, timeString: string): string {\n    try {\n      // \n      const now = window.currentGameDate ? new Date(window.currentGameDate) : new Date();\n      const date = new Date(`${dateString} ${timeString}`);\n\n      const diffMs = now.getTime() - date.getTime();\n      const diffMins = Math.floor(diffMs / 60000);\n      const diffHours = Math.floor(diffMins / 60);\n      const diffDays = Math.floor(diffHours / 24);\n\n      if (diffMins < 1) {\n        return '';\n      } else if (diffMins < 60) {\n        return `${diffMins}`;\n      } else if (diffHours < 24) {\n        return `${diffHours}`;\n      } else if (diffDays === 1) {\n        return '';\n      } else if (diffDays === 2) {\n        return '';\n      } else if (diffDays < 7) {\n        return `${diffDays}`;\n      } else {\n        // \n        const month = date.getMonth() + 1;\n        const day = date.getDate();\n        return `${month}${day}`;\n      }\n    } catch (error) {\n      console.error(':', error);\n      return `${dateString} ${timeString}`;\n    }\n  }\n\n  // \n  private getDisplayName(type: 'user' | 'char'): string {\n    return this.configManager.getDisplayName(type);\n  }\n\n  // \n  private isInMomentsView(): boolean {\n    return $('#moments-view').hasClass('active');\n  }\n\n  // \n  hasMomentNotifications(): boolean {\n    return this.configManager.getMomentNotificationState();\n  }\n\n  // \n  setMomentNotification(value: boolean): void {\n    this.hasMomentNotification = value;\n    this.configManager.setMomentNotificationState(value);\n    // UI\n    this.updateMomentNotificationIndicator();\n  }\n\n  // \n  private updateMomentNotificationIndicator(): void {\n    const $optionsBtn = $('#wechat-options-btn');\n    if (this.hasMomentNotification) {\n      if (!$optionsBtn.find('.notification-dot').length) {\n        $optionsBtn.append('<span class=\"notification-dot\"></span>');\n      }\n    } else {\n      $optionsBtn.find('.notification-dot').remove();\n    }\n  }\n\n  // \n  private getLastMomentViewTimestamp(): number {\n    return this.configManager.getLastMomentViewTimestamp();\n  }\n\n  // \n  setLastMomentViewTimestamp(): void {\n    // \n    const currentLogLength = this.blmxManager.logEntries.length;\n    this.configManager.setLastMomentViewTimestamp(currentLogLength);\n  }\n\n  // \n  onEnterMomentsView(): void {\n    // console.log('[BLMX] ');\n\n    // jQuery\n    const savedCoverPhoto = this.configManager.getSavedCoverPhoto();\n    if (savedCoverPhoto) {\n      $('#moments-cover-photo').attr('src', savedCoverPhoto);\n    }\n\n    // jQuery\n    const savedSignature = this.configManager.getSavedSignature();\n    $('#user-signature-display').text(savedSignature || '');\n\n    // \n    this.setMomentNotification(false);\n\n    // \n    this.setLastMomentViewTimestamp();\n\n    // \n    // console.log('[BLMX] :', this.blmxManager.logEntries.length);\n  }\n\n  // \n  createUserMoment(text: string, image: string = '', imageType: string = 'none'): MomentEntry {\n    // \n    const now = window.currentGameDate || new Date();\n    const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(\n      now.getDate(),\n    ).padStart(2, '0')}`;\n    const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;\n\n    return {\n      key: 'USER_MOMENT',\n      data: {\n        text,\n        image,\n        image_type: imageType as 'url' | 'desc' | 'none',\n        date: dateStr,\n        time: timeStr,\n      },\n    };\n  }\n\n  // \n  notifyMomentChange(type: 'name' | 'signature', _oldValue: string, newValue: string): void {\n    let text = '';\n    switch (type) {\n      case 'name':\n        text = `\"${newValue}\"`;\n        break;\n      case 'signature':\n        text = `\"${newValue}\"`;\n        break;\n    }\n\n    const momentEntry = this.createUserMoment(text);\n\n    // \n    this.blmxManager.addEntry(momentEntry);\n    this.renderMomentsFeed();\n  }\n\n  // \n  notifyRecallViaMoments(sender: 'USER' | 'CHAR', targetText: string): any {\n    // \n    const now = window.currentGameDate || new Date();\n    const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;\n\n    // \n    const recallEntry = {\n      key: 'RECALL',\n      data: {\n        sender: sender,\n        target_text: targetText,\n        timestamp: `${timeStr}`,\n      },\n    };\n\n    // \n    this.blmxManager.addEntry(recallEntry as any);\n\n    return recallEntry;\n  }\n}\n","//  - \n// jQuerylodash\nimport { Theme, ThemeManager } from './theme-manager';\n\nexport class ThemeEditor {\n  private themeManager: ThemeManager;\n  private onThemeChanged?: () => void;\n  private $modal: JQuery<HTMLElement>;\n  private checkboxHandlers: Map<string, (e: JQuery.ClickEvent) => void> = new Map();\n\n  constructor(themeManager: ThemeManager, onThemeChanged?: () => void) {\n    this.themeManager = themeManager;\n    this.onThemeChanged = onThemeChanged;\n    this.$modal = $('#theme-editor-modal');\n  }\n\n  //  - jQuery\n  setupThemeSelector(): void {\n    const $container = $('.theme-options');\n    if (!$container.length) return;\n\n    // \n    $container.empty();\n\n    // \n    const themes = this.themeManager.getThemes();\n\n    // lodash\n    _.forEach(themes, theme => {\n      const $themeButton = $('<div>').addClass('theme-option').css({\n        width: 'calc(50% - 0.5rem)',\n        'aspect-ratio': '1/1',\n        'border-radius': '8px',\n        'background-color': theme.colors.primary,\n        display: 'flex',\n        'flex-direction': 'column',\n        'align-items': 'center',\n        'justify-content': 'center',\n        cursor: 'pointer',\n        position: 'relative',\n        overflow: 'hidden',\n        'box-shadow': '0 2px 8px rgba(0,0,0,0.1)',\n      });\n\n      // \n      const $previewEl = $('<div>').css({\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        width: '100%',\n        height: '100%',\n        background: `linear-gradient(135deg, ${theme.colors.gradientStart}, ${theme.colors.gradientEnd})`,\n      });\n\n      // \n      const $bubblePreview = $('<div>').css({\n        position: 'relative',\n        width: '70%',\n        height: '60%',\n        display: 'flex',\n        'flex-direction': 'column',\n        'justify-content': 'space-between',\n        'z-index': 1,\n      });\n\n      const $themBubble = $('<div>').css({\n        'align-self': 'flex-start',\n        width: '60%',\n        height: '40%',\n        'background-color': theme.colors.bubbleThemBg,\n        'border-radius': '8px',\n      });\n\n      const $meBubble = $('<div>').css({\n        'align-self': 'flex-end',\n        width: '60%',\n        height: '40%',\n        'background-color': theme.colors.bubbleMeBg,\n        'border-radius': '8px',\n      });\n\n      $bubblePreview.append($themBubble, $meBubble);\n\n      // \n      const $nameEl = $('<div>').text(theme.displayName).css({\n        position: 'relative',\n        color: 'white',\n        'font-size': '0.8rem',\n        'font-weight': '500',\n        'margin-top': '5px',\n        'text-shadow': '0 1px 2px rgba(0,0,0,0.3)',\n        'z-index': 1,\n      });\n\n      $themeButton.append($previewEl, $bubblePreview, $nameEl);\n\n      // \n      $themeButton.on('click', () => {\n        this.themeManager.switchTheme(theme.name);\n        // \n        if (this.onThemeChanged) {\n          this.onThemeChanged();\n        }\n      });\n\n      $container.append($themeButton);\n    });\n\n    // \n    this.addCustomThemeSelector($container);\n  }\n\n  // \n  addCustomThemeEditButton(): void {\n    // \n    const $settingsPanel = $('.settings-panel');\n    if (!$settingsPanel.length) return;\n\n    // \n    const $editButton = $('<div>').addClass('custom-theme-edit-button').css({\n      width: '100%',\n      padding: '12px 16px',\n      margin: '8px 0',\n      'border-radius': '8px',\n      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n      color: 'white',\n      'font-size': '0.9rem',\n      'font-weight': '500',\n      'text-align': 'center',\n      cursor: 'pointer',\n      'box-shadow': '0 2px 8px rgba(0,0,0,0.1)',\n      transition: 'all 0.2s ease',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      gap: '8px',\n    });\n\n    const $icon = $('<span>').html('');\n    const $text = $('<span>').text('');\n\n    $editButton.append($icon, $text);\n\n    // \n    $editButton\n      .on('mouseenter', function () {\n        $(this).css('transform', 'translateY(-1px)');\n      })\n      .on('mouseleave', function () {\n        $(this).css('transform', 'translateY(0)');\n      });\n\n    // \n    $editButton.on('click', () => {\n      this.openThemeEditor();\n    });\n\n    // \n    // \n    const $themeOptions = $settingsPanel.find('.theme-options');\n    if ($themeOptions.length) {\n      $themeOptions.after($editButton);\n    } else {\n      $settingsPanel.append($editButton);\n    }\n  }\n\n  // \n  private addCustomThemeSelector($container: JQuery<HTMLElement>): void {\n    // \n    const customThemeData = this.getCustomThemeData();\n\n    const $customButton = $('<div>').addClass('theme-option custom-theme-option').css({\n      width: 'calc(50% - 0.5rem)',\n      'aspect-ratio': '1/1',\n      'border-radius': '8px',\n      background: customThemeData.background,\n      display: 'flex',\n      'flex-direction': 'column',\n      'align-items': 'center',\n      'justify-content': 'center',\n      cursor: 'pointer',\n      position: 'relative',\n      overflow: 'hidden',\n      'box-shadow': '0 2px 8px rgba(0,0,0,0.1)',\n    });\n\n    // \n    const $previewEl = $('<div>').css({\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      width: '100%',\n      height: '100%',\n      background: customThemeData.gradient,\n    });\n\n    const $iconEl = $('<div>').html('').css({\n      'font-size': '2rem',\n      'margin-bottom': '5px',\n      position: 'relative',\n      'z-index': 1,\n    });\n\n    const $nameEl = $('<div>').text(customThemeData.displayName).css({\n      color: 'white',\n      'font-size': '0.8rem',\n      'font-weight': '500',\n      'text-shadow': '0 1px 2px rgba(0,0,0,0.3)',\n      position: 'relative',\n      'z-index': 1,\n    });\n\n    $customButton.append($previewEl, $iconEl, $nameEl);\n\n    $customButton.on('click', () => {\n      // \n      this.themeManager.switchTheme('custom');\n      // \n      if (this.onThemeChanged) {\n        this.onThemeChanged();\n      }\n    });\n\n    $container.append($customButton);\n  }\n\n  // \n  private getCustomThemeData(): { displayName: string; background: string; gradient: string } {\n    try {\n      const customThemeJson = localStorage.getItem('blmx_custom_theme');\n      if (customThemeJson) {\n        const customTheme = JSON.parse(customThemeJson);\n        const primaryColor = customTheme.colors?.primary || '#667eea';\n        const gradientStart = customTheme.colors?.gradientStart || primaryColor;\n        const gradientEnd = customTheme.colors?.gradientEnd || primaryColor;\n\n        return {\n          displayName: customTheme.displayName || '',\n          background: primaryColor,\n          gradient: `linear-gradient(135deg, ${gradientStart}, ${gradientEnd})`,\n        };\n      }\n    } catch (error) {\n      console.warn('Failed to load custom theme data:', error);\n    }\n\n    // \n    return {\n      displayName: '',\n      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n      gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n    };\n  }\n\n  // \n  updateCustomThemeButton(): void {\n    const $customButton = $('.custom-theme-option');\n    if (!$customButton.length) return;\n\n    const customThemeData = this.getCustomThemeData();\n\n    // \n    const $previewEl = $customButton.children().eq(0); // \n    if ($previewEl.length) {\n      $previewEl.css('background', customThemeData.gradient);\n    }\n\n    // \n    const $nameEl = $customButton.children().last();\n    if ($nameEl.length && $nameEl.text() !== customThemeData.displayName) {\n      $nameEl.text(customThemeData.displayName);\n    }\n\n    // \n    $customButton.css('background', customThemeData.background);\n  }\n\n  //  - jQuery\n  openThemeEditor(): void {\n    if (!this.$modal.length) return;\n\n    // \n    const currentTheme = this.themeManager.getCurrentThemeWithAppliedValues();\n    this.fillThemeEditor(currentTheme);\n\n    // checkbox\n    this.setupCheckboxes();\n\n    // \n    this.$modal.show();\n  }\n\n  //  - jQuery\n  closeThemeEditor(): void {\n    this.$modal.hide();\n    // checkbox\n    this.cleanupCheckboxes();\n  }\n\n  //  - jQuery\n  private fillThemeEditor(theme: Theme): void {\n    // jQuery\n    const $nameInput = $('#theme-name-input');\n    const $darkModeToggle = $('#dark-mode-toggle');\n    const $singleColorIconsToggle = $('#single-color-icons-toggle');\n\n    //  - \n    let themeName: string;\n    if (theme.name === 'custom') {\n      // displayName\n      themeName = theme.displayName || '';\n    } else {\n      // \" + \"\n      themeName = ` ${theme.displayName}`;\n    }\n    $nameInput.val(themeName);\n\n    //  - lodash\n    const colorMappings = {\n      '#phone-frame-color': theme.colors.phoneFrame,\n      '#primary-color': theme.colors.primary,\n      '#light-color': theme.colors.light,\n      '#ultra-light-color': theme.colors.ultraLight,\n      '#deep-color': theme.colors.deep,\n      '#text-primary-color': theme.colors.textPrimary,\n      '#text-secondary-color': theme.colors.textSecondary,\n      '#bubble-me-color': theme.colors.bubbleMeBg,\n      '#bubble-me-text-color': theme.colors.bubbleMeText,\n      '#bubble-them-color': theme.colors.bubbleThemBg,\n      '#bubble-them-text-color': theme.colors.bubbleThemText,\n      '#status-bar-color': theme.colors.statusBarColor,\n      '#dynamic-island-color': theme.colors.dynamicIslandColor,\n      '#border-color': theme.colors.borderColor,\n      '#shadow-color': theme.colors.shadowColor,\n    };\n\n    // lodashforEach\n    _.forEach(colorMappings, (colorValue, selector) => {\n      $(selector).val(this.convertToHex(colorValue));\n    });\n\n    // checkbox\n    $darkModeToggle.prop('checked', theme.colors.isDarkMode);\n    $singleColorIconsToggle.prop('checked', theme.colors.useSingleColorIcons || false);\n\n    // checkboxopenThemeEditor()setupCheckboxes()\n  }\n\n  // checkbox - jQuery\n  private setupCheckboxes(): void {\n    // \n    this.cleanupCheckboxes();\n\n    // checkbox\n    this.setupSingleCheckboxWithJQuery('dark-mode-toggle', 'dark-mode-checkbox-button');\n\n    // checkbox\n    this.setupSingleCheckboxWithJQuery('single-color-icons-toggle', 'single-color-icons-checkbox-button');\n  }\n\n  // checkbox\n  private cleanupCheckboxes(): void {\n    // \n    this.checkboxHandlers.forEach((handler, id) => {\n      $(`#${id}`).off('click', handler);\n    });\n    this.checkboxHandlers.clear();\n  }\n\n  // jQuerycheckbox\n  private setupSingleCheckboxWithJQuery(checkboxId: string, buttonId: string): void {\n    const $checkbox = $(`#${checkboxId}`);\n    const $button = $(`#${buttonId}`);\n\n    if (!$checkbox.length || !$button.length) return;\n\n    // checkbox\n    const updateCheckboxState = (checked: boolean) => {\n      $button.toggleClass('checked', checked);\n    };\n\n    // \n    const handleClick = (e: JQuery.ClickEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const checkbox = $checkbox[0] as HTMLInputElement;\n      checkbox.checked = !checkbox.checked;\n      updateCheckboxState(checkbox.checked);\n    };\n\n    // \n    this.checkboxHandlers.set(buttonId, handleClick);\n\n    // \n    $button.on('click', handleClick);\n\n    // \n    const checkbox = $checkbox[0] as HTMLInputElement;\n    updateCheckboxState(checkbox.checked);\n  }\n\n  // \n  resetThemeEditor(): void {\n    // \n    const blueTheme = this.themeManager.getThemes().blue;\n    this.fillThemeEditor(blueTheme);\n\n    // \n    this.setupCheckboxes();\n  }\n\n  // JSON - \n  exportThemeAsJSON(): void {\n    try {\n      const currentTheme = this.getCurrentThemeFromEditor();\n      const wallpaperManager = this.themeManager.getWallpaperManager();\n\n      // \n      const currentWallpapers = {\n        chat: wallpaperManager.getCurrentWallpaper('chat'),\n        home: wallpaperManager.getCurrentWallpaper('home'),\n        settings: wallpaperManager.getCurrentWallpaper('settings'),\n      };\n\n      // \n      const themeData = {\n        name: currentTheme.name,\n        displayName: currentTheme.displayName,\n        version: '1.0',\n        exportDate: new Date().toISOString(),\n        colors: currentTheme.colors,\n        wallpapers: currentWallpapers, // \n      };\n\n      const jsonString = JSON.stringify(themeData, null, 2);\n      const blob = new Blob([jsonString], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n\n      // custom-.json\n      const themeName = currentTheme.displayName || '';\n      const safeThemeName = themeName.replace(/[<>:\"/\\\\|?*]/g, '_'); // \n      const fileName = `custom-${safeThemeName}.json`;\n\n      // jQuery\n      const $a = $('<a>', {\n        href: url,\n        download: fileName,\n        css: { display: 'none' },\n      });\n      $('body').append($a);\n      $a[0].click();\n      $a.remove();\n      URL.revokeObjectURL(url);\n\n      console.log(`[ThemeEditor] JSON: ${fileName}`);\n    } catch (error) {\n      console.error('[ThemeEditor] JSON:', error);\n      alert('');\n    }\n  }\n\n  // \n  importTheme(): void {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = '.json';\n    input.style.display = 'none';\n\n    input.addEventListener('change', event => {\n      const file = (event.target as HTMLInputElement).files?.[0];\n      if (!file) return;\n\n      const reader = new FileReader();\n      reader.onload = e => {\n        try {\n          const content = e.target?.result as string;\n          let themeData;\n\n          if (file.name.endsWith('.json')) {\n            themeData = JSON.parse(content);\n          } else {\n            throw new Error('JSON');\n          }\n\n          // \n          if (!this.validateThemeData(themeData)) {\n            throw new Error('');\n          }\n\n          // \n          this.applyImportedTheme(themeData);\n          console.log('[ThemeEditor] ');\n          alert('');\n        } catch (error) {\n          console.error('[ThemeEditor] :', error);\n          alert(`: ${error instanceof Error ? error.message : ''}`);\n        }\n      };\n\n      reader.readAsText(file);\n    });\n\n    // jQueryDOM\n    $('body').append(input);\n    input.click();\n    $(input).remove();\n  }\n\n  //  - jQuery\n  private getCurrentThemeFromEditor(): Theme {\n    // jQuery\n    const getValue = (selector: string, defaultValue: string = '') => ($(selector).val() as string) || defaultValue;\n    const getChecked = (selector: string) => $(selector).prop('checked') as boolean;\n\n    return this.createCustomTheme({\n      name: getValue('#theme-name-input', ''),\n      phoneFrame: getValue('#phone-frame-color', '#b4d0fa'),\n      primary: getValue('#primary-color', '#72adf3'),\n      light: getValue('#light-color', '#a8cbeb'),\n      ultraLight: getValue('#ultra-light-color', '#e8f4fd'),\n      deep: getValue('#deep-color', '#2c5282'),\n      textPrimary: getValue('#text-primary-color', 'rgb(139, 162, 186)'),\n      textSecondary: getValue('#text-secondary-color', '#64748b'),\n      bubbleMeBg: getValue('#bubble-me-color', '#a8cbeb'),\n      bubbleMeText: getValue('#bubble-me-text-color', '#ffffff'),\n      bubbleThemBg: getValue('#bubble-them-color', '#ffffff'),\n      bubbleThemText: getValue('#bubble-them-text-color', '#72adf3'),\n      appBgColor: '#ffffff',\n      settingsBgColor: '#f2f2f7',\n      settingsCardBgColor: '#ffffff',\n      statusBar: getValue('#status-bar-color', '#428af2'),\n      dynamicIsland: getValue('#dynamic-island-color', '#a0c4f4'),\n      border: getValue('#border-color', '#E0E0E0'),\n      shadow: getValue('#shadow-color', '#4a90e2'),\n      isDarkMode: getChecked('#dark-mode-toggle'),\n      useSingleColorIcons: getChecked('#single-color-icons-toggle'),\n    });\n  }\n\n  //  - jQuery\n  saveCustomTheme(): void {\n    // getCurrentThemeFromEditor\n    const customTheme = this.getCurrentThemeFromEditor();\n\n    // \n    this.themeManager.saveCustomTheme(customTheme);\n    this.themeManager.switchTheme('custom');\n\n    // \n    this.updateCustomThemeButton();\n\n    // \n    this.closeThemeEditor();\n\n    // \n    if (this.onThemeChanged) {\n      this.onThemeChanged();\n    }\n  }\n\n  // \n  private createCustomTheme(params: {\n    name: string;\n    phoneFrame: string;\n    primary: string;\n    light: string;\n    ultraLight: string;\n    deep: string;\n    textPrimary: string;\n    textSecondary: string;\n    bubbleMeBg: string;\n    bubbleMeText: string;\n    bubbleThemBg: string;\n    bubbleThemText: string;\n    appBgColor: string;\n    settingsBgColor: string;\n    settingsCardBgColor: string;\n    statusBar: string;\n    dynamicIsland: string;\n    border: string;\n    shadow: string;\n    isDarkMode: boolean;\n    useSingleColorIcons: boolean;\n  }): Theme {\n    const {\n      name,\n      phoneFrame,\n      primary,\n      light,\n      ultraLight,\n      deep,\n      textPrimary,\n      textSecondary,\n      bubbleMeBg,\n      bubbleMeText,\n      bubbleThemBg,\n      bubbleThemText,\n      appBgColor,\n      settingsBgColor,\n      settingsCardBgColor,\n      statusBar,\n      dynamicIsland,\n      border,\n      shadow,\n      isDarkMode,\n      useSingleColorIcons,\n    } = params;\n\n    // RGB\n    const r = parseInt(shadow.slice(1, 3), 16);\n    const g = parseInt(shadow.slice(3, 5), 16);\n    const b = parseInt(shadow.slice(5, 7), 16);\n    const shadowColorRgba = isDarkMode ? 'rgba(0, 0, 0, 0.5)' : `rgba(${r}, ${g}, ${b}, 0.3)`;\n    const bubbleShadow = `0 2px 8px rgba(${r}, ${g}, ${b}, 0.15)`;\n\n    // \n    const gradientStart = this.lightenDarkenColor(primary, 20);\n    const gradientEnd = this.lightenDarkenColor(primary, -10);\n\n    // \n    const soft = this.lightenDarkenColor(light, -10);\n    const textColor = '#ffffff';\n    const headerBg = isDarkMode\n      ? 'linear-gradient(315deg, #333333 0%, #444444 100%)'\n      : `linear-gradient(315deg, ${this.lightenDarkenColor(ultraLight, -5)} 0%, ${ultraLight} 100%)`;\n\n    // \n    const customTheme: Theme = {\n      name: 'custom',\n      displayName: name,\n      colors: {\n        phoneFrame: phoneFrame,\n        phoneFrameGradient: [\n          this.lightenDarkenColor(phoneFrame, -40),\n          phoneFrame,\n          this.lightenDarkenColor(phoneFrame, 20),\n          this.lightenDarkenColor(phoneFrame, -40),\n        ],\n        primary: primary,\n        light: light,\n        ultraLight: ultraLight,\n        soft: soft,\n        deep: deep,\n        textPrimary: textPrimary,\n        textSecondary: textSecondary,\n        textColor: textColor,\n        bubbleMeBg,\n        bubbleMeText,\n        bubbleThemBg,\n        bubbleThemText,\n        headerBg,\n        appBgColor,\n        settingsBgColor,\n        settingsCardBgColor,\n        gradientStart,\n        gradientEnd,\n        statusBarColor: statusBar,\n        dynamicIslandColor: dynamicIsland,\n        borderColor: border,\n        shadowColor: shadow,\n        shadowColorRgba,\n        bubbleShadow,\n        isDarkMode,\n        defaultWallpapers: {\n          chat: isDarkMode\n            ? 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg'\n            : 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_3.jpg',\n          home: isDarkMode\n            ? 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg'\n            : 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg',\n          settings: isDarkMode ? '#1a1a1a' : '#f2f7fd',\n        },\n        useSingleColorIcons,\n      },\n    };\n\n    return customTheme;\n  }\n\n  // \n  private lightenDarkenColor(col: string, amt: number): string {\n    let usePound = false;\n\n    if (col[0] === '#') {\n      col = col.slice(1);\n      usePound = true;\n    }\n\n    const num = parseInt(col, 16);\n\n    let r = (num >> 16) + amt;\n    if (r > 255) r = 255;\n    else if (r < 0) r = 0;\n\n    let b = ((num >> 8) & 0x00ff) + amt;\n    if (b > 255) b = 255;\n    else if (b < 0) b = 0;\n\n    let g = (num & 0x0000ff) + amt;\n    if (g > 255) g = 255;\n    else if (g < 0) g = 0;\n\n    return (usePound ? '#' : '') + (g | (b << 8) | (r << 16)).toString(16);\n  }\n\n  // \n  private convertToHex(color: string): string {\n    // \n    if (color.startsWith('#')) {\n      return color;\n    }\n\n    // rgb()\n    const rgbMatch = color.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\n    if (rgbMatch) {\n      const r = parseInt(rgbMatch[1]);\n      const g = parseInt(rgbMatch[2]);\n      const b = parseInt(rgbMatch[3]);\n      return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\n    }\n\n    // rgba()alpha\n    const rgbaMatch = color.match(/rgba\\((\\d+),\\s*(\\d+),\\s*(\\d+),\\s*[\\d.]+\\)/);\n    if (rgbaMatch) {\n      const r = parseInt(rgbaMatch[1]);\n      const g = parseInt(rgbaMatch[2]);\n      const b = parseInt(rgbaMatch[3]);\n      return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\n    }\n\n    // \n    console.warn(`[ThemeEditor] : ${color}`);\n    return '#000000';\n  }\n\n  // \n  private validateThemeData(data: any): boolean {\n    if (!data || typeof data !== 'object') return false;\n\n    // \n    const requiredFields = ['name', 'colors'];\n    for (const field of requiredFields) {\n      if (!(field in data)) return false;\n    }\n\n    // colors\n    const colors = data.colors;\n    if (!colors || typeof colors !== 'object') return false;\n\n    // \n    const requiredColors = ['primary', 'phoneFrame', 'textPrimary', 'textSecondary'];\n    for (const color of requiredColors) {\n      if (!(color in colors)) return false;\n    }\n\n    return true;\n  }\n\n  //  - jQuery\n  private applyImportedTheme(themeData: any): void {\n    // \n    $('#theme-name-input').val(themeData.displayName || themeData.name || '');\n\n    //  - lodash\n    const colorMappings = {\n      '#phone-frame-color': themeData.colors.phoneFrame,\n      '#primary-color': themeData.colors.primary,\n      '#light-color': themeData.colors.light,\n      '#ultra-light-color': themeData.colors.ultraLight,\n      '#deep-color': themeData.colors.deep,\n      '#text-primary-color': themeData.colors.textPrimary,\n      '#text-secondary-color': themeData.colors.textSecondary,\n      '#bubble-me-color': themeData.colors.bubbleMeBg,\n      '#bubble-me-text-color': themeData.colors.bubbleMeText,\n      '#bubble-them-color': themeData.colors.bubbleThemBg,\n      '#bubble-them-text-color': themeData.colors.bubbleThemText,\n      '#status-bar-color': themeData.colors.statusBarColor,\n      '#dynamic-island-color': themeData.colors.dynamicIslandColor,\n      '#border-color': themeData.colors.borderColor,\n      '#shadow-color': themeData.colors.shadowColor,\n    };\n\n    // lodash\n    _.forEach(colorMappings, (colorValue, selector) => {\n      if (colorValue) {\n        $(selector).val(this.convertToHex(colorValue));\n      }\n    });\n\n    // checkbox\n    if ('isDarkMode' in themeData.colors) {\n      $('#dark-mode-toggle').prop('checked', themeData.colors.isDarkMode);\n    }\n\n    if ('useSingleColorIcons' in themeData.colors) {\n      $('#single-color-icons-toggle').prop('checked', themeData.colors.useSingleColorIcons);\n    }\n\n    // \n    if (themeData.wallpapers) {\n      this.applyImportedWallpapers(themeData.wallpapers);\n    }\n\n    // checkbox\n    this.setupCheckboxes();\n  }\n\n  // \n  private applyImportedWallpapers(wallpapers: any): void {\n    try {\n      const wallpaperManager = this.themeManager.getWallpaperManager();\n\n      // \n      const viewTypes: ('chat' | 'home' | 'settings')[] = ['chat', 'home', 'settings'];\n\n      viewTypes.forEach(viewType => {\n        const wallpaper = wallpapers[viewType];\n        if (wallpaper) {\n          // \n          wallpaperManager.setWallpaper(viewType, wallpaper);\n        }\n      });\n\n      console.log('[ThemeEditor] ');\n    } catch (error) {\n      console.warn('[ThemeEditor] :', error);\n    }\n  }\n}\n","// \nexport interface Theme {\n  name: string;\n  displayName: string;\n  colors: {\n    // \n    phoneFrame: string;\n    phoneFrameGradient: string[];\n\n    // \n    primary: string;\n    light: string;\n    ultraLight: string;\n    soft: string;\n    deep: string;\n\n    // \n    gradientStart: string;\n    gradientEnd: string;\n\n    // \n    textColor: string;\n    textPrimary: string;\n    textSecondary: string;\n\n    // \n    borderColor: string;\n    bubbleShadow: string;\n\n    // \n    bubbleThemBg: string;\n    bubbleMeBg: string;\n\n    // \n    bubbleThemText: string;\n    bubbleMeText: string;\n\n    // \n    headerBg: string;\n\n    // \n    statusBarColor: string;\n\n    // \n    dynamicIslandColor: string;\n\n    // \n    appBgColor: string;\n\n    // \n    settingsBgColor: string;\n\n    // \n    settingsCardBgColor: string;\n\n    // \n    shadowColor: string;\n    shadowColorRgba: string;\n\n    // \n    isDarkMode: boolean;\n\n    // \n    defaultWallpapers: {\n      chat: string; // URL\n      home: string;\n      settings: string;\n    };\n\n    // \n    useSingleColorIcons?: boolean;\n  };\n}\n\n// \nexport const APP_VERSION = '1.1.0';\n\n// \nexport const THEMES: Record<string, Theme> = {\n  blue: {\n    name: 'blue',\n    displayName: '',\n    colors: {\n      // \n      phoneFrame: '#b4d0fa',\n      phoneFrameGradient: ['#4a95ed', '#98c2f5', '#accef2', '#4a95ed'],\n\n      // \n      primary: '#72adf3',\n      light: '#a8cbeb',\n      ultraLight: '#e8f4fd',\n      soft: '#b8d4f0',\n      deep: '#2c5282',\n\n      // \n      gradientStart: '#98c2f5',\n      gradientEnd: '#accef2',\n\n      // \n      textColor: '#ffffff',\n      textPrimary: 'rgb(139, 162, 186)',\n      textSecondary: '#64748b',\n\n      // \n      borderColor: '#cbd5e1',\n      bubbleShadow: '0 2px 8px rgba(74, 144, 226, 0.15)',\n\n      // \n      bubbleThemBg: '#ffffff',\n      bubbleMeBg: '#a8cbeb',\n\n      // \n      bubbleThemText: '#72adf3',\n      bubbleMeText: '#ffffff',\n\n      // \n      headerBg: 'linear-gradient(315deg, #eef4ff 0%, #f8faff 100%)',\n\n      // \n      statusBarColor: '#428af2',\n\n      // \n      dynamicIslandColor: '#a0c4f4',\n\n      // \n      appBgColor: '#ffffff',\n\n      // \n      settingsBgColor: '#f2f2f7',\n\n      // \n      settingsCardBgColor: '#ffffff',\n\n      // \n      shadowColor: '#4a90e2',\n      shadowColorRgba: 'rgba(74, 144, 226, 0.3)',\n\n      // \n      isDarkMode: false,\n\n      // \n      defaultWallpapers: {\n        chat: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_3.jpg', // \n        home: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg', // \n        settings: '#f2f7fd',\n      },\n\n      // \n      useSingleColorIcons: true,\n    },\n  },\n\n  pink: {\n    name: 'pink',\n    displayName: '',\n    colors: {\n      // \n      phoneFrame: '#fad0e8',\n      phoneFrameGradient: ['#ed4a9e', '#f598c8', '#f2acce', '#ed4a9e'],\n\n      // \n      primary: '#f372ad',\n      light: '#eba8cb',\n      ultraLight: '#fde8f4',\n      soft: '#f0b8d4',\n      deep: '#822c5c',\n\n      // \n      gradientStart: '#f598c8',\n      gradientEnd: '#f2acce',\n\n      // \n      textColor: '#ffffff',\n      textPrimary: 'rgb(186, 139, 162)',\n      textSecondary: '#8b647a',\n\n      // \n      borderColor: '#e1cbd5',\n      bubbleShadow: '0 2px 8px rgba(226, 74, 144, 0.15)',\n\n      // \n      bubbleThemBg: '#ffffff',\n      bubbleMeBg: '#eba8cb',\n\n      // \n      bubbleThemText: '#f372ad',\n      bubbleMeText: '#ffffff',\n\n      // \n      headerBg: 'linear-gradient(315deg, #ffeeef 0%, #fff8fa 100%)',\n\n      // \n      statusBarColor: '#ed72ad',\n\n      // \n      dynamicIslandColor: '#f4a0c4',\n\n      // \n      appBgColor: '#ffffff',\n\n      // \n      settingsBgColor: '#fff2f7',\n\n      // \n      settingsCardBgColor: '#ffffff',\n\n      // \n      shadowColor: '#e24a90',\n      shadowColorRgba: 'rgba(226, 74, 144, 0.3)',\n\n      // \n      isDarkMode: false,\n\n      // \n      defaultWallpapers: {\n        chat: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg', // \n        home: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_3.jpg', // \n        settings: '#fdf2f7',\n      },\n\n      // \n      useSingleColorIcons: true,\n    },\n  },\n\n  white: {\n    name: 'white',\n    displayName: '',\n    colors: {\n      // \n      phoneFrame: '#000000',\n      phoneFrameGradient: ['#000000', '#222222', '#333333', '#000000'],\n\n      //  - \n      primary: '#999999', // \n      light: '#cccccc',\n      ultraLight: '#f8f8f8',\n      soft: '#e0e0e0',\n      deep: '#666666',\n\n      // \n      gradientStart: '#cccccc',\n      gradientEnd: '#dddddd',\n\n      // \n      textColor: '#ffffff',\n      textPrimary: '#333333',\n      textSecondary: '#909090',\n\n      // \n      borderColor: '#e0e0e0',\n      bubbleShadow: '0 2px 8px rgba(0, 0, 0, 0.08)',\n\n      // \n      bubbleThemBg: '#ffffff',\n      bubbleMeBg: '#A0E75A', // \n\n      // \n      bubbleThemText: '#333333',\n      bubbleMeText: '#333333',\n\n      // \n      headerBg: 'linear-gradient(315deg, #f5f5f5 0%, #ffffff 100%)',\n\n      // \n      statusBarColor: '#000000',\n\n      // \n      dynamicIslandColor: '#000000',\n\n      // \n      appBgColor: '#ffffff',\n\n      // \n      settingsBgColor: '#f5f5f5',\n\n      // \n      settingsCardBgColor: '#ffffff',\n\n      // \n      shadowColor: '#999999',\n      shadowColorRgba: 'rgba(0, 0, 0, 0.1)',\n\n      // \n      isDarkMode: false,\n\n      // \n      defaultWallpapers: {\n        chat: '#EDEDED', // \n        home: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg', // \n        settings: '#f5f5f5',\n      },\n\n      // \n      useSingleColorIcons: false,\n    },\n  },\n\n  dark: {\n    name: 'dark',\n    displayName: '',\n    colors: {\n      // \n      phoneFrame: '#2c2c2c',\n      phoneFrameGradient: ['#1a1a1a', '#2c2c2c', '#3c3c3c', '#1a1a1a'],\n\n      // \n      primary: '#505050',\n      light: '#3c3c3c',\n      ultraLight: '#1a1a1a',\n      soft: '#2c2c2c',\n      deep: '#c0c0c0',\n\n      // \n      gradientStart: '#3c3c3c',\n      gradientEnd: '#2c2c2c',\n\n      // \n      textColor: '#e0e0e0',\n      textPrimary: '#c0c0c0',\n      textSecondary: '#a0a0a0',\n\n      // \n      borderColor: '#3c3c3c',\n      bubbleShadow: '0 2px 8px rgba(0, 0, 0, 0.3)',\n\n      // \n      bubbleThemBg: '#2a2a2a',\n      bubbleMeBg: '#505050',\n\n      // \n      bubbleThemText: '#e0e0e0',\n      bubbleMeText: '#c0c0c0',\n\n      // \n      headerBg: 'linear-gradient(315deg, #2c2c2c 0%, #1a1a1a 100%)',\n\n      // \n      statusBarColor: '#888888',\n\n      // \n      dynamicIslandColor: '#3c3c3c',\n\n      // \n      appBgColor: '#1a1a1a',\n\n      // \n      settingsBgColor: '#1a1a1a',\n\n      // \n      settingsCardBgColor: '#2c2c2c',\n\n      // \n      shadowColor: '#000000',\n      shadowColorRgba: 'rgba(0, 0, 0, 0.5)',\n\n      // \n      isDarkMode: true,\n\n      // \n      defaultWallpapers: {\n        chat: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg', // \n        home: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg', // \n        settings: '#1a1a1a',\n      },\n\n      // \n      useSingleColorIcons: false,\n    },\n  },\n};\n\n// \nexport class ThemeManager {\n  private static THEME_STORAGE_KEY = 'blmx_theme';\n  private static CUSTOM_THEME_STORAGE_KEY = 'blmx_custom_theme';\n  private static VERSION_STORAGE_KEY = 'blmx_app_version';\n  private currentTheme: Theme;\n  private wallpaperManager: WallpaperManager;\n\n  constructor() {\n    // \n    this.checkVersion();\n\n    // \n    const savedThemeName = localStorage.getItem(ThemeManager.THEME_STORAGE_KEY) || 'white';\n\n    if (savedThemeName === 'custom') {\n      try {\n        const customThemeJson = localStorage.getItem(ThemeManager.CUSTOM_THEME_STORAGE_KEY);\n        if (customThemeJson) {\n          this.currentTheme = JSON.parse(customThemeJson);\n        } else {\n          this.currentTheme = THEMES.white;\n        }\n      } catch (e) {\n        console.error('Failed to load custom theme:', e);\n        this.currentTheme = THEMES.white;\n      }\n    } else {\n      this.currentTheme = THEMES[savedThemeName] || THEMES.white;\n    }\n\n    // \n    this.wallpaperManager = new WallpaperManager();\n\n    // \n    this.applyTheme(this.currentTheme);\n  }\n\n  // \n  private checkVersion(): void {\n    const savedVersion = localStorage.getItem(ThemeManager.VERSION_STORAGE_KEY);\n\n    // \n    if (!savedVersion || savedVersion !== APP_VERSION) {\n      console.log(`: ${savedVersion || ''} -> ${APP_VERSION}, ...`);\n      this.cleanOutdatedData();\n\n      // \n      localStorage.setItem(ThemeManager.VERSION_STORAGE_KEY, APP_VERSION);\n    }\n  }\n\n  // \n  private cleanOutdatedData(): void {\n    // \n    const keysToPreserve: string[] = [];\n\n    // \n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (\n        key &&\n        (key.startsWith('blmx_user_name_') ||\n          key.startsWith('blmx_user_avatar_') ||\n          key.startsWith('blmx_char_avatar_') ||\n          key.startsWith('blmx_remark_') ||\n          key.startsWith('blmx_signature_') ||\n          key.startsWith('blmx_cover_photo_') ||\n          key.startsWith('blmx_input_placeholder_'))\n      ) {\n        keysToPreserve.push(key);\n      }\n    }\n\n    // \n    const preservedData: Record<string, string> = {};\n    keysToPreserve.forEach(key => {\n      const value = localStorage.getItem(key);\n      if (value) preservedData[key] = value;\n    });\n\n    //  blmx_ \n    for (let i = localStorage.length - 1; i >= 0; i--) {\n      const key = localStorage.key(i);\n      if (key && key.startsWith('blmx_')) {\n        localStorage.removeItem(key);\n      }\n    }\n\n    // \n    Object.entries(preservedData).forEach(([key, value]) => {\n      localStorage.setItem(key, value);\n    });\n  }\n\n  // \n  getCurrentTheme(): Theme {\n    return this.currentTheme;\n  }\n\n  // DOMCSS\n  getCurrentThemeWithAppliedValues(): Theme {\n    const theme = { ...this.currentTheme };\n    const colors = { ...theme.colors };\n\n    // DOMCSS\n    const root = document.documentElement;\n    const computedStyle = getComputedStyle(root);\n\n    // \n    const actualValues = {\n      phoneFrame: computedStyle.getPropertyValue('--phoneFrame').trim(),\n      primary: computedStyle.getPropertyValue('--primary-blue').trim(),\n      light: computedStyle.getPropertyValue('--light-blue').trim(),\n      ultraLight: computedStyle.getPropertyValue('--ultra-light-blue').trim(),\n      soft: computedStyle.getPropertyValue('--soft-blue').trim(),\n      deep: computedStyle.getPropertyValue('--deep-blue').trim(),\n      textColor: computedStyle.getPropertyValue('--text-color').trim(),\n      textPrimary: computedStyle.getPropertyValue('--text-primary').trim(),\n      textSecondary: computedStyle.getPropertyValue('--text-secondary').trim(),\n      borderColor: computedStyle.getPropertyValue('--border-color').trim(),\n      bubbleShadow: computedStyle.getPropertyValue('--bubble-shadow').trim(),\n      bubbleThemBg: computedStyle.getPropertyValue('--wechat-bubble-them-bg').trim(),\n      bubbleMeBg: computedStyle.getPropertyValue('--wechat-bubble-me-bg').trim(),\n      bubbleThemText: computedStyle.getPropertyValue('--wechat-bubble-them-text').trim(),\n      bubbleMeText: computedStyle.getPropertyValue('--wechat-bubble-me-text').trim(),\n      headerBg: computedStyle.getPropertyValue('--header-bg').trim(),\n      statusBarColor: computedStyle.getPropertyValue('--status-bar-color').trim(),\n      dynamicIslandColor: computedStyle.getPropertyValue('--dynamic-island-color').trim(),\n      appBgColor: computedStyle.getPropertyValue('--app-bg-color').trim(),\n      settingsBgColor: computedStyle.getPropertyValue('--settings-bg-color').trim(),\n      settingsCardBgColor: computedStyle.getPropertyValue('--settings-card-bg-color').trim(),\n      shadowColor: computedStyle.getPropertyValue('--shadow-color').trim(),\n      shadowColorRgba: computedStyle.getPropertyValue('--shadow-color-rgba').trim(),\n      gradientStart:\n        computedStyle.getPropertyValue('--blue-gradient-start').trim() ||\n        computedStyle.getPropertyValue('--primary-gradient-light').trim(),\n      gradientEnd:\n        computedStyle.getPropertyValue('--blue-gradient-end').trim() ||\n        computedStyle.getPropertyValue('--primary-gradient-dark').trim(),\n    };\n\n    // CSS\n    Object.keys(actualValues).forEach(key => {\n      const value = actualValues[key as keyof typeof actualValues];\n      if (value && value !== '') {\n        (colors as any)[key] = value;\n      }\n    });\n\n    // \n    colors.isDarkMode = theme.colors.isDarkMode;\n    colors.useSingleColorIcons = theme.colors.useSingleColorIcons;\n    colors.phoneFrameGradient = theme.colors.phoneFrameGradient;\n    colors.defaultWallpapers = theme.colors.defaultWallpapers;\n\n    return {\n      ...theme,\n      colors,\n    };\n  }\n\n  // \n  getThemes(): Record<string, Theme> {\n    return THEMES;\n  }\n\n  // \n  getWallpaperManager(): WallpaperManager {\n    return this.wallpaperManager;\n  }\n\n  // \n  switchTheme(themeName: string): void {\n    if (themeName === 'custom') {\n      try {\n        const customThemeJson = localStorage.getItem(ThemeManager.CUSTOM_THEME_STORAGE_KEY);\n        if (customThemeJson) {\n          this.currentTheme = JSON.parse(customThemeJson);\n          localStorage.setItem(ThemeManager.THEME_STORAGE_KEY, 'custom');\n\n          // \n          this.wallpaperManager.setCurrentThemeName('custom');\n\n          this.applyTheme(this.currentTheme);\n\n          // \n          this.wallpaperManager.applyThemeDefaultWallpapers(this.currentTheme);\n        }\n      } catch (e) {\n        console.error('Failed to load custom theme:', e);\n      }\n    } else if (THEMES[themeName]) {\n      this.currentTheme = THEMES[themeName];\n      localStorage.setItem(ThemeManager.THEME_STORAGE_KEY, themeName);\n\n      // \n      this.wallpaperManager.setCurrentThemeName(themeName);\n\n      this.applyTheme(this.currentTheme);\n\n      // \n      this.wallpaperManager.applyThemeDefaultWallpapers(this.currentTheme);\n    }\n  }\n\n  // \n  saveCustomTheme(theme: Theme): void {\n    this.currentTheme = theme;\n    localStorage.setItem(ThemeManager.CUSTOM_THEME_STORAGE_KEY, JSON.stringify(theme));\n    localStorage.setItem(ThemeManager.THEME_STORAGE_KEY, 'custom');\n\n    // \n    this.wallpaperManager.setCurrentThemeName('custom');\n\n    this.applyTheme(theme);\n\n    // \n    this.wallpaperManager.applyThemeDefaultWallpapers(theme);\n  }\n\n  // DOM\n  private applyTheme(theme: Theme): void {\n    const colors = theme.colors;\n    const root = document.documentElement;\n\n    // CSS\n    root.style.setProperty('--phoneFrame', colors.phoneFrame);\n    root.style.setProperty('--primary-blue', colors.primary);\n    root.style.setProperty('--light-blue', colors.light);\n    root.style.setProperty('--ultra-light-blue', colors.ultraLight);\n    root.style.setProperty('--blue-gradient-start', colors.gradientStart);\n    root.style.setProperty('--blue-gradient-end', colors.gradientEnd);\n    root.style.setProperty('--soft-blue', colors.soft);\n    root.style.setProperty('--deep-blue', colors.deep);\n\n    //  - \n    root.style.setProperty('--text-color', colors.textColor);\n    root.style.setProperty('--text-primary', colors.textPrimary);\n    root.style.setProperty('--text-secondary', colors.textSecondary);\n\n    // \n    root.style.setProperty('--border-color', colors.borderColor);\n\n    // useSingleColorIcons\n    if (colors.useSingleColorIcons) {\n      // \n      document.body.classList.add('single-color-icon');\n\n      // \n      const lighterColor = this.lightenDarkenColor(colors.primary, 20);\n      const darkerColor = this.lightenDarkenColor(colors.primary, -20);\n\n      // \n      root.style.setProperty('--primary-gradient-light', lighterColor);\n      root.style.setProperty('--primary-gradient-dark', darkerColor);\n    } else {\n      // \n      document.body.classList.remove('single-color-icon');\n      root.style.setProperty('--wechat-green-icon', theme.name === 'white' ? '#07C160' : '#07C160');\n      root.style.setProperty('--settings-icon-color', theme.name === 'white' ? '#8a8a8a' : '#8a8a8a');\n    }\n\n    root.style.setProperty('--wechat-green-bubble', colors.light);\n    root.style.setProperty('--wechat-bg', colors.ultraLight);\n    root.style.setProperty('--link-color', colors.primary);\n    root.style.setProperty('--text-color', colors.textColor);\n    root.style.setProperty('--text-primary', colors.textPrimary);\n    root.style.setProperty('--text-secondary', colors.textSecondary);\n    root.style.setProperty('--border-color', colors.borderColor);\n    root.style.setProperty('--header-bg', colors.headerBg);\n    root.style.setProperty('--bubble-shadow', colors.bubbleShadow);\n    root.style.setProperty('--wechat-bubble-them-bg', colors.bubbleThemBg);\n    root.style.setProperty('--wechat-bubble-me-bg', colors.bubbleMeBg);\n\n    // \n    root.style.setProperty('--wechat-bubble-them-text', colors.bubbleThemText || colors.primary);\n    root.style.setProperty('--wechat-bubble-me-text', colors.bubbleMeText || '#ffffff');\n\n    // \n    root.style.setProperty('--status-bar-color', colors.statusBarColor);\n\n    // \n    root.style.setProperty('--dynamic-island-color', colors.dynamicIslandColor);\n\n    // \n    root.style.setProperty('--app-bg-color', colors.appBgColor);\n\n    // \n    root.style.setProperty('--settings-bg-color', colors.settingsBgColor);\n\n    // \n    root.style.setProperty('--settings-card-bg-color', colors.settingsCardBgColor);\n\n    // \n    root.style.setProperty('--input-bg', colors.isDarkMode ? '#2a2a2a' : '#ffffff');\n\n    // \n    root.style.setProperty('--shadow-color', colors.shadowColor);\n    root.style.setProperty('--shadow-color-rgba', colors.shadowColorRgba);\n\n    // RGB\n    const shadowRGB = this.extractRgbComponents(colors.shadowColor);\n    root.style.setProperty('--shadow-r', shadowRGB.r.toString());\n    root.style.setProperty('--shadow-g', shadowRGB.g.toString());\n    root.style.setProperty('--shadow-b', shadowRGB.b.toString());\n\n    // \n    if (colors.isDarkMode) {\n      document.body.classList.add('dark-mode');\n    } else {\n      document.body.classList.remove('dark-mode');\n    }\n\n    // \n    const phoneFrame = document.querySelector('.phone-frame') as HTMLElement;\n    if (phoneFrame) {\n      phoneFrame.style.background = colors.phoneFrame;\n\n      //  - \n      const gradientColors = colors.phoneFrameGradient.join(', ');\n\n      // \n      let phoneFrameStyle = document.getElementById('phone-frame-style') as HTMLStyleElement;\n      if (!phoneFrameStyle) {\n        phoneFrameStyle = document.createElement('style');\n        phoneFrameStyle.id = 'phone-frame-style';\n        document.head.appendChild(phoneFrameStyle);\n      }\n\n      // \n      phoneFrameStyle.textContent = `\n        .phone-frame::before {\n          background: linear-gradient(45deg, ${gradientColors});\n          background-size: 400% 400%;\n        }\n      `;\n    }\n\n    // \n    const dynamicIsland = document.querySelector('.dynamic-island') as HTMLElement;\n    if (dynamicIsland) {\n      dynamicIsland.style.background = colors.dynamicIslandColor;\n    }\n\n    // \n    const statusLeft = document.querySelector('.status-left') as HTMLElement;\n    const statusRight = document.querySelector('.status-right') as HTMLElement;\n    if (statusLeft && statusRight) {\n      statusLeft.style.color = colors.statusBarColor;\n      statusRight.style.color = colors.statusBarColor;\n    }\n\n    // \n    const settingsView = document.getElementById('settings-view');\n    if (settingsView) {\n      settingsView.style.backgroundColor = colors.settingsBgColor;\n    }\n\n    // \n    const settingsCards = document.querySelectorAll('.settings-card');\n    settingsCards.forEach((card: Element) => {\n      (card as HTMLElement).style.backgroundColor = colors.settingsCardBgColor;\n    });\n\n    // \n    if (phoneFrame) {\n      phoneFrame.style.boxShadow = `\n        0 15px 20px ${this.hexToRgba(colors.shadowColor, 0.25)},\n        0 8px 20px ${this.hexToRgba(colors.shadowColor, 0.15)},\n        0 3px 8px rgba(0, 0, 0, 0.1),\n        inset 0 1px 0 rgba(255, 255, 255, 0.5),\n        inset 0 -1px 0 rgba(255, 255, 255, 0.2),\n        0 5px ${this.hexToRgba(colors.shadowColor, 0.08)}\n      `;\n    }\n\n    // \n    const style = document.createElement('style');\n    style.id = 'theme-dynamic-styles';\n\n    // \n    // \n    // const isCustomBubbleColors = theme.name === 'custom';\n\n    style.textContent = `\n      /*  -  */\n      .message-row.me .message-bubble {\n        background-color: ${colors.bubbleMeBg} !important;\n        background: ${colors.bubbleMeBg} !important;\n        color: ${colors.bubbleMeText || '#ffffff'} !important;\n        box-shadow: 0 4px 12px ${this.hexToRgba(colors.shadowColor, 0.3)};\n      }\n      \n      /*  */\n      .message-row.them .message-bubble {\n        background-color: ${colors.bubbleThemBg} !important;\n        background: ${colors.bubbleThemBg} !important;\n        color: ${colors.bubbleThemText || colors.primary} !important;\n      }\n      \n      /*  */\n      .message-row.me .message-bubble.voice-bubble {\n        background: ${colors.bubbleMeBg} !important;\n        background-color: ${colors.bubbleMeBg} !important;\n        background-image: none !important;\n        color: ${colors.bubbleMeText || '#ffffff'} !important;\n      }\n      \n      .message-row.them .message-bubble.voice-bubble {\n        background: ${colors.bubbleThemBg} !important;\n        color: ${colors.bubbleThemText || colors.primary} !important;\n      }\n      \n      /*  */\n      .post-media .image-desc-content {\n        background-color: ${this.hexToRgba(colors.primary, 0.1)} !important;\n        border: 1px solid ${this.hexToRgba(colors.primary, 0.1)} !important;\n      }\n      \n      /*  */\n      .wechat-footer .send-btn {\n        box-shadow: 0 4px 12px ${this.hexToRgba(colors.shadowColor, 0.3)};\n      }\n      \n      .wechat-footer .send-btn:hover {\n        box-shadow: 0 6px 16px ${this.hexToRgba(colors.shadowColor, 0.4)};\n      }\n      \n      /*  */\n      ${\n        colors.isDarkMode\n          ? `\n        .settings-card p, \n        .settings-card a,\n        .settings-card li a,\n        .post-content,\n        .post-meta,\n        .theme-editor-modal .modal-content {\n          color: #e0e0e0 !important;\n        }\n        \n        .settings-card,\n        .theme-editor-modal .modal-content {\n          background-color: #2a2a2a !important;\n        }\n        \n        /*  */\n        .typing-indicator .message-bubble {\n          background-color: ${colors.bubbleThemBg} !important;\n          background: ${colors.bubbleThemBg} !important;\n          color: #ffffff !important;\n          border: none !important;\n        }\n        \n        .typing-dot {\n          background-color: rgba(255, 255, 255, 0.6) !important;\n        }\n        \n        .settings-card li {\n          border-bottom-color: #3c3c3c !important;\n        }\n        \n        .settings-card li a {\n          color: #a0a0a0 !important;\n        }\n        \n        #show-last-ai-response-btn,\n        #show-last-sent-prompt-btn {\n          background-color: #2c2c2c !important;\n          color: #a0a0a0 !important;\n        }\n\n        /*  */\n        #moments-view {\n          background: linear-gradient(180deg, #1a1a1a 0%, #252525 100%) !important;\n        }\n        \n        .moments-body {\n          background-color: #1a1a1a !important;\n        }\n        \n        .moment-post {\n          border-bottom-color: #2c2c2c !important;\n        }\n        \n        .post-interactions {\n          background: #2a2a2a !important;\n          border-color: #3c3c3c !important;\n        }\n        \n        .post-interactions::before {\n          border-bottom-color: #2a2a2a !important;\n        }\n        \n        .likes-section {\n          background: rgba(42, 42, 42, 0.8) !important;\n        }\n        \n        .comments-section {\n          border-top-color: #3c3c3c !important;\n        }\n        \n        .post-meta .comment-button {\n          background: #2c2c2c !important;\n        }\n\n        /*  -  */\n        .post-media .image-desc-content {\n          background-color: rgba(42, 42, 42, 0.8) !important;\n          border: 1px solid rgba(60, 60, 60, 0.4) !important;\n          color: #e0e0e0 !important;\n        }\n\n        /*  */\n        .post-author-name, \n        .liker-name, \n        .comment-author {\n          color: #a0c0e0 !important;\n        }\n        \n        .moments-header,\n        .wechat-header {\n          background: linear-gradient(315deg, #252525 0%, #1a1a1a 100%) !important;\n          border-bottom-color: #3c3c3c !important;\n        }\n        \n        .wechat-footer {\n          background: linear-gradient(315deg, #252525 0%, #1a1a1a 100%) !important;\n          border-top-color: #3c3c3c !important;\n        }\n        \n        .wechat-footer .text-input {\n          background-color: #2a2a2a !important;\n          border-color: #3c3c3c !important;\n          color: #e0e0e0 !important;\n        }\n        \n        .wechat-footer .text-input::placeholder {\n          color: #808080 !important;\n        }\n        \n        .timestamp-text,\n        .event-time-text {\n          background: linear-gradient(315deg, #505050 0%, #3c3c3c 100%) !important;\n        }\n        \n        .recall-notice-text {\n          background: linear-gradient(315deg, #505050 0%, #3c3c3c 100%) !important;\n        }\n        \n        .message-row.them .voice-bubble .voice-icon {\n          color: #a0c0e0 !important;\n        }\n        \n        .voice-text-content {\n          background-color: #2a2a2a !important;\n          border-color: #3c3c3c !important;\n          color: #e0e0e0 !important;\n        }\n        \n        .location-card,\n        .file-card {\n          background-color: #2a2a2a !important;\n        }\n        \n        .location-content .location-title {\n          color: #e0e0e0 !important;\n        }\n        \n        .file-details .file-name {\n          color: #e0e0e0 !important;\n        }\n        \n        .file-footer {\n          background-color: #252525 !important;\n          border-top-color: #3c3c3c !important;\n        }\n        \n        .panel-container {\n          background-color: #1a1a1a !important;\n        }\n        \n        .feature-icon {\n          background-color: #2a2a2a !important;\n          border-color: #3c3c3c !important;\n        }\n        \n        .feature-label {\n          color: #a0a0a0 !important;\n        }\n        \n        /* Theme-colored icons in dark mode */\n        .feature-icon .theme-icon {\n          color: var(--primary-blue) !important;\n        }\n        \n        /*  */\n        .wallpaper-container {\n          background-color: #2a2a2a !important;\n          color: #e0e0e0 !important;\n        }\n        \n        .wallpaper-container h2,\n        .wallpaper-container h3,\n        .wallpaper-container p {\n          color: #e0e0e0 !important;\n        }\n        \n        .wallpaper-container input[type=\"text\"],\n        .wallpaper-container input[type=\"file\"] {\n          background-color: #1a1a1a !important;\n          border-color: #3c3c3c !important;\n          color: #e0e0e0 !important;\n        }\n        \n        .wallpaper-item .name {\n          background-color: rgba(42, 42, 42, 0.9) !important;\n          color: #e0e0e0 !important;\n        }\n      `\n          : ''\n      }\n    `;\n\n    const oldDynamicStyles = document.getElementById('theme-dynamic-styles');\n    if (oldDynamicStyles) {\n      oldDynamicStyles.remove();\n    }\n    document.head.appendChild(style);\n  }\n\n  // HEXRGBA\n  private hexToRgba(hex: string, alpha: number): string {\n    const r = parseInt(hex.slice(1, 3), 16);\n    const g = parseInt(hex.slice(3, 5), 16);\n    const b = parseInt(hex.slice(5, 7), 16);\n\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`;\n  }\n\n  // RGB\n  private extractRgbComponents(hex: string): { r: number; g: number; b: number } {\n    const r = parseInt(hex.slice(1, 3), 16);\n    const g = parseInt(hex.slice(3, 5), 16);\n    const b = parseInt(hex.slice(5, 7), 16);\n\n    return { r, g, b };\n  }\n\n  // \n  private lightenDarkenColor(color: string, amount: number): string {\n    let hex = color.replace('#', '');\n    if (hex.length === 3) {\n      hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\n    }\n    const num = parseInt(hex, 16);\n    let r = (num >> 16) + amount;\n    let g = ((num >> 8) & 0x00ff) + amount;\n    let b = (num & 0x0000ff) + amount;\n\n    r = Math.max(0, Math.min(255, r));\n    g = Math.max(0, Math.min(255, g));\n    b = Math.max(0, Math.min(255, b));\n\n    const rHex = r.toString(16).padStart(2, '0');\n    const gHex = g.toString(16).padStart(2, '0');\n    const bHex = b.toString(16).padStart(2, '0');\n\n    return `#${rHex}${gHex}${bHex}`;\n  }\n}\n\n// \nexport interface Wallpaper {\n  id: string;\n  type: 'color' | 'image' | 'url';\n  value: string; // URL\n  name: string;\n  thumbnail?: string; // URL\n}\n\n// \nexport class WallpaperManager {\n  private static WALLPAPER_STORAGE_KEY_PREFIX = 'blmx_wallpaper_';\n  private static CUSTOM_WALLPAPERS_KEY = 'blmx_custom_wallpapers';\n  private static THEME_WALLPAPER_KEY_PREFIX = 'blmx_theme_wallpaper_';\n  private currentThemeName: string = 'white'; // \n\n  // \n  private builtInWallpapers: Wallpaper[] = [\n    { id: 'blue_solid', type: 'color', value: '#e8f4fd', name: '' },\n    { id: 'pink_solid', type: 'color', value: '#fde8f4', name: '' },\n    { id: 'white_solid', type: 'color', value: '#f8f8f8', name: '' },\n    { id: 'dark_solid', type: 'color', value: '#1a1a1a', name: '' },\n    {\n      id: 'default_image',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '',\n    },\n    {\n      id: 'dark_image',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '',\n    },\n    {\n      id: 'blue_theme',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '',\n    },\n    {\n      id: 'pink_theme',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '',\n    },\n    {\n      id: 'kitty_theme',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '',\n    },\n    {\n      id: 'deep_stars_2',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg',\n      name: '2',\n    },\n    {\n      id: 'deep_stars_3',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_3.jpg',\n      name: '3',\n    },\n    {\n      id: 'white_stars',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '',\n    },\n    {\n      id: 'pink_stars_2',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg',\n      name: '2',\n    },\n    {\n      id: 'pink_grid_2',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg',\n      name: '2',\n    },\n    {\n      id: 'pink_grid_4',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_4.jpg',\n      name: '4',\n    },\n    {\n      id: 'blue_1',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '1',\n    },\n  ];\n\n  // \n  private customWallpapers: Wallpaper[] = [];\n\n  constructor() {\n    this.loadCustomWallpapers();\n    // localStorage\n    const savedThemeName = localStorage.getItem('blmx_theme');\n    if (savedThemeName) {\n      this.currentThemeName = savedThemeName;\n    }\n\n    // \n    this.migrateOldWallpaperSettings();\n  }\n\n  // \n  setCurrentThemeName(themeName: string): void {\n    this.currentThemeName = themeName;\n  }\n\n  // +\n  getAllWallpapers(): Wallpaper[] {\n    return [...this.builtInWallpapers, ...this.customWallpapers];\n  }\n\n  // \n  getBuiltInWallpapers(): Wallpaper[] {\n    return this.builtInWallpapers;\n  }\n\n  // \n  getCustomWallpapers(): Wallpaper[] {\n    return this.customWallpapers;\n  }\n\n  // \n  addCustomWallpaper(wallpaper: Omit<Wallpaper, 'id'>): Wallpaper {\n    const id = `custom_${Date.now()}`;\n    const newWallpaper: Wallpaper = { ...wallpaper, id };\n\n    this.customWallpapers.push(newWallpaper);\n    this.saveCustomWallpapers();\n\n    return newWallpaper;\n  }\n\n  // \n  deleteCustomWallpaper(id: string): boolean {\n    const initialLength = this.customWallpapers.length;\n    this.customWallpapers = this.customWallpapers.filter(w => w.id !== id);\n\n    if (this.customWallpapers.length !== initialLength) {\n      this.saveCustomWallpapers();\n      return true;\n    }\n\n    return false;\n  }\n\n  // \n  setWallpaper(viewType: 'chat' | 'home' | 'settings', wallpaper: Wallpaper | null): void {\n    // \n    const storageKey = `${WallpaperManager.THEME_WALLPAPER_KEY_PREFIX}${this.currentThemeName}_${viewType}`;\n\n    if (wallpaper) {\n      localStorage.setItem(storageKey, JSON.stringify(wallpaper));\n    } else {\n      localStorage.removeItem(storageKey);\n    }\n  }\n\n  // \n  getCurrentWallpaper(viewType: 'chat' | 'home' | 'settings'): Wallpaper | null {\n    // \n    const themeStorageKey = `${WallpaperManager.THEME_WALLPAPER_KEY_PREFIX}${this.currentThemeName}_${viewType}`;\n    const savedThemeWallpaper = localStorage.getItem(themeStorageKey);\n\n    if (savedThemeWallpaper) {\n      try {\n        return JSON.parse(savedThemeWallpaper);\n      } catch (e) {\n        console.error('Failed to parse theme wallpaper:', e);\n      }\n    }\n\n    // \n    const oldStorageKey = `${WallpaperManager.WALLPAPER_STORAGE_KEY_PREFIX}${viewType}`;\n    const savedOldWallpaper = localStorage.getItem(oldStorageKey);\n\n    if (savedOldWallpaper) {\n      try {\n        return JSON.parse(savedOldWallpaper);\n      } catch (e) {\n        console.error('Failed to parse old wallpaper:', e);\n      }\n    }\n\n    return null;\n  }\n\n  // \n  private migrateOldWallpaperSettings(): void {\n    const viewTypes: Array<'chat' | 'home' | 'settings'> = ['chat', 'home', 'settings'];\n\n    viewTypes.forEach(viewType => {\n      const oldStorageKey = `${WallpaperManager.WALLPAPER_STORAGE_KEY_PREFIX}${viewType}`;\n      const savedOldWallpaper = localStorage.getItem(oldStorageKey);\n\n      if (savedOldWallpaper) {\n        try {\n          // \n          JSON.parse(savedOldWallpaper);\n          // \n          const themeStorageKey = `${WallpaperManager.THEME_WALLPAPER_KEY_PREFIX}${this.currentThemeName}_${viewType}`;\n\n          // \n          if (!localStorage.getItem(themeStorageKey)) {\n            localStorage.setItem(themeStorageKey, savedOldWallpaper);\n          }\n\n          // \n          localStorage.removeItem(oldStorageKey);\n        } catch (e) {\n          console.error('Failed to migrate old wallpaper setting:', e);\n        }\n      }\n    });\n  }\n\n  // \n  applyThemeDefaultWallpapers(theme: Theme): void {\n    // \n    this.setCurrentThemeName(theme.name);\n\n    const viewTypes: Array<'chat' | 'home' | 'settings'> = ['chat', 'home', 'settings'];\n\n    viewTypes.forEach(viewType => {\n      // \n      const themeStorageKey = `${WallpaperManager.THEME_WALLPAPER_KEY_PREFIX}${theme.name}_${viewType}`;\n      const existingWallpaper = localStorage.getItem(themeStorageKey);\n\n      if (existingWallpaper) {\n        // \n        return;\n      }\n\n      const defaultValue = theme.colors.defaultWallpapers[viewType];\n\n      // \n      const isColor = defaultValue.startsWith('#');\n\n      const wallpaper: Wallpaper = {\n        id: `theme_default_${viewType}`,\n        type: isColor ? 'color' : 'image',\n        value: defaultValue,\n        name: `${theme.displayName}${viewType === 'chat' ? '' : viewType === 'home' ? '' : ''}`,\n      };\n\n      // \n      localStorage.setItem(themeStorageKey, JSON.stringify(wallpaper));\n    });\n  }\n\n  // DOM\n  applyWallpaperToElement(element: HTMLElement, wallpaper: Wallpaper | null, defaultThemeWallpaper?: string): void {\n    if (!element) return;\n\n    // \n    element.style.backgroundImage = 'none';\n    element.style.backgroundColor = '';\n    element.style.backgroundSize = '';\n    element.style.backgroundPosition = '';\n    element.style.backgroundRepeat = '';\n\n    if (wallpaper) {\n      if (wallpaper.type === 'color') {\n        //  - \n        element.style.backgroundImage = 'none';\n        element.style.backgroundColor = wallpaper.value;\n      } else {\n        // \n        element.style.backgroundImage = `url(\"${wallpaper.value}\")`;\n        element.style.backgroundSize = 'cover';\n        element.style.backgroundPosition = 'center';\n        element.style.backgroundRepeat = 'no-repeat';\n      }\n    } else if (defaultThemeWallpaper) {\n      // \n      if (defaultThemeWallpaper.startsWith('#')) {\n        // \n        element.style.backgroundImage = 'none';\n        element.style.backgroundColor = defaultThemeWallpaper;\n      } else {\n        // URL\n        element.style.backgroundImage = `url(\"${defaultThemeWallpaper}\")`;\n        element.style.backgroundSize = 'cover';\n        element.style.backgroundPosition = 'center';\n        element.style.backgroundRepeat = 'no-repeat';\n      }\n    }\n  }\n\n  // URL\n  async createWallpaperFromUrl(url: string, name: string): Promise<Wallpaper | null> {\n    try {\n      // URL\n      new URL(url);\n\n      return this.addCustomWallpaper({\n        type: 'url',\n        value: url,\n        name: name || `URL ${new Date().toLocaleString()}`,\n      });\n    } catch (e) {\n      console.error('Invalid URL:', e);\n      return null;\n    }\n  }\n\n  // File\n  async createWallpaperFromFile(file: File): Promise<Wallpaper | null> {\n    return new Promise(resolve => {\n      if (!file.type.startsWith('image/')) {\n        resolve(null);\n        return;\n      }\n\n      const reader = new FileReader();\n      reader.onload = e => {\n        if (e.target?.result) {\n          const wallpaper = this.addCustomWallpaper({\n            type: 'image',\n            value: e.target.result as string,\n            name: file.name || ` ${new Date().toLocaleString()}`,\n          });\n          resolve(wallpaper);\n        } else {\n          resolve(null);\n        }\n      };\n\n      reader.onerror = () => resolve(null);\n      reader.readAsDataURL(file);\n    });\n  }\n\n  // \n  createSolidColorWallpaper(color: string, name?: string): Wallpaper | null {\n    // 36\n    if (!color.match(/^#([0-9A-Fa-f]{3}){1,2}$/)) {\n      console.error('Invalid color format:', color);\n      return null;\n    }\n\n    // 6\n    let normalizedColor = color;\n    if (color.length === 4) {\n      // #RGB \n      const r = color[1];\n      const g = color[2];\n      const b = color[3];\n      normalizedColor = `#${r}${r}${g}${g}${b}${b}`;\n    }\n\n    return this.addCustomWallpaper({\n      type: 'color',\n      value: normalizedColor,\n      name: name || ` ${normalizedColor}`,\n    });\n  }\n\n  // \n  private loadCustomWallpapers(): void {\n    const savedWallpapers = localStorage.getItem(WallpaperManager.CUSTOM_WALLPAPERS_KEY);\n\n    if (savedWallpapers) {\n      try {\n        this.customWallpapers = JSON.parse(savedWallpapers);\n      } catch (e) {\n        console.error('Failed to load custom wallpapers:', e);\n        this.customWallpapers = [];\n      }\n    }\n  }\n\n  // \n  private saveCustomWallpapers(): void {\n    localStorage.setItem(WallpaperManager.CUSTOM_WALLPAPERS_KEY, JSON.stringify(this.customWallpapers));\n  }\n}\n","// \n// UI\n\nimport { ConfigManager } from './config-manager';\nimport { LogEntry } from './script';\nimport { APP_VERSION } from './theme-manager';\n\nexport class UIManager {\n  private configManager: ConfigManager;\n  private onAddEntry?: (entry: LogEntry) => void;\n  private onRenderEntry?: (entry: LogEntry, index?: number, animate?: boolean) => void;\n\n  constructor(\n    configManager: ConfigManager,\n    onAddEntry?: (entry: LogEntry) => void,\n    onRenderEntry?: (entry: LogEntry, index?: number, animate?: boolean) => void,\n  ) {\n    this.configManager = configManager;\n    this.onAddEntry = onAddEntry;\n    this.onRenderEntry = onRenderEntry;\n  }\n\n  // \n  displayAppVersion(): void {\n    $('#app-version-display').text(`v${APP_VERSION}`);\n  }\n\n  // \n  checkVersionUpdateNotification(): void {\n    const lastNotifiedVersion = this.configManager.getLastNotifiedVersion();\n\n    // \n    if (lastNotifiedVersion !== APP_VERSION) {\n      this.showVersionUpdateNotification();\n      this.configManager.setLastNotifiedVersion(APP_VERSION);\n    }\n  }\n\n  // \n  private showVersionUpdateNotification(): void {\n    // \n    const updateEntry: LogEntry = {\n      type: 'message',\n      sender: 'them',\n      content: ` v${APP_VERSION}`,\n      id: `system-${Date.now()}`,\n      isSystemMessage: true,\n    };\n\n    // \n    if (this.onAddEntry) {\n      this.onAddEntry(updateEntry);\n    }\n\n    // \n    if (this.onRenderEntry) {\n      this.onRenderEntry(updateEntry, undefined, true);\n    }\n  }\n\n  // \n  updateFooterButtonsState(hasNotifications: boolean): void {\n    const $wechatInput = $('#wechat-input-field');\n    const $sendBtn = $('#send-btn');\n    const $plusBtn = $('#plus-btn');\n\n    const hasText = $wechatInput.val()?.toString().trim() !== '';\n    const shouldShowSendBtn = hasText || hasNotifications;\n\n    // jQuery\n    $sendBtn.css('display', shouldShowSendBtn ? 'flex' : 'none');\n    $plusBtn.css('display', hasText ? 'none' : 'inline-block');\n  }\n\n  // \n  togglePanel(panelToShow: string | null): void {\n    const $panelContainer = $('#panel-container');\n    const $currentActivePanel = $('.panel-view.active');\n    const isActive = $panelContainer.hasClass('active');\n\n    if (isActive && $currentActivePanel.length && $currentActivePanel.attr('id')?.startsWith(panelToShow || '')) {\n      $panelContainer.removeClass('active');\n      $currentActivePanel.removeClass('active');\n    } else if (panelToShow) {\n      if ($currentActivePanel.length) $currentActivePanel.removeClass('active');\n      $(`#${panelToShow}-panel`).addClass('active');\n      if (!isActive) $panelContainer.addClass('active');\n    } else {\n      if (isActive) $panelContainer.removeClass('active');\n      if ($currentActivePanel.length) $currentActivePanel.removeClass('active');\n    }\n  }\n\n  // \n  navigateTo(viewName: 'home' | 'wechat' | 'moments' | 'settings', onEnterMomentsView?: () => void): void {\n    const views = {\n      home: '#app-homescreen',\n      wechat: '#wechat-view',\n      moments: '#moments-view',\n      settings: '#settings-view',\n    };\n\n    // jQuery\n    $('.app-view').removeClass('active');\n    $(views[viewName]).addClass('active');\n\n    // \n    if (viewName === 'moments' && onEnterMomentsView) {\n      onEnterMomentsView();\n    }\n  }\n\n  // \n  setupInputPlaceholder(charDisplayName: string): void {\n    const savedPlaceholder = this.configManager.getSavedInputPlaceholder();\n    const $inputElement = $('#wechat-input-field');\n    $inputElement.attr('placeholder', savedPlaceholder || ` ${charDisplayName} ...`);\n    $inputElement.prop('disabled', false);\n  }\n\n  // \n  setupPhoneSizeAdjustment(): void {\n    const defaultBtn = document.getElementById('phone-size-default');\n    const mediumBtn = document.getElementById('phone-size-medium');\n    const smallBtn = document.getElementById('phone-size-small');\n    const phoneScreen = document.querySelector('.phone-screen') as HTMLElement;\n\n    if (!defaultBtn || !mediumBtn || !smallBtn || !phoneScreen) {\n      console.error('[BLMX] Phone size adjustment elements not found');\n      return;\n    }\n\n    // \n    const savedSize = this.configManager.getPhoneSize();\n    this.applyPhoneSize(savedSize, phoneScreen, [defaultBtn, mediumBtn, smallBtn]);\n\n    // \n    defaultBtn.addEventListener('click', () => {\n      this.applyPhoneSize('default', phoneScreen, [defaultBtn, mediumBtn, smallBtn]);\n    });\n\n    mediumBtn.addEventListener('click', () => {\n      this.applyPhoneSize('medium', phoneScreen, [defaultBtn, mediumBtn, smallBtn]);\n    });\n\n    smallBtn.addEventListener('click', () => {\n      this.applyPhoneSize('small', phoneScreen, [defaultBtn, mediumBtn, smallBtn]);\n    });\n  }\n\n  // \n  setupStickerSizeControl(): void {\n    const sizeSlider = document.getElementById('sticker-size-slider') as HTMLInputElement;\n    const sizeInput = document.getElementById('sticker-size-input') as HTMLInputElement;\n    const smallSizeBtn = document.getElementById('sticker-size-small');\n    const mediumSizeBtn = document.getElementById('sticker-size-medium');\n\n    if (!sizeSlider || !sizeInput || !smallSizeBtn || !mediumSizeBtn) {\n      return;\n    }\n\n    // \n    const savedSize = this.configManager.getStickerSize();\n\n    // \n    sizeSlider.value = savedSize.toString();\n    sizeInput.value = savedSize.toString();\n\n    // \n    if (savedSize === 80) {\n      smallSizeBtn.classList.add('sticker-size-active');\n      mediumSizeBtn.classList.remove('sticker-size-active');\n    } else if (savedSize === 120) {\n      smallSizeBtn.classList.remove('sticker-size-active');\n      mediumSizeBtn.classList.add('sticker-size-active');\n    } else {\n      smallSizeBtn.classList.remove('sticker-size-active');\n      mediumSizeBtn.classList.remove('sticker-size-active');\n    }\n\n    // CSS\n    this.applyStickerSize(savedSize);\n\n    // \n    sizeSlider.addEventListener('input', () => {\n      const newSize = parseInt(sizeSlider.value);\n      sizeInput.value = newSize.toString();\n      this.configManager.setStickerSize(newSize);\n      this.applyStickerSize(newSize);\n\n      // \n      this.updateStickerSizeButtonState(newSize, smallSizeBtn, mediumSizeBtn);\n    });\n\n    // \n    sizeInput.addEventListener('change', () => {\n      let newSize = parseInt(sizeInput.value);\n      // \n      if (newSize < 40) newSize = 40;\n      if (newSize > 200) newSize = 200;\n\n      const newSizeStr = newSize.toString();\n      sizeInput.value = newSizeStr;\n      sizeSlider.value = newSizeStr;\n      this.configManager.setStickerSize(newSize);\n      this.applyStickerSize(newSize);\n\n      // \n      this.updateStickerSizeButtonState(newSize, smallSizeBtn, mediumSizeBtn);\n    });\n\n    // \n    smallSizeBtn.addEventListener('click', () => {\n      this.setStickerSize(80, sizeSlider, sizeInput, smallSizeBtn, mediumSizeBtn);\n    });\n\n    // \n    mediumSizeBtn.addEventListener('click', () => {\n      this.setStickerSize(120, sizeSlider, sizeInput, smallSizeBtn, mediumSizeBtn);\n    });\n  }\n\n  // \n  private applyPhoneSize(size: 'default' | 'medium' | 'small', phoneScreen: HTMLElement, buttons: HTMLElement[]): void {\n    // \n    const PHONE_SIZES = {\n      default: '48.75rem', // : 48.75rem (780px)\n      medium: '42rem', // : 42rem (672px)\n      small: '36rem', // : 36rem (576px)\n    };\n\n    // \n    phoneScreen.style.height = PHONE_SIZES[size];\n\n    // \n    this.configManager.setPhoneSize(size);\n\n    // \n    buttons.forEach(btn => btn.classList.remove('phone-size-active'));\n\n    // \n    if (size === 'default') {\n      buttons[0].classList.add('phone-size-active');\n    } else if (size === 'medium') {\n      buttons[1].classList.add('phone-size-active');\n    } else if (size === 'small') {\n      buttons[2].classList.add('phone-size-active');\n    }\n  }\n\n  // \n  private applyStickerSize(size: number): void {\n    document.documentElement.style.setProperty('--sticker-size', `${size}px`);\n  }\n\n  // \n  private setStickerSize(\n    size: number,\n    sizeSlider: HTMLInputElement,\n    sizeInput: HTMLInputElement,\n    smallSizeBtn: HTMLElement,\n    mediumSizeBtn: HTMLElement,\n  ): void {\n    sizeSlider.value = size.toString();\n    sizeInput.value = size.toString();\n    this.configManager.setStickerSize(size);\n    this.applyStickerSize(size);\n\n    this.updateStickerSizeButtonState(size, smallSizeBtn, mediumSizeBtn);\n  }\n\n  // \n  private updateStickerSizeButtonState(size: number, smallSizeBtn: HTMLElement, mediumSizeBtn: HTMLElement): void {\n    if (size === 80) {\n      smallSizeBtn.classList.add('sticker-size-active');\n      mediumSizeBtn.classList.remove('sticker-size-active');\n    } else if (size === 120) {\n      smallSizeBtn.classList.remove('sticker-size-active');\n      mediumSizeBtn.classList.add('sticker-size-active');\n    } else {\n      smallSizeBtn.classList.remove('sticker-size-active');\n      mediumSizeBtn.classList.remove('sticker-size-active');\n    }\n  }\n\n  // \n  scrollToBottom(): void {\n    setTimeout(() => {\n      const wechatBody = document.querySelector('.wechat-body') as HTMLElement;\n      if (wechatBody) {\n        wechatBody.scrollTop = wechatBody.scrollHeight;\n      }\n    }, 300);\n  }\n\n  // \n  setupFontSelection(): void {\n    const $customFontBtn = $('#font-default');\n    const $systemFontBtn = $('#font-system');\n\n    if (!$customFontBtn.length || !$systemFontBtn.length) {\n      return;\n    }\n\n    // localStorage\n    const savedFont = localStorage.getItem('blmx_font_setting') || 'custom';\n    this.applyFontSetting(savedFont as 'custom' | 'system');\n\n    // \n    $customFontBtn.on('click', () => {\n      this.applyFontSetting('custom');\n      localStorage.setItem('blmx_font_setting', 'custom');\n    });\n\n    $systemFontBtn.on('click', () => {\n      this.applyFontSetting('system');\n      localStorage.setItem('blmx_font_setting', 'system');\n    });\n  }\n\n  // \n  private applyFontSetting(fontType: 'custom' | 'system'): void {\n    const $body = $('body');\n    const $customBtn = $('#font-default');\n    const $systemBtn = $('#font-system');\n\n    // \n    $('.font-btn').removeClass('font-active');\n\n    if (fontType === 'custom') {\n      //  - \n      this.applyCustomFont();\n      $customBtn.addClass('font-active');\n    } else {\n      //  - \n      this.applySystemFont();\n      $systemBtn.addClass('font-active');\n    }\n  }\n\n  // \n  private applyCustomFont(): void {\n    const $body = $('body');\n\n    // WebView\n    const isIOSWebView = /iPhone|iPad|iPod/.test(navigator.userAgent) && /WebKit/.test(navigator.userAgent);\n    const isHuaweiWebView = /HUAWEI/.test(navigator.userAgent);\n\n    if (isIOSWebView || isHuaweiWebView) {\n      // WebView\n      // Font Loading API\n      const fontStack =\n        \"'MyCustomFont', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif\";\n      $body.css('font-family', fontStack);\n\n      // \n      $body.addClass('force-font-refresh');\n      setTimeout(() => {\n        $body.removeClass('force-font-refresh');\n      }, 50);\n\n      // \n      setTimeout(() => {\n        $body.css('font-family', fontStack);\n      }, 100);\n\n      return;\n    }\n\n    // \n    this.checkFontLoaded('MyCustomFont').then(loaded => {\n      if (loaded) {\n        // \n        $body.css('font-family', \"'MyCustomFont', 'Noto Sans SC', sans-serif\");\n      } else {\n        // \n        this.loadCustomFont()\n          .then(() => {\n            $body.css('font-family', \"'MyCustomFont', 'Noto Sans SC', sans-serif\");\n          })\n          .catch(() => {\n            // \n            $body.css('font-family', \"'Noto Sans SC', sans-serif\");\n          });\n      }\n    });\n  }\n\n  // \n  private applySystemFont(): void {\n    const $body = $('body');\n\n    // WebView\n    const isIOSWebView = /iPhone|iPad|iPod/.test(navigator.userAgent) && /WebKit/.test(navigator.userAgent);\n    const isHuaweiWebView = /HUAWEI/.test(navigator.userAgent);\n\n    let fontStack: string;\n\n    if (isIOSWebView) {\n      // iOS WebView \n      fontStack = '-apple-system, \"SF Pro Display\", \"SF Pro Text\", \"Helvetica Neue\", Helvetica, Arial, sans-serif';\n    } else if (isHuaweiWebView) {\n      //  WebView \n      fontStack = '\"HarmonyOS Sans\", \"Noto Sans SC\", \"Microsoft YaHei\", Arial, sans-serif';\n    } else {\n      // \n      fontStack =\n        '-apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Helvetica Neue\", Arial, \"Noto Sans\", \"Liberation Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji\"';\n    }\n\n    $body.css('font-family', fontStack);\n\n    // WebView\n    if (isIOSWebView || isHuaweiWebView) {\n      $body.addClass('force-font-refresh');\n      setTimeout(() => {\n        $body.removeClass('force-font-refresh');\n      }, 50);\n    }\n  }\n\n  // \n  private checkFontLoaded(fontFamily: string): Promise<boolean> {\n    return new Promise(resolve => {\n      if (!document.fonts) {\n        // Font Loading API\n        resolve(true);\n        return;\n      }\n\n      document.fonts.ready\n        .then(() => {\n          const fontFace = Array.from(document.fonts).find(\n            font => font.family === fontFamily || font.family === `'${fontFamily}'`,\n          );\n          resolve(!!fontFace && fontFace.status === 'loaded');\n        })\n        .catch(() => {\n          resolve(false);\n        });\n    });\n  }\n\n  // \n  private loadCustomFont(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      if (!document.fonts) {\n        // Font Loading API\n        const testElement = $('<div>')\n          .css({\n            position: 'absolute',\n            left: '-9999px',\n            top: '-9999px',\n            fontSize: '72px',\n            fontFamily: \"'MyCustomFont', monospace\",\n            visibility: 'hidden',\n          })\n          .text('test')\n          .appendTo('body');\n\n        // \n        setTimeout(() => {\n          testElement.remove();\n          resolve();\n        }, 1000);\n        return;\n      }\n\n      const fontFace = new FontFace('MyCustomFont', 'url(https://files.catbox.moe/er4wsg.ttf)');\n\n      fontFace\n        .load()\n        .then(loadedFace => {\n          document.fonts.add(loadedFace);\n          resolve();\n        })\n        .catch(error => {\n          reject(error);\n        });\n    });\n  }\n\n  // \n  setupFullscreenSizeAdjustment(): void {\n    // DOM\n    setTimeout(() => {\n      const $defaultBtn = $('#fullscreen-size-default');\n      const $largeBtn = $('#fullscreen-size-large');\n      const $xlargeBtn = $('#fullscreen-size-xlarge');\n      const $slider = $('#fullscreen-size-slider');\n      const $input = $('#fullscreen-size-input');\n\n      if (!$defaultBtn.length || !$largeBtn.length || !$xlargeBtn.length || !$slider.length || !$input.length) {\n        return;\n      }\n\n      this.initializeFullscreenSizeControls($defaultBtn, $largeBtn, $xlargeBtn, $slider, $input);\n    }, 100);\n  }\n\n  // \n  private initializeFullscreenSizeControls(\n    $defaultBtn: JQuery,\n    $largeBtn: JQuery,\n    $xlargeBtn: JQuery,\n    $slider: JQuery,\n    $input: JQuery,\n  ): void {\n    // localStorage\n    const savedSize = this.configManager.getFullscreenSize();\n\n    // \n    $slider.val(savedSize);\n    $input.val(savedSize);\n    this.applyFullscreenSize(savedSize);\n    this.updateFullscreenSizeButtonState(savedSize);\n\n    // \n    $defaultBtn.off('click').on('click', e => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.setFullscreenSize(100);\n    });\n\n    $largeBtn.off('click').on('click', e => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.setFullscreenSize(130);\n    });\n\n    $xlargeBtn.off('click').on('click', e => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.setFullscreenSize(160);\n    });\n\n    // \n    $slider.off('input').on('input', e => {\n      const newSize = parseInt($(e.target).val() as string);\n      $input.val(newSize);\n      this.setFullscreenSize(newSize);\n    });\n\n    // \n    $input.off('change').on('change', e => {\n      let newSize = parseInt($(e.target).val() as string);\n      // \n      if (newSize < 50) newSize = 50;\n      if (newSize > 200) newSize = 200;\n\n      $input.val(newSize);\n      $slider.val(newSize);\n      this.setFullscreenSize(newSize);\n    });\n\n    // \n    this.setupFullscreenListener();\n  }\n\n  // \n  private setupFullscreenListener(): void {\n    const handleFullscreenChange = () => {\n      const isFullscreen = !!(\n        document.fullscreenElement ||\n        (document as any).webkitFullscreenElement ||\n        (document as any).mozFullScreenElement ||\n        (document as any).msFullscreenElement\n      );\n\n      if (!isFullscreen) {\n        // \n        this.resetBrowserZoom();\n      } else {\n        // \n        const currentSize = this.configManager.getFullscreenSize();\n        this.applyBrowserLikeZoom(currentSize / 100);\n      }\n    };\n\n    // \n    document.addEventListener('fullscreenchange', handleFullscreenChange);\n    document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\n    document.addEventListener('mozfullscreenchange', handleFullscreenChange);\n    document.addEventListener('MSFullscreenChange', handleFullscreenChange);\n  }\n\n  // \n  private resetBrowserZoom(): void {\n    const body = document.body;\n\n    // \n    body.style.transform = '';\n    body.style.transformOrigin = '';\n    body.style.position = '';\n    body.style.width = '';\n    body.style.height = '';\n    body.style.margin = '';\n  }\n\n  // UI\n  private setFullscreenSize(size: number): void {\n    // \n    this.configManager.setFullscreenSize(size);\n\n    // \n    $('#fullscreen-size-slider').val(size);\n    $('#fullscreen-size-input').val(size);\n\n    // \n    this.applyFullscreenSize(size);\n\n    // \n    this.updateFullscreenSizeButtonState(size);\n  }\n\n  // \n  private applyFullscreenSize(size: number): void {\n    const scale = size / 100;\n\n    // \n    const isFullscreen = !!(\n      document.fullscreenElement ||\n      (document as any).webkitFullscreenElement ||\n      (document as any).mozFullScreenElement ||\n      (document as any).msFullscreenElement\n    );\n\n    if (isFullscreen) {\n      // \n      this.applyBrowserLikeZoom(scale);\n    }\n    // \n  }\n\n  // \n  private applyBrowserLikeZoom(scale: number): void {\n    const body = document.body;\n\n    if (scale !== 1) {\n      body.style.transform = `scale(${scale})`;\n      body.style.transformOrigin = 'center center';\n      body.style.position = 'relative';\n      body.style.width = `${100 / scale}%`;\n      body.style.height = `${100 / scale}%`;\n      body.style.margin = '0 auto';\n    } else {\n      body.style.transform = '';\n      body.style.transformOrigin = '';\n      body.style.position = '';\n      body.style.width = '';\n      body.style.height = '';\n      body.style.margin = '';\n    }\n  }\n\n  // \n  private updateFullscreenSizeButtonState(size: number): void {\n    // \n    $('.fullscreen-size-btn').removeClass('fullscreen-size-active');\n\n    // \n    if (size === 100) {\n      $('#fullscreen-size-default').addClass('fullscreen-size-active');\n    } else if (size === 130) {\n      $('#fullscreen-size-large').addClass('fullscreen-size-active');\n    } else if (size === 160) {\n      $('#fullscreen-size-xlarge').addClass('fullscreen-size-active');\n    }\n    // \n  }\n}\n","import { EventManager } from './event-manager';\nimport {\n  ChatEntry,\n  EventLogEntry,\n  FileMessage,\n  GiftMessage,\n  ImageMessage,\n  LocationMessage,\n  LogEntry,\n  StickerMessage,\n  TextMessage,\n  TransferMessage,\n  VoiceMessage,\n} from './script';\n\n// \ninterface Avatars {\n  user: string;\n  char: string;\n}\n\ninterface UIRendererOptions {\n  getDisplayName: (type: 'user' | 'char') => string;\n  findStickerUrlByName: (name: string) => string | undefined;\n  onTransferAccept?: (data: TransferMessage['data']) => void;\n  onGiftAction?: (data: GiftMessage['data']) => Promise<void>;\n  onRecallMessage?: (entry: ChatEntry) => Promise<void>;\n  isMessageInQueue?: (messageId: string) => boolean;\n}\n\n// UI\nexport class UIRenderer {\n  private wechatBody: HTMLElement;\n  private lastDisplayedTimeInMinutes: number = -Infinity;\n  private options: UIRendererOptions;\n  private avatars: Avatars;\n  private eventManager: EventManager;\n\n  // \n  private renderQueue: LogEntry[] = [];\n  private isRendering: boolean = false;\n  private renderThrottle: number = 16; // 60fps\n\n  constructor(wechatBodySelector: string, avatars: Avatars, options: UIRendererOptions) {\n    const $wechatBody = $(wechatBodySelector);\n    if (!$wechatBody.length) {\n      throw new Error(`Element with selector \"${wechatBodySelector}\" not found`);\n    }\n    this.wechatBody = $wechatBody[0];\n    this.avatars = avatars;\n    this.options = options;\n    this.eventManager = new EventManager();\n\n    // \n    this.startRenderLoop();\n  }\n\n  /**\n   * \n   */\n  private startRenderLoop(): void {\n    const processQueue = () => {\n      if (this.renderQueue.length > 0 && !this.isRendering) {\n        this.isRendering = true;\n        const batch = this.renderQueue.splice(0, 5); // 5\n\n        batch.forEach(entry => {\n          this.renderEntry(entry, undefined, false);\n        });\n\n        this.isRendering = false;\n      }\n\n      setTimeout(processQueue, this.renderThrottle);\n    };\n\n    processQueue();\n  }\n\n  /**\n   * \n   */\n  private queueRender(entry: LogEntry): void {\n    this.renderQueue.push(entry);\n  }\n\n  // \n  clearChat(): void {\n    this.wechatBody.innerHTML = '';\n    this.lastDisplayedTimeInMinutes = -Infinity;\n  }\n\n  // UI\n  renderEntry(entry: LogEntry, index?: number, animate: boolean = false): void {\n    if (!entry) return;\n\n    if ('type' in entry) {\n      switch (entry.type) {\n        case 'message':\n          if (entry.isSystemMessage) {\n            this.renderSystemMessage(entry as TextMessage, animate, index);\n          } else {\n            this.addMessageToWeChat(entry, index, animate);\n          }\n          break;\n        case 'time':\n          this.addTimestampToWeChat(entry.content.date, entry.content.time, true, index);\n          break;\n        case 'event':\n          this.addEventLogToWeChat(entry.content, index);\n          break;\n        default:\n          this.addMessageToWeChat(entry, index, animate);\n      }\n    }\n  }\n\n  // \n  renderRecallNotice(entry: LogEntry, elementToReplace: HTMLElement | null = null, index?: number): void {\n    const who = this.options.getDisplayName('sender' in entry && entry.sender === 'me' ? 'user' : 'char');\n    const noticeRow = document.createElement('div');\n    noticeRow.className = 'timestamp-row';\n\n    // data-log-index\n    if (index !== undefined) {\n      noticeRow.dataset.logIndex = index.toString();\n    }\n\n    // idmessage-id\n    if ('id' in entry) {\n      noticeRow.dataset.messageId = entry.id;\n    }\n\n    const recalledText =\n      typeof entry.recalled_content === 'object' && entry.recalled_content !== null\n        ? entry.recalled_content.text\n        : entry.recalled_content;\n\n    noticeRow.innerHTML = `\n      <div class=\"recall-notice-container\">\n        <div class=\"recall-notice-text\">\"${who}\" </div>\n        <div class=\"recall-content\">${recalledText || ('content' in entry ? entry.content : '')}</div>\n      </div>\n    `;\n\n    const noticeTextEl = noticeRow.querySelector('.recall-notice-text');\n    const contentEl = noticeRow.querySelector('.recall-content');\n\n    if (noticeTextEl && contentEl) {\n      noticeTextEl.addEventListener('click', () => {\n        contentEl.classList.toggle('expanded');\n      });\n    }\n\n    if (elementToReplace) {\n      elementToReplace.replaceWith(noticeRow);\n    } else {\n      this.wechatBody.appendChild(noticeRow);\n    }\n\n    this.scrollToBottom();\n  }\n\n  renderMomentsFeed(\n    logEntries: LogEntry[],\n    getDisplayName: (type: 'user' | 'char') => string,\n    avatars: { user: string; char: string },\n  ): void {\n    const momentsFeedList = $('#moments-feed-list')[0] as HTMLUListElement;\n    if (!momentsFeedList) return;\n\n    momentsFeedList.innerHTML = '';\n    const posts: { [key: number]: any } = {};\n    const momentPostLogIndices: number[] = [];\n\n    logEntries.forEach((entry, index) => {\n      if ('key' in entry && entry.key.includes('_MOMENT')) {\n        momentPostLogIndices.push(index);\n      }\n    });\n\n    momentPostLogIndices.forEach(logIndex => {\n      const entry = logEntries[logIndex];\n      posts[logIndex] = { ...(entry as any), likes: [], comments: [], id: logIndex };\n    });\n\n    logEntries.forEach((entry, index) => {\n      if ('key' in entry && (entry.key.includes('_LIKE') || entry.key.includes('_COMMENT'))) {\n        const targetPostAbsoluteIndex = momentPostLogIndices[parseInt((entry as any).data.target_post_id, 10)];\n        const targetPost = posts[targetPostAbsoluteIndex];\n\n        if (targetPost) {\n          if (entry.key.includes('_LIKE')) {\n            const likerName = entry.key.startsWith('USER') ? getDisplayName('user') : getDisplayName('char');\n            if (!targetPost.likes.some((l: any) => l.name === likerName)) {\n              targetPost.likes.push({ key: entry.key, name: likerName, originalLogIndex: index });\n            }\n          } else {\n            targetPost.comments.push({ ...(entry as any), originalLogIndex: index });\n          }\n        } else {\n          // \n        }\n      }\n    });\n\n    Object.values(posts)\n      .reverse()\n      .forEach(post => {\n        const fromUser = post.key.startsWith('USER');\n        const authorName = fromUser ? getDisplayName('user') : getDisplayName('char');\n        const authorAvatar = fromUser ? avatars.user : avatars.char;\n        const li = document.createElement('li');\n        li.className = 'moment-post';\n        li.dataset.postId = post.id;\n        const momentSequenceId = momentPostLogIndices.indexOf(post.id);\n        li.dataset.momentSequenceId = String(momentSequenceId);\n        // moment-id\n        li.dataset.momentId = String(momentSequenceId);\n\n        let mediaHtml = '';\n        if (post.data.image_type === 'url' && post.data.image) {\n          mediaHtml = `<img src=\"${post.data.image}\" class=\"post-media-image\" />`;\n        } else if (post.data.image_type === 'desc' && post.data.image) {\n          mediaHtml = `<div class=\"image-desc-content\"><div class=\"text-wrapper\">${post.data.image}</div></div>`;\n        }\n\n        let interactionsHtml = '';\n        if (post.likes.length > 0 || post.comments.length > 0) {\n          const likersHtml =\n            post.likes.length > 0\n              ? `<div class=\"likes-section\"><i class=\"fas fa-heart\"></i> ${post.likes\n                  .map((l: any) => `<span class=\"liker-name\">${l.name}</span>`)\n                  .join(', ')}</div>`\n              : '';\n          const commentsHtml =\n            post.comments.length > 0\n              ? `<ul class=\"comments-section\">${post.comments\n                  .map(\n                    (c: any) =>\n                      `<li><span class=\"comment-author\">${\n                        c.key.startsWith('USER') ? getDisplayName('user') : getDisplayName('char')\n                      }</span>: ${c.data.text}</li>`,\n                  )\n                  .join('')}</ul>`\n              : '';\n          interactionsHtml = `<div class=\"post-interactions\">${likersHtml}${commentsHtml}</div>`;\n        }\n\n        const displayTime = this.formatMomentTimestamp(post.data.date, post.data.time);\n        const deleteBtnHtml = fromUser ? `<span class=\"delete-moment-btn\" title=\"\"></span>` : '';\n\n        li.innerHTML = `<img src=\"${authorAvatar}\" class=\"post-author-avatar\" />\n                         <div class=\"post-details\">\n                             <span class=\"post-author-name\">${authorName}</span>\n                             <p class=\"post-content\">${post.data.text || ''}</p>\n                             <div class=\"post-media\">${mediaHtml}</div>\n                             <div class=\"post-meta\">\n                                 <div class=\"post-meta-left\">\n                                     <span class=\"timestamp\">${displayTime}</span>\n                                     ${deleteBtnHtml}\n                                 </div>\n                                 <div class=\"post-actions\">\n                                     <span class=\"comment-button\" title=\"/\"><i class=\"fas fa-comment-dots\"></i></span>\n                                 </div>\n                             </div>\n                             ${interactionsHtml}\n                         </div>`;\n        momentsFeedList.appendChild(li);\n      });\n  }\n\n  // \"\"\n  showTypingIndicator(): void {\n    this.hideTypingIndicator(); // \n    const indicator = document.createElement('div');\n    indicator.className = 'typing-indicator';\n    indicator.id = 'typing-indicator-id';\n    const avatarSrc = this.avatars.char;\n\n    indicator.innerHTML = `\n      <img src=\"${avatarSrc}\" class=\"message-avatar\" />\n      <div class=\"message-bubble\">\n        <span class=\"typing-dot\"></span>\n        <span class=\"typing-dot\"></span>\n        <span class=\"typing-dot\"></span>\n      </div>\n    `;\n    this.wechatBody.appendChild(indicator);\n    this.scrollToBottom();\n  }\n\n  // \"\"\n  hideTypingIndicator(): void {\n    $('#typing-indicator-id').remove();\n  }\n\n  // AI\n  showGeneratingIndicator(): void {\n    this.hideGeneratingIndicator(); // \n\n    //  - jQuery\n    const dynamicIsland = $('.dynamic-island')[0] as HTMLElement;\n    if (!dynamicIsland) return;\n\n    // \n    const loadingContainer = document.createElement('div');\n    loadingContainer.className = 'generating-indicator';\n    loadingContainer.id = 'generating-indicator-id';\n\n    // \n    loadingContainer.innerHTML = `\n      <span class=\"generating-dot\"></span>\n      <span class=\"generating-dot\"></span>\n      <span class=\"generating-dot\"></span>\n    `;\n\n    // \n    dynamicIsland.appendChild(loadingContainer);\n\n    // \n    dynamicIsland.classList.add('generating-active');\n  }\n\n  // AI\n  hideGeneratingIndicator(): void {\n    $('#generating-indicator-id').remove();\n    $('.dynamic-island').removeClass('generating-active');\n  }\n\n  // \n  calculateTypingDelay(messageContent: string | object): number {\n    // \n    if (typeof messageContent !== 'string' || messageContent.trim() === '') {\n      return 800 + Math.random() * 700; // 0.8s to 1.5s\n    }\n\n    const textLength = messageContent.length;\n    const baseDelay = 500; //  0.5s\n    const perCharDelay = 40; //  40ms\n    const randomComponent = Math.random() * 800; //  0-0.8s \n\n    const totalDelay = baseDelay + textLength * perCharDelay + randomComponent;\n\n    // 3 (3000ms)\n    return Math.min(totalDelay, 3000);\n  }\n\n  // \n  private addMessageToWeChat(entry: ChatEntry, index?: number, isNewMessage: boolean = false): void {\n    const { id, sender, type } = entry;\n    const messageRow = document.createElement('div');\n    messageRow.className = 'message-row';\n    if (index !== undefined) messageRow.dataset.logIndex = index.toString();\n    messageRow.dataset.messageId = id;\n\n    const senderClass = sender;\n    messageRow.classList.add(senderClass);\n\n    const avatarSrc = sender === 'me' ? this.avatars.user : this.avatars.char;\n    const avatarImgHtml = `<img src=\"${avatarSrc}\" class=\"message-avatar\" />`;\n\n    if (type === 'voice') {\n      this.renderVoiceMessage(messageRow, entry as VoiceMessage, avatarImgHtml);\n    } else {\n      let bubbleContent = '';\n\n      switch (type) {\n        case 'sticker':\n          bubbleContent = this.renderStickerContent(entry as StickerMessage);\n          break;\n        case 'image':\n          bubbleContent = this.renderImageContent(entry as ImageMessage);\n          break;\n        case 'location':\n          bubbleContent = this.renderLocationContent(entry as LocationMessage);\n          break;\n        case 'transfer':\n          bubbleContent = this.renderTransferContent(entry as TransferMessage);\n          break;\n        case 'file':\n          bubbleContent = this.renderFileContent(entry as FileMessage);\n          break;\n        case 'gift':\n          {\n            // \n            const giftEntry = entry as GiftMessage;\n            const isRedEnvelope =\n              giftEntry.data.name.includes('') ||\n              giftEntry.data.name.includes('') ||\n              giftEntry.data.name.includes('');\n\n            if (isRedEnvelope) {\n              bubbleContent = this.renderRedEnvelopeContent(giftEntry);\n            } else {\n              bubbleContent = this.renderGiftContent(giftEntry);\n            }\n          }\n          break;\n        default:\n          bubbleContent = (entry as TextMessage).content.replace(/</g, '&lt;').replace(/>/g, '&gt;');\n          break;\n      }\n\n      // \n      let bubbleClass = 'message-bubble';\n      if (type === 'sticker') {\n        bubbleClass += ' sticker-bubble';\n      } else if (type === 'image') {\n        bubbleClass += ' image-desc-bubble';\n      } else if (type === 'location') {\n        bubbleClass += ' location-bubble';\n      } else if (type === 'transfer') {\n        bubbleClass += ' transfer-bubble';\n      } else if (type === 'file') {\n        bubbleClass += ' file-bubble';\n      } else if (type === 'gift') {\n        bubbleClass += ' gift-bubble';\n      }\n\n      messageRow.innerHTML =\n        sender === 'me'\n          ? `<div class=\"${bubbleClass}\">${bubbleContent}</div>${avatarImgHtml}`\n          : `${avatarImgHtml}<div class=\"${bubbleClass}\">${bubbleContent}</div>`;\n\n      const bubble = messageRow.querySelector('.message-bubble');\n      if (bubble) {\n        this.applyBubbleStyles(bubble, type, entry);\n        this.setupBubbleInteractions(bubble, type, entry);\n      }\n    }\n\n    if (isNewMessage) {\n      messageRow.classList.add('new-message');\n    }\n\n    // USER\n    if (sender === 'me' && entry.type === 'message') {\n      this.setupUserMessageLongPress(messageRow, entry);\n    }\n\n    this.wechatBody.appendChild(messageRow);\n    this.scrollToBottom();\n  }\n\n  // \n  private renderVoiceMessage(messageRow: HTMLElement, entry: VoiceMessage, avatarImgHtml: string): void {\n    const contentContainer = document.createElement('div');\n    contentContainer.className = 'message-content-container';\n\n    const bubble = document.createElement('div');\n    bubble.className = 'message-bubble voice-bubble';\n    bubble.innerHTML = `<span class=\"duration\">${entry.content.duration}\"</span><i class=\"fas fa-wifi voice-icon\"></i>`;\n\n    const textRevealBox = document.createElement('div');\n    textRevealBox.className = 'voice-text-content';\n    textRevealBox.textContent = entry.content.text;\n\n    contentContainer.appendChild(bubble);\n    contentContainer.appendChild(textRevealBox);\n\n    if (entry.sender === 'me') {\n      messageRow.appendChild(contentContainer);\n      messageRow.insertAdjacentHTML('beforeend', avatarImgHtml);\n    } else {\n      messageRow.insertAdjacentHTML('afterbegin', avatarImgHtml);\n      messageRow.appendChild(contentContainer);\n    }\n\n    let longPressFired = false;\n    const timerDuration = 500;\n    let pressTimer: number;\n\n    bubble.addEventListener('pointerdown', e => {\n      if (e.pointerType === 'mouse' && (e as PointerEvent).button !== 0) return;\n      longPressFired = false;\n      pressTimer = window.setTimeout(() => {\n        messageRow.classList.add('voice-text-visible');\n        longPressFired = true;\n      }, timerDuration);\n    });\n\n    bubble.addEventListener('pointerup', () => {\n      clearTimeout(pressTimer);\n      if (!longPressFired) {\n        if (messageRow.classList.contains('voice-text-visible')) {\n          messageRow.classList.remove('voice-text-visible');\n        }\n      }\n    });\n\n    bubble.addEventListener('pointerleave', () => clearTimeout(pressTimer));\n    bubble.addEventListener('contextmenu', e => e.preventDefault());\n  }\n\n  // \n  private renderStickerContent(entry: StickerMessage): string {\n    const stickerUrl = this.options.findStickerUrlByName(entry.content);\n    if (stickerUrl) {\n      // HTML\n      return `<div class=\"sticker-container\"><img src=\"${stickerUrl}\" class=\"sticker-img\" /></div>`;\n    } else {\n      return `<div class=\"sticker-placeholder\">[]</div>`;\n    }\n  }\n\n  // \n  private renderImageContent(entry: ImageMessage): string {\n    if (entry.content.type === 'url') {\n      let imageUrl = entry.content.value;\n      if (imageUrl.startsWith('blmx-img-')) {\n        const storedImage = sessionStorage.getItem(imageUrl);\n        if (storedImage) {\n          imageUrl = storedImage;\n        } else {\n          return `<div class=\"image-desc-content\"><div class=\"text-wrapper\">[]</div></div>`;\n        }\n      }\n      return `<img src=\"${imageUrl}\" class=\"chat-image\" />`;\n    } else {\n      const descText = entry.content.value;\n      return `<div class=\"image-desc-content\"><div class=\"text-wrapper\">${String(descText)\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')}</div></div>`;\n    }\n  }\n\n  // \n  private renderLocationContent(entry: LocationMessage): string {\n    return `<div class=\"location-card\">\n      <div class=\"location-content\">\n        <div class=\"location-title\">${entry.content}</div>\n        <div class=\"location-subtitle\"></div>\n      </div>\n      <div class=\"location-map-placeholder\"></div>\n    </div>`;\n  }\n\n  // \n  private renderTransferContent(entry: TransferMessage): string {\n    const isReceipt = entry.data.status !== 'sent';\n    const detailsHtml = isReceipt\n      ? `<div class=\"status-text\">${entry.data.status === 'accepted' ? '' : ''}</div>`\n      : `<div class=\"note\">${entry.data.note || ' '}</div>`;\n    const cardClass = isReceipt ? 'transfer-receipt' : 'transfer-initial';\n\n    return `<div class=\"transfer-card ${cardClass}\">\n      <div class=\"transfer-content\">\n        <img src=\"https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/%E7%B4%A0%E6%9D%90/arrows.png\" class=\"transfer-icon-image\">\n        <div class=\"transfer-details\">\n          <div class=\"amount\">${entry.data.amount}</div>\n          ${detailsHtml}\n        </div>\n      </div>\n      <div class=\"transfer-footer\"></div>\n    </div>`;\n  }\n\n  // \n  private renderFileContent(entry: FileMessage): string {\n    return `<div class=\"file-card\">\n      <div class=\"file-content\">\n        <i class=\"fas fa-file-alt file-icon\"></i>\n        <div class=\"file-details\">\n          <div class=\"file-name\">${entry.content.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>\n        </div>\n      </div>\n      <div class=\"file-footer\"></div>\n    </div>`;\n  }\n\n  // \n  private renderGiftContent(entry: GiftMessage): string {\n    let detailsClass = '';\n    let detailsContent = '';\n    const isReceipt = entry.data.status !== 'sent';\n    const cardClass = isReceipt ? 'gift-receipt' : 'gift-initial';\n\n    if (entry.data.status === 'sent') {\n      if (entry.data.price) {\n        detailsClass = 'gift-price';\n        detailsContent = ` ${entry.data.price}`;\n      }\n    } else {\n      detailsClass = 'gift-status-text';\n      detailsContent = entry.data.status === 'accepted' ? '' : '';\n    }\n\n    return `<div class=\"gift-card ${cardClass}\">\n      <div class=\"gift-content\">\n        <span class=\"gift-icon-emoji\"></span>\n        <div class=\"gift-details\">\n          <div class=\"gift-name\">${entry.data.name}</div>\n          ${detailsContent ? `<div class=\"${detailsClass}\">${detailsContent}</div>` : ''}\n        </div>\n      </div>\n      <div class=\"gift-footer\"></div>\n    </div>`;\n  }\n\n  // \n  private renderRedEnvelopeContent(entry: GiftMessage): string {\n    let detailsClass = '';\n    let detailsContent = '';\n    const isReceipt = entry.data.status !== 'sent';\n    const cardClass = isReceipt ? 'gift-receipt' : 'gift-initial';\n\n    if (entry.data.status === 'sent') {\n      if (entry.data.price) {\n        detailsClass = 'gift-price';\n        detailsContent = ` ${entry.data.price}`;\n      }\n    } else {\n      detailsClass = 'gift-status-text';\n      detailsContent = entry.data.status === 'accepted' ? '' : '';\n    }\n\n    return `<div class=\"gift-card ${cardClass}\">\n      <div class=\"gift-content\">\n        <img src=\"https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/%E7%B4%A0%E6%9D%90/red-envelope.png\" class=\"gift-icon-image\">\n        <div class=\"gift-details\">\n          <div class=\"gift-name\">${entry.data.name}</div>\n          ${detailsContent ? `<div class=\"${detailsClass}\">${detailsContent}</div>` : ''}\n        </div>\n      </div>\n      <div class=\"gift-footer\"></div>\n    </div>`;\n  }\n\n  // \n  private applyBubbleStyles(bubble: Element, type: string, entry: ChatEntry): void {\n    if (type === 'image') {\n      if ((entry as ImageMessage).content.type === 'url') {\n        bubble.classList.add('image-url-bubble');\n      } else {\n        bubble.classList.add('image-desc-bubble');\n      }\n    } else {\n      const bubbleTypeMap: Record<string, string> = {\n        sticker: 'sticker-bubble',\n        location: 'location-bubble',\n        transfer: 'transfer-bubble',\n        file: 'file-bubble',\n        gift: 'gift-bubble',\n      };\n\n      if (bubbleTypeMap[type]) {\n        bubble.classList.add(bubbleTypeMap[type]);\n      }\n    }\n  }\n\n  // \n  private setupBubbleInteractions(bubble: Element, type: string, entry: ChatEntry): void {\n    if (type === 'transfer') {\n      const transferCard = bubble.querySelector('.transfer-card');\n      if (!transferCard) return;\n\n      const transferEntry = entry as TransferMessage;\n      const isReceipt = transferEntry.data.status !== 'sent';\n\n      if (!isReceipt && entry.sender === 'them') {\n        transferCard.classList.add('them');\n        transferCard.addEventListener(\n          'click',\n          () => {\n            // \n            if (this.options.onTransferAccept) {\n              this.options.onTransferAccept({\n                ...transferEntry.data,\n                status: 'accepted' as 'accepted' | 'rejected',\n              });\n            }\n          },\n          { once: true },\n        );\n      }\n    }\n\n    if (type === 'gift') {\n      const giftBubble = bubble as HTMLElement;\n      const giftCard = bubble.querySelector('.gift-card');\n      const giftEntry = entry as GiftMessage;\n      const isReceipt = giftEntry.data.status !== 'sent';\n\n      if (isReceipt) {\n        // \n        return;\n      }\n\n      // AI\n      if (giftCard) giftCard.classList.add(entry.sender === 'them' ? 'them' : 'me');\n      giftBubble.classList.add('gift-clickable');\n      giftBubble.addEventListener(\n        'click',\n        async () => {\n          if (this.options.onGiftAction) {\n            await this.options.onGiftAction(giftEntry.data);\n          }\n\n          giftBubble.classList.remove('gift-clickable');\n        },\n        { once: true },\n      );\n    }\n  }\n\n  // \n  private addTimestampToWeChat(date: string, time: string, isSystemTime: boolean, index?: number): void {\n    const timeText = this.formatMomentTimestamp(date, time);\n\n    // \n    // \n    if (isSystemTime) {\n      // 10\n      const isOnlyTime = timeText === time;\n\n      if (isOnlyTime) {\n        // \n        const timeInMinutes = this.parseTimeToMinutes(timeText);\n        if (timeInMinutes !== null && timeInMinutes - this.lastDisplayedTimeInMinutes < 10) {\n          return; // \n        }\n\n        // \n        if (timeInMinutes !== null) {\n          this.lastDisplayedTimeInMinutes = timeInMinutes;\n        }\n      } else {\n        // \n        this.lastDisplayedTimeInMinutes = -Infinity;\n      }\n    }\n\n    // \n    const t = document.createElement('div');\n    t.className = 'timestamp-row';\n    if (index !== undefined) t.dataset.logIndex = index.toString();\n\n    // \n    t.dataset.originalDate = date;\n    t.dataset.originalTime = time;\n\n    t.innerHTML = `<span class=\"timestamp-text\">${timeText}</span>`;\n    this.wechatBody.appendChild(t);\n\n    this.scrollToBottom();\n  }\n\n  // \n  private addEventLogToWeChat(eventData: EventLogEntry['content'], index?: number): void {\n    // eventData\n    if (!eventData || !eventData.date || !eventData.time) {\n      console.error(':', eventData);\n      return;\n    }\n\n    // \n    const timeText = this.formatMomentTimestamp(eventData.date, eventData.time);\n\n    // \n    const row = document.createElement('div');\n    row.className = 'event-log-row';\n    if (index !== undefined) row.dataset.logIndex = index.toString();\n\n    // \n    row.dataset.originalDate = eventData.date;\n    row.dataset.originalTime = eventData.time;\n\n    // \n    if (eventData.description) {\n      row.innerHTML = `\n        <div class=\"event-log-container\">\n          <div class=\"event-time-text has-desc clickable\">${timeText}</div>\n          <div class=\"event-description\">${eventData.description}</div>\n        </div>\n      `;\n    } else {\n      row.innerHTML = `\n        <div class=\"event-log-container\">\n          <div class=\"event-time-text\">${timeText}</div>\n        </div>\n      `;\n    }\n\n    // \n    if (eventData.description) {\n      const timeEl = row.querySelector('.event-time-text');\n      const descEl = row.querySelector('.event-description');\n\n      if (timeEl && descEl) {\n        timeEl.addEventListener('click', () => {\n          // CSS/display\n          descEl.classList.toggle('expanded');\n        });\n      }\n    }\n\n    // \n    this.wechatBody.appendChild(row);\n    this.scrollToBottom();\n  }\n\n  // \n  private renderSystemMessage(entry: TextMessage, animate: boolean = false, index?: number): void {\n    const chatContainer = this.wechatBody;\n    if (!chatContainer) return;\n\n    const systemRow = document.createElement('div');\n    systemRow.className = 'event-log-row';\n    if (animate) systemRow.classList.add('new-message');\n    if (entry.id) {\n      systemRow.dataset.messageId = entry.id;\n    }\n    if (index !== undefined) {\n      systemRow.dataset.logIndex = index.toString();\n    }\n\n    const systemContainer = document.createElement('div');\n    systemContainer.className = 'event-log-container';\n\n    const systemText = document.createElement('div');\n    systemText.className = 'event-time-text system-message';\n    systemText.textContent = entry.content;\n\n    systemContainer.appendChild(systemText);\n    systemRow.appendChild(systemContainer);\n    chatContainer.appendChild(systemRow);\n\n    this.scrollToBottom();\n  }\n\n  // \n  private parseTimeToMinutes(timeString: string): number | null {\n    const match = timeString.match(/(\\d{1,2}):(\\d{2})/);\n    return match ? 60 * parseInt(match[1], 10) + parseInt(match[2], 10) : null;\n  }\n\n  // \n  private formatMomentTimestamp(dateString: string, timeString: string): string {\n    if (!dateString || !timeString) return ' ';\n\n    try {\n      // \n      const postDate = new Date(dateString);\n      // \n      const currentDate = window.currentGameDate ? new Date(window.currentGameDate) : new Date();\n\n      // \n      const postYear = postDate.getFullYear();\n      const postMonth = postDate.getMonth();\n      const postDay = postDate.getDate();\n\n      const nowYear = currentDate.getFullYear();\n      const nowMonth = currentDate.getMonth();\n      const nowDay = currentDate.getDate();\n\n      // \n      if (postYear === nowYear && postMonth === nowMonth && postDay === nowDay) {\n        return timeString;\n      }\n\n      // \n      const yesterday = new Date(currentDate);\n      yesterday.setDate(currentDate.getDate() - 1);\n      const yesterdayYear = yesterday.getFullYear();\n      const yesterdayMonth = yesterday.getMonth();\n      const yesterdayDay = yesterday.getDate();\n\n      // \n      if (postYear === yesterdayYear && postMonth === yesterdayMonth && postDay === yesterdayDay) {\n        return ` ${timeString}`;\n      }\n\n      // \n      if (postYear === nowYear) {\n        return `${postMonth + 1}${postDay} ${timeString}`;\n      }\n\n      // \n      return `${postYear}${postMonth + 1}${postDay} ${timeString}`;\n    } catch (error) {\n      console.error('Error formatting timestamp:', error);\n      return timeString; // \n    }\n  }\n\n  // \n  public refreshAllTimestamps(): void {\n    // \n    const timestampRows = $('.timestamp-row', this.wechatBody);\n    const eventLogRows = $('.event-log-row', this.wechatBody);\n\n    // \n    timestampRows.each((_, row) => {\n      const $row = $(row);\n      const $timestampText = $row.find('.timestamp-text');\n      if ($timestampText.length) {\n        const originalDate = $row.data('originalDate');\n        const originalTime = $row.data('originalTime');\n        if (originalDate && originalTime) {\n          $timestampText.text(this.formatMomentTimestamp(originalDate, originalTime));\n        }\n      }\n    });\n\n    // \n    eventLogRows.each((_, row) => {\n      const $row = $(row);\n      const $eventTimeText = $row.find('.event-time-text');\n      if ($eventTimeText.length) {\n        const originalDate = $row.data('originalDate');\n        const originalTime = $row.data('originalTime');\n        if (originalDate && originalTime) {\n          // \n          $eventTimeText.text(this.formatMomentTimestamp(originalDate, originalTime));\n        }\n      }\n    });\n  }\n\n  renderFeatureGrid(\n    gridElement: HTMLElement,\n    features: any[],\n    callbacks: {\n      onToggleDeleteMode: () => void;\n      onAddStickers: () => void;\n    },\n  ): void {\n    if (!gridElement) {\n      console.error('[BLMX] Grid element not found for renderFeatureGrid');\n      return;\n    }\n\n    gridElement.innerHTML = '';\n    const isDeleteMode = gridElement.classList.contains('sticker-delete-mode');\n\n    features.forEach(feature => {\n      const item = document.createElement('div');\n      item.className = 'feature-item';\n\n      let iconHtml = '';\n      if (feature.isAddBtn) {\n        // \n        if (feature.label === '') {\n          iconHtml = `<div class=\"feature-icon\"><i class=\"fas fa-cog\"></i></div>`;\n        } else {\n          iconHtml = `<div class=\"feature-icon\"><i class=\"fas fa-${\n            feature.label === '' ? 'plus' : 'trash-alt'\n          }\"></i></div>`;\n        }\n      } else if (feature.icon && feature.icon.startsWith('http')) {\n        // URL ()\n        iconHtml = `<div class=\"feature-icon\"><img src=\"${feature.icon}\" alt=\"${feature.label}\" class=\"feature-icon-img\"></div>`;\n      } else if (\n        feature.icon &&\n        (feature.icon.startsWith('fas ') || feature.icon.startsWith('far ') || feature.icon.startsWith('fab '))\n      ) {\n        // Font Awesome\n        iconHtml = `<div class=\"feature-icon\"><i class=\"${feature.icon} theme-icon\"></i></div>`;\n      } else if (feature.icon && feature.icon.startsWith('fa')) {\n        // Font Awesome\n        iconHtml = `<div class=\"feature-icon\"><i class=\"${feature.icon} theme-icon\"></i></div>`;\n      } else {\n        // \n        iconHtml = `<div class=\"feature-icon\"><i class=\"${feature.icon || 'fas fa-question'}\"></i></div>`;\n      }\n\n      item.innerHTML = `${iconHtml}<span class=\"feature-label\">${feature.label}</span>`;\n\n      const iconContainer = item.querySelector('.feature-icon');\n      if (isDeleteMode && !feature.isAddBtn && !feature.isDefault) {\n        // checkbox\n        const checkbox = document.createElement('input');\n        checkbox.type = 'checkbox';\n        checkbox.className = 'sticker-checkbox';\n        checkbox.dataset.stickerLabel = feature.label;\n        item.appendChild(checkbox);\n\n        // checkbox\n        const checkboxButton = document.createElement('div');\n        checkboxButton.className = 'sticker-checkbox-button';\n        checkboxButton.style.display = 'block';\n        item.appendChild(checkboxButton);\n\n        // checkbox\n        const updateCheckboxState = (checked: boolean) => {\n          if (checked) {\n            checkboxButton.classList.add('checked');\n          } else {\n            checkboxButton.classList.remove('checked');\n          }\n          iconContainer?.classList.toggle('selected-for-delete', checked);\n        };\n\n        // \n        const handleClick = (e: Event) => {\n          e.preventDefault();\n          e.stopPropagation();\n          checkbox.checked = !checkbox.checked;\n          updateCheckboxState(checkbox.checked);\n        };\n\n        item.addEventListener('click', handleClick);\n        checkboxButton.addEventListener('click', handleClick);\n\n        // \n        updateCheckboxState(checkbox.checked);\n      } else if (feature.label === '') {\n        item.addEventListener('click', callbacks.onAddStickers);\n      } else if (feature.label === '' || feature.label === '') {\n        item.addEventListener('click', callbacks.onToggleDeleteMode);\n      } else {\n        item.addEventListener('click', feature.action);\n      }\n\n      gridElement.appendChild(item);\n    });\n  }\n\n  // \n  private scrollToBottom(): void {\n    // scrollTopjQuery\n    this.wechatBody.scrollTop = this.wechatBody.scrollHeight;\n\n    // DOM\n    setTimeout(() => {\n      this.wechatBody.scrollTop = this.wechatBody.scrollHeight;\n    }, 100);\n  }\n\n  // USER - \n  private setupUserMessageLongPress(messageRow: HTMLElement, entry: ChatEntry): void {\n    const $messageRow = $(messageRow);\n    const $messageBubble = $messageRow.find('.message-bubble');\n    const $targetElement = $messageBubble.length ? $messageBubble : $messageRow;\n\n    // \n    this.addLongPressListener($targetElement[0], () => {\n      this.handleLongPressRecall(entry);\n    });\n\n    // \n    this.setupDoubleClickRecall($targetElement, entry);\n  }\n\n  //  - \n  private addLongPressListener(\n    element: HTMLElement,\n    callback: () => void,\n    options = { duration: 600, preventDefault: true },\n  ): void {\n    let timer: number;\n    let startX: number, startY: number;\n\n    const onStart = (e: PointerEvent) => {\n      if (e.pointerType === 'mouse' && e.button !== 0) return;\n      startX = e.clientX;\n      startY = e.clientY;\n      if (options.preventDefault) e.preventDefault();\n      clearTimeout(timer);\n      timer = setTimeout(() => {\n        timer = 0;\n        callback();\n      }, options.duration);\n    };\n\n    const onMove = (e: PointerEvent) => {\n      if (!timer) return;\n      const moveX = e.clientX;\n      const moveY = e.clientY;\n      if (Math.abs(moveX - startX) > 10 || Math.abs(moveY - startY) > 10) {\n        clearTimeout(timer);\n      }\n    };\n\n    const onEnd = () => clearTimeout(timer);\n\n    element.addEventListener('pointerdown', onStart);\n    element.addEventListener('pointermove', onMove);\n    element.addEventListener('pointerup', onEnd);\n    element.addEventListener('pointerleave', onEnd);\n\n    if (options.preventDefault) {\n      element.addEventListener('contextmenu', e => e.preventDefault());\n    }\n  }\n\n  //  - \n  private async handleLongPressRecall(entry: ChatEntry): Promise<void> {\n    try {\n      // \n      if (this.options.isMessageInQueue && this.options.isMessageInQueue(entry.id)) {\n        await this.handleUserMessageRecall(entry);\n      } else {\n        // jQuery UI\n        const $messageElement = $(`[data-message-id=\"${entry.id}\"]`);\n        $messageElement.effect('shake', { times: 2, distance: 5 }, 300);\n\n        const { DialogManager } = await import('./dialog-manager');\n        const dialogManager = DialogManager.getInstance();\n        await dialogManager.alert('', '');\n      }\n    } catch (error) {\n      console.error(':', error);\n\n      // \n      const $messageElement = $(`[data-message-id=\"${entry.id}\"]`);\n      $messageElement.effect('shake', { times: 2, distance: 5 }, 300);\n    }\n  }\n\n  // USER\n  private async handleUserMessageRecall(entry: ChatEntry): Promise<void> {\n    try {\n      // DialogManager\n      const { DialogManager } = await import('./dialog-manager');\n      const dialogManager = DialogManager.getInstance();\n\n      // \n      const confirmed = await dialogManager.confirm(\n        '\"\"',\n        '',\n        '',\n        '',\n      );\n\n      if (confirmed) {\n        // \n        if (this.options.onRecallMessage) {\n          await this.options.onRecallMessage(entry);\n        }\n      }\n    } catch (error) {\n      console.error(':', error);\n    }\n  }\n\n  //  - \n  private setupDoubleClickRecall($targetElement: JQuery, entry: ChatEntry): void {\n    let clickCount = 0;\n    let clickTimer: number;\n    const doubleClickDelay = 300; // 300ms\n\n    $targetElement.on('click.doubleClickRecall', e => {\n      // \n      e.stopPropagation();\n\n      clickCount++;\n\n      if (clickCount === 1) {\n        // \n        clickTimer = window.setTimeout(() => {\n          // \n          clickCount = 0;\n        }, doubleClickDelay);\n      } else if (clickCount === 2) {\n        // \n        clearTimeout(clickTimer);\n        clickCount = 0;\n\n        // \n        $targetElement.addClass('double-click-active');\n        setTimeout(() => {\n          $targetElement.removeClass('double-click-active');\n        }, 200);\n\n        // \n        if ('vibrate' in navigator) {\n          navigator.vibrate([30, 50, 30]); // \n        }\n\n        // \n        this.handleDoubleClickRecall(entry);\n      }\n    });\n  }\n\n  // \n  private async handleDoubleClickRecall(entry: ChatEntry): Promise<void> {\n    try {\n      // \n      if (this.options.isMessageInQueue && this.options.isMessageInQueue(entry.id)) {\n        await this.handleUserMessageRecall(entry);\n      } else {\n        // jQuery UI\n        const $messageElement = $(`[data-message-id=\"${entry.id}\"]`);\n        $messageElement.effect('shake', { times: 2, distance: 5 }, 300);\n\n        const { DialogManager } = await import('./dialog-manager');\n        const dialogManager = DialogManager.getInstance();\n        await dialogManager.alert('', '');\n      }\n    } catch (error) {\n      console.error(':', error);\n\n      // \n      const $messageElement = $(`[data-message-id=\"${entry.id}\"]`);\n      $messageElement.effect('shake', { times: 2, distance: 5 }, 300);\n    }\n  }\n\n  /**\n   * \n   */\n  cleanup(): void {\n    this.eventManager.cleanup();\n  }\n}\n","// \n// UI\n\nimport { Wallpaper, WallpaperManager } from './theme-manager';\n\nexport class WallpaperSelector {\n  private wallpaperManager: WallpaperManager;\n  private themeManager: any; // \n\n  constructor(wallpaperManager: WallpaperManager, themeManager: any) {\n    this.wallpaperManager = wallpaperManager;\n    this.themeManager = themeManager;\n  }\n\n  // \n  showWallpaperSelector(viewType: 'chat' | 'home' | 'settings', onApplyWallpaper: () => void): void {\n    // \n    const modal = document.createElement('div');\n    modal.className = 'wallpaper-modal';\n    modal.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background-color: rgba(0, 0, 0, 0.7);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      z-index: 1000;\n    `;\n\n    // \n    const container = document.createElement('div');\n    container.className = 'wallpaper-container';\n    container.style.cssText = `\n      background-color: white;\n      border-radius: 12px;\n      width: 90%;\n      max-width: 500px;\n      max-height: 80vh;\n      overflow-y: auto;\n      padding: 20px;\n      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);\n    `;\n\n    // \n    const title = document.createElement('h2');\n    title.textContent = `${viewType === 'chat' ? '' : viewType === 'home' ? '' : ''}`;\n    title.style.cssText = `\n      margin-top: 0;\n      color: var(--text-primary);\n      font-size: 1.2rem;\n      text-align: center;\n      margin-bottom: 20px;\n    `;\n    container.appendChild(title);\n\n    // \n    const tabs = this.createTabs(container);\n    container.appendChild(tabs);\n\n    // \n    this.createBuiltinWallpaperTab(container, viewType, modal, onApplyWallpaper);\n    this.createSolidColorTab(container, viewType, modal, onApplyWallpaper);\n    this.createCustomWallpaperTab(container, viewType, modal, onApplyWallpaper);\n    this.createUploadTab(container, viewType, modal, onApplyWallpaper);\n\n    // \n    this.createBottomButtons(container, viewType, modal, onApplyWallpaper);\n\n    modal.appendChild(container);\n    document.body.appendChild(modal);\n  }\n\n  // \n  private createTabs(container: HTMLElement): HTMLElement {\n    const tabs = document.createElement('div');\n    tabs.style.cssText = `\n      display: flex;\n      border-bottom: 1px solid ${document.body.classList.contains('dark-mode') ? '#3c3c3c' : '#eee'};\n      margin-bottom: 15px;\n    `;\n\n    const createTab = (label: string, id: string, isActive: boolean = false) => {\n      const tab = document.createElement('div');\n      tab.textContent = label;\n      tab.dataset.tabId = id;\n      tab.style.cssText = `\n        padding: 10px 15px;\n        cursor: pointer;\n        font-weight: ${isActive ? 'bold' : 'normal'};\n        color: ${isActive ? 'var(--primary-blue)' : 'var(--text-secondary)'};\n        border-bottom: ${isActive ? '2px solid var(--primary-blue)' : 'none'};\n        margin-bottom: -1px;\n      `;\n      tab.addEventListener('click', () => {\n        // \n        tabs.querySelectorAll('div').forEach(t => {\n          t.style.fontWeight = 'normal';\n          t.style.color = 'var(--text-secondary)';\n          t.style.borderBottom = 'none';\n        });\n\n        // \n        tab.style.fontWeight = 'bold';\n        tab.style.color = 'var(--primary-blue)';\n        tab.style.borderBottom = '2px solid var(--primary-blue)';\n\n        // \n        container.querySelectorAll('.tab-content').forEach(c => {\n          (c as HTMLElement).style.display = 'none';\n        });\n\n        // \n        const content = container.querySelector(`.tab-content[data-tab-id=\"${id}\"]`);\n        if (content) {\n          (content as HTMLElement).style.display = 'block';\n        }\n      });\n      return tab;\n    };\n\n    tabs.appendChild(createTab('', 'builtin', true));\n    tabs.appendChild(createTab('', 'solid'));\n    tabs.appendChild(createTab('', 'custom'));\n    tabs.appendChild(createTab('', 'upload'));\n\n    return tabs;\n  }\n\n  // \n  private createBuiltinWallpaperTab(\n    container: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const builtinContent = document.createElement('div');\n    builtinContent.className = 'tab-content';\n    builtinContent.dataset.tabId = 'builtin';\n    builtinContent.style.cssText = 'display: block;';\n\n    // \n    const builtinWallpapers = this.wallpaperManager.getBuiltInWallpapers().filter(w => w.type === 'image');\n\n    // \n    const builtinGrid = document.createElement('div');\n    builtinGrid.style.cssText = `\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 10px;\n    `;\n\n    builtinWallpapers.forEach(wallpaper => {\n      const wallpaperItem = this.createWallpaperItem(wallpaper, viewType, false, modal, onApplyWallpaper);\n      builtinGrid.appendChild(wallpaperItem);\n    });\n\n    builtinContent.appendChild(builtinGrid);\n    container.appendChild(builtinContent);\n  }\n\n  // \n  private createSolidColorTab(\n    container: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const solidContent = document.createElement('div');\n    solidContent.className = 'tab-content';\n    solidContent.dataset.tabId = 'solid';\n    solidContent.style.cssText = 'display: none;';\n\n    // \n    const solidWallpapers = this.wallpaperManager.getBuiltInWallpapers().filter(w => w.type === 'color');\n\n    // \n    const solidGrid = document.createElement('div');\n    solidGrid.style.cssText = `\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 10px;\n    `;\n\n    solidWallpapers.forEach(wallpaper => {\n      const wallpaperItem = this.createWallpaperItem(wallpaper, viewType, false, modal, onApplyWallpaper);\n      solidGrid.appendChild(wallpaperItem);\n    });\n\n    solidContent.appendChild(solidGrid);\n\n    // \n    this.addColorPicker(solidContent, viewType, modal, onApplyWallpaper);\n\n    container.appendChild(solidContent);\n  }\n\n  // \n  private createCustomWallpaperTab(\n    container: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const customContent = document.createElement('div');\n    customContent.className = 'tab-content';\n    customContent.dataset.tabId = 'custom';\n    customContent.style.cssText = 'display: none;';\n\n    // \n    const customWallpapers = this.wallpaperManager.getCustomWallpapers();\n\n    if (customWallpapers.length === 0) {\n      const noCustomWallpapers = document.createElement('p');\n      noCustomWallpapers.textContent = '\"\"';\n      noCustomWallpapers.style.cssText = `\n        text-align: center;\n        color: var(--text-secondary);\n        margin: 30px 0;\n      `;\n      customContent.appendChild(noCustomWallpapers);\n    } else {\n      // \n      const customGrid = document.createElement('div');\n      customGrid.style.cssText = `\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 10px;\n      `;\n\n      customWallpapers.forEach(wallpaper => {\n        const wallpaperItem = this.createWallpaperItem(wallpaper, viewType, true, modal, onApplyWallpaper);\n        customGrid.appendChild(wallpaperItem);\n      });\n\n      customContent.appendChild(customGrid);\n    }\n\n    container.appendChild(customContent);\n  }\n\n  // \n  private createUploadTab(\n    container: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const uploadContent = document.createElement('div');\n    uploadContent.className = 'tab-content';\n    uploadContent.dataset.tabId = 'upload';\n    uploadContent.style.cssText = 'display: none; padding: 10px 0;';\n\n    // \n    this.createLocalUploadSection(uploadContent, viewType, modal, onApplyWallpaper);\n\n    // URL\n    this.createUrlUploadSection(uploadContent, viewType, modal, onApplyWallpaper);\n\n    container.appendChild(uploadContent);\n  }\n\n  // \n  private addColorPicker(\n    solidContent: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const colorPickerContainer = document.createElement('div');\n    colorPickerContainer.style.cssText = `\n      margin-top: 20px;\n      padding-top: 15px;\n      border-top: 1px solid ${document.body.classList.contains('dark-mode') ? '#3c3c3c' : '#eee'};\n    `;\n\n    const colorPickerLabel = document.createElement('p');\n    colorPickerLabel.textContent = ':';\n    colorPickerLabel.style.cssText = `\n      margin: 0 0 10px 0;\n      font-size: 0.9rem;\n      color: var(--text-primary);\n    `;\n\n    const colorPicker = document.createElement('input');\n    colorPicker.type = 'color';\n    colorPicker.value = '#ffffff';\n    colorPicker.style.cssText = `\n      width: 100%;\n      height: 40px;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n    `;\n\n    const colorNameInput = document.createElement('input');\n    colorNameInput.type = 'text';\n    colorNameInput.placeholder = ' ()';\n    colorNameInput.style.cssText = `\n      width: 100%;\n      padding: 8px;\n      margin-top: 10px;\n      border: 1px solid #ddd;\n      border-radius: 5px;\n      box-sizing: border-box;\n    `;\n\n    const addColorBtn = document.createElement('button');\n    addColorBtn.textContent = '';\n    addColorBtn.style.cssText = `\n      width: 100%;\n      padding: 10px;\n      margin-top: 10px;\n      background: var(--primary-blue);\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    `;\n\n    addColorBtn.addEventListener('click', () => {\n      const color = colorPicker.value;\n      const name = colorNameInput.value.trim() || ` ${color}`;\n\n      const newWallpaper = this.wallpaperManager.createSolidColorWallpaper(color, name);\n\n      if (newWallpaper) {\n        // \n        this.wallpaperManager.setWallpaper(viewType, newWallpaper);\n        onApplyWallpaper();\n\n        // \n        document.body.removeChild(modal);\n      } else {\n        // \n        alert('');\n      }\n    });\n\n    colorPickerContainer.appendChild(colorPickerLabel);\n    colorPickerContainer.appendChild(colorPicker);\n    colorPickerContainer.appendChild(colorNameInput);\n    colorPickerContainer.appendChild(addColorBtn);\n\n    solidContent.appendChild(colorPickerContainer);\n  }\n\n  // \n  private createLocalUploadSection(\n    uploadContent: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const localUploadSection = document.createElement('div');\n    localUploadSection.style.cssText = 'margin-bottom: 20px;';\n\n    const localUploadTitle = document.createElement('h3');\n    localUploadTitle.textContent = '';\n    localUploadTitle.style.cssText = `\n      font-size: 1rem;\n      color: var(--text-primary);\n      margin: 0 0 10px 0;\n    `;\n\n    const fileInput = document.createElement('input');\n    fileInput.type = 'file';\n    fileInput.accept = 'image/*';\n    fileInput.style.cssText = `\n      width: 100%;\n      padding: 10px;\n      margin-bottom: 10px;\n      border: 1px solid #ddd;\n      border-radius: 5px;\n      box-sizing: border-box;\n    `;\n\n    const uploadBtn = document.createElement('button');\n    uploadBtn.textContent = '';\n    uploadBtn.style.cssText = `\n      width: 100%;\n      padding: 10px;\n      background: var(--primary-blue);\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    `;\n\n    uploadBtn.addEventListener('click', async () => {\n      if (fileInput.files && fileInput.files[0]) {\n        const file = fileInput.files[0];\n        const newWallpaper = await this.wallpaperManager.createWallpaperFromFile(file);\n\n        if (newWallpaper) {\n          // \n          this.wallpaperManager.setWallpaper(viewType, newWallpaper);\n          onApplyWallpaper();\n\n          // \n          document.body.removeChild(modal);\n        }\n      }\n    });\n\n    localUploadSection.appendChild(localUploadTitle);\n    localUploadSection.appendChild(fileInput);\n    localUploadSection.appendChild(uploadBtn);\n    uploadContent.appendChild(localUploadSection);\n  }\n\n  // URL\n  private createUrlUploadSection(\n    uploadContent: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const urlUploadSection = document.createElement('div');\n    urlUploadSection.style.cssText = `\n      margin-top: 30px;\n      padding-top: 20px;\n      border-top: 1px solid ${document.body.classList.contains('dark-mode') ? '#3c3c3c' : '#eee'};\n    `;\n\n    const urlUploadTitle = document.createElement('h3');\n    urlUploadTitle.textContent = 'URL';\n    urlUploadTitle.style.cssText = `\n      font-size: 1rem;\n      color: var(--text-primary);\n      margin: 0 0 10px 0;\n    `;\n\n    const urlInput = document.createElement('input');\n    urlInput.type = 'text';\n    urlInput.placeholder = 'URL';\n    urlInput.style.cssText = `\n      width: 100%;\n      padding: 10px;\n      margin-bottom: 10px;\n      border: 1px solid #ddd;\n      border-radius: 5px;\n      box-sizing: border-box;\n    `;\n\n    const nameInput = document.createElement('input');\n    nameInput.type = 'text';\n    nameInput.placeholder = ' ()';\n    nameInput.style.cssText = `\n      width: 100%;\n      padding: 10px;\n      margin-bottom: 10px;\n      border: 1px solid #ddd;\n      border-radius: 5px;\n      box-sizing: border-box;\n    `;\n\n    const addUrlBtn = document.createElement('button');\n    addUrlBtn.textContent = '';\n    addUrlBtn.style.cssText = `\n      width: 100%;\n      padding: 10px;\n      background: var(--primary-blue);\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    `;\n\n    addUrlBtn.addEventListener('click', async () => {\n      const url = urlInput.value.trim();\n      const name = nameInput.value.trim() || 'URL';\n\n      if (url) {\n        const newWallpaper = await this.wallpaperManager.createWallpaperFromUrl(url, name);\n\n        if (newWallpaper) {\n          // \n          this.wallpaperManager.setWallpaper(viewType, newWallpaper);\n          onApplyWallpaper();\n\n          // \n          document.body.removeChild(modal);\n        } else {\n          alert('URLURL');\n        }\n      }\n    });\n\n    urlUploadSection.appendChild(urlUploadTitle);\n    urlUploadSection.appendChild(urlInput);\n    urlUploadSection.appendChild(nameInput);\n    urlUploadSection.appendChild(addUrlBtn);\n    uploadContent.appendChild(urlUploadSection);\n  }\n\n  // \n  private createWallpaperItem(\n    wallpaper: Wallpaper,\n    viewType: 'chat' | 'home' | 'settings',\n    showDeleteButton: boolean,\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): HTMLElement {\n    const item = document.createElement('div');\n    item.style.cssText = `\n      border-radius: 8px;\n      overflow: hidden;\n      position: relative;\n      cursor: pointer;\n      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n      transition: transform 0.2s ease, box-shadow 0.2s ease;\n    `;\n\n    // \n    const preview = document.createElement('div');\n    preview.style.cssText = `\n      width: 100%;\n      height: 100px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    `;\n\n    if (wallpaper.type === 'color') {\n      // \n      preview.style.backgroundImage = 'none';\n      preview.style.backgroundColor = wallpaper.value;\n    } else {\n      preview.style.backgroundImage = `url(\"${wallpaper.value}\")`;\n      preview.style.backgroundSize = 'cover';\n      preview.style.backgroundPosition = 'center';\n    }\n\n    // \n    const name = document.createElement('div');\n    name.textContent = wallpaper.name;\n    name.style.cssText = `\n      padding: 8px;\n      text-align: center;\n      font-size: 0.8rem;\n      color: var(--text-primary);\n      background-color: ${\n        document.body.classList.contains('dark-mode') ? 'rgba(42, 42, 42, 0.9)' : 'rgba(255, 255, 255, 0.9)'\n      };\n    `;\n\n    // \n    if (showDeleteButton) {\n      const deleteBtn = document.createElement('button');\n      deleteBtn.innerHTML = '&times;';\n      deleteBtn.style.cssText = `\n        position: absolute;\n        top: 5px;\n        right: 5px;\n        width: 20px;\n        height: 20px;\n        border-radius: 50%;\n        background-color: rgba(255, 0, 0, 0.7);\n        color: white;\n        border: none;\n        font-size: 14px;\n        line-height: 1;\n        cursor: pointer;\n        z-index: 1;\n      `;\n\n      deleteBtn.addEventListener('click', e => {\n        e.stopPropagation();\n\n        if (confirm('')) {\n          this.wallpaperManager.deleteCustomWallpaper(wallpaper.id);\n\n          // \n          const currentWallpaper = this.wallpaperManager.getCurrentWallpaper(viewType);\n          if (currentWallpaper && currentWallpaper.id === wallpaper.id) {\n            this.wallpaperManager.setWallpaper(viewType, null);\n            onApplyWallpaper();\n          }\n\n          // \n          item.parentElement?.removeChild(item);\n        }\n      });\n\n      item.appendChild(deleteBtn);\n    }\n\n    // \n    item.addEventListener('click', () => {\n      // \n      const currentTheme = this.themeManager.getCurrentTheme();\n      this.wallpaperManager.setCurrentThemeName(currentTheme.name);\n\n      this.wallpaperManager.setWallpaper(viewType, wallpaper);\n      onApplyWallpaper();\n\n      // \n      document.body.removeChild(modal);\n    });\n\n    item.appendChild(preview);\n    item.appendChild(name);\n\n    return item;\n  }\n\n  // \n  private createBottomButtons(\n    container: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const buttonsContainer = document.createElement('div');\n    buttonsContainer.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      margin-top: 20px;\n      padding-top: 15px;\n      border-top: 1px solid ${document.body.classList.contains('dark-mode') ? '#3c3c3c' : '#eee'};\n    `;\n\n    const resetBtn = document.createElement('button');\n    resetBtn.textContent = '';\n    resetBtn.style.cssText = `\n      padding: 10px 15px;\n      background: ${document.body.classList.contains('dark-mode') ? '#3c3c3c' : '#f1f5f9'};\n      color: var(--text-primary);\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    `;\n\n    resetBtn.addEventListener('click', () => {\n      // \n      this.wallpaperManager.setWallpaper(viewType, null);\n      onApplyWallpaper();\n\n      // \n      document.body.removeChild(modal);\n    });\n\n    const closeBtn = document.createElement('button');\n    closeBtn.textContent = '';\n    closeBtn.style.cssText = `\n      padding: 10px 20px;\n      background: var(--primary-blue);\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    `;\n\n    closeBtn.addEventListener('click', () => {\n      document.body.removeChild(modal);\n    });\n\n    buttonsContainer.appendChild(resetBtn);\n    buttonsContainer.appendChild(closeBtn);\n    container.appendChild(buttonsContainer);\n  }\n}\n","// \n// \n\nimport { Theme, ThemeManager, WallpaperManager } from './theme-manager';\nimport { WallpaperSelector } from './wallpaper-selector';\n\nexport class WallpaperController {\n  private wallpaperManager: WallpaperManager;\n  private themeManager: ThemeManager;\n  private wallpaperSelector: WallpaperSelector;\n\n  constructor(themeManager: ThemeManager) {\n    this.themeManager = themeManager;\n    this.wallpaperManager = themeManager.getWallpaperManager();\n    this.wallpaperSelector = new WallpaperSelector(this.wallpaperManager, this.themeManager);\n  }\n\n  // \n  applyWallpapers(): void {\n    const $chatView = $('#wechat-view');\n    const $homeScreen = $('#app-homescreen');\n    const $settingsView = $('#settings-view');\n    const currentTheme = this.themeManager.getCurrentTheme();\n\n    // \n    this.wallpaperManager.setCurrentThemeName(currentTheme.name);\n\n    // \n    const chatWallpaper = this.wallpaperManager.getCurrentWallpaper('chat');\n    this.wallpaperManager.applyWallpaperToElement(\n      $chatView[0],\n      chatWallpaper,\n      currentTheme.colors.defaultWallpapers.chat,\n    );\n\n    // \n    const homeWallpaper = this.wallpaperManager.getCurrentWallpaper('home');\n    this.wallpaperManager.applyWallpaperToElement(\n      $homeScreen[0],\n      homeWallpaper,\n      currentTheme.colors.defaultWallpapers.home,\n    );\n\n    // \n    const settingsWallpaper = this.wallpaperManager.getCurrentWallpaper('settings');\n    this.wallpaperManager.applyWallpaperToElement(\n      $settingsView[0],\n      settingsWallpaper,\n      currentTheme.colors.defaultWallpapers.settings,\n    );\n  }\n\n  // \n  changeWallpaper(viewType: 'chat' | 'home' | 'settings'): void {\n    // \n    this.wallpaperSelector.showWallpaperSelector(viewType, () => {\n      this.applyWallpapers();\n    });\n  }\n\n  // \n  initializeWallpapers(theme: Theme): void {\n    // \n    this.wallpaperManager.applyThemeDefaultWallpapers(theme);\n    this.applyWallpapers();\n  }\n\n  // \n  getWallpaperManager(): WallpaperManager {\n    return this.wallpaperManager;\n  }\n}\n","import { AiResponseManager } from './ai-response-manager';\nimport { ConfigManager } from './config-manager';\nimport { addTestEntry, clearDebugData, loadDebugData, showDebugInfo, showTestEntryTypes } from './debug-data'; // \nimport { DialogManager } from './dialog-manager';\nimport { InputHandler } from './input-handler';\nimport { MomentsManager } from './moments-manager';\nimport { BLMX_Protocol, ChatEntry, getTavernHelper, LogEntry } from './script';\nimport { ThemeEditor } from './theme-editor';\nimport { ThemeManager } from './theme-manager';\nimport { IAppController, IEventHandler } from './types';\nimport { UIManager } from './ui-manager';\nimport { UIRenderer } from './ui-renderer';\nimport { WallpaperController } from './wallpaper-controller';\n\n/**\n * \n *\n * \n * 1. \n * 2. \n * 3. \n * 4. \n *\n * \n * - ConfigManager: \n * - UIManager: \n * - MomentsManager: \n * - AiResponseManager: AI\n * - ThemeEditor: \n * - InputHandler: \n * - WallpaperController: \n */\nexport class AppController implements IAppController {\n  private blmxManager!: BLMX_Protocol;\n  private uiRenderer!: UIRenderer;\n  private eventHandler!: IEventHandler;\n  private themeManager!: ThemeManager;\n  private wallpaperController!: WallpaperController;\n  private configManager!: ConfigManager;\n  private momentsManager!: MomentsManager;\n  private aiResponseManager!: AiResponseManager;\n  private themeEditor!: ThemeEditor;\n  private inputHandler!: InputHandler;\n  private uiManager!: UIManager;\n  private dialogManager!: DialogManager;\n\n  // \n  private userMessageQueue: ChatEntry[] = [];\n\n  // \n  hasMomentNotifications(): boolean {\n    return this.momentsManager.hasMomentNotifications();\n  }\n\n  setMomentNotification(value: boolean): void {\n    this.momentsManager.setMomentNotification(value);\n  }\n\n  constructor() {\n    // \n    this.configManager = new ConfigManager();\n  }\n\n  // \n  async initialize(): Promise<void> {\n    try {\n      window.currentGameDate = new Date();\n\n      // \n      this.themeManager = new ThemeManager();\n      this.wallpaperController = new WallpaperController(this.themeManager);\n\n      // \n      const currentTheme = this.themeManager.getCurrentTheme();\n      this.wallpaperController.initializeWallpapers(currentTheme);\n\n      const charData = await getTavernHelper().getCharData();\n\n      // \n      await this.configManager.loadFromStorage(charData);\n\n      // \n      let config = this.configManager.getConfig();\n      if (!config.avatars.char) {\n        const charAvatarPath = await getTavernHelper().getCharAvatarPath();\n        this.configManager.updateAvatar('char', charAvatarPath);\n        config = this.configManager.getConfig(); // \n      }\n\n      // UI - jQuery\n      $('.contact-name').text(this.getDisplayName('char'));\n      $('#moments-user-name').text(this.getDisplayName('user'));\n      $('#moments-user-avatar').attr('src', config.avatars.user);\n\n      //  - jQuery\n      const savedCoverPhoto = this.configManager.getSavedCoverPhoto();\n      if (savedCoverPhoto) {\n        $('#moments-cover-photo').attr('src', savedCoverPhoto);\n      }\n\n      //  - jQuery\n      const savedSignature = this.configManager.getSavedSignature();\n      $('#user-signature-display').text(savedSignature);\n\n      // BLMX\n      this.blmxManager = new BLMX_Protocol(config.currentCharId);\n      await this.blmxManager.initialize();\n\n      // \n      if ((window as any).BLMX_DEV_MODE) {\n        loadDebugData(this.blmxManager);\n      }\n\n      // EventHandler\n      const EventHandler = (window as any).EventHandlerClass;\n      this.eventHandler = new EventHandler(\n        '#wechat-input-field',\n        '#send-btn',\n        '#plus-btn',\n        this.blmxManager,\n        this,\n        null, // uiRenderer \n        {\n          getDisplayName: this.getDisplayName.bind(this),\n          stageAndDisplayEntry: this.stageAndDisplayEntry.bind(this),\n          triggerAiResponse: this.triggerAiResponse.bind(this),\n          updateFooterButtonsState: this.updateFooterButtonsState.bind(this),\n          renderChatHistory: this.renderChatHistory.bind(this),\n          renderMomentsFeed: this.renderMomentsFeed.bind(this),\n          togglePanel: this.togglePanel.bind(this),\n          findStickerUrlByName: this.findStickerUrlByName.bind(this),\n        },\n      );\n\n      // UI\n      this.uiRenderer = new UIRenderer('.wechat-body', config.avatars, {\n        getDisplayName: this.getDisplayName.bind(this),\n        findStickerUrlByName: this.findStickerUrlByName.bind(this),\n        onTransferAccept: this.handleTransferAccept.bind(this),\n        onGiftAction: this.handleGiftAction.bind(this),\n        onRecallMessage: this.handleMessageRecall.bind(this),\n        isMessageInQueue: this.isMessageInQueue.bind(this),\n      });\n\n      // EventHandleruiRenderer\n      this.eventHandler.setUIRenderer(this.uiRenderer);\n\n      // \n      this.momentsManager = new MomentsManager(this.blmxManager, this.configManager, this.uiRenderer);\n\n      // AI\n      this.aiResponseManager = new AiResponseManager(\n        this.blmxManager,\n        this.uiRenderer,\n        this.eventHandler,\n        this.momentsManager,\n      );\n\n      // \n      this.themeEditor = new ThemeEditor(this.themeManager, () => {\n        this.applyWallpapers();\n      });\n\n      // \n      this.inputHandler = new InputHandler(\n        this.configManager,\n        this.stageAndDisplayEntry.bind(this),\n        this.updateFooterButtonsState.bind(this),\n      );\n\n      // UI\n      this.uiManager = new UIManager(\n        this.configManager,\n        this.blmxManager.addEntry.bind(this.blmxManager),\n        this.uiRenderer.renderEntry.bind(this.uiRenderer),\n      );\n\n      // \n      this.dialogManager = DialogManager.getInstance();\n\n      // \n      this.applyWallpapers();\n\n      // \n      this.renderChatHistory();\n      this.renderMomentsFeed();\n\n      // \n      this.uiManager.setupInputPlaceholder(this.getDisplayName('char'));\n\n      // \n      this.updateFooterButtonsState();\n\n      // UI\n      this.setupThemeSelector();\n\n      // \n      this.themeEditor.updateCustomThemeButton();\n\n      // \n      this.uiManager.setupPhoneSizeAdjustment();\n\n      // \n      this.uiManager.setupStickerSizeControl();\n\n      // \n      this.uiManager.setupFontSelection();\n\n      // \n      this.uiManager.setupFullscreenSizeAdjustment();\n\n      // \n      this.uiManager.displayAppVersion();\n\n      // \n      this.uiManager.checkVersionUpdateNotification();\n\n      // \n      //  MomentsManager \n\n      //  AiResponseManager \n    } catch (error) {\n      // console.error('[BLMX] Failed to initialize:', error);\n    }\n  }\n\n  // \n  getDisplayName(type: 'user' | 'char'): string {\n    return this.configManager.getDisplayName(type);\n  }\n\n  findStickerUrlByName(name: string): string | undefined {\n    return this.configManager.findStickerUrlByName(name);\n  }\n\n  // \n  applyWallpapers(): void {\n    this.wallpaperController.applyWallpapers();\n  }\n\n  changeWallpaper(viewType: 'chat' | 'home' | 'settings'): void {\n    this.wallpaperController.changeWallpaper(viewType);\n  }\n\n  // \n  renderChatHistory(): void {\n    this.uiRenderer.clearChat();\n    if (!this.blmxManager) return;\n\n    // \n    this.blmxManager.logEntries.forEach((entry, index) => {\n      if (entry.recalled) {\n        this.uiRenderer.renderRecallNotice(entry, null, index);\n      } else {\n        this.uiRenderer.renderEntry(entry, index, false);\n      }\n    });\n\n    // \n    this.userMessageQueue.forEach((entry, queueIndex) => {\n      //  + \n      const actualIndex = this.blmxManager.logEntries.length + queueIndex;\n      if (entry.recalled) {\n        this.uiRenderer.renderRecallNotice(entry, null, actualIndex);\n      } else {\n        this.uiRenderer.renderEntry(entry, actualIndex, false);\n      }\n    });\n\n    this.uiRenderer.refreshAllTimestamps();\n    this.uiManager.scrollToBottom();\n  }\n\n  renderMomentsFeed(): void {\n    this.momentsManager.renderMomentsFeed();\n  }\n\n  // \n  stageAndDisplayEntry(entry: LogEntry): void {\n    if ('type' in entry) {\n      if (entry.type === 'event') {\n        // event\n        this.blmxManager.addEntry(entry);\n        const entryIndex = this.blmxManager.logEntries.length - 1;\n        this.uiRenderer.renderEntry(entry, entryIndex, true);\n\n        // AI\n        if ('sender' in entry && entry.sender === 'me') {\n          this.eventHandler.setHasPendingNotifications(true);\n        }\n\n        return;\n      } else if (entry.type === 'time') {\n        // time\n        return;\n      }\n\n      if (!entry.id) {\n        entry.id = 'msg-' + Date.now() + Math.random();\n      }\n\n      // \n      if (\n        entry.type === 'image' &&\n        'content' in entry &&\n        entry.content.type === 'url' &&\n        typeof entry.content.value === 'string' &&\n        entry.content.value.startsWith('data:image')\n      ) {\n        // \n        ((entry as ChatEntry).content as any).isNewForAI = true;\n      }\n\n      // \n      if ('sender' in entry && entry.sender === 'me') {\n        this.userMessageQueue.push(entry as ChatEntry);\n        this.eventHandler.setHasPendingNotifications(true);\n\n        //  + \n        const queueIndex = this.userMessageQueue.length - 1;\n        const globalIndex = this.blmxManager.logEntries.length + queueIndex;\n        this.uiRenderer.renderEntry(entry as ChatEntry, globalIndex, true);\n      } else {\n        // \n        this.blmxManager.addEntry(entry as ChatEntry);\n        const entryIndex = this.blmxManager.logEntries.length - 1;\n        this.uiRenderer.renderEntry(entry as ChatEntry, entryIndex, true);\n      }\n      this.updateFooterButtonsState();\n    }\n  }\n\n  // AI\n  async triggerAiResponse(immediate: boolean = false): Promise<void> {\n    // \n    const hasQueuedMessages = this.userMessageQueue.length > 0;\n\n    // \n    if (!immediate && !hasQueuedMessages && !this.eventHandler.hasNotifications) {\n      return;\n    }\n\n    // AI\n    if (hasQueuedMessages) {\n      // \n      const messagesToProcess = [...this.userMessageQueue];\n\n      // \n      messagesToProcess.forEach(entry => {\n        if (entry.type === 'image' && 'content' in entry && (entry.content as any).isNewForAI) {\n          (entry.content as any).value = `[]`;\n          delete (entry.content as any).isNewForAI;\n        }\n        this.blmxManager.addEntry(entry);\n      });\n\n      //  userMessageQueue = []\n      this.userMessageQueue = [];\n    }\n\n    await this.aiResponseManager.triggerAiResponse(immediate);\n  }\n\n  // UI\n  updateFooterButtonsState(): void {\n    this.uiManager.updateFooterButtonsState(this.eventHandler.hasNotifications);\n  }\n\n  togglePanel(panelToShow: string | null): void {\n    this.uiManager.togglePanel(panelToShow);\n  }\n\n  // \n  navigateTo(viewName: 'home' | 'wechat' | 'moments' | 'settings'): void {\n    const views = {\n      home: '#app-homescreen',\n      wechat: '#wechat-view',\n      moments: '#moments-view',\n      settings: '#settings-view',\n    };\n\n    try {\n      // jQuery\n      if (typeof $ !== 'undefined' && typeof jQuery !== 'undefined') {\n        // jQuery\n        $('.app-view').removeClass('active');\n        $(views[viewName]).addClass('active');\n      } else {\n        // jQuery\n        $('.app-view').removeClass('active');\n        const $targetView = $(views[viewName]);\n        if ($targetView.length) {\n          $targetView.addClass('active');\n        } else {\n          console.error(`[BLMX] : ${views[viewName]}`);\n        }\n      }\n\n      // \n      if (viewName === 'moments') {\n        // \n        this.setMomentNotification(false);\n\n        // \n        this.renderMomentsFeed();\n      }\n    } catch (error) {\n      console.error(`[BLMX] :`, error);\n\n      // jQuery\n      try {\n        $('.app-view').removeClass('active');\n        const $targetElement = $(views[viewName]);\n        if ($targetElement.length) {\n          $targetElement.addClass('active');\n        }\n      } catch (e) {\n        console.error(`[BLMX] :`, e);\n      }\n    }\n  }\n\n  async updateAvatar(avatarType: 'user' | 'char'): Promise<void> {\n    const config = this.configManager.getConfig();\n    const currentUrl = config.avatars[avatarType] || '';\n    const displayName = this.getDisplayName(avatarType);\n\n    if (avatarType === 'user') {\n      // \n      await this.showUserProfileDialog(currentUrl);\n    } else {\n      // \n      const newUrl = await this.dialogManager.showInputDialog(\n        '',\n        `${displayName}URL`,\n        currentUrl,\n        '',\n        'url',\n      );\n\n      if (newUrl) {\n        this.configManager.updateAvatar(avatarType, newUrl);\n        await this.dialogManager.alert('', '');\n        this.renderChatHistory();\n        this.renderMomentsFeed();\n      }\n    }\n  }\n\n  // +\n  private async showUserProfileDialog(currentAvatarUrl: string): Promise<void> {\n    const currentSignature = this.configManager.getSavedSignature();\n\n    return new Promise(resolve => {\n      // HTML\n      const dialogHtml = `\n        <div class=\"custom-dialog-overlay\" id=\"user-profile-dialog-overlay\">\n          <div class=\"custom-dialog user-profile-dialog\">\n            <div class=\"dialog-header\">\n              <h3 class=\"dialog-title\"></h3>\n            </div>\n            <div class=\"dialog-body\">\n              <div class=\"dialog-input-container\">\n                <input type=\"url\" id=\"avatar-url-input\" value=\"${currentAvatarUrl}\" placeholder=\"\">\n              </div>\n              <div class=\"dialog-input-container\">\n                <input type=\"text\" id=\"signature-input\" value=\"${currentSignature}\" placeholder=\"\">\n              </div>\n            </div>\n            <div class=\"dialog-footer\">\n              <button class=\"dialog-button cancel-button\" id=\"user-profile-cancel\"></button>\n              <button class=\"dialog-button primary-button\" id=\"user-profile-confirm\"></button>\n            </div>\n          </div>\n        </div>\n      `;\n\n      // \n      const $phoneScreen = $('.phone-screen');\n      if ($phoneScreen.length) {\n        $phoneScreen.append(dialogHtml);\n      } else {\n        // body\n        $('body').append(dialogHtml);\n      }\n      const $overlay = $('#user-profile-dialog-overlay');\n\n      // \n      $overlay.show();\n\n      // \n      $('#user-profile-cancel').on('click', () => {\n        $overlay.remove();\n        resolve();\n      });\n\n      $('#user-profile-confirm').on('click', async () => {\n        const newAvatarUrl = ($('#avatar-url-input').val() as string).trim();\n        const newSignature = ($('#signature-input').val() as string).trim();\n\n        let hasChanges = false;\n\n        // \n        if (newAvatarUrl && newAvatarUrl !== currentAvatarUrl) {\n          this.configManager.updateAvatar('user', newAvatarUrl);\n          $('#moments-user-avatar').attr('src', newAvatarUrl);\n          hasChanges = true;\n        }\n\n        // \n        if (newSignature !== currentSignature) {\n          this.configManager.setSignature(newSignature);\n          $('#user-signature-display').text(newSignature);\n          hasChanges = true;\n\n          // \n          if (newSignature !== currentSignature) {\n            const shouldNotify = await this.dialogManager.confirm(\n              'AI',\n              '',\n            );\n            if (shouldNotify) {\n              this.momentsManager.notifyMomentChange('signature', currentSignature, newSignature);\n              this.eventHandler.setHasPendingNotifications(true);\n            }\n          }\n        }\n\n        $overlay.remove();\n\n        if (hasChanges) {\n          this.renderChatHistory();\n          this.renderMomentsFeed();\n          await this.dialogManager.alert('', '');\n        }\n\n        resolve();\n      });\n\n      // ESC\n      $(document).on('keydown.userProfile', e => {\n        if (e.key === 'Escape') {\n          $overlay.remove();\n          $(document).off('keydown.userProfile');\n          resolve();\n        }\n      });\n\n      // \n      $overlay.on('click', e => {\n        if (e.target === $overlay[0]) {\n          $overlay.remove();\n          resolve();\n        }\n      });\n\n      // \n      setTimeout(() => {\n        $('#avatar-url-input').focus();\n      }, 100);\n    });\n  }\n\n  async updateCharRemark(): Promise<void> {\n    const oldDisplayName = this.getDisplayName('char');\n    const config = this.configManager.getConfig();\n    const newRemark = await this.dialogManager.prompt(':', config.charRemark, '');\n    if (newRemark !== null) {\n      this.configManager.updateCharRemark(newRemark);\n      const newDisplayName = this.getDisplayName('char');\n\n      $('#contact-name-header').text(newDisplayName);\n      $('#wechat-input-field').attr(\n        'placeholder',\n        this.configManager.getSavedInputPlaceholder() || ` ${newDisplayName} ...`,\n      );\n\n      $('#moments-feed-list .post-author-name').each(function () {\n        if ($(this).text() === oldDisplayName) $(this).text(newDisplayName);\n      });\n\n      $('.recall-notice-text').each(function () {\n        const text = $(this).text();\n        if (text && text.includes(`\"${oldDisplayName}\"`)) {\n          $(this).text(`\"${newDisplayName}\" `);\n        }\n      });\n\n      await this.dialogManager.alert('', '');\n    }\n  }\n\n  async updateUserName(): Promise<void> {\n    const oldName = this.getDisplayName('user');\n    const newName = await this.dialogManager.showInputDialog('', '', oldName, '...');\n\n    if (newName && newName.trim() !== '' && newName !== oldName) {\n      this.configManager.updateUserName(newName);\n      $('#moments-user-name').text(newName);\n\n      // AI\n      const shouldNotify = await this.dialogManager.confirm('AI', '');\n      if (shouldNotify) {\n        this.momentsManager.notifyMomentChange('name', oldName, newName);\n        this.eventHandler.setHasPendingNotifications(true);\n      }\n\n      await this.dialogManager.alert('', '');\n    }\n  }\n\n  // updateSignature\n\n  async updateCoverPhoto(): Promise<void> {\n    const currentCover = this.configManager.getSavedCoverPhoto() || '';\n    const newCover = await this.dialogManager.showInputDialog(\n      '',\n      'URL',\n      currentCover,\n      '',\n      'url',\n    );\n    if (newCover) {\n      this.configManager.setCoverPhoto(newCover);\n      $('#moments-cover-photo').attr('src', newCover);\n    }\n  }\n\n  // \n  async handleTransferAccept(data: any): Promise<void> {\n    await this.inputHandler.handleTransferAccept(data);\n  }\n\n  async handleGiftAction(data: any): Promise<void> {\n    await this.inputHandler.handleGiftAction(data);\n    this.eventHandler.setHasPendingNotifications(true);\n  }\n\n  // \n  isMessageInQueue(messageId: string): boolean {\n    return this.userMessageQueue.some(entry => entry.id === messageId);\n  }\n\n  // \n  removeFromUserMessageQueue(index: number): void {\n    if (index >= 0 && index < this.userMessageQueue.length) {\n      this.userMessageQueue.splice(index, 1);\n    }\n  }\n\n  // \n  async handleMessageRecall(entry: ChatEntry): Promise<void> {\n    try {\n      // \n      if (entry.type !== 'message') {\n        // \n        return;\n      }\n\n      // \n      const queueIndex = this.userMessageQueue.findIndex(queueEntry => queueEntry.id === entry.id);\n\n      if (queueIndex === -1) {\n        // \n        return;\n      }\n\n      const targetEntry = this.userMessageQueue[queueIndex];\n\n      // recalled_content\n      targetEntry.recalled_content = targetEntry.content;\n\n      // \n      targetEntry.recalled_timestamp = new Date().toISOString();\n\n      // \n      targetEntry.recalled = true;\n\n      // \n      this.renderChatHistory();\n    } catch (error) {\n      console.error(':', error);\n    }\n  }\n\n  // AI\n  getLatestAiRawResponse(): string {\n    return this.aiResponseManager.getLatestAiRawResponse();\n  }\n\n  getLatestSentPrompt(): string {\n    return this.aiResponseManager.getLatestSentPrompt();\n  }\n\n  getRawAiResponse(): string {\n    return this.aiResponseManager.getRawAiResponse();\n  }\n\n  getFullPrompt(): string {\n    return this.aiResponseManager.getFullPrompt();\n  }\n\n  // \n  setupThemeSelector(): void {\n    this.themeEditor.setupThemeSelector();\n    this.themeEditor.addCustomThemeEditButton();\n    this.setupThemeEditorEvents();\n  }\n\n  private setupThemeEditorEvents(): void {\n    // jQuery\n    $('#close-theme-editor').on('click', () => this.themeEditor.closeThemeEditor());\n    $('#save-theme-btn').on('click', () => this.themeEditor.saveCustomTheme());\n    $('#reset-theme-btn').on('click', () => this.themeEditor.resetThemeEditor());\n    $('#custom-theme-btn').on('click', () => this.themeEditor.openThemeEditor());\n    $('#import-theme-btn').on('click', () => this.themeEditor.importTheme());\n    $('#export-json-btn').on('click', () => this.themeEditor.exportThemeAsJSON());\n  }\n\n  openThemeEditor(): void {\n    this.themeEditor.openThemeEditor();\n  }\n\n  closeThemeEditor(): void {\n    this.themeEditor.closeThemeEditor();\n  }\n\n  // HEXRGBA\n  hexToRgba(hex: string, alpha: number): string {\n    const r = parseInt(hex.slice(1, 3), 16);\n    const g = parseInt(hex.slice(3, 5), 16);\n    const b = parseInt(hex.slice(5, 7), 16);\n\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`;\n  }\n\n  // \n  addTestEntry(entryType: string): void {\n    addTestEntry(this.blmxManager, entryType);\n  }\n\n  clearDebugData(): void {\n    clearDebugData(this.blmxManager);\n  }\n\n  showTestEntryTypes(): void {\n    showTestEntryTypes();\n  }\n\n  showDebugInfo(): void {\n    showDebugInfo(this);\n  }\n\n  // \n  notifyRecallViaMoments(sender: 'USER' | 'CHAR', targetText: string): void {\n    // AI\n    if (confirm('AI')) {\n      this.momentsManager.notifyRecallViaMoments(sender, targetText);\n      this.eventHandler.setHasPendingNotifications(true);\n    }\n  }\n\n  /**\n   * \n   */\n  cleanup(): void {\n    // \n    if (this.aiResponseManager && typeof this.aiResponseManager.cleanup === 'function') {\n      this.aiResponseManager.cleanup();\n    }\n\n    if (this.uiRenderer && typeof this.uiRenderer.cleanup === 'function') {\n      this.uiRenderer.cleanup();\n    }\n  }\n}\n","/**\n * \n * SCSS\n */\n\n// \nimport './styles/main.scss';\n\n/**\n * \n * \n */\nexport class StyleManager {\n  private static instance: StyleManager;\n  private loadedStyles: Set<string> = new Set();\n\n  private constructor() {\n    this.initializeStyles();\n  }\n\n  /**\n   * \n   */\n  public static getInstance(): StyleManager {\n    if (!StyleManager.instance) {\n      StyleManager.instance = new StyleManager();\n    }\n    return StyleManager.instance;\n  }\n\n  /**\n   * \n   */\n  private initializeStyles(): void {\n    console.log('[StyleManager] ...');\n\n    // \n    this.loadedStyles.add('main');\n\n    // body\n    document.body.classList.add('styles-loaded');\n\n    console.log('[StyleManager] ');\n  }\n\n  /**\n   * \n   */\n  public isStyleLoaded(styleName: string): boolean {\n    return this.loadedStyles.has(styleName);\n  }\n\n  /**\n   * \n   */\n  public toggleTheme(theme: 'light' | 'dark'): void {\n    const body = document.body;\n\n    if (theme === 'dark') {\n      body.classList.add('dark-mode');\n    } else {\n      body.classList.remove('dark-mode');\n    }\n\n    console.log(`[StyleManager] : ${theme}`);\n  }\n\n  /**\n   * \n   */\n  public getCurrentTheme(): 'light' | 'dark' {\n    return document.body.classList.contains('dark-mode') ? 'dark' : 'light';\n  }\n\n  /**\n   * CSS\n   */\n  public setCSSVariable(name: string, value: string): void {\n    document.documentElement.style.setProperty(name, value);\n  }\n\n  /**\n   * CSS\n   */\n  public getCSSVariable(name: string): string {\n    return getComputedStyle(document.documentElement).getPropertyValue(name).trim();\n  }\n\n  /**\n   * CSS\n   */\n  public setCSSVariables(variables: Record<string, string>): void {\n    Object.entries(variables).forEach(([name, value]) => {\n      this.setCSSVariable(name, value);\n    });\n  }\n\n  /**\n   * CSS\n   */\n  public resetCSSVariables(): void {\n    // CSS\n    const style = document.documentElement.style;\n    const propertiesToRemove: string[] = [];\n\n    for (let i = 0; i < style.length; i++) {\n      const property = style[i];\n      if (property.startsWith('--')) {\n        propertiesToRemove.push(property);\n      }\n    }\n\n    propertiesToRemove.forEach(property => {\n      style.removeProperty(property);\n    });\n  }\n\n  /**\n   * \n   */\n  public addStyleClass(element: HTMLElement, className: string): void {\n    element.classList.add(className);\n  }\n\n  /**\n   * \n   */\n  public removeStyleClass(element: HTMLElement, className: string): void {\n    element.classList.remove(className);\n  }\n\n  /**\n   * \n   */\n  public toggleStyleClass(element: HTMLElement, className: string): boolean {\n    return element.classList.toggle(className);\n  }\n\n  /**\n   * \n   */\n  public hasStyleClass(element: HTMLElement, className: string): boolean {\n    return element.classList.contains(className);\n  }\n\n  /**\n   * \n   */\n  public getStatus(): {\n    loadedStyles: string[];\n    currentTheme: string;\n    stylesLoaded: boolean;\n  } {\n    return {\n      loadedStyles: Array.from(this.loadedStyles),\n      currentTheme: this.getCurrentTheme(),\n      stylesLoaded: document.body.classList.contains('styles-loaded'),\n    };\n  }\n}\n\n// \nexport const styleManager = StyleManager.getInstance();\n\n// \nconsole.log('[StyleManager] ');\n","import { AppController } from './app-controller';\nimport { DialogManager } from './dialog-manager';\nimport { EventHandler } from './event-handler';\nimport { styleManager } from './style-manager';\n\n//  - false\n// window\n(window as any).BLMX_DEV_MODE = false;\n\n// EventHandler\n(window as any).EventHandlerClass = EventHandler;\n\n// AI\n(window as any).BLMX_PROCESSING_AI_RESPONSE = false;\n\n// jQuery$(async () => {})\n$(async () => {\n  try {\n    // \n    (window as any).BLMX_PROCESSING_AI_RESPONSE = false;\n\n    // \n    const appController = new AppController();\n    await appController.initialize();\n\n    // \n    (window as any).blmxApp = appController;\n    (window as any).blmxStyleManager = styleManager;\n    (window as any).dialogManager = DialogManager.getInstance();\n\n    if ((window as any).BLMX_DEV_MODE) {\n      console.log('[BLMX] ');\n      console.log('[BLMX] :');\n      console.log('  window.blmxApp.showTestEntryTypes() - ');\n      console.log('  window.blmxApp.addTestEntry() - ');\n      console.log('  window.blmxApp.clearDebugData() - ');\n    }\n  } catch (error) {\n    console.error('[BLMX] :', error);\n\n    // alert\n    // \n    setTimeout(() => {\n      const dialogManager = DialogManager.getInstance();\n      dialogManager.alert('', '');\n    }, 500); // DOM\n  }\n});\n","import { DialogManager } from './dialog-manager';\nimport { BLMX_Protocol, ChatEntry, LogEntry } from './script';\nimport { IAppController, IEventHandler } from './types';\nimport { UIRenderer } from './ui-renderer';\nimport { safeJsonStringify, SafeStorage } from './utils';\n\n// \ninterface EventHandlerOptions {\n  getDisplayName: (type: 'user' | 'char') => string;\n  stageAndDisplayEntry: (entry: LogEntry) => void;\n  triggerAiResponse: (immediate?: boolean) => Promise<void>;\n  updateFooterButtonsState: () => void;\n  renderChatHistory: () => void;\n  renderMomentsFeed: () => void;\n  togglePanel: (panelName: string | null) => void;\n  findStickerUrlByName: (name: string) => string | undefined;\n}\n\n// \nexport class EventHandler implements IEventHandler {\n  private wechatInput: HTMLInputElement;\n  private sendBtn: HTMLElement;\n  private plusBtn: HTMLElement;\n  private uiRenderer: UIRenderer | null;\n  private options: EventHandlerOptions;\n  private blmxManager: BLMX_Protocol;\n  private appController: IAppController;\n  private hasPendingNotifications: boolean = false;\n  private dialogManager: DialogManager = DialogManager.getInstance();\n\n  // getter\n  get hasNotifications(): boolean {\n    return this.hasPendingNotifications;\n  }\n\n  // UIRenderer\n  setUIRenderer(uiRenderer: UIRenderer): void {\n    this.uiRenderer = uiRenderer;\n  }\n\n  constructor(\n    inputSelector: string,\n    sendBtnSelector: string,\n    plusBtnSelector: string,\n    blmxManager: BLMX_Protocol,\n    appController: IAppController,\n    uiRenderer: UIRenderer | null,\n    options: EventHandlerOptions,\n  ) {\n    this.wechatInput = $(inputSelector)[0] as HTMLInputElement;\n    this.sendBtn = $(sendBtnSelector)[0] as HTMLElement;\n    this.plusBtn = $(plusBtnSelector)[0] as HTMLElement;\n\n    if (!this.wechatInput || !this.sendBtn || !this.plusBtn) {\n      throw new Error('One or more required elements not found');\n    }\n\n    this.blmxManager = blmxManager;\n    this.options = options;\n    this.appController = appController;\n    this.uiRenderer = uiRenderer;\n\n    this.setupEventListeners();\n  }\n\n  // \n  setHasPendingNotifications(value: boolean): void {\n    this.hasPendingNotifications = value;\n    this.options.updateFooterButtonsState();\n  }\n\n  // \n  addLongPressListener(\n    element: HTMLElement,\n    callback: () => void,\n    options: { duration: number; preventDefault: boolean } = { duration: 600, preventDefault: true },\n  ): void {\n    let timer: number;\n    let startX: number, startY: number;\n\n    const onStart = (e: PointerEvent) => {\n      if (e.type === 'mousedown' && e.button !== 0) return;\n      startX = e.clientX;\n      startY = e.clientY;\n      if (options.preventDefault) e.preventDefault();\n      clearTimeout(timer);\n      timer = window.setTimeout(() => {\n        timer = 0;\n        callback();\n      }, options.duration);\n    };\n\n    const onMove = (e: PointerEvent) => {\n      if (!timer) return;\n      const moveX = e.clientX;\n      const moveY = e.clientY;\n      if (Math.abs(moveX - startX) > 10 || Math.abs(moveY - startY) > 10) {\n        clearTimeout(timer);\n      }\n    };\n\n    const onEnd = () => clearTimeout(timer);\n\n    element.addEventListener('pointerdown', onStart);\n    element.addEventListener('pointermove', onMove);\n    element.addEventListener('pointerup', onEnd);\n    element.addEventListener('pointerleave', onEnd);\n\n    if (options.preventDefault) {\n      element.addEventListener('contextmenu', e => e.preventDefault());\n    }\n  }\n\n  // \n  async promptForDateTime(defaultText: string): Promise<[string, string] | null> {\n    const dateTimeInput = await this.dialogManager.prompt(\n      '',\n      defaultText,\n      '',\n      '',\n      '',\n      'text',\n      'YYYY-MM-DD HH:mm',\n    );\n\n    if (!dateTimeInput || !/^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}$/.test(dateTimeInput)) {\n      if (dateTimeInput) await this.dialogManager.alert('YYYY-MM-DD HH:mm ', '');\n      return null;\n    }\n\n    const [newDate, newTime] = dateTimeInput.split(' ');\n    const parsedDate = new Date(dateTimeInput.replace(' ', 'T'));\n\n    if (isNaN(parsedDate.getTime())) {\n      await this.dialogManager.alert('', '');\n      return null;\n    }\n\n    // \n    window.currentGameDate = parsedDate;\n\n    // \n    const $timeElement = $('#current-time');\n    if ($timeElement.length) {\n      const formattedTime = `${window.currentGameDate.getHours().toString().padStart(2, '0')}:${window.currentGameDate\n        .getMinutes()\n        .toString()\n        .padStart(2, '0')}`;\n      $timeElement.text(formattedTime);\n    }\n\n    // \n    if (this.uiRenderer) {\n      this.uiRenderer.refreshAllTimestamps();\n    }\n\n    return [newDate, newTime] as [string, string];\n  }\n\n  // \n  async handleMessageRecall(messageId: string): Promise<void> {\n    const entryToRecall = this.blmxManager.logEntries.find(e => 'id' in e && e.id === messageId) as\n      | ChatEntry\n      | undefined;\n\n    if (entryToRecall) {\n      const currentDate = window.currentGameDate || new Date();\n      const timeString = `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1)\n        .toString()\n        .padStart(2, '0')}-${currentDate.getDate().toString().padStart(2, '0')} ${currentDate\n        .getHours()\n        .toString()\n        .padStart(2, '0')}:${currentDate.getMinutes().toString().padStart(2, '0')}`;\n\n      const dateTimeResult = await this.promptForDateTime(timeString);\n\n      if (dateTimeResult === null) {\n        return;\n      }\n\n      const confirmed = await this.dialogManager.confirm('', '');\n\n      if (confirmed) {\n        const [newDate, newTime] = dateTimeResult;\n        // \n        entryToRecall.recalled = true;\n        entryToRecall.recalled_timestamp = `${newDate} ${newTime}`;\n        entryToRecall.recalled_content = entryToRecall.content;\n\n        // \n        this.blmxManager.persistLogToStorage().then(() => {\n          // \n          this.options.renderChatHistory();\n        });\n\n        // \n        this.options.updateFooterButtonsState();\n\n        // AI\n        if (entryToRecall.sender === 'me') {\n          // \n          const messageContent =\n            typeof entryToRecall.content === 'string'\n              ? entryToRecall.content\n              : safeJsonStringify(entryToRecall.content);\n\n          // AppController\n          this.appController.notifyRecallViaMoments('USER', messageContent);\n        }\n      }\n    } else {\n      await this.dialogManager.alert('', '');\n    }\n  }\n\n  // \n  private setupEventListeners(): void {\n    //  - jQuery\n    $(this.sendBtn).on('click', () => {\n      const text = this.wechatInput.value.trim();\n      if (text) {\n        this.options.stageAndDisplayEntry({\n          id: `msg-${Date.now()}${Math.random()}`,\n          type: 'message',\n          sender: 'me',\n          content: text,\n        });\n        this.wechatInput.value = '';\n        this.options.updateFooterButtonsState();\n      } else {\n        // AI\n        this.hasPendingNotifications = false;\n        this.options.triggerAiResponse(true); // immediate=true\n      }\n    });\n\n    $('#smile-btn').on('click', () => {\n      this.options.togglePanel('sticker');\n      this.renderStickerFeatures();\n    });\n\n    // Plus - jQuery\n    $(this.plusBtn).on('click', () => {\n      this.options.togglePanel('plus');\n      this.renderPlusFeatures();\n    });\n\n    $('#microphone-btn').on('click', async () => {\n      const result = await this.dialogManager.showVoiceDialog();\n      if (result) {\n        this.options.stageAndDisplayEntry({\n          id: `msg-${Date.now()}${Math.random()}`,\n          type: 'voice',\n          sender: 'me',\n          content: { text: result.text, duration: result.duration },\n        });\n      }\n    });\n\n    //  - jQuery\n    $(this.wechatInput).on('keydown', (e: JQuery.KeyDownEvent) => {\n      if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        $(this.sendBtn).trigger('click');\n      }\n    });\n\n    $(this.wechatInput).on('input', () => {\n      this.options.updateFooterButtonsState();\n    });\n\n    $(this.wechatInput).on('focus', () => {\n      this.options.togglePanel(null);\n    });\n\n    // \n    $('#app-wechat').on('click', () => this.appController.navigateTo('wechat'));\n    $('#app-settings').on('click', () => this.appController.navigateTo('settings'));\n    $('#wechat-back-btn-dummy').on('click', () => this.appController.navigateTo('home'));\n    $('#settings-back-btn').on('click', () => this.appController.navigateTo('home'));\n    $('#wechat-options-btn').on('click', () => this.appController.navigateTo('moments'));\n    $('#moments-back-btn').on('click', () => this.appController.navigateTo('wechat'));\n\n    // \n    this.renderPlusFeatures();\n    this.renderStickerFeatures();\n\n    // \n    this.setupClickListeners();\n\n    //  - jQuery\n    this.addLongPressListener(\n      $('#wechat-input-field')[0] as HTMLElement,\n      async () => {\n        // \n        const currentPlaceholder = $('#wechat-input-field').attr('placeholder') || '';\n        const newPlaceholder = await this.dialogManager.prompt(\n          ':',\n          currentPlaceholder,\n          '',\n        );\n        if (newPlaceholder !== null) {\n          $('#wechat-input-field').attr('placeholder', newPlaceholder);\n          localStorage.setItem(`blmx_input_placeholder_${this.blmxManager.getCharId()}`, newPlaceholder);\n        }\n      },\n      { duration: 5000, preventDefault: false },\n    );\n  }\n\n  private async setupClickListeners(): Promise<void> {\n    $('#hidden-send-trigger').on('click', async () => {\n      const confirmed = await this.dialogManager.confirm('AI', 'AI');\n      if (confirmed) {\n        this.options.triggerAiResponse(true);\n      }\n    });\n\n    //  - \n    $('#wechat-options-btn').on('click', () => {\n      this.appController.navigateTo('moments');\n    });\n\n    $('#delete-mode-trigger').on('click', async () => {\n      const wechatView = $('#wechat-view');\n      wechatView?.toggleClass('delete-mode');\n      if (wechatView?.hasClass('delete-mode')) {\n        await this.dialogManager.alert(\n          '',\n          '',\n        );\n      } else {\n        await this.dialogManager.alert('', '');\n      }\n    });\n\n    $('#post-moment-btn').on('click', async () => {\n      const currentDate = window.currentGameDate || new Date();\n      const timeString = `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1)\n        .toString()\n        .padStart(2, '0')}-${currentDate.getDate().toString().padStart(2, '0')} ${currentDate\n        .getHours()\n        .toString()\n        .padStart(2, '0')}:${currentDate.getMinutes().toString().padStart(2, '0')}`;\n\n      // \n      const momentData = await this.dialogManager.showMomentDialog(timeString);\n      if (!momentData) return; // \n\n      // ID\n      const momentId = `moment-${Date.now()}-${Math.random().toString(36).substring(2, 10)}`;\n      const momentEntry = {\n        key: 'USER_MOMENT',\n        id: momentId,\n        data: {\n          text: momentData.text,\n          image: momentData.image,\n          image_type: momentData.image_type,\n          image_desc: momentData.image_desc,\n          date: momentData.date,\n          time: momentData.time,\n        },\n      } as import('./script').MomentEntry;\n\n      // \n      this.blmxManager.addEntry(momentEntry);\n\n      // \n      const momentDateTime = `${momentData.date} ${momentData.time}`;\n      const momentDate = new Date(momentDateTime.replace(' ', 'T'));\n      const currentGameDate = window.currentGameDate || new Date();\n\n      // \n      if (momentDate > currentGameDate) {\n        // 300ms\n        setTimeout(async () => {\n          const shouldAdvanceTime = await this.dialogManager.confirm(\n            `${momentData.date} ${momentData.time}\\n`,\n            '',\n          );\n\n          if (shouldAdvanceTime) {\n            // \n            const parsedDate = new Date(momentDateTime.replace(' ', 'T'));\n            if (!isNaN(parsedDate.getTime())) {\n              // \n              window.currentGameDate = parsedDate;\n\n              // \n              const $timeElement = $('#current-time');\n              if ($timeElement.length) {\n                const formattedTime = `${window.currentGameDate\n                  .getHours()\n                  .toString()\n                  .padStart(2, '0')}:${window.currentGameDate.getMinutes().toString().padStart(2, '0')}`;\n                $timeElement.text(formattedTime);\n              }\n\n              // \n              if (this.uiRenderer) {\n                this.uiRenderer.refreshAllTimestamps();\n              }\n\n              // \n              const timeAdvanceEvent: import('./script').EventLogEntry = {\n                type: 'event',\n                content: {\n                  date: momentData.date,\n                  time: momentData.time,\n                  description: ` ${momentData.date} ${momentData.time}`,\n                },\n                id: `event-${Date.now()}`,\n              };\n              this.blmxManager.addEntry(timeAdvanceEvent);\n\n              // \n              this.options.renderMomentsFeed();\n            }\n          }\n        }, 300);\n      }\n\n      // \n      this.options.renderMomentsFeed();\n\n      // \n      this.setHasPendingNotifications(true);\n      this.options.updateFooterButtonsState();\n\n      // UI\n      this.blmxManager.persistLogToStorage().then(() => {});\n    });\n\n    const momentsFeedList = $('#moments-feed-list');\n    momentsFeedList?.on('click', async e => {\n      const target = $(e.target)[0] as HTMLElement;\n      const postEl = target.closest('.moment-post') as HTMLElement;\n      if (!postEl) return;\n\n      // ID\n      const momentId = postEl.dataset.momentId;\n      if (!momentId) {\n        console.error('[BLMX] IDdata-moment-id');\n        return;\n      }\n      // \n\n      if (target.closest('.delete-moment-btn')) {\n        const confirmed = await this.dialogManager.confirm(\n          '\\n',\n          '',\n        );\n        if (confirmed) {\n          // momentIdID\n          const momentPostLogIndices: number[] = [];\n          this.blmxManager.logEntries.forEach((entry, index) => {\n            if ('key' in entry && entry.key.includes('_MOMENT')) {\n              momentPostLogIndices.push(index);\n            }\n          });\n\n          const momentSequenceId = parseInt(momentId, 10);\n          const actualMomentIndex = momentPostLogIndices[momentSequenceId];\n\n          // \n\n          if (actualMomentIndex !== undefined && actualMomentIndex >= 0) {\n            // \n            const indicesToDelete: number[] = [actualMomentIndex];\n\n            // \n            this.blmxManager.logEntries.forEach((entry, index) => {\n              if (\n                'key' in entry &&\n                (entry.key === 'USER_LIKE' || entry.key === 'USER_COMMENT') &&\n                'data' in entry &&\n                'target_post_id' in entry.data &&\n                entry.data.target_post_id === momentSequenceId\n              ) {\n                indicesToDelete.push(index);\n              }\n            });\n\n            // \n            indicesToDelete.sort((a, b) => b - a);\n            for (const index of indicesToDelete) {\n              this.blmxManager.logEntries.splice(index, 1);\n            }\n\n            // \n            this.blmxManager.persistLogToStorage().then(() => {\n              // \n              this.options.renderMomentsFeed();\n            });\n          }\n        }\n      } else if (target.closest('.comment-button')) {\n        // /\n        const result = await this.dialogManager.showCommentDialog();\n        if (result) {\n          if (result.type === 'like') {\n            // \n            const likeId = `like-${Date.now()}-${Math.random().toString(36).substring(2, 10)}`;\n            const likeEntry = {\n              key: 'USER_LIKE',\n              id: likeId,\n              data: { target_post_id: parseInt(momentId, 10) },\n            } as import('./script').LikeEntry;\n\n            this.blmxManager.addEntry(likeEntry);\n            // \n          } else if (result.type === 'comment' && result.content) {\n            // \n            const commentId = `comment-${Date.now()}-${Math.random().toString(36).substring(2, 10)}`;\n            const commentEntry = {\n              key: 'USER_COMMENT',\n              id: commentId,\n              data: { text: result.content, target_post_id: parseInt(momentId, 10) },\n            } as import('./script').CommentEntry;\n\n            this.blmxManager.addEntry(commentEntry);\n            // \n          }\n\n          // \n          this.options.renderMomentsFeed();\n          this.setHasPendingNotifications(true);\n          this.options.updateFooterButtonsState();\n\n          // \n          this.blmxManager.persistLogToStorage();\n        }\n      }\n    });\n\n    $(document.body).on('click', e => {\n      const target = $(e.target)[0] as HTMLElement;\n      if (target.matches('.message-avatar')) {\n        const row = target.closest('.message-row');\n        if (row) {\n          const avatarType = row.classList.contains('me') ? 'user' : 'char';\n          this.appController.updateAvatar(avatarType);\n        }\n      }\n    });\n\n    $('#contact-name-header').on('click', () => {\n      this.appController.updateCharRemark();\n    });\n    $('#moments-user-name').on('click', () => {\n      this.appController.updateUserName();\n    });\n    $('#moments-user-avatar').on('click', () => {\n      this.appController.updateAvatar('user');\n    });\n    // \n    $('#moments-cover-photo').on('click', () => {\n      this.appController.updateCoverPhoto();\n    });\n\n    const $wechatBody = $('.wechat-body');\n    // jQueryoncapture\n    $wechatBody.on('click', async (e: JQuery.ClickEvent) => {\n      const $wechatView = $('#wechat-view');\n      if (!$wechatView.hasClass('delete-mode')) {\n        return;\n      }\n\n      // data-log-index\n      const $targetRow = $(e.target).closest('[data-log-index]');\n      if ($targetRow.length) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const indexToDelete = parseInt($targetRow.data('logIndex'), 10);\n        const previewText = $targetRow.text().trim().replace(/\\s+/g, ' ').substring(0, 50);\n\n        const confirmed = await this.dialogManager.confirm(\n          `\\n\\n: \"${previewText}...\"`,\n          '',\n        );\n        if (confirmed) {\n          const mainLogLength = this.blmxManager.logEntries.length;\n\n          if (indexToDelete < mainLogLength) {\n            // \n            this.blmxManager.logEntries.splice(indexToDelete, 1);\n            await this.blmxManager.persistLogToStorage();\n          } else {\n            // \n            const queueIndex = indexToDelete - mainLogLength;\n            this.appController.removeFromUserMessageQueue(queueIndex);\n          }\n\n          this.options.renderChatHistory();\n          this.options.renderMomentsFeed();\n        }\n        return;\n      }\n\n      // data-log-indexdata-message-id\n      const $messageRow = $(e.target).closest('[data-message-id]');\n      if ($messageRow.length) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const messageId = $messageRow.data('messageId');\n        const previewText = $messageRow.text().trim().replace(/\\s+/g, ' ').substring(0, 50);\n\n        const confirmed = await this.dialogManager.confirm(\n          `\\n\\n: \"${previewText}...\"`,\n          '',\n        );\n        if (confirmed) {\n          // messageId\n          const indexToDelete = this.blmxManager.logEntries.findIndex(entry => 'id' in entry && entry.id === messageId);\n\n          if (indexToDelete !== -1) {\n            this.blmxManager.logEntries.splice(indexToDelete, 1);\n            this.blmxManager.persistLogToStorage().then(() => {\n              this.options.renderChatHistory();\n              this.options.renderMomentsFeed();\n            });\n          } else {\n            // DOM\n            $messageRow.remove();\n            await this.dialogManager.alert('', '');\n          }\n        }\n      }\n    });\n\n    $('#change-chat-wallpaper-btn').on('click', e => {\n      e.preventDefault();\n      this.appController.changeWallpaper('chat');\n    });\n    $('#change-home-wallpaper-btn').on('click', e => {\n      e.preventDefault();\n      this.appController.changeWallpaper('home');\n    });\n    $('#change-settings-wallpaper-btn').on('click', e => {\n      e.preventDefault();\n      this.appController.changeWallpaper('settings');\n    });\n\n    $('#show-last-ai-response-btn').on('click', async e => {\n      e.preventDefault();\n      const response = this.appController.getLatestAiRawResponse();\n      await this.dialogManager.showScrollableText(response || 'AI', 'AI', '');\n    });\n\n    $('#show-last-sent-prompt-btn').on('click', async e => {\n      e.preventDefault();\n      const prompt = this.appController.getLatestSentPrompt();\n      await this.dialogManager.showScrollableText(prompt || '', '', '');\n    });\n\n    // \n    $('.dynamic-island').on('click', async () => {\n      try {\n        // jQueryAPI\n        if (!document.fullscreenElement) {\n          // \n          await document.documentElement.requestFullscreen();\n        } else {\n          // \n          await document.exitFullscreen();\n        }\n      } catch (error) {\n        console.warn('[BLMX] :', error);\n        await this.dialogManager.alert('', '');\n      }\n    });\n  }\n\n  private renderPlusFeatures(): void {\n    const $plusGrid = $('#plus-grid');\n    if (!$plusGrid.length) return;\n\n    const PLUS_FEATURES = [\n      {\n        label: '',\n        icon: 'fas fa-images',\n        action: async () => {\n          const desc = await this.dialogManager.prompt(':', '', '');\n          if (desc) {\n            this.options.stageAndDisplayEntry({\n              type: 'image',\n              sender: 'me',\n              content: { type: 'desc', value: desc },\n              id: `msg-${Date.now()}`,\n            });\n            this.options.togglePanel(null);\n          }\n        },\n      },\n      {\n        label: '',\n        icon: 'fas fa-camera',\n        action: async () => {\n          const currentDate = window.currentGameDate || new Date();\n          const dateString = `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1)\n            .toString()\n            .padStart(2, '0')}-${currentDate.getDate().toString().padStart(2, '0')}`;\n          const timeString = `${currentDate.getHours().toString().padStart(2, '0')}:${currentDate\n            .getMinutes()\n            .toString()\n            .padStart(2, '0')}`;\n\n          // \n          const timeJumpData = await this.dialogManager.showTimeJumpDialog(`${dateString} ${timeString}`);\n          if (!timeJumpData) return;\n\n          const eventData = {\n            date: timeJumpData.date,\n            time: timeJumpData.time,\n            description: timeJumpData.description,\n          };\n\n          // eventlog\n          const [newDate, newTime] = [timeJumpData.date, timeJumpData.time];\n          window.currentGameDate = new Date(`${newDate} ${newTime}`.replace(' ', 'T'));\n\n          // \n          const $timeElement = $('#current-time');\n          if ($timeElement.length) {\n            const formattedTime = `${window.currentGameDate\n              .getHours()\n              .toString()\n              .padStart(2, '0')}:${window.currentGameDate.getMinutes().toString().padStart(2, '0')}`;\n            $timeElement.text(formattedTime);\n          }\n\n          this.options.stageAndDisplayEntry({\n            type: 'event',\n            content: eventData,\n            id: `event-${Date.now()}`,\n          } as import('./script').EventLogEntry);\n          this.options.togglePanel(null);\n        },\n      },\n      {\n        label: '',\n        icon: 'fas fa-video',\n        action: async () =>\n          await this.dialogManager.alert(\n            'discordhttps://discord.com/channels/1379304008157499423/1388180976873766973https://discord.com/channels/1291925535324110879/1388182155707814009',\n            '',\n          ),\n      },\n      {\n        label: '',\n        icon: 'fas fa-map-marker-alt',\n        action: async () => {\n          const loc = await this.dialogManager.prompt(':', '', '');\n          if (loc)\n            this.options.stageAndDisplayEntry({\n              type: 'location',\n              sender: 'me',\n              content: loc,\n              id: `msg-${Date.now()}`,\n            });\n          this.options.togglePanel(null);\n        },\n      },\n      {\n        label: '',\n        icon: 'fas fa-envelope',\n        action: async () => {\n          const result = await this.dialogManager.showRedPacketDialog();\n          if (result) {\n            const giftData = {\n              name: '',\n              price: result.amount,\n              note: result.note,\n              status: 'sent' as const,\n            };\n            this.options.stageAndDisplayEntry({\n              type: 'gift',\n              sender: 'me',\n              content: safeJsonStringify(giftData),\n              data: giftData,\n              id: `msg-${Date.now()}`,\n            });\n            this.options.togglePanel(null);\n          }\n        },\n      },\n      {\n        label: '',\n        icon: 'fas fa-money-bill-wave',\n        action: async () => {\n          const result = await this.dialogManager.showTransferDialog();\n          if (result) {\n            const transferData = {\n              amount: result.amount,\n              note: result.note || ' ',\n              status: 'sent' as const,\n            };\n            this.options.stageAndDisplayEntry({\n              type: 'transfer',\n              sender: 'me',\n              content: safeJsonStringify(transferData),\n              data: transferData,\n              id: `msg-${Date.now()}`,\n            });\n            this.options.togglePanel(null);\n          }\n        },\n      },\n      {\n        label: '',\n        icon: 'fas fa-file-alt',\n        action: async () => {\n          const fileName = await this.dialogManager.prompt(':', '', '');\n          if (fileName)\n            this.options.stageAndDisplayEntry({\n              type: 'file',\n              sender: 'me',\n              content: fileName,\n              id: `msg-${Date.now()}`,\n            });\n          this.options.togglePanel(null);\n        },\n      },\n      {\n        label: '',\n        icon: 'fas fa-gift',\n        action: async () => {\n          const result = await this.dialogManager.showGiftDialog();\n          if (result) {\n            const giftData = {\n              name: result.name,\n              price: result.price,\n              status: 'sent' as const,\n            };\n            this.options.stageAndDisplayEntry({\n              type: 'gift',\n              sender: 'me',\n              content: safeJsonStringify(giftData),\n              data: giftData,\n              id: `msg-${Date.now()}`,\n            });\n            this.options.togglePanel(null);\n          }\n        },\n      },\n    ];\n\n    // uiRenderer\n    if (this.uiRenderer) {\n      // DOMjQuery\n      this.uiRenderer.renderFeatureGrid($plusGrid[0], PLUS_FEATURES, {\n        onToggleDeleteMode: () => {},\n        onAddStickers: () => {},\n      });\n    } else {\n      console.error('[BLMX] UIRenderer is not initialized');\n    }\n  }\n\n  private renderStickerFeatures(): void {\n    const $stickerGrid = $('#sticker-grid');\n    if (!$stickerGrid.length) return;\n\n    // \n    const defaultGlobalStickers = [{ label: '', url: 'https://files.catbox.moe/3j0tpc.jpeg' }];\n\n    //  - \n    const GLOBAL_STICKER_STORAGE_KEY = 'blmx_wechat_stickers_global_blmx';\n    const customStickers = SafeStorage.getItem(GLOBAL_STICKER_STORAGE_KEY, []) || [];\n    const allStickers = [...defaultGlobalStickers, ...customStickers];\n\n    // \n    const features = allStickers.map(s => ({\n      label: s.label,\n      icon: s.url,\n      isDefault: defaultGlobalStickers.some(ds => ds.label === s.label),\n      action: () => {\n        this.options.stageAndDisplayEntry({\n          type: 'sticker',\n          sender: 'me',\n          content: s.label,\n          id: `msg-${Date.now()}`,\n        });\n        this.options.togglePanel(null);\n      },\n    }));\n\n    // \"\"\n    features.unshift({\n      label: '',\n      icon: 'fas fa-cog', // \n      isAddBtn: true,\n      isDefault: false, // isDefault\n      action: () => {\n        this.showStickerManager();\n      },\n    } as {\n      label: string;\n      icon: string;\n      isAddBtn: boolean;\n      isDefault: boolean;\n      action: () => void;\n    });\n\n    // uiRenderer\n    if (this.uiRenderer) {\n      // DOMjQuery\n      this.uiRenderer.renderFeatureGrid($stickerGrid[0], features, {\n        onToggleDeleteMode: () => this.showStickerManager(),\n        onAddStickers: () => this.showStickerManager(),\n      });\n    } else {\n      console.error('[BLMX] UIRenderer is not initialized');\n    }\n  }\n\n  // \n  private showStickerManager(): void {\n    // \n    const modal = document.createElement('div');\n    modal.className = 'sticker-manager-modal';\n\n    // \n    const container = document.createElement('div');\n    container.className = 'sticker-manager-container';\n\n    // innerHTML\n    container.innerHTML = `\n      <h2></h2>\n      <div class=\"sticker-manager-tabs\">\n        <div class=\"tab-button active\" data-tab=\"add-sticker\"></div>\n        <div class=\"tab-button\" data-tab=\"batch-add\"></div>\n        <div class=\"tab-button\" data-tab=\"delete-manage\"></div>\n      </div>\n      <div class=\"sticker-manager-content\">\n        <!--  -->\n        <div class=\"tab-content active\" data-tab=\"add-sticker\">\n          <div class=\"add-sticker-section\">\n            <div class=\"add-sticker-form\">\n              <div class=\"form-group\">\n                <label for=\"sticker-label\"></label>\n                <input type=\"text\" id=\"sticker-label\" placeholder=\"/\">\n              </div>\n              <div class=\"form-group\">\n                <label for=\"sticker-url\">URL</label>\n                <input type=\"url\" id=\"sticker-url\" placeholder=\"URL\">\n              </div>\n              <div class=\"preview-container\">\n                <div class=\"preview-label\"></div>\n                <img id=\"preview-img\" class=\"preview-img\" style=\"display: none;\">\n              </div>\n              <button class=\"add-sticker-btn\"></button>\n            </div>\n          </div>\n        </div>\n\n        <!--  -->\n        <div class=\"tab-content\" data-tab=\"batch-add\">\n          <div class=\"batch-add-section\">\n            <div class=\"batch-instructions\">\n              <p></p>\n              <ul>\n                <li><strong>http://</strong></li>\n                <li><strong></strong></li>\n                <li> <strong>=http://</strong> </li>\n                <li><code>https://example.com/smile.jpg,https://example.com/cry.jpg</code></li>\n              </ul>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"batch-textarea\"></label>\n              <textarea id=\"batch-textarea\" placeholder=\"...\"></textarea>\n            </div>\n            <button class=\"batch-add-btn\"></button>\n          </div>\n        </div>\n\n        <!--  -->\n        <div class=\"tab-content\" data-tab=\"delete-manage\">\n          <div class=\"delete-manage-section\">\n            <div class=\"control-bar\">\n              <div class=\"selection-controls\">\n                <button class=\"select-all-btn\"></button>\n                <button class=\"deselect-all-btn\"></button>\n              </div>\n              <button class=\"delete-selected-btn\"></button>\n            </div>\n            <div class=\"sticker-list-container\">\n              <div class=\"sticker-grid\" id=\"delete-sticker-grid\">\n                <!--  -->\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class=\"sticker-manager-footer\">\n        <button class=\"dialog-button\"></button>\n      </div>\n    `;\n\n    // DOM\n    const tabButtons = container.querySelectorAll('.tab-button') as NodeListOf<HTMLElement>;\n    const tabContents = container.querySelectorAll('.tab-content') as NodeListOf<HTMLElement>;\n    const closeBtn = container.querySelector('.dialog-button') as HTMLButtonElement;\n\n    // \n    const labelInput = container.querySelector('#sticker-label') as HTMLInputElement;\n    const urlInput = container.querySelector('#sticker-url') as HTMLInputElement;\n    const previewImg = container.querySelector('#preview-img') as HTMLImageElement;\n    const addStickerBtn = container.querySelector('.add-sticker-btn') as HTMLButtonElement;\n\n    // \n    const batchTextarea = container.querySelector('#batch-textarea') as HTMLTextAreaElement;\n    const batchAddBtn = container.querySelector('.batch-add-btn') as HTMLButtonElement;\n\n    // \n    const selectAllBtn = container.querySelector('.select-all-btn') as HTMLButtonElement;\n    const deselectAllBtn = container.querySelector('.deselect-all-btn') as HTMLButtonElement;\n    const deleteSelectedBtn = container.querySelector('.delete-selected-btn') as HTMLButtonElement;\n    const deleteStickerGrid = container.querySelector('#delete-sticker-grid') as HTMLElement;\n\n    // \n    tabButtons.forEach(button => {\n      button.addEventListener('click', () => {\n        const targetTab = button.dataset.tab;\n\n        // \n        tabButtons.forEach(btn => btn.classList.remove('active'));\n        tabContents.forEach(content => content.classList.remove('active'));\n\n        // \n        button.classList.add('active');\n        const targetContent = container.querySelector(`.tab-content[data-tab=\"${targetTab}\"]`);\n        if (targetContent) {\n          targetContent.classList.add('active');\n        }\n\n        // \n        if (targetTab === 'delete-manage') {\n          renderDeleteStickerList();\n        }\n      });\n    });\n\n    // URL\n    urlInput.addEventListener('input', () => {\n      if (urlInput.value.trim()) {\n        previewImg.src = urlInput.value.trim();\n        previewImg.style.display = 'block';\n      } else {\n        previewImg.style.display = 'none';\n      }\n    });\n\n    // \n    addStickerBtn.addEventListener('click', () => {\n      const label = labelInput.value.trim();\n      const url = urlInput.value.trim();\n\n      if (!label || !url) {\n        alert('URL');\n        return;\n      }\n\n      const GLOBAL_STICKER_STORAGE_KEY = 'blmx_wechat_stickers_global_blmx';\n      const existingStickers = SafeStorage.getItem<any[]>(GLOBAL_STICKER_STORAGE_KEY, []) || [];\n\n      const newSticker = { label, url };\n      existingStickers.push(newSticker);\n\n      SafeStorage.setItem(GLOBAL_STICKER_STORAGE_KEY, existingStickers);\n      alert('');\n\n      // \n      labelInput.value = '';\n      urlInput.value = '';\n      previewImg.style.display = 'none';\n\n      // \n      this.renderStickerFeatures();\n    });\n\n    // \n    batchAddBtn.addEventListener('click', () => {\n      const input = batchTextarea.value.trim();\n      if (!input) {\n        alert('');\n        return;\n      }\n\n      const GLOBAL_STICKER_STORAGE_KEY = 'blmx_wechat_stickers_global_blmx';\n      const pairs = input.split(',');\n      const newStickers = [];\n\n      for (const pair of pairs) {\n        // URL - httphttps\n        const urlStartIndex = pair.indexOf('http');\n\n        if (urlStartIndex > 0) {\n          const label = pair.substring(0, urlStartIndex).trim();\n          const url = pair.substring(urlStartIndex).trim();\n\n          if (label && url) {\n            newStickers.push({ label, url });\n          }\n        } else if (pair.includes('=')) {\n          // label=url\n          const [label, url] = pair.split('=').map(part => part.trim());\n          if (label && url) {\n            newStickers.push({ label, url });\n          }\n        }\n      }\n\n      if (newStickers.length > 0) {\n        const existingStickers = SafeStorage.getItem<any[]>(GLOBAL_STICKER_STORAGE_KEY, []) || [];\n        const updatedStickers = [...existingStickers, ...newStickers];\n        SafeStorage.setItem(GLOBAL_STICKER_STORAGE_KEY, updatedStickers);\n        alert(`${newStickers.length} `);\n        batchTextarea.value = '';\n\n        // \n        this.renderStickerFeatures();\n      } else {\n        alert('');\n      }\n    });\n\n    // \n    const renderDeleteStickerList = () => {\n      const GLOBAL_STICKER_STORAGE_KEY = 'blmx_wechat_stickers_global_blmx';\n      const stickers = SafeStorage.getItem<any[]>(GLOBAL_STICKER_STORAGE_KEY, []) || [];\n\n      deleteStickerGrid.innerHTML = '';\n\n      if (stickers.length === 0) {\n        const noStickersMsg = document.createElement('div');\n        noStickersMsg.textContent = '\"\"';\n        noStickersMsg.className = 'no-stickers-msg';\n        deleteStickerGrid.appendChild(noStickersMsg);\n        return;\n      }\n\n      stickers.forEach((sticker: any, index: number) => {\n        const stickerItem = document.createElement('div');\n        stickerItem.className = 'sticker-item';\n\n        // checkbox\n        const checkbox = document.createElement('input');\n        checkbox.type = 'checkbox';\n        checkbox.className = 'sticker-checkbox';\n        checkbox.dataset.index = index.toString();\n\n        // checkbox\n        const checkboxButton = document.createElement('div');\n        checkboxButton.className = 'sticker-checkbox-button';\n\n        // \n        const stickerImg = document.createElement('img');\n        stickerImg.src = sticker.url;\n        stickerImg.alt = sticker.label;\n        stickerImg.className = 'sticker-preview';\n\n        const stickerLabel = document.createElement('div');\n        stickerLabel.className = 'sticker-label';\n        stickerLabel.textContent = sticker.label;\n\n        // checkbox\n        const updateCheckboxState = (checked: boolean) => {\n          if (checked) {\n            checkboxButton.classList.add('checked');\n          } else {\n            checkboxButton.classList.remove('checked');\n          }\n        };\n\n        // \n        const handleClick = (e: Event) => {\n          e.preventDefault();\n          e.stopPropagation();\n          checkbox.checked = !checkbox.checked;\n          updateCheckboxState(checkbox.checked);\n        };\n\n        stickerItem.addEventListener('click', handleClick);\n        checkboxButton.addEventListener('click', handleClick);\n\n        // \n        stickerItem.appendChild(checkbox);\n        stickerItem.appendChild(checkboxButton);\n        stickerItem.appendChild(stickerImg);\n        stickerItem.appendChild(stickerLabel);\n\n        deleteStickerGrid.appendChild(stickerItem);\n\n        // \n        updateCheckboxState(checkbox.checked);\n      });\n    };\n\n    // \n    selectAllBtn.addEventListener('click', () => {\n      const checkboxes = deleteStickerGrid.querySelectorAll('.sticker-checkbox') as NodeListOf<HTMLInputElement>;\n      const checkboxButtons = deleteStickerGrid.querySelectorAll('.sticker-checkbox-button');\n\n      checkboxes.forEach((checkbox, index) => {\n        checkbox.checked = true;\n        checkboxButtons[index]?.classList.add('checked');\n      });\n    });\n\n    // \n    deselectAllBtn.addEventListener('click', () => {\n      const checkboxes = deleteStickerGrid.querySelectorAll('.sticker-checkbox') as NodeListOf<HTMLInputElement>;\n      const checkboxButtons = deleteStickerGrid.querySelectorAll('.sticker-checkbox-button');\n\n      checkboxes.forEach((checkbox, index) => {\n        checkbox.checked = false;\n        checkboxButtons[index]?.classList.remove('checked');\n      });\n    });\n\n    // \n    deleteSelectedBtn.addEventListener('click', () => {\n      const checkboxes = deleteStickerGrid.querySelectorAll(\n        '.sticker-checkbox:checked',\n      ) as NodeListOf<HTMLInputElement>;\n\n      if (checkboxes.length === 0) {\n        alert('');\n        return;\n      }\n\n      if (confirm(` ${checkboxes.length} `)) {\n        const GLOBAL_STICKER_STORAGE_KEY = 'blmx_wechat_stickers_global_blmx';\n        const stickers = SafeStorage.getItem<any[]>(GLOBAL_STICKER_STORAGE_KEY, []) || [];\n\n        // \n        const indicesToDelete = (window as any)._.chain(checkboxes)\n          .map((checkbox: HTMLInputElement) => parseInt(checkbox.dataset.index!))\n          .sortBy()\n          .reverse()\n          .value();\n\n        // \n        indicesToDelete.forEach((index: number) => {\n          stickers.splice(index, 1);\n        });\n\n        SafeStorage.setItem(GLOBAL_STICKER_STORAGE_KEY, stickers);\n        alert(` ${checkboxes.length} `);\n\n        // \n        renderDeleteStickerList();\n\n        // \n        this.renderStickerFeatures();\n      }\n    });\n\n    // \n    closeBtn.addEventListener('click', () => {\n      document.body.removeChild(modal);\n    });\n\n    // \n    modal.addEventListener('click', e => {\n      if (e.target === modal) {\n        document.body.removeChild(modal);\n      }\n    });\n\n    modal.appendChild(container);\n    document.body.appendChild(modal);\n  }\n}\n"],"names":["LogLevel","DialogManager","static","activeDialog","activeOverlay","getInstance","instance","escapeHtml","text","$","html","safeShowDialog","dialogFunction","this","forceCleanupDialogs","createBaseDialogElements","dialogClass","addClass","appendDialogToPage","$phoneScreen","length","append","initializeCheckboxButtons","find","each","_","button","$button","$checkbox","checkbox","updateCheckboxButtonState","checked","on","e","preventDefault","stopPropagation","disabled","changeEvent","Event","bubbles","dispatchEvent","attr","role","tabindex","toString","toggleClass","alert","message","title","confirmText","showDialog","type","confirm","cancelText","prompt","defaultValue","inputType","placeholder","inputValue","inputPlaceholder","showScrollableText","content","Promise","resolve","innerHTML","$copyBtn","$confirmBtn","handleCancel","closeDialog","async","navigator","clipboard","writeText","originalText","setTimeout","error","console","$textElement","range","document","createRange","selectNodeContents","selection","window","getSelection","removeAllRanges","addRange","key","off","options","overlay","dialog","createDialogElements","$inputEl","trigger","confirmButton","querySelector","addEventListener","inputEl","value","undefined","cancelButton","target","handleKeyDown","removeEventListener","$overlay","$dialog","className","$header","$title","$body","$message","$inputContainer","$input","val","$footer","$cancelButton","$confirmButton","showCommentDialog","$cancelBtn","$likeBtn","$commentText","handleComment","css","ctrlKey","appendChild","showTransferDialog","$amountInput","$noteInput","handleConfirm","amount","note","parseFloat","toFixed","showRedPacketDialog","showGiftDialog","cancelBtn","confirmBtn","nameInput","priceInput","name","trim","price","showInputDialog","label","$inputField","showVoiceDialog","textArea","durationInput","durationStr","duration","parseInt","isNaN","showReceiveDialog","data","isGift","icon","rejectBtn","acceptBtn","handleAccept","showMomentDialog","defaultTime","currentDate","currentGameDate","Date","defaultDateTime","getFullYear","getMonth","padStart","getDate","getHours","getMinutes","imageTypeRadios","querySelectorAll","imageContentLabel","imageContentInput","urlDescGroup","forEach","radio","isDesc","textContent","style","display","imageTypeInput","imageContentField","imageDescField","datetimeInput","imageContent","imageType","imageDesc","datetime","datetimeMatch","match","image","image_type","image_desc","date","time","$textArea","showTimeJumpDialog","descriptionInput","description","$timeInput","$container","selector","element","remove","warn","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","d","definition","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","DebugLogger","isDevelopment","logLevel","logHistory","maxHistorySize","checkDevelopmentMode","DEBUG","ERROR","BLMX_DEV_MODE","localStorage","getItem","location","hostname","search","includes","setLogLevel","level","setDevelopmentMode","enabled","setItem","removeItem","addToHistory","push","timestamp","shift","formatMessage","toISOString","substr","debug","log","info","INFO","WARN","timeStart","timeEnd","groupStart","group","groupEnd","getHistory","filterModule","filterLevel","filtered","filter","clearHistory","exportHistory","JSON","stringify","showDebugPanel","slice","levelIcon","getStatus","historyCount","blmxLogger","EventManager","listeners","timers","Set","intervals","isDestroyed","addGlobalListener","event","handler","cleanup","eventOn","addDOMListener","callback","delay","timerId","delete","add","setInterval","interval","intervalId","clearTimeout","has","clearInterval","clear","listenersCount","timersCount","size","intervalsCount","isDestroyed_","globalEventManager","getTavernHelper","parent","TavernHelper","BLMX_Protocol","logEntries","messageId","charId","LOG_START_TAG","LOG_END_TAG","constructor","getCharId","initialize","lastMessageId","getLastMessageId","persistLogToStorage","latestUiMessage","previousUiMessages","i","msg","getChatMessages","id","consolidatedLogParts","latestLogStartIndex","indexOf","latestLogEndIndex","logPart","prevMsg","prevLogStartIndex","prevLogEndIndex","unshift","cleanedContent","substring","setChatMessage","refresh","finalLogString","join","_parseLogFromString","logString","_renderLogToString","existingMessage","existingContent","logStartIndex","logEndIndex","newLogBlock","fullText","split","line","separatorIndex","parse","now","String","newEntry","timeDate","getTime","timeElement","getElementById","timeString","recallData","senderToFind","sender","targetText","target_text","entryToRecall","reverse","normalizeText","replace","toLowerCase","voiceText","err","recalled","recalled_content","recalled_timestamp","recall_data","Math","random","voiceMatch","voiceData","stickerMatch","imageMatch","imgData","locationMatch","transferMatch","fileMatch","giftMatch","recallCommands","map","prefix","Boolean","addEntry","entry","some","existingEntry","entryData","existingData","target_post_id","isEqual","getContextForAI","safeJsonParse","jsonString","safeJsonStringify","SafeStorage","item","serialized","AiResponseManager","blmxManager","uiRenderer","eventHandler","momentsManager","eventManager","isGenerating","latestAiRawResponse","latestSentPrompt","rawAiResponse","fullPrompt","event_data","chat","promptLength","getIsGenerating","triggerAiResponse","_immediate","BLMX_PROCESSING_AI_RESPONSE","contextForAI","isNewForAI","setHasPendingNotifications","MAX_RETRIES","attempt","success","maxRetries","showGeneratingIndicator","stream","generate","user_input","should_stream","finalAiResponse","chunk","hideGeneratingIndicator","processedResponse","len","firstHalf","lines","uniqueLines","uniq","processAiResponse","showErrorMessage","refreshAllTimestamps","response","entriesForAnimation","hasNewCharMoments","responseLines","lineCount","valuePreview","valueLength","renderMomentsFeed","parsedMessageContent","parsedImageData","url","parsedStickerContent","originalEntry","recallTimestamp","displayAiEntriesSequentially","hasClass","setLastMomentViewTimestamp","setMomentNotification","$errorDiv","entries","messageLikeTypes","entryIndex","findIndex","entryType","showTypingIndicator","messageText","calculateTypingDelay","hideTypingIndicator","renderEntry","entryToUpdate","recallEntryIndex","$elementToReplace","renderRecallNotice","getLatestAiRawResponse","getLatestSentPrompt","getRawAiResponse","getFullPrompt","STORAGE_KEYS","ConfigManager","config","defaultGlobalStickers","avatars","user","char","names","charRemark","currentCharId","getConfig","setConfig","getDisplayName","updateAvatar","avatarType","newUrl","storageKey","updateCharRemark","newRemark","updateUserName","newName","findStickerUrlByName","customGlobalStickers","charStickers","oldGlobalStickers","oldCharStickers","globalStickers","s","loadFromStorage","charData","savedCharAvatar","getMomentNotificationState","setMomentNotificationState","getLastMomentViewTimestamp","lastView","getSavedCoverPhoto","setCoverPhoto","getSavedSignature","setSignature","signature","getSavedInputPlaceholder","setInputPlaceholder","getPhoneSize","savedSize","setPhoneSize","getFullscreenSize","max","min","setFullscreenSize","clampedSize","getStickerSize","setStickerSize","getLastNotifiedVersion","setLastNotifiedVersion","version","getCurrentDate","getCurrentTime","floor","debugData","status","InputHandler","configManager","onStageAndDisplayEntry","onUpdateFooterButtonsState","dialogManager","handleTransferAccept","result","acceptData","rejectData","handleGiftAction","receiptData","sendTextMessage","messageEntry","sendSticker","stickerName","stickerEntry","sendImage","imageData","imageEntry","sendVoiceMessage","voiceEntry","sendLocation","locationData","locationEntry","sendFile","fileData","fileEntry","sendTransfer","transferData","transferEntry","sendGift","giftData","giftEntry","handleFileUpload","file","startsWith","reader","FileReader","onload","readAsDataURL","handleImageUrl","URL","handleVoiceRecording","mediaDevices","getUserMedia","audio","getTracks","track","stop","handleLocationShare","geolocation","getCurrentPosition","position","latitude","longitude","coords","locationName","address","handleTransferSend","amountStr","handleGiftSend","giftName","giftImage","getStickerList","searchStickers","query","stickers","searchTerm","sticker","clearInput","inputElement","focusInput","focus","getInputText","setInputText","MomentsManager","hasMomentNotification","$momentsFeedList","isInMomentsView","empty","posts","momentPostLogIndices","reduce","index","logIndex","likes","comments","lastViewTimestamp","userInMomentsView","targetPostAbsoluteIndex","targetPost","likerName","l","originalLogIndex","keys","chain","values","post","fromUser","authorName","authorAvatar","$li","momentSequenceId","mediaHtml","interactionsHtml","c","displayTime","formatMomentTime","savedCoverPhoto","dateString","diffMs","diffMins","diffHours","diffDays","month","hasMomentNotifications","updateMomentNotificationIndicator","$optionsBtn","currentLogLength","onEnterMomentsView","savedSignature","createUserMoment","notifyMomentChange","_oldValue","newValue","momentEntry","notifyRecallViaMoments","recallEntry","ThemeEditor","themeManager","onThemeChanged","$modal","checkboxHandlers","Map","setupThemeSelector","themes","getThemes","theme","$themeButton","width","colors","primary","cursor","overflow","$previewEl","top","left","height","background","gradientStart","gradientEnd","$bubblePreview","$themBubble","bubbleThemBg","$meBubble","bubbleMeBg","$nameEl","displayName","color","switchTheme","addCustomThemeSelector","addCustomThemeEditButton","$settingsPanel","$editButton","padding","margin","transition","gap","$icon","$text","openThemeEditor","$themeOptions","after","customThemeData","getCustomThemeData","$customButton","gradient","$iconEl","customThemeJson","customTheme","primaryColor","updateCustomThemeButton","children","eq","last","currentTheme","getCurrentThemeWithAppliedValues","fillThemeEditor","setupCheckboxes","show","closeThemeEditor","hide","cleanupCheckboxes","$nameInput","$darkModeToggle","$singleColorIconsToggle","themeName","colorMappings","phoneFrame","light","ultraLight","deep","textPrimary","textSecondary","bubbleMeText","bubbleThemText","statusBarColor","dynamicIslandColor","borderColor","shadowColor","colorValue","convertToHex","isDarkMode","useSingleColorIcons","setupSingleCheckboxWithJQuery","checkboxId","buttonId","updateCheckboxState","handleClick","set","resetThemeEditor","blueTheme","blue","exportThemeAsJSON","getCurrentThemeFromEditor","wallpaperManager","getWallpaperManager","currentWallpapers","getCurrentWallpaper","home","settings","themeData","exportDate","wallpapers","blob","Blob","createObjectURL","fileName","$a","href","download","click","revokeObjectURL","importTheme","input","createElement","accept","files","endsWith","Error","validateThemeData","applyImportedTheme","readAsText","getValue","getChecked","createCustomTheme","appBgColor","settingsBgColor","settingsCardBgColor","statusBar","dynamicIsland","border","shadow","saveCustomTheme","params","r","g","b","shadowColorRgba","bubbleShadow","lightenDarkenColor","soft","headerBg","phoneFrameGradient","textColor","defaultWallpapers","col","amt","usePound","num","rgbMatch","rgbaMatch","requiredFields","field","requiredColors","applyImportedWallpapers","viewType","wallpaper","setWallpaper","APP_VERSION","THEMES","pink","white","dark","ThemeManager","checkVersion","savedThemeName","THEME_STORAGE_KEY","CUSTOM_THEME_STORAGE_KEY","WallpaperManager","applyTheme","savedVersion","VERSION_STORAGE_KEY","cleanOutdatedData","keysToPreserve","preservedData","getCurrentTheme","root","documentElement","computedStyle","getComputedStyle","actualValues","getPropertyValue","setCurrentThemeName","applyThemeDefaultWallpapers","setProperty","body","classList","lighterColor","darkerColor","shadowRGB","extractRgbComponents","gradientColors","phoneFrameStyle","head","statusLeft","statusRight","settingsView","backgroundColor","card","boxShadow","hexToRgba","oldDynamicStyles","hex","alpha","currentThemeName","builtInWallpapers","customWallpapers","loadCustomWallpapers","migrateOldWallpaperSettings","getAllWallpapers","getBuiltInWallpapers","getCustomWallpapers","addCustomWallpaper","newWallpaper","saveCustomWallpapers","deleteCustomWallpaper","initialLength","w","THEME_WALLPAPER_KEY_PREFIX","themeStorageKey","savedThemeWallpaper","oldStorageKey","WALLPAPER_STORAGE_KEY_PREFIX","savedOldWallpaper","applyWallpaperToElement","defaultThemeWallpaper","backgroundImage","backgroundSize","backgroundPosition","backgroundRepeat","createWallpaperFromUrl","toLocaleString","createWallpaperFromFile","onerror","createSolidColorWallpaper","normalizedColor","savedWallpapers","CUSTOM_WALLPAPERS_KEY","UIManager","onAddEntry","onRenderEntry","displayAppVersion","checkVersionUpdateNotification","showVersionUpdateNotification","updateEntry","isSystemMessage","updateFooterButtonsState","hasNotifications","$wechatInput","$sendBtn","$plusBtn","hasText","shouldShowSendBtn","togglePanel","panelToShow","$panelContainer","$currentActivePanel","isActive","removeClass","navigateTo","viewName","wechat","moments","setupInputPlaceholder","charDisplayName","savedPlaceholder","$inputElement","setupPhoneSizeAdjustment","defaultBtn","mediumBtn","smallBtn","phoneScreen","applyPhoneSize","setupStickerSizeControl","sizeSlider","sizeInput","smallSizeBtn","mediumSizeBtn","applyStickerSize","newSize","updateStickerSizeButtonState","newSizeStr","buttons","default","medium","small","btn","scrollToBottom","wechatBody","scrollTop","scrollHeight","setupFontSelection","$customFontBtn","$systemFontBtn","savedFont","applyFontSetting","fontType","$customBtn","$systemBtn","applyCustomFont","applySystemFont","isIOSWebView","test","userAgent","isHuaweiWebView","fontStack","checkFontLoaded","then","loaded","loadCustomFont","catch","fontFamily","fonts","ready","fontFace","Array","from","font","family","reject","testElement","fontSize","visibility","appendTo","FontFace","load","loadedFace","setupFullscreenSizeAdjustment","$defaultBtn","$largeBtn","$xlargeBtn","$slider","initializeFullscreenSizeControls","applyFullscreenSize","updateFullscreenSizeButtonState","setupFullscreenListener","handleFullscreenChange","fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement","currentSize","applyBrowserLikeZoom","resetBrowserZoom","transform","transformOrigin","scale","UIRenderer","lastDisplayedTimeInMinutes","Infinity","renderQueue","isRendering","renderThrottle","wechatBodySelector","$wechatBody","startRenderLoop","processQueue","splice","queueRender","clearChat","animate","renderSystemMessage","addMessageToWeChat","addTimestampToWeChat","addEventLogToWeChat","elementToReplace","who","noticeRow","dataset","recalledText","noticeTextEl","contentEl","toggle","replaceWith","momentsFeedList","li","postId","momentId","formatMomentTimestamp","deleteBtnHtml","indicator","avatarSrc","loadingContainer","messageContent","totalDelay","isNewMessage","messageRow","senderClass","avatarImgHtml","renderVoiceMessage","bubbleContent","renderStickerContent","renderImageContent","renderLocationContent","renderTransferContent","renderFileContent","renderRedEnvelopeContent","renderGiftContent","bubbleClass","bubble","applyBubbleStyles","setupBubbleInteractions","setupUserMessageLongPress","contentContainer","textRevealBox","insertAdjacentHTML","longPressFired","pressTimer","pointerType","contains","stickerUrl","imageUrl","storedImage","sessionStorage","descText","isReceipt","detailsHtml","detailsClass","detailsContent","cardClass","bubbleTypeMap","transfer","gift","transferCard","onTransferAccept","once","giftBubble","giftCard","onGiftAction","isSystemTime","timeText","timeInMinutes","parseTimeToMinutes","t","originalDate","originalTime","eventData","row","timeEl","descEl","chatContainer","systemRow","systemContainer","systemText","postDate","postYear","postMonth","postDay","nowYear","nowMonth","nowDay","yesterday","setDate","yesterdayYear","yesterdayMonth","yesterdayDay","timestampRows","eventLogRows","$row","$timestampText","$eventTimeText","renderFeatureGrid","gridElement","features","callbacks","isDeleteMode","feature","iconHtml","isAddBtn","iconContainer","isDefault","onAddStickers","onToggleDeleteMode","action","stickerLabel","checkboxButton","$messageRow","$messageBubble","$targetElement","addLongPressListener","handleLongPressRecall","setupDoubleClickRecall","timer","startX","startY","onEnd","clientX","clientY","moveX","moveY","abs","isMessageInQueue","handleUserMessageRecall","effect","times","distance","onRecallMessage","clickTimer","clickCount","vibrate","handleDoubleClickRecall","WallpaperSelector","showWallpaperSelector","onApplyWallpaper","modal","cssText","container","tabs","createTabs","createBuiltinWallpaperTab","createSolidColorTab","createCustomWallpaperTab","createUploadTab","createBottomButtons","createTab","tab","tabId","fontWeight","borderBottom","builtinContent","builtinWallpapers","builtinGrid","wallpaperItem","createWallpaperItem","solidContent","solidWallpapers","solidGrid","addColorPicker","customContent","noCustomWallpapers","customGrid","uploadContent","createLocalUploadSection","createUrlUploadSection","colorPickerContainer","colorPickerLabel","colorPicker","colorNameInput","addColorBtn","removeChild","localUploadSection","localUploadTitle","fileInput","uploadBtn","urlUploadSection","urlUploadTitle","urlInput","addUrlBtn","showDeleteButton","preview","deleteBtn","currentWallpaper","parentElement","buttonsContainer","resetBtn","closeBtn","WallpaperController","wallpaperSelector","applyWallpapers","$chatView","$homeScreen","$settingsView","chatWallpaper","homeWallpaper","settingsWallpaper","changeWallpaper","initializeWallpapers","AppController","wallpaperController","aiResponseManager","themeEditor","inputHandler","uiManager","userMessageQueue","getCharData","charAvatarPath","getCharAvatarPath","addBatch","requestAnimationFrame","loadDebugData","EventHandler","EventHandlerClass","bind","stageAndDisplayEntry","renderChatHistory","handleMessageRecall","setUIRenderer","queueIndex","actualIndex","globalIndex","immediate","hasQueuedMessages","views","jQuery","$targetView","currentUrl","showUserProfileDialog","currentAvatarUrl","currentSignature","dialogHtml","newAvatarUrl","newSignature","hasChanges","oldDisplayName","newDisplayName","oldName","updateCoverPhoto","currentCover","newCover","removeFromUserMessageQueue","queueEntry","targetEntry","setupThemeEditorEvents","addTestEntry","clearDebugData","showTestEntryTypes","showDebugInfo","appController","StyleManager","loadedStyles","initializeStyles","isStyleLoaded","styleName","toggleTheme","setCSSVariable","getCSSVariable","setCSSVariables","variables","resetCSSVariables","propertiesToRemove","property","removeProperty","addStyleClass","removeStyleClass","toggleStyleClass","hasStyleClass","stylesLoaded","styleManager","wechatInput","sendBtn","plusBtn","hasPendingNotifications","inputSelector","sendBtnSelector","plusBtnSelector","setupEventListeners","promptForDateTime","defaultText","dateTimeInput","newDate","newTime","parsedDate","$timeElement","formattedTime","dateTimeResult","renderStickerFeatures","renderPlusFeatures","shiftKey","setupClickListeners","currentPlaceholder","newPlaceholder","wechatView","momentData","momentDateTime","timeAdvanceEvent","postEl","closest","actualMomentIndex","indicesToDelete","sort","a","likeEntry","commentEntry","matches","$targetRow","indexToDelete","previewText","mainLogLength","exitFullscreen","requestFullscreen","$plusGrid","PLUS_FEATURES","desc","timeJumpData","loc","$stickerGrid","customStickers","ds","showStickerManager","tabButtons","tabContents","labelInput","previewImg","addStickerBtn","batchTextarea","batchAddBtn","selectAllBtn","deselectAllBtn","deleteSelectedBtn","deleteStickerGrid","targetTab","targetContent","renderDeleteStickerList","src","GLOBAL_STICKER_STORAGE_KEY","existingStickers","newSticker","pairs","newStickers","pair","urlStartIndex","part","updatedStickers","noStickersMsg","stickerItem","stickerImg","alt","checkboxes","checkboxButtons","sortBy","blmxApp","blmxStyleManager"],"sourceRoot":""}