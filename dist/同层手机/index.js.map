{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/src//debug-logger.ts","src://tavern_helper_template/src//dialog-manager.ts","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/src//event-manager.ts","src://tavern_helper_template/src//script.ts","src://tavern_helper_template/src//utils.ts","src://tavern_helper_template/src//ai-response-manager.ts","src://tavern_helper_template/src//config-manager.ts","src://tavern_helper_template/src//debug-data.ts","src://tavern_helper_template/src//input-handler.ts","src://tavern_helper_template/src//moments-manager.ts","src://tavern_helper_template/src//theme-editor.ts","src://tavern_helper_template/src//theme-manager.ts","src://tavern_helper_template/src//ui-manager.ts","src://tavern_helper_template/src//ui-renderer.ts","src://tavern_helper_template/src//wallpaper-selector.ts","src://tavern_helper_template/src//wallpaper-controller.ts","src://tavern_helper_template/src//app-controller.ts","src://tavern_helper_template/src//style-manager.ts","src://tavern_helper_template/src//wechat-home.ts","src://tavern_helper_template/src//index.ts","src://tavern_helper_template/src//event-handler.ts"],"sourcesContent":["/**\n * \n *  console.log \n */\n\nexport enum LogLevel {\n  DEBUG = 0,\n  INFO = 1,\n  WARN = 2,\n  ERROR = 3,\n}\n\nexport class DebugLogger {\n  private static instance: DebugLogger;\n  private isDevelopment: boolean;\n  private logLevel: LogLevel;\n  private logHistory: Array<{ timestamp: Date; level: LogLevel; module: string; message: string; data?: any }> = [];\n  private maxHistorySize: number = 1000;\n\n  private constructor() {\n    // \n    this.isDevelopment = this.checkDevelopmentMode();\n    this.logLevel = this.isDevelopment ? LogLevel.DEBUG : LogLevel.ERROR;\n  }\n\n  static getInstance(): DebugLogger {\n    if (!DebugLogger.instance) {\n      DebugLogger.instance = new DebugLogger();\n    }\n    return DebugLogger.instance;\n  }\n\n  /**\n   * \n   */\n  private checkDevelopmentMode(): boolean {\n    // \n    return !!(\n      (window as any).BLMX_DEV_MODE ||\n      (window as any).DEBUG ||\n      localStorage.getItem('blmx_debug') === 'true' ||\n      location.hostname === 'localhost' ||\n      location.hostname === '127.0.0.1' ||\n      location.search.includes('debug=true')\n    );\n  }\n\n  /**\n   * \n   */\n  setLogLevel(level: LogLevel): void {\n    this.logLevel = level;\n  }\n\n  /**\n   * /\n   */\n  setDevelopmentMode(enabled: boolean): void {\n    this.isDevelopment = enabled;\n    if (enabled) {\n      localStorage.setItem('blmx_debug', 'true');\n    } else {\n      localStorage.removeItem('blmx_debug');\n    }\n  }\n\n  /**\n   * \n   */\n  private addToHistory(level: LogLevel, module: string, message: string, data?: any): void {\n    this.logHistory.push({\n      timestamp: new Date(),\n      level,\n      module,\n      message,\n      data,\n    });\n\n    // \n    if (this.logHistory.length > this.maxHistorySize) {\n      this.logHistory.shift();\n    }\n  }\n\n  /**\n   * \n   */\n  private formatMessage(module: string, message: string): string {\n    const timestamp = new Date().toISOString().substr(11, 12);\n    return `[${timestamp}] [BLMX:${module}] ${message}`;\n  }\n\n  /**\n   * \n   */\n  debug(module: string, message: string, data?: any): void {\n    if (this.logLevel <= LogLevel.DEBUG && this.isDevelopment) {\n      console.log(this.formatMessage(module, message), data || '');\n      this.addToHistory(LogLevel.DEBUG, module, message, data);\n    }\n  }\n\n  /**\n   * \n   */\n  info(module: string, message: string, data?: any): void {\n    if (this.logLevel <= LogLevel.INFO && this.isDevelopment) {\n      console.info(this.formatMessage(module, message), data || '');\n      this.addToHistory(LogLevel.INFO, module, message, data);\n    }\n  }\n\n  /**\n   * \n   */\n  warn(module: string, message: string, data?: any): void {\n    if (this.logLevel <= LogLevel.WARN) {\n      console.warn(this.formatMessage(module, message), data || '');\n      this.addToHistory(LogLevel.WARN, module, message, data);\n    }\n  }\n\n  /**\n   * \n   */\n  error(module: string, message: string, data?: any): void {\n    console.error(this.formatMessage(module, message), data || '');\n    this.addToHistory(LogLevel.ERROR, module, message, data);\n  }\n\n  /**\n   * \n   */\n  timeStart(module: string, label: string): void {\n    if (this.isDevelopment) {\n      console.time(this.formatMessage(module, label));\n    }\n  }\n\n  /**\n   * \n   */\n  timeEnd(module: string, label: string): void {\n    if (this.isDevelopment) {\n      console.timeEnd(this.formatMessage(module, label));\n    }\n  }\n\n  /**\n   * \n   */\n  groupStart(module: string, title: string): void {\n    if (this.isDevelopment) {\n      console.group(this.formatMessage(module, title));\n    }\n  }\n\n  /**\n   * \n   */\n  groupEnd(): void {\n    if (this.isDevelopment) {\n      console.groupEnd();\n    }\n  }\n\n  /**\n   * \n   */\n  getHistory(filterModule?: string, filterLevel?: LogLevel): typeof this.logHistory {\n    let filtered = this.logHistory;\n\n    if (filterModule) {\n      filtered = filtered.filter(log => log.module === filterModule);\n    }\n\n    if (filterLevel !== undefined) {\n      filtered = filtered.filter(log => log.level >= filterLevel);\n    }\n\n    return filtered;\n  }\n\n  /**\n   * \n   */\n  clearHistory(): void {\n    this.logHistory = [];\n  }\n\n  /**\n   * JSON\n   */\n  exportHistory(): string {\n    return JSON.stringify(this.logHistory, null, 2);\n  }\n\n  /**\n   * \n   */\n  showDebugPanel(): void {\n    if (!this.isDevelopment) {\n      console.warn('');\n      return;\n    }\n\n    console.group(' BLMX ');\n    console.log(':', this.isDevelopment);\n    console.log(':', LogLevel[this.logLevel]);\n    console.log(':', this.logHistory.length);\n    \n    if (this.logHistory.length > 0) {\n      console.log(':');\n      this.logHistory.slice(-10).forEach(log => {\n        const levelIcon = ['', '', '', ''][log.level];\n        console.log(`${levelIcon} [${log.module}] ${log.message}`, log.data || '');\n      });\n    }\n    \n    console.groupEnd();\n  }\n\n  /**\n   * \n   */\n  getStatus(): {\n    isDevelopment: boolean;\n    logLevel: string;\n    historyCount: number;\n  } {\n    return {\n      isDevelopment: this.isDevelopment,\n      logLevel: LogLevel[this.logLevel],\n      historyCount: this.logHistory.length,\n    };\n  }\n}\n\n// \nexport const logger = DebugLogger.getInstance();\n\n// \nif (typeof window !== 'undefined' && logger.getStatus().isDevelopment) {\n  (window as any).blmxLogger = logger;\n}\n","/**\n * \n * alertconfirmprompt\n */\n\n// \ntype DialogType = 'alert' | 'confirm' | 'prompt';\n\n// \ninterface DialogOptions {\n  title?: string;\n  message: string;\n  type: DialogType;\n  inputType?: string;\n  inputPlaceholder?: string;\n  inputValue?: string;\n  confirmText?: string;\n  cancelText?: string;\n  className?: string;\n}\n\nexport class DialogManager {\n  private static instance: DialogManager;\n  private activeDialog: HTMLElement | null = null;\n  private activeOverlay: HTMLElement | null = null;\n\n  private constructor() {\n    // \n  }\n\n  /**\n   * \n   */\n  public static getInstance(): DialogManager {\n    if (!DialogManager.instance) {\n      DialogManager.instance = new DialogManager();\n    }\n    return DialogManager.instance;\n  }\n\n  /**\n   * HTML\n   */\n  private escapeHtml(text: string): string {\n    return $('<div>').text(text).html();\n  }\n\n  /**\n   *  - \n   */\n  private async safeShowDialog<T>(dialogFunction: () => Promise<T>): Promise<T> {\n    // \n    this.forceCleanupDialogs();\n\n    return await dialogFunction();\n  }\n\n  /**\n   * \n   */\n  private createBaseDialogElements(dialogClass: string): void {\n    this.activeOverlay = $('<div>').addClass('dialog-overlay mobile-dialog-overlay')[0] as HTMLElement;\n    this.activeDialog = $('<div>').addClass(`dialog ${dialogClass} mobile-dialog`)[0] as HTMLElement;\n  }\n\n  /**\n   * \n   */\n  private appendDialogToPage(): void {\n    if (!this.activeOverlay) return;\n\n    const $phoneScreen = $('.phone-screen');\n    if ($phoneScreen.length) {\n      $phoneScreen.append(this.activeOverlay);\n    } else {\n      // body\n      $('body').append(this.activeOverlay);\n    }\n  }\n\n  /**\n   * checkbox\n   */\n  private initializeCheckboxButtons(): void {\n    if (!this.activeDialog) return;\n\n    $(this.activeDialog)\n      .find('.checkbox-button')\n      .each((_, button) => {\n        const $button = $(button);\n        const $checkbox = $button.find('input[type=\"checkbox\"]');\n        if (!$checkbox.length) return;\n\n        const checkbox = $checkbox[0] as HTMLInputElement;\n\n        // \n        this.updateCheckboxButtonState(button as HTMLElement, checkbox.checked);\n\n        // \n        $button.on('click', e => {\n          e.preventDefault();\n          e.stopPropagation();\n\n          if (checkbox.disabled) return;\n\n          // \n          checkbox.checked = !checkbox.checked;\n          this.updateCheckboxButtonState(button as HTMLElement, checkbox.checked);\n\n          // change - \n          const changeEvent = new Event('change', { bubbles: true });\n          checkbox.dispatchEvent(changeEvent);\n        });\n\n        // \n        $checkbox.on('change', () => {\n          this.updateCheckboxButtonState(button as HTMLElement, checkbox.checked);\n        });\n\n        // \n        $button.attr({\n          role: 'checkbox',\n          tabindex: '0',\n          'aria-checked': checkbox.checked.toString(),\n        });\n      });\n  }\n\n  /**\n   * checkbox\n   */\n  private updateCheckboxButtonState(button: HTMLElement, checked: boolean): void {\n    const $button = $(button);\n    $button.toggleClass('checked', checked);\n    $button.attr('aria-checked', checked.toString());\n  }\n\n  /**\n   * alert\n   */\n  public alert(message: string, title = '', confirmText = ''): Promise<void> {\n    return this.safeShowDialog(() =>\n      this.showDialog({\n        type: 'alert',\n        title,\n        message,\n        confirmText,\n      }),\n    );\n  }\n\n  /**\n   * confirm\n   */\n  public confirm(message: string, title = '', confirmText = '', cancelText = ''): Promise<boolean> {\n    return this.safeShowDialog(\n      () =>\n        this.showDialog({\n          type: 'confirm',\n          title,\n          message,\n          confirmText,\n          cancelText,\n        }) as Promise<boolean>,\n    );\n  }\n\n  /**\n   * prompt\n   */\n  public prompt(\n    message: string,\n    defaultValue = '',\n    title = '',\n    confirmText = '',\n    cancelText = '',\n    inputType = 'text',\n    placeholder = '',\n  ): Promise<string | null> {\n    return this.safeShowDialog(\n      () =>\n        this.showDialog({\n          type: 'prompt',\n          title,\n          message,\n          confirmText,\n          cancelText,\n          inputType,\n          inputValue: defaultValue,\n          inputPlaceholder: placeholder,\n        }) as Promise<string | null>,\n    );\n  }\n\n  /**\n   * \n   */\n  public showScrollableText(content: string, title = '', confirmText = ''): Promise<void> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('scrollable-text-dialog');\n\n          // \n          this.activeDialog!.innerHTML = `\n          <div class=\"dialog-header\">\n            <h3>${title}</h3>\n          </div>\n          <div class=\"dialog-body scrollable-content\">\n            <pre class=\"scrollable-text\">${this.escapeHtml(content)}</pre>\n          </div>\n          <div class=\"dialog-footer\">\n            <button class=\"dialog-button copy-btn\"></button>\n            <button class=\"dialog-button primary-button\">${confirmText}</button>\n          </div>\n        `;\n\n          const $copyBtn = $(this.activeDialog!).find('.copy-btn');\n          const $confirmBtn = $(this.activeDialog!).find('.primary-button');\n\n          const handleCopy = async () => {\n            try {\n              await navigator.clipboard.writeText(content);\n              // \n              const originalText = $copyBtn.text();\n              $copyBtn.text('');\n              setTimeout(() => {\n                $copyBtn.text(originalText);\n              }, 1000);\n            } catch (error) {\n              console.error(':', error);\n              // \n              const $textElement = $(this.activeDialog!).find('.scrollable-text');\n              if ($textElement.length) {\n                const range = document.createRange();\n                range.selectNodeContents($textElement[0]);\n                const selection = window.getSelection();\n                if (selection) {\n                  selection.removeAllRanges();\n                  selection.addRange(range);\n                }\n              }\n            }\n          };\n\n          const handleConfirm = () => {\n            this.closeDialog();\n            resolve();\n          };\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve();\n          };\n\n          $copyBtn.on('click', handleCopy);\n          $confirmBtn.on('click', handleConfirm);\n\n          // ESC\n          $(document).on('keydown.dialog', (e: any) => {\n            if (e.key === 'Escape') {\n              handleCancel();\n              $(document).off('keydown.dialog');\n            }\n          });\n\n          // \n          $(this.activeOverlay!).append(this.activeDialog!);\n          this.appendDialogToPage();\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  private showDialog(options: DialogOptions): Promise<any> {\n    // \n    const { overlay, dialog } = this.createDialogElements(options);\n\n    // \n    this.activeOverlay = overlay;\n    this.activeDialog = dialog;\n\n    // \n    this.appendDialogToPage();\n\n    // \n    if (options.type === 'prompt') {\n      const $inputEl = $(dialog).find('input, textarea');\n      if ($inputEl.length) {\n        setTimeout(() => $inputEl.trigger('focus'), 100);\n      }\n    }\n\n    return new Promise(resolve => {\n      // \n      const confirmButton = dialog.querySelector('.primary-button');\n      if (confirmButton) {\n        confirmButton.addEventListener('click', () => {\n          if (options.type === 'prompt') {\n            const inputEl = dialog.querySelector('input, textarea') as HTMLInputElement;\n            const value = inputEl ? inputEl.value : null;\n            this.closeDialog();\n            resolve(value);\n          } else {\n            this.closeDialog();\n            resolve(options.type === 'confirm' ? true : undefined);\n          }\n        });\n      }\n\n      // \n      const cancelButton = dialog.querySelector('.cancel-button');\n      if (cancelButton) {\n        cancelButton.addEventListener('click', () => {\n          this.closeDialog();\n          resolve(options.type === 'prompt' ? null : false);\n        });\n      }\n\n      // alert\n      if (options.type === 'alert') {\n        overlay.addEventListener('click', e => {\n          if (e.target === overlay) {\n            this.closeDialog();\n            resolve(undefined);\n          }\n        });\n      }\n\n      // \n      const handleKeyDown = (e: KeyboardEvent) => {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          if (options.type === 'prompt') {\n            const inputEl = dialog.querySelector('input, textarea') as HTMLInputElement;\n            const value = inputEl ? inputEl.value : null;\n            this.closeDialog();\n            resolve(value);\n          } else if (options.type === 'confirm') {\n            this.closeDialog();\n            resolve(true);\n          } else {\n            // alert\n            this.closeDialog();\n            resolve(undefined);\n          }\n          document.removeEventListener('keydown', handleKeyDown);\n        } else if (e.key === 'Escape') {\n          e.preventDefault();\n          this.closeDialog();\n          resolve(options.type === 'prompt' ? null : false);\n          document.removeEventListener('keydown', handleKeyDown);\n        }\n      };\n      document.addEventListener('keydown', handleKeyDown);\n    });\n  }\n\n  /**\n   * \n   */\n  private createDialogElements(options: DialogOptions): { overlay: HTMLElement; dialog: HTMLElement } {\n    // \n    const $overlay = $('<div>').addClass('custom-dialog-overlay');\n\n    // \n    const $dialog = $('<div>').addClass(`custom-dialog ${options.className || ''}`);\n\n    // \n    const $header = $('<div>').addClass('dialog-header');\n    const $title = $('<h3>')\n      .addClass('dialog-title')\n      .text(options.title || '');\n    $header.append($title);\n    $dialog.append($header);\n\n    // \n    const $body = $('<div>').addClass('dialog-body');\n\n    // \n    const $message = $('<div>').text(options.message);\n    $body.append($message);\n\n    // prompt\n    if (options.type === 'prompt') {\n      const $inputContainer = $('<div>').addClass('dialog-input-container');\n      const $input = $(options.inputType === 'textarea' ? '<textarea>' : '<input>');\n\n      if (options.inputType !== 'textarea') {\n        $input.attr('type', options.inputType || 'text');\n      }\n\n      if (options.inputValue) {\n        $input.val(options.inputValue);\n      }\n\n      if (options.inputPlaceholder) {\n        $input.attr('placeholder', options.inputPlaceholder);\n      }\n\n      $inputContainer.append($input);\n      $body.append($inputContainer);\n    }\n\n    $dialog.append($body);\n\n    // \n    const $footer = $('<div>').addClass('dialog-footer');\n\n    // \n    if (options.type === 'confirm' || options.type === 'prompt') {\n      const $cancelButton = $('<button>')\n        .addClass('dialog-button cancel-button')\n        .text(options.cancelText || '');\n      $footer.append($cancelButton);\n    }\n\n    const $confirmButton = $('<button>')\n      .addClass('dialog-button primary-button')\n      .text(options.confirmText || '');\n    $footer.append($confirmButton);\n\n    $dialog.append($footer);\n    $overlay.append($dialog);\n\n    return { overlay: $overlay[0], dialog: $dialog[0] };\n  }\n\n  /**\n   * /\n   */\n  public showCommentDialog(): Promise<{ type: 'like' | 'comment'; content?: string } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('comment-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3></h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"comment-text\"></label>\n            <textarea id=\"comment-text\" placeholder=\"...\" rows=\"3\"></textarea>\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-button cancel-btn\"></button>\n          <button class=\"dialog-button like-btn\"></button>\n          <button class=\"dialog-button confirm-btn\"></button>\n        </div>\n      `;\n\n          const $dialog = $(this.activeDialog!);\n          const $cancelBtn = $dialog.find('.cancel-btn');\n          const $likeBtn = $dialog.find('.like-btn');\n          const $confirmBtn = $dialog.find('.confirm-btn');\n          const $commentText = $dialog.find('#comment-text');\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleLike = () => {\n            this.closeDialog();\n            resolve({ type: 'like' });\n          };\n\n          const handleComment = () => {\n            const content = $commentText.val() as string;\n            if (!content) {\n              // alert\n              $commentText.css('borderColor', '#ff4444');\n              $commentText.attr('placeholder', '');\n              $commentText.trigger('focus');\n              return;\n            }\n            this.closeDialog();\n            resolve({ type: 'comment', content });\n          };\n\n          $cancelBtn.on('click', handleCancel);\n          $likeBtn.on('click', handleLike);\n          $confirmBtn.on('click', handleComment);\n\n          // \n          const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Enter' && e.ctrlKey) {\n              // Ctrl+Enter \n              e.preventDefault();\n              handleComment();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            $commentText.trigger('focus');\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  public showTransferDialog(): Promise<{ amount: string; note: string } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('transfer-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3></h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"transfer-amount\"> *</label>\n            <input type=\"number\" id=\"transfer-amount\" placeholder=\"\" step=\"0.01\" min=\"0.01\">\n          </div>\n          <div class=\"form-group\">\n            <label for=\"transfer-note\"></label>\n            <input type=\"text\" id=\"transfer-note\" placeholder=\"\">\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-button cancel-btn\"></button>\n          <button class=\"dialog-button confirm-btn\"></button>\n        </div>\n      `;\n\n          const $dialog = $(this.activeDialog!);\n          const $cancelBtn = $dialog.find('.cancel-btn');\n          const $confirmBtn = $dialog.find('.confirm-btn');\n          const $amountInput = $dialog.find('#transfer-amount');\n          const $noteInput = $dialog.find('#transfer-note');\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            const amount = $amountInput.val() as string;\n            const note = $noteInput.val() as string;\n\n            if (!amount || parseFloat(amount) <= 0) {\n              // alert\n              $amountInput.css('borderColor', '#ff4444');\n              $amountInput.attr('placeholder', '');\n              $amountInput.trigger('focus');\n              return;\n            }\n\n            this.closeDialog();\n            resolve({ amount: parseFloat(amount).toFixed(2), note: note || '' });\n          };\n\n          $cancelBtn.on('click', handleCancel);\n          $confirmBtn.on('click', handleConfirm);\n\n          // \n          $(document).on('keydown.transfer-dialog', (e: any) => {\n            if (e.key === 'Enter') {\n              handleConfirm();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              $(document).off('keydown.transfer-dialog');\n            }\n          });\n\n          // \n          $(this.activeOverlay!).append(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            $amountInput.trigger('focus');\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  public showRedPacketDialog(): Promise<{ amount: string; note: string } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('red-packet-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3> </h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"red-packet-amount\"> *</label>\n            <input type=\"number\" id=\"red-packet-amount\" placeholder=\"\" step=\"0.01\" min=\"0.01\">\n          </div>\n          <div class=\"form-group\">\n            <label for=\"red-packet-note\"></label>\n            <input type=\"text\" id=\"red-packet-note\" placeholder=\"\" value=\"\">\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-button cancel-btn\"></button>\n          <button class=\"dialog-button confirm-btn\"></button>\n        </div>\n      `;\n\n          const $dialog = $(this.activeDialog!);\n          const $cancelBtn = $dialog.find('.cancel-btn');\n          const $confirmBtn = $dialog.find('.confirm-btn');\n          const $amountInput = $dialog.find('#red-packet-amount');\n          const $noteInput = $dialog.find('#red-packet-note');\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            const amount = $amountInput.val() as string;\n            const note = $noteInput.val() as string;\n\n            if (!amount || parseFloat(amount) <= 0) {\n              // alert\n              $amountInput.css('borderColor', '#ff4444');\n              $amountInput.attr('placeholder', '');\n              $amountInput.trigger('focus');\n              return;\n            }\n\n            this.closeDialog();\n            resolve({ amount: parseFloat(amount).toFixed(2), note: note || '' });\n          };\n\n          $cancelBtn.on('click', handleCancel);\n          $confirmBtn.on('click', handleConfirm);\n\n          // \n          $(document).on('keydown.red-packet-dialog', (e: any) => {\n            if (e.key === 'Enter') {\n              handleConfirm();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              $(document).off('keydown.red-packet-dialog');\n            }\n          });\n\n          // \n          $(this.activeOverlay!).append(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            $amountInput.trigger('focus');\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  public showGiftDialog(): Promise<{ name: string; price?: string } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('gift-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3> </h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"gift-name\"> *</label>\n            <input type=\"text\" id=\"gift-name\" placeholder=\"\">\n          </div>\n          <div class=\"form-group\">\n            <label for=\"gift-price\"></label>\n            <input type=\"number\" id=\"gift-price\" placeholder=\"\" step=\"0.01\" min=\"0\">\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-button cancel-btn\"></button>\n          <button class=\"dialog-button confirm-btn\"></button>\n        </div>\n      `;\n\n          const cancelBtn = this.activeDialog!.querySelector('.cancel-btn') as HTMLButtonElement;\n          const confirmBtn = this.activeDialog!.querySelector('.confirm-btn') as HTMLButtonElement;\n          const nameInput = this.activeDialog!.querySelector('#gift-name') as HTMLInputElement;\n          const priceInput = this.activeDialog!.querySelector('#gift-price') as HTMLInputElement;\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            const name = nameInput.value.trim();\n            const price = priceInput.value.trim();\n\n            if (!name) {\n              // alert\n              $(nameInput).css('borderColor', '#ff4444');\n              $(nameInput).attr('placeholder', '');\n              $(nameInput).trigger('focus');\n              return;\n            }\n\n            this.closeDialog();\n            resolve({\n              name,\n              price: price && parseFloat(price) > 0 ? parseFloat(price).toFixed(2) : undefined,\n            });\n          };\n\n          cancelBtn.addEventListener('click', handleCancel);\n          confirmBtn.addEventListener('click', handleConfirm);\n\n          // \n          const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Enter') {\n              handleConfirm();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            $(nameInput).trigger('focus');\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * prompt\n   */\n  public showInputDialog(\n    title: string,\n    label: string,\n    defaultValue: string = '',\n    placeholder: string = '',\n    inputType: 'text' | 'url' | 'email' = 'text',\n  ): Promise<string | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('input-dialog');\n\n          this.activeDialog!.innerHTML = `\n            <div class=\"dialog-header\">\n              <h3>${title}</h3>\n            </div>\n            <div class=\"dialog-body\">\n              <div class=\"form-group\">\n                <label for=\"input-field\">${label}</label>\n                <input type=\"${inputType}\" id=\"input-field\" placeholder=\"${placeholder}\" value=\"${defaultValue}\">\n              </div>\n            </div>\n            <div class=\"dialog-footer\">\n              <button class=\"dialog-button cancel-btn\"></button>\n              <button class=\"dialog-button confirm-btn\"></button>\n            </div>\n          `;\n\n          const $dialog = $(this.activeDialog!);\n          const $cancelBtn = $dialog.find('.cancel-btn');\n          const $confirmBtn = $dialog.find('.confirm-btn');\n          const $inputField = $dialog.find('#input-field');\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            const value = $inputField.val() as string;\n            this.closeDialog();\n            resolve(value);\n          };\n\n          $cancelBtn.on('click', handleCancel);\n          $confirmBtn.on('click', handleConfirm);\n\n          // \n          const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Enter') {\n              handleConfirm();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            $inputField.trigger('focus');\n            if (defaultValue) {\n              $inputField.trigger('select');\n            }\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  public showVoiceDialog(): Promise<{ text: string; duration: number } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('voice-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3> </h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"voice-text\"></label>\n            <textarea id=\"voice-text\" placeholder=\"...\" rows=\"3\"></textarea>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"voice-duration\"></label>\n            <input type=\"number\" id=\"voice-duration\" placeholder=\"\" min=\"1\" max=\"60\" value=\"3\">\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-button cancel-btn\"></button>\n          <button class=\"dialog-button confirm-btn\"></button>\n        </div>\n      `;\n\n          const cancelBtn = this.activeDialog!.querySelector('.cancel-btn') as HTMLButtonElement;\n          const confirmBtn = this.activeDialog!.querySelector('.confirm-btn') as HTMLButtonElement;\n          const textArea = this.activeDialog!.querySelector('#voice-text') as HTMLTextAreaElement;\n          const durationInput = this.activeDialog!.querySelector('#voice-duration') as HTMLInputElement;\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            const text = textArea.value.trim();\n            const durationStr = durationInput.value.trim();\n\n            if (!text) {\n              // alert\n              $(textArea).css('borderColor', '#ff4444');\n              $(textArea).attr('placeholder', '');\n              $(textArea).trigger('focus');\n              return;\n            }\n\n            const duration = parseInt(durationStr, 10);\n            if (!durationStr || isNaN(duration) || duration <= 0 || duration > 60) {\n              // alert\n              $(durationInput).css('borderColor', '#ff4444');\n              $(durationInput).attr('placeholder', '1-60');\n              $(durationInput).trigger('focus');\n              return;\n            }\n\n            this.closeDialog();\n            resolve({ text, duration });\n          };\n\n          cancelBtn.addEventListener('click', handleCancel);\n          confirmBtn.addEventListener('click', handleConfirm);\n\n          // textareaCtrl+Enter\n          const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Enter' && e.ctrlKey) {\n              e.preventDefault();\n              handleConfirm();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            $(textArea).trigger('focus');\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * /\n   */\n  public showReceiveDialog(type: 'gift' | 'transfer', data: any): Promise<'accept' | 'reject' | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          // \n          this.createBaseDialogElements('receive-dialog');\n\n          const isGift = type === 'gift';\n          const title = isGift ? '' : '';\n          const icon = isGift ? '' : '';\n\n          let content = '';\n          if (isGift) {\n            content = `\n          <div class=\"receive-content\">\n            <div class=\"receive-icon\">${icon}</div>\n            <div class=\"receive-info\">\n              <div class=\"receive-title\">${data.name}</div>\n              ${data.price ? `<div class=\"receive-price\">${data.price}</div>` : ''}\n              ${data.note ? `<div class=\"receive-note\">${data.note}</div>` : ''}\n            </div>\n          </div>\n        `;\n          } else {\n            content = `\n          <div class=\"receive-content\">\n            <div class=\"receive-icon\">${icon}</div>\n            <div class=\"receive-info\">\n              <div class=\"receive-title\"></div>\n              <div class=\"receive-price\">${data.amount}</div>\n              ${data.note ? `<div class=\"receive-note\">${data.note}</div>` : ''}\n            </div>\n          </div>\n        `;\n          }\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3>${title}</h3>\n        </div>\n        <div class=\"dialog-body\">\n          ${content}\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-button reject-btn\"></button>\n          <button class=\"dialog-button accept-btn\"></button>\n        </div>\n      `;\n\n          const rejectBtn = this.activeDialog!.querySelector('.reject-btn') as HTMLButtonElement;\n          const acceptBtn = this.activeDialog!.querySelector('.accept-btn') as HTMLButtonElement;\n\n          const handleReject = () => {\n            this.closeDialog();\n            resolve('reject');\n          };\n\n          const handleAccept = () => {\n            this.closeDialog();\n            resolve('accept');\n          };\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          rejectBtn.addEventListener('click', handleReject);\n          acceptBtn.addEventListener('click', handleAccept);\n\n          // \n          const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Enter') {\n              // Enter/\n              e.preventDefault();\n              handleAccept();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  public showMomentDialog(defaultTime?: string): Promise<{\n    text: string;\n    image: string;\n    image_type: 'none' | 'url' | 'desc';\n    image_desc: string;\n    date: string;\n    time: string;\n  } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          const currentDate = window.currentGameDate || new Date();\n          const defaultDateTime =\n            defaultTime ||\n            `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1).toString().padStart(2, '0')}-${currentDate\n              .getDate()\n              .toString()\n              .padStart(2, '0')} ${currentDate.getHours().toString().padStart(2, '0')}:${currentDate\n              .getMinutes()\n              .toString()\n              .padStart(2, '0')}`;\n\n          // \n          this.createBaseDialogElements('moment-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3></h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"moment-text\">...</label>\n            <textarea id=\"moment-text\" placeholder=\"...\" rows=\"3\"></textarea>\n          </div>\n\n          <div class=\"form-group\">\n            <label> </label>\n            <div class=\"radio-group\">\n              <label><input type=\"radio\" name=\"image-type\" value=\"desc\" checked> </label>\n              <label><input type=\"radio\" name=\"image-type\" value=\"url\"> </label>\n            </div>\n          </div>\n\n          <div class=\"form-group\">\n            <label for=\"image-content\" id=\"image-content-label\"></label>\n            <input type=\"text\" id=\"image-content\" placeholder=\"...\">\n          </div>\n\n          <div class=\"form-group url-desc-group\" style=\"display: none;\">\n            <label for=\"image-desc\">AI</label>\n            <input type=\"text\" id=\"image-desc\" placeholder=\"AI...\">\n          </div>\n\n          <div class=\"form-group\">\n            <label for=\"moment-datetime\"></label>\n            <input type=\"text\" id=\"moment-datetime\" value=\"${defaultDateTime}\" placeholder=\"YYYY-MM-DD HH:MM\">\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-btn dialog-btn-cancel\"></button>\n          <button class=\"dialog-btn dialog-btn-confirm\"></button>\n        </div>\n      `;\n\n          // \n          const imageTypeRadios = this.activeDialog!.querySelectorAll(\n            'input[name=\"image-type\"]',\n          ) as NodeListOf<HTMLInputElement>;\n          const imageContentLabel = this.activeDialog!.querySelector('#image-content-label') as HTMLElement;\n          const imageContentInput = this.activeDialog!.querySelector('#image-content') as HTMLInputElement;\n          const urlDescGroup = this.activeDialog!.querySelector('.url-desc-group') as HTMLElement;\n\n          // checkboxcheckbox\n          this.initializeCheckboxButtons();\n\n          // \n          imageTypeRadios.forEach(radio => {\n            radio.addEventListener('change', () => {\n              const isDesc = radio.value === 'desc';\n              imageContentLabel.textContent = isDesc ? '' : '';\n              imageContentInput.placeholder = isDesc ? '...' : '...';\n              urlDescGroup.style.display = isDesc ? 'none' : 'block';\n            });\n          });\n\n          // \n          const cancelBtn = this.activeDialog!.querySelector('.dialog-btn-cancel') as HTMLElement;\n          const confirmBtn = this.activeDialog!.querySelector('.dialog-btn-confirm') as HTMLElement;\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            // \n            if (!this.activeDialog) {\n              return;\n            }\n\n            const textArea = this.activeDialog!.querySelector('#moment-text') as HTMLTextAreaElement;\n            const imageTypeInput = this.activeDialog!.querySelector(\n              'input[name=\"image-type\"]:checked',\n            ) as HTMLInputElement;\n            const imageContentField = this.activeDialog!.querySelector('#image-content') as HTMLInputElement;\n            const imageDescField = this.activeDialog!.querySelector('#image-desc') as HTMLInputElement;\n            const datetimeInput = this.activeDialog!.querySelector('#moment-datetime') as HTMLInputElement;\n\n            if (!textArea || !datetimeInput) {\n              return;\n            }\n\n            const text = textArea.value;\n            const imageContent = imageContentField ? imageContentField.value.trim() : '';\n            const hasImage = imageContent !== '';\n            const imageType = hasImage && imageTypeInput ? (imageTypeInput.value as 'url' | 'desc') : 'none';\n            const imageDesc = imageType === 'url' && imageDescField ? imageDescField.value.trim() : imageContent;\n            const datetime = datetimeInput.value;\n\n            // \n            if ((!text || text.trim() === '') && (!imageContent || imageContent.trim() === '')) {\n              // alert\n              $(textArea).css('borderColor', '#ff4444');\n              $(textArea).attr('placeholder', '');\n              $(textArea).trigger('focus');\n              return;\n            }\n\n            // \n            const datetimeMatch = datetime.match(/^(\\d{4}-\\d{2}-\\d{2})\\s+(\\d{2}:\\d{2})$/);\n            if (!datetimeMatch) {\n              // alert\n              $(datetimeInput).css('borderColor', '#ff4444');\n              $(datetimeInput).attr('placeholder', 'YYYY-MM-DD HH:MM');\n              $(datetimeInput).trigger('focus');\n              return;\n            }\n\n            this.closeDialog();\n            resolve({\n              text: text.trim(),\n              image: imageContent.trim(),\n              image_type: imageType,\n              image_desc: imageDesc.trim(),\n              date: datetimeMatch[1],\n              time: datetimeMatch[2],\n            });\n          };\n\n          cancelBtn.addEventListener('click', handleCancel);\n          confirmBtn.addEventListener('click', handleConfirm);\n\n          // \n          const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Enter' && e.ctrlKey) {\n              // Ctrl+Enter \n              e.preventDefault();\n              handleConfirm();\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            if (this.activeDialog) {\n              const $textArea = $(this.activeDialog).find('#moment-text');\n              if ($textArea.length) {\n                $textArea.trigger('focus');\n              }\n            }\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  public showTimeJumpDialog(defaultTime?: string): Promise<{\n    date: string;\n    time: string;\n    description: string;\n  } | null> {\n    return this.safeShowDialog(\n      () =>\n        new Promise(resolve => {\n          const currentDate = window.currentGameDate || new Date();\n          const defaultDateTime =\n            defaultTime ||\n            `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1).toString().padStart(2, '0')}-${currentDate\n              .getDate()\n              .toString()\n              .padStart(2, '0')} ${currentDate.getHours().toString().padStart(2, '0')}:${currentDate\n              .getMinutes()\n              .toString()\n              .padStart(2, '0')}`;\n\n          // \n          this.createBaseDialogElements('time-jump-dialog');\n\n          this.activeDialog!.innerHTML = `\n        <div class=\"dialog-header\">\n          <h3></h3>\n        </div>\n        <div class=\"dialog-body\">\n          <div class=\"form-group\">\n            <label for=\"jump-datetime\"></label>\n            <input type=\"text\" id=\"jump-datetime\" value=\"${defaultDateTime}\" placeholder=\"YYYY-MM-DD HH:MM\">\n          </div>\n\n          <div class=\"form-group\">\n            <label for=\"event-description\"> </label>\n            <textarea id=\"event-description\" placeholder=\"...\" rows=\"3\"></textarea>\n          </div>\n        </div>\n        <div class=\"dialog-footer\">\n          <button class=\"dialog-btn dialog-btn-cancel\"></button>\n          <button class=\"dialog-btn dialog-btn-confirm\"></button>\n        </div>\n      `;\n\n          // checkboxcheckbox\n          this.initializeCheckboxButtons();\n\n          // \n          const cancelBtn = this.activeDialog!.querySelector('.dialog-btn-cancel') as HTMLElement;\n          const confirmBtn = this.activeDialog!.querySelector('.dialog-btn-confirm') as HTMLElement;\n\n          const handleCancel = () => {\n            this.closeDialog();\n            resolve(null);\n          };\n\n          const handleConfirm = () => {\n            // \n            if (!this.activeDialog) {\n              return;\n            }\n\n            const datetimeInput = this.activeDialog!.querySelector('#jump-datetime') as HTMLInputElement;\n            const descriptionInput = this.activeDialog!.querySelector('#event-description') as HTMLTextAreaElement;\n\n            if (!datetimeInput) {\n              return;\n            }\n\n            const datetime = datetimeInput.value;\n            const description = descriptionInput ? descriptionInput.value.trim() : '';\n\n            // \n            const datetimeMatch = datetime.match(/^(\\d{4}-\\d{2}-\\d{2})\\s+(\\d{2}:\\d{2})$/);\n            if (!datetimeMatch) {\n              // alert\n              $(datetimeInput).css('borderColor', '#ff4444');\n              $(datetimeInput).attr('placeholder', 'YYYY-MM-DD HH:MM');\n              $(datetimeInput).trigger('focus');\n              return;\n            }\n\n            this.closeDialog();\n            resolve({\n              date: datetimeMatch[1],\n              time: datetimeMatch[2],\n              description: description, // \n            });\n          };\n\n          cancelBtn.addEventListener('click', handleCancel);\n          confirmBtn.addEventListener('click', handleConfirm);\n\n          // \n          const handleKeyDown = (e: KeyboardEvent) => {\n            // \n            if (!this.activeDialog) {\n              document.removeEventListener('keydown', handleKeyDown);\n              return;\n            }\n\n            if (e.key === 'Enter') {\n              // Enter\n              e.preventDefault();\n              handleConfirm();\n              document.removeEventListener('keydown', handleKeyDown);\n            } else if (e.key === 'Escape') {\n              handleCancel();\n              document.removeEventListener('keydown', handleKeyDown);\n            }\n          };\n          document.addEventListener('keydown', handleKeyDown);\n\n          // \n          this.activeOverlay!.appendChild(this.activeDialog!);\n          this.appendDialogToPage();\n\n          // \n          setTimeout(() => {\n            if (this.activeDialog) {\n              const $timeInput = $(this.activeDialog).find('#jump-datetime');\n              if ($timeInput.length) {\n                $timeInput.trigger('focus');\n                $timeInput.trigger('select');\n              }\n            }\n          }, 100);\n        }),\n    );\n  }\n\n  /**\n   * \n   */\n  private forceCleanupDialogs(): void {\n    // \n    const $container = $('.phone-screen').length ? $('.phone-screen') : $('body');\n\n    // \n    const selectors = [\n      '[class*=\"dialog-overlay\"]',\n      '[class*=\"dialog\"]',\n      '.custom-dialog-overlay',\n      '.mobile-dialog-overlay',\n      '.custom-dialog',\n      '.mobile-dialog',\n    ];\n\n    selectors.forEach(selector => {\n      $container.find(selector).each((_, element) => {\n        try {\n          $(element).remove();\n        } catch (error) {\n          console.warn(':', error);\n        }\n      });\n    });\n\n    // \n    this.activeDialog = null;\n    this.activeOverlay = null;\n  }\n\n  /**\n   * \n   */\n  private closeDialog(): void {\n    this.forceCleanupDialogs();\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","/**\n * \n * \n */\n\nexport class EventManager {\n  private listeners: Array<() => void> = [];\n  private timers: Set<number> = new Set();\n  private intervals: Set<number> = new Set();\n  private isDestroyed: boolean = false;\n\n  /**\n   * \n   * @param event \n   * @param handler \n   * @returns \n   */\n  addGlobalListener(event: string, handler: Function): () => void {\n    if (this.isDestroyed) {\n      console.warn('[EventManager] ');\n      return () => {};\n    }\n\n    const cleanup = (window as any).eventOn(event, handler);\n    if (cleanup && typeof cleanup === 'function') {\n      this.listeners.push(cleanup);\n      return cleanup;\n    } else {\n      console.warn(`[EventManager]  ${event} `);\n      return () => {};\n    }\n  }\n\n  /**\n   * DOM\n   * @param element DOM\n   * @param event \n   * @param handler \n   * @param options \n   */\n  addDOMListener(\n    element: Element | Window | Document,\n    event: string,\n    handler: EventListener,\n    options?: boolean | AddEventListenerOptions,\n  ): void {\n    if (this.isDestroyed) {\n      console.warn('[EventManager] DOM');\n      return;\n    }\n\n    element.addEventListener(event, handler, options);\n\n    // \n    const cleanup = () => {\n      element.removeEventListener(event, handler, options);\n    };\n\n    this.listeners.push(cleanup);\n  }\n\n  /**\n   * setTimeout\n   * @param callback \n   * @param delay \n   * @returns ID\n   */\n  setTimeout(callback: Function, delay: number): number {\n    if (this.isDestroyed) {\n      console.warn('[EventManager] ');\n      return -1;\n    }\n\n    const timerId = window.setTimeout(() => {\n      this.timers.delete(timerId);\n      try {\n        callback();\n      } catch (error) {\n        console.error('[EventManager] :', error);\n      }\n    }, delay);\n\n    this.timers.add(timerId);\n    return timerId;\n  }\n\n  /**\n   * setInterval\n   * @param callback \n   * @param interval \n   * @returns ID\n   */\n  setInterval(callback: Function, interval: number): number {\n    if (this.isDestroyed) {\n      console.warn('[EventManager] ');\n      return -1;\n    }\n\n    const intervalId = window.setInterval(() => {\n      try {\n        callback();\n      } catch (error) {\n        console.error('[EventManager] :', error);\n      }\n    }, interval);\n\n    this.intervals.add(intervalId);\n    return intervalId;\n  }\n\n  /**\n   * \n   * @param timerId ID\n   */\n  clearTimeout(timerId: number): void {\n    if (this.timers.has(timerId)) {\n      window.clearTimeout(timerId);\n      this.timers.delete(timerId);\n    }\n  }\n\n  /**\n   * \n   * @param intervalId ID\n   */\n  clearInterval(intervalId: number): void {\n    if (this.intervals.has(intervalId)) {\n      window.clearInterval(intervalId);\n      this.intervals.delete(intervalId);\n    }\n  }\n\n  /**\n   * \n   */\n  cleanup(): void {\n    if (this.isDestroyed) {\n      return;\n    }\n\n    // \n    this.listeners.forEach(cleanup => {\n      try {\n        cleanup();\n      } catch (error) {\n        console.error('[EventManager] :', error);\n      }\n    });\n    this.listeners = [];\n\n    // \n    this.timers.forEach(timerId => {\n      window.clearTimeout(timerId);\n    });\n    this.timers.clear();\n\n    // \n    this.intervals.forEach(intervalId => {\n      window.clearInterval(intervalId);\n    });\n    this.intervals.clear();\n\n    this.isDestroyed = true;\n    //console.log('[EventManager] ');\n  }\n\n  /**\n   * \n   */\n  getStatus(): {\n    listenersCount: number;\n    timersCount: number;\n    intervalsCount: number;\n    isDestroyed: boolean;\n  } {\n    return {\n      listenersCount: this.listeners.length,\n      timersCount: this.timers.size,\n      intervalsCount: this.intervals.size,\n      isDestroyed: this.isDestroyed,\n    };\n  }\n\n  /**\n   * \n   */\n  isDestroyed_(): boolean {\n    return this.isDestroyed;\n  }\n}\n\n/**\n * \n * \n */\nexport const globalEventManager = new EventManager();\n\n/**\n * \n */\nif (typeof window !== 'undefined') {\n  window.addEventListener('beforeunload', () => {\n    globalEventManager.cleanup();\n  });\n}\n","export interface TavernHelperBridge {\n  getCharData(): Promise<{ name: string }>;\n  getCharAvatarPath(): Promise<string>;\n  getLastMessageId(): Promise<number | null>;\n  getChatMessages(id: number): Promise<Array<{ message: string }>>;\n  setChatMessage(content: string, id: number, options: { refresh: 'none' }): Promise<void>;\n  generate(options: { user_input: string; should_stream: boolean }): Promise<AsyncGenerator<string, void, unknown>>;\n}\n\n// \ndeclare global {\n  interface Window {\n    currentGameDate: Date;\n  }\n}\n\n// TavernHelper\nexport function getTavernHelper(): TavernHelperBridge {\n  return (window.parent as any).TavernHelper;\n}\n\nexport type Sender = 'me' | 'them';\n\nexport interface BaseLogEntry {\n  recalled?: boolean;\n  recalled_content?: any;\n  recalled_timestamp?: string;\n}\n\nexport interface BaseChatMessage extends BaseLogEntry {\n  id: string;\n  sender: Sender;\n}\n\n// \nexport interface TextMessage extends BaseChatMessage {\n  type: 'message';\n  content: string;\n  isSystemMessage?: boolean; // \n}\n\nexport interface VoiceMessage extends BaseChatMessage {\n  type: 'voice';\n  content: { text: string; duration: number };\n}\n\nexport interface StickerMessage extends BaseChatMessage {\n  type: 'sticker';\n  content: string; // sticker name/label\n  size?: 'small' | 'medium' | 'large'; // Add size option for stickers\n}\n\nexport interface ImageMessage extends BaseChatMessage {\n  type: 'image';\n  content: { type: 'url' | 'desc'; value: string };\n}\n\nexport interface LocationMessage extends BaseChatMessage {\n  type: 'location';\n  content: string;\n}\n\nexport interface TransferMessage extends BaseChatMessage {\n  type: 'transfer';\n  content: string; // JSON string\n  data: {\n    amount: string;\n    note?: string;\n    status: 'sent' | 'accepted' | 'rejected';\n  };\n}\n\nexport interface FileMessage extends BaseChatMessage {\n  type: 'file';\n  content: string; // filename\n}\n\nexport interface GiftMessage extends BaseChatMessage {\n  type: 'gift';\n  content: string; // JSON string\n  data: {\n    name: string;\n    price?: string;\n    status: 'sent' | 'accepted' | 'rejected';\n  };\n}\n\nexport type ChatEntry =\n  | TextMessage\n  | VoiceMessage\n  | StickerMessage\n  | ImageMessage\n  | LocationMessage\n  | TransferMessage\n  | FileMessage\n  | GiftMessage;\n\nexport interface TimeLogEntry extends BaseLogEntry {\n  type: 'time';\n  content: { date: string; time: string };\n  id?: string; // id\n}\n\nexport interface EventLogEntry extends BaseLogEntry {\n  type: 'event';\n  content: { date: string; time: string; description?: string };\n  id?: string; // id\n}\n\nexport type SystemEntry = TimeLogEntry | EventLogEntry;\n\nexport interface MomentEntry extends BaseLogEntry {\n  key: 'USER_MOMENT' | 'CHAR_MOMENT';\n  data: {\n    text: string;\n    image: string;\n    image_type: 'url' | 'desc' | 'none';\n    image_desc?: string;\n    date: string;\n    time: string;\n  };\n}\n\nexport interface CommentEntry extends BaseLogEntry {\n  key: 'USER_COMMENT' | 'CHAR_COMMENT';\n  data: {\n    text: string;\n    target_post_id: number;\n  };\n}\n\nexport interface LikeEntry extends BaseLogEntry {\n  key: 'USER_LIKE' | 'CHAR_LIKE';\n  data: {\n    target_post_id: number;\n  };\n}\n\nexport type MomentRelatedEntry = MomentEntry | CommentEntry | LikeEntry;\n\nexport type LogEntry = ChatEntry | SystemEntry | MomentRelatedEntry;\n\nexport class BLMX_Protocol {\n  public logEntries: LogEntry[] = [];\n  private messageId: number | null = null;\n  private readonly charId: string;\n  private readonly LOG_START_TAG = '===BLMX_LOG_BEGIN===';\n  private readonly LOG_END_TAG = '===BLMX_LOG_END===';\n\n  constructor(charId: string) {\n    this.charId = charId;\n  }\n\n  // ID\n  getCharId(): string {\n    return this.charId;\n  }\n\n  async initialize(): Promise<boolean> {\n    // console.log('[BLMX] Initializing and scanning for chat history...');\n    const lastMessageId = await getTavernHelper().getLastMessageId();\n\n    if (lastMessageId === null) {\n      // console.warn('[BLMX] No messages found. Starting fresh at message ID 0.');\n      this.messageId = 0;\n      this.logEntries = [];\n      await this.persistLogToStorage();\n      return true;\n    }\n\n    let latestUiMessage: { id: number; content: string } | null = null;\n    const previousUiMessages: { id: number; content: string }[] = [];\n\n    for (let i = lastMessageId; i >= 0; i--) {\n      try {\n        const msg = (await getTavernHelper().getChatMessages(i))[0];\n        if (msg && msg.message && msg.message.includes(this.LOG_START_TAG)) {\n          if (!latestUiMessage) {\n            latestUiMessage = { id: i, content: msg.message };\n          } else {\n            previousUiMessages.push({ id: i, content: msg.message });\n          }\n        }\n      } catch (error) {\n        // Ignore errors, likely message not found\n      }\n    }\n\n    if (!latestUiMessage) {\n      // console.log('[BLMX] No UI log found. Creating a new one in the latest message.');\n      this.messageId = lastMessageId;\n      this.logEntries = [];\n      await this.persistLogToStorage();\n      return true;\n    }\n\n    // console.log(`[BLMX] Found latest UI log in message ${latestUiMessage.id}. Consolidating...`);\n    this.messageId = latestUiMessage.id;\n    const consolidatedLogParts: string[] = [];\n\n    const latestLogStartIndex = latestUiMessage.content.indexOf(this.LOG_START_TAG);\n    const latestLogEndIndex = latestUiMessage.content.indexOf(this.LOG_END_TAG);\n    if (latestLogStartIndex !== -1 && latestLogEndIndex !== -1) {\n      const logPart = latestUiMessage.content\n        .slice(latestLogStartIndex + this.LOG_START_TAG.length, latestLogEndIndex)\n        .trim();\n      if (logPart) consolidatedLogParts.push(logPart);\n    }\n\n    for (const prevMsg of previousUiMessages) {\n      const prevLogStartIndex = prevMsg.content.indexOf(this.LOG_START_TAG);\n      const prevLogEndIndex = prevMsg.content.indexOf(this.LOG_END_TAG);\n      if (prevLogStartIndex !== -1 && prevLogEndIndex !== -1) {\n        const logPart = prevMsg.content.slice(prevLogStartIndex + this.LOG_START_TAG.length, prevLogEndIndex).trim();\n        if (logPart) consolidatedLogParts.unshift(logPart);\n\n        const cleanedContent =\n          prevMsg.content.substring(0, prevLogStartIndex) +\n          prevMsg.content.substring(prevLogEndIndex + this.LOG_END_TAG.length);\n        await getTavernHelper().setChatMessage(cleanedContent.trim(), prevMsg.id, { refresh: 'none' });\n        // console.log(`[BLMX] Cleaned and moved UI log from message ${prevMsg.id}.`);\n      }\n    }\n\n    const finalLogString = consolidatedLogParts.join('\\n');\n    this._parseLogFromString(finalLogString);\n\n    await this.persistLogToStorage();\n    // console.log(`[BLMX] Consolidated log saved to message ${this.messageId}.`);\n\n    return true;\n  }\n\n  async persistLogToStorage(): Promise<void> {\n    if (this.messageId === null) {\n      console.warn('[BLMX] Cannot save log, message_id not initialized.'); // \n      return;\n    }\n    try {\n      const logString = this._renderLogToString();\n      const existingMessage = (await getTavernHelper().getChatMessages(this.messageId))[0];\n      const existingContent = existingMessage ? existingMessage.message : '';\n\n      const logStartIndex = existingContent.indexOf(this.LOG_START_TAG);\n      const logEndIndex = existingContent.indexOf(this.LOG_END_TAG);\n\n      const newLogBlock = `${this.LOG_START_TAG}\\n${logString}\\n${this.LOG_END_TAG}`;\n      let fullText: string;\n\n      if (logStartIndex !== -1 && logEndIndex !== -1) {\n        fullText =\n          existingContent.substring(0, logStartIndex) +\n          newLogBlock +\n          existingContent.substring(logEndIndex + this.LOG_END_TAG.length);\n      } else {\n        fullText = existingContent + '\\n' + newLogBlock;\n      }\n\n      await getTavernHelper().setChatMessage(fullText.trim(), this.messageId, { refresh: 'none' });\n    } catch (error) {\n      console.error('Failed to save narrative log to text box:', error);\n    }\n  }\n\n  private _parseLogFromString(logString: string): void {\n    this.logEntries = [];\n    const lines = logString.split('\\n').filter(line => line.trim() !== '');\n\n    lines.forEach(line => {\n      const separatorIndex = line.indexOf(':');\n      if (separatorIndex === -1) return;\n\n      const key = line.substring(0, separatorIndex).trim();\n      const value = line.substring(separatorIndex + 1).trim();\n      try {\n        switch (key) {\n          case 'USER_MOMENT':\n          case 'CHAR_MOMENT':\n          case 'USER_COMMENT':\n          case 'CHAR_COMMENT':\n          case 'USER_LIKE':\n          case 'CHAR_LIKE':\n            try {\n              const data = JSON.parse(value);\n              this.logEntries.push({ key, data } as MomentRelatedEntry);\n            } catch (error) {\n              console.warn('[BLMX] :', value, error);\n            }\n            break;\n          case 'TIME':\n          case 'EVENT_LOG':\n            if (value) {\n              try {\n                const data = JSON.parse(value);\n                // console.log(`[BLMX] ${key}:`, data);\n\n                // \n                if (!data.date || !data.time) {\n                  console.warn(`[BLMX] ${key}:`, data);\n                  // \n                  if (!data.date || !data.time) {\n                    const now = new Date();\n                    if (!data.date) {\n                      data.date = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(\n                        now.getDate(),\n                      ).padStart(2, '0')}`;\n                      // console.log(`[BLMX] ${key}:`, data.date);\n                    }\n                    if (!data.time) {\n                      data.time = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(\n                        2,\n                        '0',\n                      )}`;\n                      // console.log(`[BLMX] ${key}:`, data.time);\n                    }\n                  }\n                }\n\n                const entryType = key === 'TIME' ? 'time' : 'event';\n                const newEntry = { type: entryType, content: data } as SystemEntry;\n                this.logEntries.push(newEntry);\n                // console.log(`[BLMX] ${key}:`, newEntry);\n\n                const timeDate = new Date(`${data.date} ${data.time}`);\n                if (!isNaN(timeDate.getTime())) {\n                  window.currentGameDate = timeDate;\n                  const timeElement = document.getElementById('current-time');\n                  if (timeElement) {\n                    const timeString = `${window.currentGameDate\n                      .getHours()\n                      .toString()\n                      .padStart(2, '0')}:${window.currentGameDate.getMinutes().toString().padStart(2, '0')}`;\n                    timeElement.textContent = timeString;\n                  }\n                }\n              } catch (error) {\n                console.error(`[BLMX] ${key}:`, value, error);\n              }\n            } else {\n              // console.warn(`[BLMX] ${key}`);\n            }\n            break;\n          case 'RECALL': {\n            // console.log('[BLMX] RECALL:', value);\n            try {\n              const recallData = JSON.parse(value);\n              const senderToFind: Sender = recallData.sender === 'USER' ? 'me' : 'them';\n\n              // target_text\n              const targetText = recallData.target_text || recallData['target text'] || recallData.text || '';\n\n              if (!targetText) {\n                console.warn('[BLMX] RECALL:', recallData);\n                break;\n              }\n\n              // \n              const entryToRecall = this.logEntries\n                .slice()\n                .reverse()\n                .find(e => {\n                  // sendercontent\n                  if (!('sender' in e) || e.sender !== senderToFind || !('content' in e)) {\n                    return false;\n                  }\n\n                  // \n                  if (e.content === targetText) {\n                    return true;\n                  }\n\n                  // \n                  const normalizeText = (text: string) =>\n                    typeof text === 'string' ? text.replace(/[^\\w\\u4e00-\\u9fa5]/g, '').toLowerCase() : '';\n\n                  if (typeof e.content === 'string') {\n                    // \n                    if (normalizeText(e.content) === normalizeText(targetText)) {\n                      return true;\n                    }\n                    // \n                    if (e.content.includes(targetText) || targetText.includes(e.content)) {\n                      return true;\n                    }\n                  }\n\n                  // \n                  if (typeof e.content === 'object' && e.content !== null) {\n                    try {\n                      // JSON\n                      if (JSON.stringify(e.content) === targetText) {\n                        return true;\n                      }\n\n                      // text\n                      if ('text' in e.content) {\n                        const voiceText = (e.content as any).text;\n                        if (voiceText === targetText || normalizeText(voiceText) === normalizeText(targetText)) {\n                          return true;\n                        }\n                      }\n                    } catch (err) {\n                      console.warn('[BLMX] :', err);\n                    }\n                  }\n\n                  return false;\n                }) as ChatEntry;\n\n              if (entryToRecall) {\n                // console.log('[BLMX] :', entryToRecall);\n                entryToRecall.recalled = true;\n                entryToRecall.recalled_content = entryToRecall.content;\n                entryToRecall.recalled_timestamp = recallData.timestamp || new Date().toISOString();\n              } else {\n                console.warn('[BLMX] :', {\n                  sender: senderToFind,\n                  target_text: targetText,\n                  recall_data: recallData,\n                });\n              }\n            } catch (error) {\n              console.error('[BLMX] RECALL:', error);\n            }\n            break;\n          }\n          case 'USER':\n          case 'CHAR': {\n            const sender: Sender = key === 'USER' ? 'me' : 'them';\n            const id = `msg-${Date.now()}${Math.random()}-${sender}`;\n\n            const voiceMatch = value.match(/^\\[:\\s*({.*})\\]/);\n            if (voiceMatch) {\n              try {\n                const voiceData = JSON.parse(voiceMatch[1]);\n                this.logEntries.push({ id, type: 'voice', sender, content: voiceData });\n                return;\n              } catch (e) {\n                console.error('Failed to parse voice data:', voiceMatch[1], e);\n                // \n                this.logEntries.push({ id, type: 'voice', sender, content: { text: '', duration: 0 } });\n                return;\n              }\n            }\n\n            const stickerMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            if (stickerMatch) {\n              this.logEntries.push({ id, type: 'sticker', sender, content: stickerMatch[1] });\n              return;\n            }\n\n            const imageMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            if (imageMatch) {\n              try {\n                const imgData = JSON.parse(imageMatch[1]);\n                this.logEntries.push({ id, type: 'image', sender, content: imgData });\n              } catch (e) {\n                this.logEntries.push({\n                  id,\n                  type: 'image',\n                  sender,\n                  content: { type: 'desc', value: imageMatch[1] },\n                });\n              }\n              return;\n            }\n\n            const locationMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            if (locationMatch) {\n              this.logEntries.push({ id, type: 'location', sender, content: locationMatch[1] });\n              return;\n            }\n\n            const transferMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            if (transferMatch) {\n              this.logEntries.push({\n                id,\n                type: 'transfer',\n                sender,\n                content: transferMatch[1],\n                data: (() => {\n                  try {\n                    return JSON.parse(transferMatch[1]);\n                  } catch (e) {\n                    console.error('Failed to parse transfer data:', transferMatch[1], e);\n                    return { amount: 0, message: '' };\n                  }\n                })(),\n              });\n              return;\n            }\n\n            const fileMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            if (fileMatch) {\n              this.logEntries.push({ id, type: 'file', sender, content: fileMatch[1] });\n              return;\n            }\n\n            const giftMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            if (giftMatch) {\n              this.logEntries.push({\n                id,\n                type: 'gift',\n                sender,\n                content: giftMatch[1],\n                data: (() => {\n                  try {\n                    return JSON.parse(giftMatch[1]);\n                  } catch (e) {\n                    console.error('Failed to parse gift data:', giftMatch[1], e);\n                    return { name: '', value: 0 };\n                  }\n                })(),\n              });\n              return;\n            }\n\n            this.logEntries.push({ id, type: 'message', sender, content: value });\n            break;\n          }\n        }\n      } catch (e) {\n        console.error('Failed to parse log line:', line, e);\n      }\n    });\n  }\n\n  private _renderLogToString(): string {\n    const recallCommands: string[] = [];\n    const allEntriesString = this.logEntries\n      .map(e => {\n        if (e.recalled) {\n          const recallData = {\n            sender: 'sender' in e && e.sender === 'me' ? 'USER' : 'CHAR',\n            target_text:\n              typeof e.recalled_content === 'object' && e.recalled_content !== null\n                ? e.recalled_content.text\n                : e.recalled_content,\n            timestamp: e.recalled_timestamp,\n          };\n          if (recallData.target_text) {\n            recallCommands.push(`RECALL: ${JSON.stringify(recallData)}`);\n          }\n        }\n\n        if ('key' in e) {\n          return `${e.key}: ${JSON.stringify(e.data)}`;\n        }\n\n        if ('type' in e) {\n          if (e.type === 'time' || e.type === 'event') {\n            const key = e.type === 'time' ? 'TIME' : 'EVENT_LOG';\n            // console.log(`[BLMX] ${key}:`, e);\n            return `${key}: ${JSON.stringify(e.content)}`;\n          }\n\n          const prefix = e.sender === 'me' ? 'USER' : 'CHAR';\n          let content: string | object = e.content;\n          switch (e.type) {\n            case 'sticker':\n              content = `[: ${e.content}]`;\n              break;\n            case 'voice':\n              content = `[: ${JSON.stringify(e.content)}]`;\n              break;\n            case 'image':\n              content = `[: ${JSON.stringify(e.content)}]`;\n              break;\n            case 'location':\n              content = `[: ${e.content}]`;\n              break;\n            case 'file':\n              content = `[: ${e.content}]`;\n              break;\n            case 'gift':\n              content = `[: ${e.content}]`;\n              break;\n            case 'transfer':\n              content = `[: ${e.content}]`;\n              break;\n          }\n          return `${prefix}: ${content}`;\n        }\n        return ''; // Should not happen for valid entries\n      })\n      .join('\\n');\n\n    return [allEntriesString, ...recallCommands].filter(Boolean).join('\\n');\n  }\n\n  // addEntry - \n  addEntry(entry: LogEntry | null): void {\n    if (entry) {\n      // \n      if ('type' in entry && entry.type === 'sticker') {\n        this.logEntries.push(entry);\n        return;\n      }\n\n      // \n      const isDuplicate = this.logEntries.some(existingEntry => {\n        // \n        if ('key' in entry && 'key' in existingEntry) {\n          if (entry.key === existingEntry.key) {\n            // \n            if (entry.key.includes('_MOMENT')) {\n              const entryData = (entry as MomentEntry).data;\n              const existingData = (existingEntry as MomentEntry).data;\n              return (\n                existingData.text === entryData.text &&\n                existingData.date === entryData.date &&\n                existingData.time === entryData.time\n              );\n            }\n            // ID\n            else if (entry.key.includes('_COMMENT')) {\n              const entryData = (entry as CommentEntry).data;\n              const existingData = (existingEntry as CommentEntry).data;\n              return existingData.text === entryData.text && existingData.target_post_id === entryData.target_post_id;\n            }\n            // ID\n            else if (entry.key.includes('_LIKE')) {\n              const entryData = (entry as LikeEntry).data;\n              const existingData = (existingEntry as LikeEntry).data;\n              return existingData.target_post_id === entryData.target_post_id;\n            }\n          }\n        }\n\n        // \n        if ('type' in entry && 'type' in existingEntry) {\n          // \n          if (entry.type === existingEntry.type) {\n            // IDID\n            if ('id' in entry && 'id' in existingEntry && entry.id === existingEntry.id) {\n              return true;\n            }\n\n            // \n            if (\n              (entry.type === 'message' || entry.type === 'location' || entry.type === 'file') &&\n              'sender' in entry &&\n              'sender' in existingEntry &&\n              'content' in entry &&\n              'content' in existingEntry\n            ) {\n              return (\n                entry.sender === existingEntry.sender && (window as any)._.isEqual(entry.content, existingEntry.content)\n              );\n            }\n\n            // \n            if ((entry.type === 'time' || entry.type === 'event') && 'content' in entry && 'content' in existingEntry) {\n              return (window as any)._.isEqual(entry.content, existingEntry.content);\n            }\n\n            // image, voice, transfer, gift\n            if (\n              'content' in entry &&\n              'content' in existingEntry &&\n              (entry.type === 'image' || entry.type === 'voice' || entry.type === 'transfer' || entry.type === 'gift')\n            ) {\n              return (window as any)._.isEqual(entry.content, existingEntry.content);\n            }\n          }\n        }\n\n        return false;\n      });\n\n      if (isDuplicate) {\n        // console.log(`[BLMX] :`, entry);\n        return; // \n      }\n\n      this.logEntries.push(entry);\n\n      //  - \n      if ('type' in entry && (entry.type === 'time' || entry.type === 'event')) {\n        const data = entry.content;\n        const timeDate = new Date(`${data.date} ${data.time}`);\n        if (!isNaN(timeDate.getTime())) {\n          window.currentGameDate = timeDate;\n          const timeElement = document.getElementById('current-time');\n          if (timeElement) {\n            const timeString = `${window.currentGameDate\n              .getHours()\n              .toString()\n              .padStart(2, '0')}:${window.currentGameDate.getMinutes().toString().padStart(2, '0')}`;\n            timeElement.textContent = timeString;\n          }\n        }\n      }\n    }\n  }\n\n  getContextForAI(): string {\n    return this._renderLogToString();\n  }\n}\n","/**\n * \n * \n */\n\nimport { logger } from './debug-logger';\n\n/**\n * JSON\n * @param jsonString JSON\n * @param defaultValue \n * @returns \n */\nexport function safeJsonParse<T = any>(jsonString: string, defaultValue: T | null = null): T | null {\n  try {\n    return JSON.parse(jsonString);\n  } catch (error) {\n    logger.warn('Utils', 'JSON', { jsonString: jsonString.substring(0, 100), error });\n    return defaultValue;\n  }\n}\n\n/**\n * JSON\n * @param obj \n * @param defaultValue \n * @returns JSON\n */\nexport function safeJsonStringify(obj: any, defaultValue: string = '{}'): string {\n  try {\n    return JSON.stringify(obj);\n  } catch (error) {\n    logger.warn('Utils', 'JSON', { error });\n    return defaultValue;\n  }\n}\n\n/**\n *  - lodashdebounce\n * @param func \n * @param wait \n * @param options lodash debounce\n * @returns \n */\nexport function debounce<T extends (...args: any[]) => any>(\n  func: T,\n  wait: number,\n  options?: { leading?: boolean; trailing?: boolean; maxWait?: number },\n): T {\n  return (window as any)._.debounce(func, wait, options);\n}\n\n/**\n *  - lodashthrottle\n * @param func \n * @param wait \n * @param options lodash throttle\n * @returns \n */\nexport function throttle<T extends (...args: any[]) => any>(\n  func: T,\n  wait: number,\n  options?: { leading?: boolean; trailing?: boolean },\n): T {\n  return (window as any)._.throttle(func, wait, options);\n}\n\n/**\n * \n * @param ms \n * @returns Promise\n */\nexport function delay(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n/**\n * DOM - jQuery\n * @param selector CSS\n * @param context document\n * @returns jQuery\n */\nexport function $safe(selector: string, context?: Element | Document): JQuery<HTMLElement> {\n  try {\n    return context ? $(selector, context) : $(selector);\n  } catch (error) {\n    logger.warn('Utils', 'jQuery', { selector, error });\n    return $(); // jQuery\n  }\n}\n\n/**\n * DOM\n * @param selector CSS\n * @param context document\n * @returns null\n */\nexport function safeQuerySelector<T extends Element = Element>(\n  selector: string,\n  context: Document | Element = document,\n): T | null {\n  try {\n    return context.querySelector<T>(selector);\n  } catch (error) {\n    logger.warn('Utils', 'DOM', { selector, error });\n    return null;\n  }\n}\n\n/**\n * DOM- jQuery\n * @param selector CSS\n * @param context document\n * @returns \n */\nexport function safeQuerySelectorAll<T extends Element = Element>(\n  selector: string,\n  context: Document | Element = document,\n): T[] {\n  try {\n    const $elements = context ? $(selector, context) : $(selector);\n    return $elements.toArray() as unknown as T[];\n  } catch (error) {\n    logger.warn('Utils', 'DOM', { selector, error });\n    return [];\n  }\n}\n\n/**\n * \n * @param bytes \n * @returns \n */\nexport function formatFileSize(bytes: number): string {\n  if (bytes === 0) return '0 B';\n\n  const k = 1024;\n  const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\n/**\n * \n * @param timestamp \n * @param format \n * @returns \n */\nexport function formatTimestamp(timestamp: number, format: 'full' | 'time' | 'date' = 'full'): string {\n  const date = new Date(timestamp);\n\n  switch (format) {\n    case 'time':\n      return date.toLocaleTimeString('zh-CN', { hour12: false });\n    case 'date':\n      return date.toLocaleDateString('zh-CN');\n    case 'full':\n    default:\n      return date.toLocaleString('zh-CN', { hour12: false });\n  }\n}\n\n/**\n * ID\n * @param prefix \n * @returns ID\n */\nexport function generateId(prefix: string = 'id'): string {\n  return `${prefix}-${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;\n}\n\n/**\n *  - lodashcloneDeep\n * @param obj \n * @returns \n */\nexport function deepClone<T>(obj: T): T {\n  return (window as any)._.cloneDeep(obj);\n}\n\n/**\n * \n * @returns \n */\nexport function isMobileDevice(): boolean {\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n}\n\n/**\n * \n * @returns \n */\nexport function isTouchDevice(): boolean {\n  return 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n}\n\n/**\n * \n */\nexport const SafeStorage = {\n  /**\n   * \n   * @param key \n   * @param defaultValue \n   * @returns \n   */\n  getItem<T = string>(key: string, defaultValue: T | null = null): T | null {\n    try {\n      const item = localStorage.getItem(key);\n      if (item === null) return defaultValue;\n\n      // JSON\n      try {\n        return JSON.parse(item);\n      } catch {\n        return item as unknown as T;\n      }\n    } catch (error) {\n      logger.warn('Utils', '', { key, error });\n      return defaultValue;\n    }\n  },\n\n  /**\n   * \n   * @param key \n   * @param value \n   * @returns \n   */\n  setItem(key: string, value: any): boolean {\n    try {\n      const serialized = typeof value === 'string' ? value : JSON.stringify(value);\n      localStorage.setItem(key, serialized);\n      return true;\n    } catch (error) {\n      logger.warn('Utils', '', { key, error });\n      return false;\n    }\n  },\n\n  /**\n   * \n   * @param key \n   * @returns \n   */\n  removeItem(key: string): boolean {\n    try {\n      localStorage.removeItem(key);\n      return true;\n    } catch (error) {\n      logger.warn('Utils', '', { key, error });\n      return false;\n    }\n  },\n\n  /**\n   * \n   * @returns \n   */\n  clear(): boolean {\n    try {\n      localStorage.clear();\n      return true;\n    } catch (error) {\n      logger.warn('Utils', '', { error });\n      return false;\n    }\n  },\n};\n\n/**\n * \n */\nexport const ErrorHandler = {\n  /**\n   * \n   * @param fn \n   * @param errorMessage \n   * @returns null\n   */\n  async safeAsync<T>(fn: () => Promise<T>, errorMessage?: string): Promise<T | null> {\n    try {\n      return await fn();\n    } catch (error) {\n      logger.error('ErrorHandler', errorMessage || '', { error });\n      return null;\n    }\n  },\n\n  /**\n   * \n   * @param fn \n   * @param errorMessage \n   * @returns null\n   */\n  safeSync<T>(fn: () => T, errorMessage?: string): T | null {\n    try {\n      return fn();\n    } catch (error) {\n      logger.error('ErrorHandler', errorMessage || '', { error });\n      return null;\n    }\n  },\n};\n","// AI\n// AI\n\nimport { logger } from './debug-logger';\nimport { EventManager } from './event-manager';\nimport { MomentsManager } from './moments-manager';\nimport { BLMX_Protocol, LogEntry, getTavernHelper } from './script';\nimport { IEventHandler } from './types';\nimport { UIRenderer } from './ui-renderer';\nimport { safeJsonParse, safeJsonStringify } from './utils';\n\nexport class AiResponseManager {\n  private blmxManager: BLMX_Protocol;\n  private uiRenderer: UIRenderer;\n  private eventHandler: IEventHandler;\n  private momentsManager: MomentsManager;\n  private eventManager: EventManager;\n\n  private isGenerating: boolean = false;\n  private latestAiRawResponse: string = 'AI';\n  private latestSentPrompt: string = 'AI';\n\n  // \n  private rawAiResponse: string = '';\n  private fullPrompt: string = '';\n\n  constructor(\n    blmxManager: BLMX_Protocol,\n    uiRenderer: UIRenderer,\n    eventHandler: IEventHandler,\n    momentsManager: MomentsManager,\n  ) {\n    this.blmxManager = blmxManager;\n    this.uiRenderer = uiRenderer;\n    this.eventHandler = eventHandler;\n    this.momentsManager = momentsManager;\n    this.eventManager = new EventManager();\n\n    // \n    this.eventManager.addGlobalListener('js_generation_ended', (text: string) => {\n      this.rawAiResponse = text;\n      logger.debug('AiResponseManager', 'AI', { length: text.length });\n    });\n\n    this.eventManager.addGlobalListener('chat_completion_prompt_ready', (event_data: any) => {\n      this.fullPrompt = safeJsonStringify(event_data.chat);\n      logger.debug('AiResponseManager', '', { promptLength: this.fullPrompt.length });\n    });\n  }\n\n  // \n  getIsGenerating(): boolean {\n    return this.isGenerating;\n  }\n\n  // AI - \n  async triggerAiResponse(_immediate: boolean = false): Promise<void> {\n    if (this.isGenerating || !this.blmxManager) return;\n\n    // AppController\n\n    // \n    if ((window as any).BLMX_PROCESSING_AI_RESPONSE) {\n      logger.debug('AiResponseManager', 'AI');\n      return;\n    }\n\n    // \n    (window as any).BLMX_PROCESSING_AI_RESPONSE = true;\n    this.isGenerating = true;\n\n    try {\n      // getContextForAI should now get all necessary context from the main log.\n      let contextForAI = this.blmxManager.getContextForAI();\n\n      contextForAI +=\n        '\\nBLMX_LOGUSERCHAR\\n';\n      this.latestSentPrompt = contextForAI;\n\n      // Clean up 'isNewForAI' flags from the main log after generating context.\n      this.blmxManager.logEntries.forEach(entry => {\n        if ('type' in entry && entry.type === 'image' && 'content' in entry && (entry.content as any).isNewForAI) {\n          (entry.content as any).value = `[]`;\n          delete (entry.content as any).isNewForAI;\n        }\n      });\n\n      // \n      this.eventHandler.setHasPendingNotifications(false);\n\n      const MAX_RETRIES = 2;\n      let attempt = 0;\n      let success = false;\n\n      while (attempt <= MAX_RETRIES && !success) {\n        if (attempt > 0) {\n          logger.warn('AiResponseManager', `AI`, { attempt: attempt + 1, maxRetries: MAX_RETRIES + 1 });\n          await new Promise(resolve => setTimeout(resolve, 1000 * attempt));\n        }\n\n        try {\n          // \n          this.uiRenderer.showGeneratingIndicator();\n\n          const stream = await getTavernHelper().generate({ user_input: contextForAI, should_stream: true });\n          let finalAiResponse = '';\n\n          for await (const chunk of stream) {\n            finalAiResponse += chunk;\n          }\n\n          // \n          this.uiRenderer.hideGeneratingIndicator();\n          this.latestAiRawResponse = finalAiResponse.trim();\n\n          // \n          if (!this.rawAiResponse) {\n            this.rawAiResponse = finalAiResponse.trim();\n            logger.debug('AiResponseManager', 'AI', { length: this.rawAiResponse.length });\n          }\n\n          //  - \n          let processedResponse = finalAiResponse.trim();\n          const len = processedResponse.length;\n\n          // \n          if (len > 0 && len % 2 === 0) {\n            const firstHalf = processedResponse.substring(0, len / 2);\n            const secondHalf = processedResponse.substring(len / 2);\n\n            if (firstHalf === secondHalf && firstHalf.trim() !== '') {\n              logger.warn('AiResponseManager', 'AI');\n              processedResponse = firstHalf;\n            }\n          }\n\n          // \n          const lines = processedResponse.split('\\n').filter(line => line.trim() !== '');\n          if (lines.length > 1) {\n            const uniqueLines = (window as any)._.uniq(lines);\n            // \n            if (uniqueLines.length < lines.length * 0.7) {\n              logger.warn('AiResponseManager', 'AI');\n              processedResponse = uniqueLines.join('\\n');\n            }\n          }\n\n          if (processedResponse.trim()) {\n            // AI\n            success = await this.processAiResponse(processedResponse.trim());\n          }\n        } catch (error) {\n          logger.error('AiResponseManager', `${attempt}`, { attempt, error });\n          this.uiRenderer.hideGeneratingIndicator();\n\n          if (attempt >= MAX_RETRIES) {\n            this.showErrorMessage('AI (F12)');\n          }\n        }\n\n        attempt++;\n      }\n\n      if (!success && attempt > MAX_RETRIES) {\n        console.error(`[BLMX] AI generation failed after ${MAX_RETRIES + 1} attempts (empty response).`);\n        this.showErrorMessage('(AI)');\n        this.latestAiRawResponse = '[AI]';\n      }\n\n      await this.blmxManager.persistLogToStorage();\n\n      // AI\n      this.uiRenderer.refreshAllTimestamps();\n    } catch (error) {\n      console.error('[BLMX] Error in triggerAiResponse:', error);\n    } finally {\n      // \n      this.isGenerating = false;\n      (window as any).BLMX_PROCESSING_AI_RESPONSE = false;\n    }\n  }\n\n  // AI\n  private async processAiResponse(response: string): Promise<boolean> {\n    const entriesForAnimation: LogEntry[] = [];\n    let hasNewCharMoments = false;\n\n    // \n    const processedResponse = response.replace(/^\\s*[[{].*[\\]}]\\s*$/gm, match => {\n      const parsed = safeJsonParse(match.trim());\n      return parsed !== null ? match : '';\n    });\n\n    const responseLines = processedResponse.split('\\n').filter(line => line.trim() !== '');\n    logger.debug('AiResponseManager', 'AI', { lineCount: responseLines.length });\n\n    responseLines.forEach(line => {\n      const separatorIndex = line.indexOf(':');\n      if (separatorIndex === -1) {\n        logger.debug('AiResponseManager', '', { line });\n        return;\n      }\n\n      const key = line.substring(0, separatorIndex).trim();\n      const value = line.substring(separatorIndex + 1).trim();\n      logger.debug('AiResponseManager', '', {\n        key,\n        valuePreview: value.substring(0, 50) + (value.length > 50 ? '...' : ''),\n        valueLength: value.length,\n      });\n\n      if (!key || !value) return;\n\n      try {\n        let newEntry: LogEntry | null = null;\n        // case\n        const id = `ai-${Date.now()}-${Math.random()}`;\n        let voiceMatch: RegExpMatchArray | null = null;\n        let stickerMatch: RegExpMatchArray | null = null;\n        let imageMatch: RegExpMatchArray | null = null;\n        let locationMatch: RegExpMatchArray | null = null;\n        let transferMatch: RegExpMatchArray | null = null;\n        let fileMatch: RegExpMatchArray | null = null;\n        let giftMatch: RegExpMatchArray | null = null;\n\n        switch (key) {\n          case 'CHAR_MOMENT':\n          case 'CHAR_COMMENT':\n          case 'CHAR_LIKE':\n            newEntry = { key, data: safeJsonParse(value) } as any;\n            this.blmxManager.addEntry(newEntry);\n\n            // \n            if (newEntry) {\n              entriesForAnimation.push(newEntry);\n              hasNewCharMoments = true;\n            }\n\n            // \n            if (this.momentsManager) {\n              this.momentsManager.renderMomentsFeed();\n            }\n            break;\n\n          case 'message': {\n            const parsedMessageContent = safeJsonParse(value);\n            newEntry = {\n              id: `ai-${Date.now()}-${Math.random()}`,\n              type: 'message',\n              sender: 'them',\n              content: parsedMessageContent !== null ? parsedMessageContent : value,\n            } as any;\n            this.blmxManager.addEntry(newEntry);\n            if (newEntry) entriesForAnimation.push(newEntry);\n            break;\n          }\n\n          case 'CHAR':\n            // CHAR\n            voiceMatch = value.match(/^\\[:\\s*({.*})\\]/);\n            stickerMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            imageMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            locationMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            transferMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            fileMatch = value.match(/^\\[:\\s*(.*)\\]/);\n            giftMatch = value.match(/^\\[:\\s*(.*)\\]/);\n\n            if (voiceMatch) {\n              const parsedVoiceData = safeJsonParse(voiceMatch[1]);\n              newEntry = {\n                id,\n                type: 'voice',\n                sender: 'them',\n                content: parsedVoiceData || { text: '', duration: 0 },\n              };\n            } else if (stickerMatch) {\n              newEntry = {\n                id,\n                type: 'sticker',\n                sender: 'them',\n                content: stickerMatch[1],\n              };\n            } else if (imageMatch) {\n              const parsedImageData = safeJsonParse(imageMatch[1]);\n              if (parsedImageData !== null) {\n                // JSON\n                newEntry = {\n                  id,\n                  type: 'image',\n                  sender: 'them',\n                  content: parsedImageData,\n                };\n              } else {\n                // \n                newEntry = {\n                  id,\n                  type: 'image',\n                  sender: 'them',\n                  content: { type: 'desc', value: imageMatch[1] },\n                };\n              }\n            } else if (locationMatch) {\n              newEntry = {\n                id,\n                type: 'location',\n                sender: 'them',\n                content: locationMatch[1],\n              };\n            } else if (transferMatch) {\n              try {\n                newEntry = {\n                  id,\n                  type: 'transfer',\n                  sender: 'them',\n                  content: transferMatch[1],\n                  data: safeJsonParse(transferMatch[1]) || { amount: 0, message: '' },\n                } as any;\n              } catch (e) {\n                console.error('Failed to parse transfer data:', transferMatch[1], e);\n              }\n            } else if (fileMatch) {\n              try {\n                newEntry = {\n                  id,\n                  type: 'file',\n                  sender: 'them',\n                  content: fileMatch[1],\n                  data: safeJsonParse(fileMatch[1]) || { name: '', size: 0, url: '' },\n                } as any;\n              } catch (e) {\n                console.error('Failed to parse file data:', fileMatch[1], e);\n              }\n            } else if (giftMatch) {\n              try {\n                newEntry = {\n                  id,\n                  type: 'gift',\n                  sender: 'them',\n                  content: giftMatch[1],\n                  data: safeJsonParse(giftMatch[1]) || { name: '', value: 0 },\n                } as any;\n              } catch (e) {\n                console.error('Failed to parse gift data:', giftMatch[1], e);\n              }\n            } else {\n              // \n              newEntry = {\n                id,\n                type: 'message',\n                sender: 'them',\n                content: value,\n              };\n            }\n\n            if (newEntry) {\n              this.blmxManager.addEntry(newEntry);\n              entriesForAnimation.push(newEntry);\n            }\n            break;\n\n          case 'sticker': {\n            this.addStickerEntry(value, entriesForAnimation);\n            break;\n          }\n\n          case 'voice':\n            this.addJsonContentEntry('voice', value, entriesForAnimation);\n            break;\n\n          case 'image':\n            this.addJsonContentEntry('image', value, entriesForAnimation);\n            break;\n\n          case 'location':\n            this.addJsonContentEntry('location', value, entriesForAnimation);\n            break;\n\n          case 'transfer':\n            this.addJsonContentEntry('transfer', value, entriesForAnimation);\n            break;\n\n          case 'file':\n            this.addJsonContentEntry('file', value, entriesForAnimation);\n            break;\n\n          case 'gift':\n            this.addJsonContentEntry('gift', value, entriesForAnimation);\n            break;\n\n          case 'RECALL': {\n            const recallData = safeJsonParse(value);\n            const senderToFind = recallData.sender === 'USER' ? 'me' : 'them';\n            const entryToRecall = this.blmxManager.logEntries\n              .slice()\n              .reverse()\n              .find(\n                e =>\n                  'sender' in e && e.sender === senderToFind && 'content' in e && e.content === recallData.target_text,\n              ) as any;\n\n            if (entryToRecall) {\n              // \"\"\n              entriesForAnimation.push({\n                type: 'recall_instruction',\n                content: {\n                  originalEntry: entryToRecall,\n                  recallTimestamp: recallData.timestamp,\n                },\n              } as any);\n            }\n            break;\n          }\n\n          case 'EVENT_LOG':\n          case 'TIME':\n            newEntry = {\n              type: key === 'TIME' ? 'time' : 'event',\n              content: safeJsonParse(value),\n            } as any;\n            this.blmxManager.addEntry(newEntry);\n            if (newEntry) entriesForAnimation.push(newEntry);\n            break;\n\n          default:\n            logger.warn('AiResponseManager', 'AI', { key });\n        }\n      } catch (error) {\n        console.error(`[BLMX] Error processing AI response line \"${line}\":`, error);\n      }\n    });\n\n    // \n    if (entriesForAnimation.length > 0) {\n      await this.displayAiEntriesSequentially(entriesForAnimation);\n\n      // \n      if (hasNewCharMoments && this.momentsManager) {\n        // \n        const userInMomentsView = $('#moments-view').hasClass('active');\n        if (!userInMomentsView) {\n          this.momentsManager.setMomentNotification(true);\n        } else {\n          // \n          this.momentsManager.setLastMomentViewTimestamp();\n        }\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  // \n  private showErrorMessage(message: string): void {\n    const $errorDiv = $('<div>').addClass('ai-error-message').text(message);\n\n    $('.wechat-body').append($errorDiv);\n\n    setTimeout(() => {\n      $errorDiv.remove();\n    }, 5000);\n  }\n\n  // AI\n  async displayAiEntriesSequentially(entries: LogEntry[]): Promise<void> {\n    // \"\"\n    const messageLikeTypes = ['message', 'sticker', 'voice', 'image', 'location', 'transfer', 'file', 'gift'];\n    for (const entry of entries) {\n      // \n      const entryIndex = this.blmxManager.logEntries.findIndex(log => {\n        // IDID\n        if ('id' in log && 'id' in entry && log.id === entry.id) {\n          return true;\n        }\n\n        // key\n        if ('key' in log && 'key' in entry && log.key === entry.key) {\n          // \n          if (entry.key.includes('_MOMENT')) {\n            return (window as any)._.isEqual((log as any).data, (entry as any).data);\n          }\n\n          // \n          if (entry.key.includes('_LIKE') || entry.key.includes('_COMMENT')) {\n            return (window as any)._.isEqual((log as any).data, (entry as any).data);\n          }\n        }\n\n        // IDTIMEEVENT_LOG\n        if (\n          'type' in log &&\n          'type' in entry &&\n          (log.type === 'time' || log.type === 'event') &&\n          log.type === entry.type &&\n          (window as any)._.isEqual(log.content, (entry as any).content)\n        ) {\n          return true;\n        }\n\n        // \n        if (\n          'type' in log &&\n          'type' in entry &&\n          'sender' in log &&\n          'sender' in entry &&\n          'content' in log &&\n          'content' in entry &&\n          log.type === entry.type &&\n          log.sender === entry.sender\n        ) {\n          // \n          if (typeof log.content === 'string' && typeof (entry as any).content === 'string') {\n            return log.content === (entry as any).content;\n          }\n          // lodash\n          return (window as any)._.isEqual(log.content, (entry as any).content);\n        }\n\n        return false;\n      });\n\n      if (entryIndex !== -1) {\n        logger.debug('AiResponseManager', '', {\n          entryIndex,\n          entryType: 'type' in entry ? entry.type : 'unknown',\n        });\n      }\n\n      // \"\"\n      if ('type' in entry && messageLikeTypes.includes(entry.type)) {\n        // \n        this.uiRenderer.showTypingIndicator();\n\n        const messageText =\n          entry.type === 'message' ? entry.content : entry.type === 'voice' ? (entry.content as any).text : '';\n\n        const delay = this.uiRenderer.calculateTypingDelay(messageText);\n        await new Promise(resolve => setTimeout(resolve, delay));\n\n        this.uiRenderer.hideTypingIndicator();\n        this.uiRenderer.renderEntry(entry, entryIndex !== -1 ? entryIndex : undefined, true);\n      } else if ('type' in entry && (entry.type as any) === 'recall_instruction') {\n        // \n        const { originalEntry, recallTimestamp } = (entry as any).content;\n\n        // \n        const entryToUpdate = this.blmxManager.logEntries.find(log => 'id' in log && log.id === originalEntry.id);\n        if (entryToUpdate) {\n          (entryToUpdate as any).recalled = true;\n          (entryToUpdate as any).recalled_content = originalEntry.content;\n          (entryToUpdate as any).recalled_timestamp = recallTimestamp;\n\n          // \n          const recallEntryIndex = this.blmxManager.logEntries.indexOf(entryToUpdate);\n\n          // UIDOM\n          const $elementToReplace = $(`[data-message-id=\"${originalEntry.id}\"]`);\n          if ($elementToReplace.length) {\n            // \n            await new Promise(resolve => setTimeout(resolve, 500));\n            this.uiRenderer.renderRecallNotice(entryToUpdate, $elementToReplace[0] as HTMLElement, recallEntryIndex);\n          }\n        }\n      } else {\n        //  ( EVENT_LOG, TIME)\n        this.uiRenderer.renderEntry(entry, entryIndex !== -1 ? entryIndex : undefined, true);\n      }\n\n      // \n      await new Promise(resolve => setTimeout(resolve, 800));\n    }\n\n    // \n    this.uiRenderer.refreshAllTimestamps();\n  }\n\n  /**\n   * \n   */\n  cleanup(): void {\n    this.eventManager.cleanup();\n  }\n\n  // AI\n  getLatestAiRawResponse(): string {\n    return this.latestAiRawResponse;\n  }\n\n  // \n  getLatestSentPrompt(): string {\n    return this.latestSentPrompt;\n  }\n\n  // AI\n  getRawAiResponse(): string {\n    return this.rawAiResponse;\n  }\n\n  // \n  getFullPrompt(): string {\n    return this.fullPrompt;\n  }\n\n  private addStickerEntry(value: string, entriesForAnimation: LogEntry[]): void {\n    const parsedStickerContent = safeJsonParse(value);\n    const entry = {\n      id: `ai-sticker-${Date.now()}-${Math.random()}`,\n      type: 'sticker',\n      sender: 'them',\n      content: parsedStickerContent !== null ? parsedStickerContent : value,\n    } as any;\n    this.blmxManager.addEntry(entry);\n    entriesForAnimation.push(entry);\n  }\n\n  private addJsonContentEntry(\n    type: 'voice' | 'image' | 'location' | 'transfer' | 'file' | 'gift',\n    value: string,\n    entriesForAnimation: LogEntry[],\n  ): void {\n    const entry = {\n      id: `ai-${type}-${Date.now()}-${Math.random()}`,\n      type,\n      sender: 'them',\n      content: JSON.parse(value),\n    } as any;\n    this.blmxManager.addEntry(entry);\n    entriesForAnimation.push(entry);\n  }\n}\n","// \n// \n\nimport { SafeStorage } from './utils';\n\n// \nexport interface AppConfig {\n  avatars: {\n    user: string;\n    char: string;\n  };\n  names: {\n    user: string;\n    char: string;\n  };\n  charRemark: string;\n  currentCharId: string;\n}\n\n// \nexport interface Sticker {\n  label: string;\n  url: string;\n}\n\n// \nexport const STORAGE_KEYS = {\n  GLOBAL_STICKER: 'blmx_wechat_stickers_global_blmx', // \n  CHAR_STICKER_PREFIX: 'blmx_char_stickers_blmx_', // \n  PHONE_SIZE: 'blmx_phone_size',\n  FULLSCREEN_SIZE: 'blmx_fullscreen_size',\n  STICKER_SIZE: 'blmx_sticker_size',\n  MOMENT_NOTIFICATION: 'blmx_moment_notification',\n  MOMENT_LAST_VIEW: 'blmx_moment_last_view',\n  USER_NAME_PREFIX: 'blmx_user_name_',\n  USER_AVATAR_PREFIX: 'blmx_user_avatar_',\n  CHAR_AVATAR_PREFIX: 'blmx_char_avatar_',\n  CHAR_REMARK_PREFIX: 'blmx_remark_',\n  COVER_PHOTO_PREFIX: 'blmx_cover_photo_',\n  SIGNATURE_PREFIX: 'blmx_signature_',\n  INPUT_PLACEHOLDER_PREFIX: 'blmx_input_placeholder_',\n  LAST_NOTIFIED_VERSION: 'blmx_last_notified_version',\n} as const;\n\n// \nexport const PHONE_SIZES = {\n  default: '48.75rem', // : 48.75rem (780px)\n  medium: '42rem', // : 42rem (672px)\n  small: '36rem', // : 36rem (576px)\n} as const;\n\n// \nexport const FULLSCREEN_SIZES = {\n  default: 100, // 100%\n  large: 130, // 130%\n  xlarge: 160, // 160%\n} as const;\n\n// \nexport class ConfigManager {\n  private config: AppConfig;\n  private defaultGlobalStickers: Sticker[] = [{ label: '', url: 'https://files.catbox.moe/3j0tpc.jpeg' }];\n\n  constructor() {\n    // \n    this.config = {\n      avatars: { user: '', char: '' },\n      names: { user: 'User', char: 'Character' },\n      charRemark: '',\n      currentCharId: '',\n    };\n  }\n\n  // \n  getConfig(): AppConfig {\n    return this.config;\n  }\n\n  // \n  setConfig(config: Partial<AppConfig>): void {\n    this.config = { ...this.config, ...config };\n  }\n\n  // \n  getDisplayName(type: 'user' | 'char'): string {\n    if (type === 'char') {\n      return this.config.charRemark || this.config.names.char;\n    }\n    return this.config.names.user;\n  }\n\n  // \n  updateAvatar(avatarType: 'user' | 'char', newUrl: string): void {\n    this.config.avatars[avatarType] = newUrl;\n    const storageKey =\n      avatarType === 'user'\n        ? `${STORAGE_KEYS.USER_AVATAR_PREFIX}${this.config.currentCharId}`\n        : `${STORAGE_KEYS.CHAR_AVATAR_PREFIX}${this.config.currentCharId}`;\n    localStorage.setItem(storageKey, newUrl);\n  }\n\n  // \n  updateCharRemark(newRemark: string): void {\n    this.config.charRemark = newRemark;\n    localStorage.setItem(`${STORAGE_KEYS.CHAR_REMARK_PREFIX}${this.config.currentCharId}`, newRemark);\n  }\n\n  // \n  updateUserName(newName: string): void {\n    this.config.names.user = newName;\n    localStorage.setItem(`${STORAGE_KEYS.USER_NAME_PREFIX}${this.config.currentCharId}`, newName);\n  }\n\n  // URL - \n  findStickerUrlByName(name: string): string | undefined {\n    // \n    let customGlobalStickers = SafeStorage.getItem<any[]>(STORAGE_KEYS.GLOBAL_STICKER, []) || [];\n    let charStickers =\n      SafeStorage.getItem<any[]>(`${STORAGE_KEYS.CHAR_STICKER_PREFIX}${this.config.currentCharId}`, []) || [];\n\n    // \n    if (customGlobalStickers.length === 0) {\n      const oldGlobalStickers = SafeStorage.getItem<any[]>('blmx_wechat_stickers_global', []) || [];\n      if (oldGlobalStickers.length > 0) {\n        // \n        SafeStorage.setItem(STORAGE_KEYS.GLOBAL_STICKER, oldGlobalStickers);\n        customGlobalStickers = oldGlobalStickers;\n        console.log('[BLMX] ');\n      }\n    }\n\n    if (charStickers.length === 0) {\n      const oldCharStickers = SafeStorage.getItem<any[]>(`blmx_char_stickers_${this.config.currentCharId}`, []) || [];\n      if (oldCharStickers.length > 0) {\n        // \n        SafeStorage.setItem(`${STORAGE_KEYS.CHAR_STICKER_PREFIX}${this.config.currentCharId}`, oldCharStickers);\n        charStickers = oldCharStickers;\n        console.log('[BLMX] ');\n      }\n    }\n\n    const globalStickers = [...this.defaultGlobalStickers, ...customGlobalStickers];\n    return [...globalStickers, ...charStickers].find((s: Sticker) => s.label === name)?.url;\n  }\n\n  // localStorage\n  async loadFromStorage(charData: any): Promise<void> {\n    this.config.currentCharId = charData.name;\n    this.config.names.char = charData.name;\n\n    // \n    this.config.charRemark =\n      localStorage.getItem(`${STORAGE_KEYS.CHAR_REMARK_PREFIX}${this.config.currentCharId}`) || '';\n    this.config.names.user =\n      localStorage.getItem(`${STORAGE_KEYS.USER_NAME_PREFIX}${this.config.currentCharId}`) || 'User';\n    this.config.avatars.user =\n      localStorage.getItem(`${STORAGE_KEYS.USER_AVATAR_PREFIX}${this.config.currentCharId}`) || '';\n\n    // \n    const savedCharAvatar = localStorage.getItem(`${STORAGE_KEYS.CHAR_AVATAR_PREFIX}${this.config.currentCharId}`);\n    if (savedCharAvatar) {\n      this.config.avatars.char = savedCharAvatar;\n    } else {\n      // \n      // \n      this.config.avatars.char = '';\n    }\n  }\n\n  // \n  getMomentNotificationState(): boolean {\n    const notificationState = localStorage.getItem(`${STORAGE_KEYS.MOMENT_NOTIFICATION}_${this.config.currentCharId}`);\n    return notificationState === 'true';\n  }\n\n  // \n  setMomentNotificationState(value: boolean): void {\n    localStorage.setItem(`${STORAGE_KEYS.MOMENT_NOTIFICATION}_${this.config.currentCharId}`, value.toString());\n  }\n\n  // \n  getLastMomentViewTimestamp(): number {\n    const lastView = localStorage.getItem(`${STORAGE_KEYS.MOMENT_LAST_VIEW}_${this.config.currentCharId}`);\n    return lastView ? parseInt(lastView, 10) : 0;\n  }\n\n  // \n  setLastMomentViewTimestamp(timestamp: number): void {\n    localStorage.setItem(`${STORAGE_KEYS.MOMENT_LAST_VIEW}_${this.config.currentCharId}`, timestamp.toString());\n  }\n\n  // \n  getSavedCoverPhoto(): string | null {\n    return localStorage.getItem(`${STORAGE_KEYS.COVER_PHOTO_PREFIX}${this.config.currentCharId}`);\n  }\n\n  // \n  setCoverPhoto(url: string): void {\n    localStorage.setItem(`${STORAGE_KEYS.COVER_PHOTO_PREFIX}${this.config.currentCharId}`, url);\n  }\n\n  // \n  getSavedSignature(): string {\n    return localStorage.getItem(`${STORAGE_KEYS.SIGNATURE_PREFIX}${this.config.currentCharId}`) || '';\n  }\n\n  // \n  setSignature(signature: string): void {\n    localStorage.setItem(`${STORAGE_KEYS.SIGNATURE_PREFIX}${this.config.currentCharId}`, signature);\n  }\n\n  // \n  getSavedInputPlaceholder(): string | null {\n    return localStorage.getItem(`${STORAGE_KEYS.INPUT_PLACEHOLDER_PREFIX}${this.config.currentCharId}`);\n  }\n\n  // \n  setInputPlaceholder(placeholder: string): void {\n    localStorage.setItem(`${STORAGE_KEYS.INPUT_PLACEHOLDER_PREFIX}${this.config.currentCharId}`, placeholder);\n  }\n\n  // \n  getPhoneSize(): 'default' | 'medium' | 'small' {\n    const savedSize = localStorage.getItem(STORAGE_KEYS.PHONE_SIZE) || 'default';\n    return savedSize === 'medium' ? 'medium' : savedSize === 'small' ? 'small' : 'default';\n  }\n\n  // \n  setPhoneSize(size: 'default' | 'medium' | 'small'): void {\n    localStorage.setItem(STORAGE_KEYS.PHONE_SIZE, size);\n  }\n\n  // \n  getFullscreenSize(): number {\n    const savedSize = localStorage.getItem(STORAGE_KEYS.FULLSCREEN_SIZE) || '100';\n    const size = parseInt(savedSize, 10);\n    // \n    return Math.max(50, Math.min(200, size));\n  }\n\n  // \n  setFullscreenSize(size: number): void {\n    // \n    const clampedSize = Math.max(50, Math.min(200, size));\n    localStorage.setItem(STORAGE_KEYS.FULLSCREEN_SIZE, clampedSize.toString());\n  }\n\n  // \n  getStickerSize(): number {\n    const savedSize = localStorage.getItem(STORAGE_KEYS.STICKER_SIZE) || '120';\n    return parseInt(savedSize, 10);\n  }\n\n  // \n  setStickerSize(size: number): void {\n    localStorage.setItem(STORAGE_KEYS.STICKER_SIZE, size.toString());\n  }\n\n  // \n  getLastNotifiedVersion(): string | null {\n    return localStorage.getItem(STORAGE_KEYS.LAST_NOTIFIED_VERSION);\n  }\n\n  // \n  setLastNotifiedVersion(version: string): void {\n    localStorage.setItem(STORAGE_KEYS.LAST_NOTIFIED_VERSION, version);\n  }\n}\n","// debug-data.ts\n// \n// \n\nimport { LogEntry } from './script';\n\n// \nconst getCurrentDate = (): string => {\n  const now = new Date();\n  return `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now\n    .getDate()\n    .toString()\n    .padStart(2, '0')}`;\n};\n\nconst getCurrentTime = (): string => {\n  const now = new Date();\n  return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;\n};\n\n// ID\nconst generateId = (prefix: string): string => {\n  return `${prefix}_${Date.now()}_${Math.floor(Math.random() * 1000)}`;\n};\n\n// \nexport const debugData: LogEntry[] = [\n  // \n  {\n    type: 'time',\n    content: {\n      date: getCurrentDate(),\n      time: getCurrentTime(),\n    },\n  },\n\n  // \n  {\n    type: 'event',\n    content: {\n      date: getCurrentDate(),\n      time: getCurrentTime(),\n      description: '',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('msg'),\n    type: 'message',\n    sender: 'me',\n    content: '',\n  },\n\n  //  - AI\n  {\n    id: generateId('msg'),\n    type: 'message',\n    sender: 'them',\n    content: 'AI',\n  },\n\n  //  - \n  {\n    id: generateId('sticker'),\n    type: 'sticker',\n    sender: 'me',\n    content: '',\n  },\n\n  //  - AI\n  {\n    id: generateId('sticker'),\n    type: 'sticker',\n    sender: 'them',\n    content: '',\n  },\n\n  //  - \n  {\n    id: generateId('img'),\n    type: 'image',\n    sender: 'me',\n    content: {\n      type: 'url',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n    },\n  },\n\n  //  - AI\n  {\n    id: generateId('img'),\n    type: 'image',\n    sender: 'them',\n    content: {\n      type: 'url',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('img'),\n    type: 'image',\n    sender: 'them',\n    content: {\n      type: 'desc',\n      value: '',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('voice'),\n    type: 'voice',\n    sender: 'me',\n    content: {\n      text: '',\n      duration: 5,\n    },\n  },\n\n  //  - AI\n  {\n    id: generateId('voice'),\n    type: 'voice',\n    sender: 'them',\n    content: {\n      text: 'AI',\n      duration: 8,\n    },\n  },\n\n  //  - \n  {\n    id: generateId('loc'),\n    type: 'location',\n    sender: 'me',\n    content: '',\n  },\n\n  //  - AI\n  {\n    id: generateId('loc'),\n    type: 'location',\n    sender: 'them',\n    content: '',\n  },\n\n  //  - \n  {\n    id: generateId('transfer'),\n    type: 'transfer',\n    sender: 'me',\n    content: JSON.stringify({\n      amount: '88.88',\n      note: '',\n      status: 'sent',\n    }),\n    data: {\n      amount: '88.88',\n      note: '',\n      status: 'sent',\n    },\n  },\n\n  //  - AI\n  {\n    id: generateId('transfer'),\n    type: 'transfer',\n    sender: 'them',\n    content: JSON.stringify({\n      amount: '88.88',\n      note: '',\n      status: 'accepted',\n    }),\n    data: {\n      amount: '88.88',\n      note: '',\n      status: 'accepted',\n    },\n  },\n\n  //  - AI\n  {\n    id: generateId('transfer'),\n    type: 'transfer',\n    sender: 'them',\n    content: JSON.stringify({\n      amount: '66.66',\n      note: 'AI',\n      status: 'sent',\n    }),\n    data: {\n      amount: '66.66',\n      note: 'AI',\n      status: 'sent',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('transfer'),\n    type: 'transfer',\n    sender: 'me',\n    content: JSON.stringify({\n      amount: '66.66',\n      note: 'AI',\n      status: 'accepted',\n    }),\n    data: {\n      amount: '66.66',\n      note: 'AI',\n      status: 'accepted',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('gift'),\n    type: 'gift',\n    sender: 'me',\n    content: JSON.stringify({\n      name: '',\n      price: '99.99',\n      status: 'sent',\n    }),\n    data: {\n      name: '',\n      price: '99.99',\n      status: 'sent',\n    },\n  },\n\n  //  - AI\n  {\n    id: generateId('gift'),\n    type: 'gift',\n    sender: 'them',\n    content: JSON.stringify({\n      name: '',\n      status: 'accepted',\n    }),\n    data: {\n      name: '',\n      status: 'accepted',\n    },\n  },\n\n  //  - AI\n  {\n    id: generateId('gift'),\n    type: 'gift',\n    sender: 'them',\n    content: JSON.stringify({\n      name: '',\n      price: '39.99',\n      status: 'sent',\n    }),\n    data: {\n      name: '',\n      price: '39.99',\n      status: 'sent',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('gift'),\n    type: 'gift',\n    sender: 'me',\n    content: JSON.stringify({\n      name: '',\n      status: 'accepted',\n    }),\n    data: {\n      name: '',\n      status: 'accepted',\n    },\n  },\n\n  //  - \n  {\n    id: generateId('file'),\n    type: 'file',\n    sender: 'me',\n    content: '.docx',\n  },\n\n  //  - AI\n  {\n    id: generateId('file'),\n    type: 'file',\n    sender: 'them',\n    content: '.pdf',\n  },\n\n  //  - \n  {\n    key: 'USER_MOMENT',\n    data: {\n      text: '',\n      image: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg',\n      image_type: 'url',\n      date: getCurrentDate(),\n      time: getCurrentTime(),\n    },\n  },\n\n  //  - AI\n  {\n    key: 'CHAR_MOMENT',\n    data: {\n      text: 'AI',\n      image: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      image_type: 'url',\n      date: getCurrentDate(),\n      time: getCurrentTime(),\n    },\n  },\n\n  //  - \n  {\n    key: 'CHAR_MOMENT',\n    data: {\n      text: '',\n      image: '',\n      image_type: 'none',\n      date: getCurrentDate(),\n      time: getCurrentTime(),\n    },\n  },\n\n  //  - \n  {\n    key: 'USER_MOMENT',\n    data: {\n      text: '',\n      image: '',\n      image_type: 'desc',\n      image_desc: '',\n      date: getCurrentDate(),\n      time: getCurrentTime(),\n    },\n  },\n\n  //  - \n  {\n    key: 'USER_COMMENT',\n    data: {\n      text: '',\n      target_post_id: 1,\n    },\n  },\n\n  //  - AI\n  {\n    key: 'CHAR_COMMENT',\n    data: {\n      text: 'AI',\n      target_post_id: 0,\n    },\n  },\n\n  //  - \n  {\n    key: 'USER_LIKE',\n    data: {\n      target_post_id: 1,\n    },\n  },\n\n  //  - AI\n  {\n    key: 'CHAR_LIKE',\n    data: {\n      target_post_id: 0,\n    },\n  },\n\n  // \n  {\n    id: generateId('msg'),\n    type: 'message',\n    sender: 'them',\n    content: '',\n    recalled: true,\n    recalled_content: '',\n    recalled_timestamp: getCurrentTime(),\n  },\n];\n\n//  - \nexport function loadDebugData(blmxManager: any): void {\n  // \n  const isDevelopment = window.location.hostname === 'localhost' || window.location.search.includes('debug=true');\n\n  if (!isDevelopment) {\n    console.log('[DEBUG] ');\n    return;\n  }\n\n  console.log('[DEBUG] ...');\n\n  // \n  const batchSize = 10;\n  let index = 0;\n\n  const addBatch = () => {\n    const batch = debugData.slice(index, index + batchSize);\n    batch.forEach(entry => {\n      blmxManager.addEntry(entry);\n    });\n\n    index += batchSize;\n\n    if (index < debugData.length) {\n      // requestAnimationFrameUI\n      requestAnimationFrame(addBatch);\n    } else {\n      console.log('[DEBUG] ', debugData.length, '');\n    }\n  };\n\n  addBatch();\n}\n\n// \nexport function clearDebugData(blmxManager: any): void {\n  console.log('[DEBUG] ...');\n  blmxManager.logEntries = [];\n  console.log('[DEBUG] ');\n}\n\n// \nexport function addTestEntry(blmxManager: any, entryType: string): void {\n  let entry: any = null;\n\n  switch (entryType) {\n    case 'text-user':\n      entry = {\n        id: generateId('msg'),\n        type: 'message',\n        sender: 'me',\n        content: '',\n      };\n      break;\n    case 'text-char':\n      entry = {\n        id: generateId('msg'),\n        type: 'message',\n        sender: 'them',\n        content: 'AI',\n      };\n      break;\n    case 'sticker-user':\n      entry = {\n        id: generateId('sticker'),\n        type: 'sticker',\n        sender: 'me',\n        content: '',\n      };\n      break;\n    case 'sticker-char':\n      entry = {\n        id: generateId('sticker'),\n        type: 'sticker',\n        sender: 'them',\n        content: '',\n      };\n      break;\n    case 'image-user':\n      entry = {\n        id: generateId('img'),\n        type: 'image',\n        sender: 'me',\n        content: {\n          type: 'url',\n          value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n        },\n      };\n      break;\n    case 'image-char':\n      entry = {\n        id: generateId('img'),\n        type: 'image',\n        sender: 'them',\n        content: {\n          type: 'url',\n          value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n        },\n      };\n      break;\n    case 'voice-user':\n      entry = {\n        id: generateId('voice'),\n        type: 'voice',\n        sender: 'me',\n        content: {\n          text: '',\n          duration: 3,\n        },\n      };\n      break;\n    case 'voice-char':\n      entry = {\n        id: generateId('voice'),\n        type: 'voice',\n        sender: 'them',\n        content: {\n          text: 'AI',\n          duration: 4,\n        },\n      };\n      break;\n    case 'transfer-user':\n      entry = {\n        id: generateId('transfer'),\n        type: 'transfer',\n        sender: 'me',\n        content: JSON.stringify({\n          amount: '88.88',\n          note: '',\n          status: 'sent',\n        }),\n        data: {\n          amount: '88.88',\n          note: '',\n          status: 'sent',\n        },\n      };\n      break;\n    case 'transfer-char':\n      entry = {\n        id: generateId('transfer'),\n        type: 'transfer',\n        sender: 'them',\n        content: JSON.stringify({\n          amount: '66.66',\n          note: 'AI',\n          status: 'sent',\n        }),\n        data: {\n          amount: '66.66',\n          note: 'AI',\n          status: 'sent',\n        },\n      };\n      break;\n    case 'gift-user':\n      entry = {\n        id: generateId('gift'),\n        type: 'gift',\n        sender: 'me',\n        content: JSON.stringify({\n          name: '',\n          price: '99.99',\n          status: 'sent',\n        }),\n        data: {\n          name: '',\n          price: '99.99',\n          status: 'sent',\n        },\n      };\n      break;\n    case 'gift-char':\n      entry = {\n        id: generateId('gift'),\n        type: 'gift',\n        sender: 'them',\n        content: JSON.stringify({\n          name: '',\n          price: '39.99',\n          status: 'sent',\n        }),\n        data: {\n          name: '',\n          price: '39.99',\n          status: 'sent',\n        },\n      };\n      break;\n    case 'moment-user':\n      entry = {\n        key: 'USER_MOMENT',\n        data: {\n          text: '',\n          image: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg',\n          image_type: 'url',\n          date: getCurrentDate(),\n          time: getCurrentTime(),\n        },\n      };\n      break;\n    case 'moment-char':\n      entry = {\n        key: 'CHAR_MOMENT',\n        data: {\n          text: 'AI',\n          image: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n          image_type: 'url',\n          date: getCurrentDate(),\n          time: getCurrentTime(),\n        },\n      };\n      break;\n    case 'event-short':\n      entry = {\n        type: 'event',\n        content: {\n          date: getCurrentDate(),\n          time: getCurrentTime(),\n          description: '',\n        },\n      };\n      break;\n    case 'event-long':\n      entry = {\n        type: 'event',\n        content: {\n          date: getCurrentDate(),\n          time: getCurrentTime(),\n          description:\n            '',\n        },\n      };\n      break;\n    case 'time':\n      entry = {\n        type: 'time',\n        content: {\n          date: getCurrentDate(),\n          time: getCurrentTime(),\n        },\n      };\n      break;\n    default:\n      console.error('[DEBUG] :', entryType);\n      return;\n  }\n\n  if (entry) {\n    blmxManager.addEntry(entry);\n    blmxManager.persistLogToStorage();\n    console.log(`[DEBUG] : ${entryType}`, entry);\n  }\n}\n\n// \nexport function showTestEntryTypes(): void {\n  console.log('[BLMX Debug] :');\n  console.log('- text-user: ');\n  console.log('- text-char: AI');\n  console.log('- sticker-user: ');\n  console.log('- sticker-char: AI');\n  console.log('- image-user: ');\n  console.log('- image-char: AI');\n  console.log('- voice-user: ');\n  console.log('- voice-char: AI');\n  console.log('- transfer-user: ');\n  console.log('- gift-user: ');\n  console.log('- moment-user: ');\n  console.log('- moment-char: AI');\n  console.log('- event-short: ');\n  console.log('- event-long: ');\n  console.log('- time: ');\n}\n\n// \nexport function showDebugInfo(appController: any): void {\n  console.log('[BLMX Debug] :');\n\n  try {\n    // \n    const rawAiResponse = appController.getRawAiResponse ? appController.getRawAiResponse() : '';\n    const fullPrompt = appController.getFullPrompt ? appController.getFullPrompt() : '';\n    const latestAiRawResponse = appController.getLatestAiRawResponse\n      ? appController.getLatestAiRawResponse()\n      : '';\n    const latestSentPrompt = appController.getLatestSentPrompt ? appController.getLatestSentPrompt() : '';\n\n    console.log('- AI:', rawAiResponse);\n    console.log('- :', fullPrompt);\n    console.log('- AI:', latestAiRawResponse);\n    console.log('- AI:', latestSentPrompt);\n  } catch (error) {\n    console.error('[BLMX Debug] :', error);\n  }\n}\n","// \n// \n\nimport { ConfigManager, Sticker } from './config-manager';\nimport { DialogManager } from './dialog-manager';\nimport { LogEntry } from './script';\n\nexport class InputHandler {\n  private configManager: ConfigManager;\n  private onStageAndDisplayEntry: (entry: LogEntry) => void;\n  private onUpdateFooterButtonsState: () => void;\n  private dialogManager: DialogManager;\n\n  constructor(\n    configManager: ConfigManager,\n    onStageAndDisplayEntry: (entry: LogEntry) => void,\n    onUpdateFooterButtonsState: () => void,\n  ) {\n    this.configManager = configManager;\n    this.onStageAndDisplayEntry = onStageAndDisplayEntry;\n    this.onUpdateFooterButtonsState = onUpdateFooterButtonsState;\n    this.dialogManager = DialogManager.getInstance();\n  }\n\n  // \n  async handleTransferAccept(data: any): Promise<void> {\n    const result = await this.dialogManager.showReceiveDialog('transfer', data);\n    if (result === 'accept') {\n      const acceptData = { ...data, status: 'accepted' };\n      this.onStageAndDisplayEntry({\n        type: 'transfer',\n        sender: 'me',\n        content: JSON.stringify(acceptData),\n        data: acceptData,\n        id: `transfer-${Date.now()}`,\n      } as any);\n    } else if (result === 'reject') {\n      const rejectData = { ...data, status: 'rejected' };\n      this.onStageAndDisplayEntry({\n        type: 'transfer',\n        sender: 'me',\n        content: JSON.stringify(rejectData),\n        data: rejectData,\n        id: `transfer-${Date.now()}`,\n      } as any);\n    }\n  }\n\n  // \n  async handleGiftAction(data: any): Promise<void> {\n    const result = await this.dialogManager.showReceiveDialog('gift', data);\n    if (result === 'accept') {\n      const receiptData = { name: data.name, status: 'accepted' };\n      this.onStageAndDisplayEntry({\n        type: 'gift',\n        sender: 'me',\n        content: JSON.stringify(receiptData),\n        data: receiptData,\n        id: `gift-${Date.now()}`,\n      } as any);\n    } else if (result === 'reject') {\n      const receiptData = { name: data.name, status: 'rejected' };\n      this.onStageAndDisplayEntry({\n        type: 'gift',\n        sender: 'me',\n        content: JSON.stringify(receiptData),\n        data: receiptData,\n        id: `gift-${Date.now()}`,\n      } as any);\n    }\n    // \n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendTextMessage(text: string): void {\n    if (!text.trim()) return;\n\n    const messageEntry: LogEntry = {\n      type: 'message',\n      sender: 'me',\n      content: text.trim(),\n      id: `msg-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(messageEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  //  - \n  sendSticker(stickerName: string): void {\n    const stickerUrl = this.configManager.findStickerUrlByName(stickerName);\n    if (!stickerUrl) {\n      console.error(`[BLMX] : ${stickerName}`);\n      return;\n    }\n\n    // \n    const stickerEntry: LogEntry = {\n      type: 'sticker',\n      sender: 'me',\n      content: stickerName, // \n      id: `sticker-${Date.now()}-${Math.random()}`, // ID\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(stickerEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendImage(imageData: { type: 'url' | 'file'; value: string; name?: string }): void {\n    const imageEntry: LogEntry = {\n      type: 'image',\n      sender: 'me',\n      content: imageData,\n      id: `image-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(imageEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendVoiceMessage(voiceData: { text: string; duration?: number }): void {\n    const voiceEntry: LogEntry = {\n      type: 'voice',\n      sender: 'me',\n      content: voiceData,\n      id: `voice-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(voiceEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendLocation(locationData: { name: string; address: string; latitude?: number; longitude?: number }): void {\n    const locationEntry: LogEntry = {\n      type: 'location',\n      sender: 'me',\n      content: locationData,\n      id: `location-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(locationEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendFile(fileData: { name: string; size: number; type: string; url?: string }): void {\n    const fileEntry: LogEntry = {\n      type: 'file',\n      sender: 'me',\n      content: fileData,\n      id: `file-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(fileEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendTransfer(transferData: { amount: number; note?: string }): void {\n    const transferEntry: LogEntry = {\n      type: 'transfer',\n      sender: 'me',\n      content: transferData,\n      id: `transfer-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(transferEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  sendGift(giftData: { name: string; image?: string; description?: string }): void {\n    const giftEntry: LogEntry = {\n      type: 'gift',\n      sender: 'me',\n      content: giftData,\n      id: `gift-${Date.now()}-${Math.random()}`,\n      timestamp: Date.now(),\n    } as any;\n\n    this.onStageAndDisplayEntry(giftEntry);\n    this.onUpdateFooterButtonsState();\n  }\n\n  // \n  async handleFileUpload(file: File): Promise<void> {\n    try {\n      if (file.type.startsWith('image/')) {\n        // \n        const reader = new FileReader();\n        reader.onload = e => {\n          const result = e.target?.result as string;\n          this.sendImage({\n            type: 'file',\n            value: result,\n            name: file.name,\n          });\n        };\n        reader.readAsDataURL(file);\n      } else {\n        // \n        this.sendFile({\n          name: file.name,\n          size: file.size,\n          type: file.type,\n        });\n      }\n    } catch (error) {\n      console.error('[BLMX] :', error);\n      const dialogManager = DialogManager.getInstance();\n      await dialogManager.alert('', '');\n    }\n  }\n\n  // URL\n  async handleImageUrl(url: string): Promise<void> {\n    if (!url.trim()) return;\n\n    // URL\n    try {\n      new URL(url);\n      this.sendImage({\n        type: 'url',\n        value: url.trim(),\n      });\n    } catch (error) {\n      const dialogManager = DialogManager.getInstance();\n      await dialogManager.alert('URL', 'URL');\n    }\n  }\n\n  // \n  async handleVoiceRecording(): Promise<void> {\n    try {\n      const dialogManager = DialogManager.getInstance();\n\n      // \n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n        await dialogManager.alert('', '');\n        return;\n      }\n\n      // \n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\n      //  MediaRecorder API\n      // \n      const text = await dialogManager.prompt(':', '', '');\n      if (text) {\n        this.sendVoiceMessage({\n          text: text.trim(),\n          duration: Math.floor(Math.random() * 30) + 5, // 5-35\n        });\n      }\n\n      // \n      stream.getTracks().forEach(track => track.stop());\n    } catch (error) {\n      console.error('[BLMX] :', error);\n      const dialogManager = DialogManager.getInstance();\n      await dialogManager.alert('', '');\n    }\n  }\n\n  // \n  handleLocationShare(): void {\n    // \n    if (!navigator.geolocation) {\n      alert('');\n      return;\n    }\n\n    navigator.geolocation.getCurrentPosition(\n      position => {\n        const { latitude, longitude } = position.coords;\n        const locationName = prompt(':') || '';\n        const address = prompt(':') || `: ${latitude.toFixed(6)}, : ${longitude.toFixed(6)}`;\n\n        this.sendLocation({\n          name: locationName,\n          address: address,\n          latitude: latitude,\n          longitude: longitude,\n        });\n      },\n      error => {\n        console.error('[BLMX] :', error);\n        // \n        const locationName = prompt(':');\n        const address = prompt(':');\n\n        if (locationName && address) {\n          this.sendLocation({\n            name: locationName,\n            address: address,\n          });\n        }\n      },\n    );\n  }\n\n  // \n  handleTransferSend(): void {\n    const amountStr = prompt(':');\n    if (!amountStr) return;\n\n    const amount = parseFloat(amountStr);\n    if (isNaN(amount) || amount <= 0) {\n      alert('');\n      return;\n    }\n\n    const note = prompt(':') || '';\n\n    this.sendTransfer({\n      amount: amount,\n      note: note,\n    });\n  }\n\n  // \n  handleGiftSend(): void {\n    const giftName = prompt(':');\n    if (!giftName) return;\n\n    const giftImage = prompt('URL:') || '';\n    const description = prompt(':') || '';\n\n    this.sendGift({\n      name: giftName,\n      image: giftImage,\n      description: description,\n    });\n  }\n\n  //  - \n  getStickerList(): Sticker[] {\n    // \n    let globalStickers = JSON.parse(localStorage.getItem('blmx_wechat_stickers_global_blmx') || '[]');\n    let charStickers = JSON.parse(\n      localStorage.getItem(`blmx_char_stickers_blmx_${this.configManager.getConfig().currentCharId}`) || '[]',\n    );\n\n    // \n    if (globalStickers.length === 0) {\n      const oldGlobalStickers = JSON.parse(localStorage.getItem('blmx_wechat_stickers_global') || '[]');\n      if (oldGlobalStickers.length > 0) {\n        globalStickers = oldGlobalStickers;\n      }\n    }\n\n    if (charStickers.length === 0) {\n      const oldCharStickers = JSON.parse(\n        localStorage.getItem(`blmx_char_stickers_${this.configManager.getConfig().currentCharId}`) || '[]',\n      );\n      if (oldCharStickers.length > 0) {\n        charStickers = oldCharStickers;\n      }\n    }\n\n    return [...globalStickers, ...charStickers];\n  }\n\n  // \n  searchStickers(query: string): Sticker[] {\n    const stickers = this.getStickerList();\n    if (!query.trim()) return stickers;\n\n    const searchTerm = query.toLowerCase();\n    return stickers.filter(sticker => sticker.label.toLowerCase().includes(searchTerm));\n  }\n\n  // \n  clearInput(): void {\n    const inputElement = document.getElementById('wechat-input-field') as HTMLInputElement;\n    if (inputElement) {\n      inputElement.value = '';\n      this.onUpdateFooterButtonsState();\n    }\n  }\n\n  // \n  focusInput(): void {\n    const inputElement = document.getElementById('wechat-input-field') as HTMLInputElement;\n    if (inputElement) {\n      inputElement.focus();\n    }\n  }\n\n  // \n  getInputText(): string {\n    const inputElement = document.getElementById('wechat-input-field') as HTMLInputElement;\n    return inputElement ? inputElement.value : '';\n  }\n\n  // \n  setInputText(text: string): void {\n    const inputElement = document.getElementById('wechat-input-field') as HTMLInputElement;\n    if (inputElement) {\n      inputElement.value = text;\n      this.onUpdateFooterButtonsState();\n    }\n  }\n}\n","// \n// \n\nimport { ConfigManager } from './config-manager';\nimport { BLMX_Protocol, LogEntry, MomentEntry } from './script';\nimport { UIRenderer } from './ui-renderer';\n\n// Allow use of lodash as global\n// @ts-ignore\ndeclare const _: any;\n\nexport class MomentsManager {\n  private blmxManager: BLMX_Protocol;\n  private configManager: ConfigManager;\n  private uiRenderer: UIRenderer;\n  private hasMomentNotification: boolean = false;\n\n  constructor(blmxManager: BLMX_Protocol, configManager: ConfigManager, uiRenderer: UIRenderer) {\n    this.blmxManager = blmxManager;\n    this.configManager = configManager;\n    this.uiRenderer = uiRenderer;\n\n    // \n    this.hasMomentNotification = this.configManager.getMomentNotificationState();\n  }\n\n  // \n  renderMomentsFeed(): void {\n    if (!this.blmxManager || !this.uiRenderer) return;\n\n    const logEntries = this.blmxManager.logEntries;\n    const avatars = this.configManager.getConfig().avatars;\n\n    // jQuery\n    const $momentsFeedList = $('#moments-feed-list');\n    if (!$momentsFeedList.length) return;\n\n    // \n    const isCurrentlyInMomentsView = this.isInMomentsView();\n    if (isCurrentlyInMomentsView) {\n      this.setLastMomentViewTimestamp();\n      // \n      this.setMomentNotification(false);\n    }\n\n    $momentsFeedList.empty();\n\n    // lodash\n    const posts: Record<number, any> = {};\n    const momentPostLogIndices = _.reduce(\n      logEntries,\n      (result: number[], entry: LogEntry, index: number) => {\n        if ('key' in entry && entry.key.includes('_MOMENT')) {\n          result.push(index);\n        }\n        return result;\n      },\n      [],\n    );\n\n    // \n    _.forEach(momentPostLogIndices, (logIndex: number) => {\n      const entry = logEntries[logIndex];\n      posts[logIndex] = { ...entry, likes: [], comments: [], id: logIndex };\n    });\n\n    // CHAR\n    let hasNewCharMoments = false;\n    const lastViewTimestamp = this.getLastMomentViewTimestamp();\n    const userInMomentsView = this.isInMomentsView();\n\n    // \n    _.forEach(logEntries, (entry: LogEntry, index: number) => {\n      if ('key' in entry && (entry.key.includes('_LIKE') || entry.key.includes('_COMMENT'))) {\n        // target_post_id\n        const targetPostAbsoluteIndex = momentPostLogIndices[parseInt((entry as any).data.target_post_id, 10)];\n        const targetPost = posts[targetPostAbsoluteIndex];\n\n        if (targetPost) {\n          if (entry.key.includes('_LIKE')) {\n            const likerName = entry.key.startsWith('USER') ? this.getDisplayName('user') : this.getDisplayName('char');\n            if (!_.some(targetPost.likes, (l: any) => l.name === likerName)) {\n              targetPost.likes.push({ key: entry.key, name: likerName, originalLogIndex: index });\n\n              // CHAR\n              if (entry.key.startsWith('CHAR') && !userInMomentsView) {\n                // \n                // \n                const isNewActivity = index > lastViewTimestamp;\n                if (isNewActivity) {\n                  hasNewCharMoments = true;\n                }\n              }\n            }\n          } else {\n            targetPost.comments.push({ ...entry, originalLogIndex: index });\n\n            // CHAR\n            if (entry.key.startsWith('CHAR') && !userInMomentsView) {\n              // \n              const isNewActivity = index > lastViewTimestamp;\n              if (isNewActivity) {\n                hasNewCharMoments = true;\n              }\n            }\n          }\n        } else {\n          console.warn(\n            `[BLMX] Could not find target post for interaction. target_post_id: ${\n              (entry as any).data.target_post_id\n            }, available posts: ${Object.keys(posts).join(', ')}`,\n            entry,\n          );\n        }\n      }\n\n      // CHAR\n      if ('key' in entry && entry.key === 'CHAR_MOMENT') {\n        // \n        const isNewMoment = index > lastViewTimestamp;\n\n        // \n        if (isNewMoment && !userInMomentsView) {\n          hasNewCharMoments = true;\n        }\n      }\n    });\n\n    //  - \n    if (!userInMomentsView) {\n      this.setMomentNotification(hasNewCharMoments);\n      // console.log('[BLMX] :', {\n      //   hasNewCharMoments,\n      //   lastViewIndex: this.getLastMomentViewTimestamp(),\n      //   currentLogLength: this.blmxManager.logEntries.length,\n      //   userInMomentsView,\n      // });\n    }\n\n    // \n    _.chain(posts)\n      .values()\n      .reverse()\n      .forEach((post: any) => {\n        const fromUser = post.key.startsWith('USER');\n        const authorName = fromUser ? this.getDisplayName('user') : this.getDisplayName('char');\n        const authorAvatar = fromUser ? avatars.user : avatars.char;\n\n        const $li = $('<li>').addClass('moment-post').attr('data-post-id', post.id);\n\n        const momentSequenceId = momentPostLogIndices.indexOf(post.id);\n        $li.attr('data-moment-sequence-id', String(momentSequenceId));\n\n        // moment-idmomentSequenceId\n        // \n        $li.attr('data-moment-id', String(momentSequenceId));\n\n        // HTML\n        let mediaHtml = '';\n        if (post.data.image_type === 'url' && post.data.image) {\n          mediaHtml = `<img src=\"${post.data.image}\" class=\"post-media-image\" />`;\n        } else if (post.data.image_type === 'desc' && post.data.image) {\n          mediaHtml = `<div class=\"image-desc-content\"><div class=\"text-wrapper\">${post.data.image}</div></div>`;\n        }\n\n        // HTML\n        let interactionsHtml = '';\n        if (post.likes.length > 0 || post.comments.length > 0) {\n          const likersHtml =\n            post.likes.length > 0\n              ? `<div class=\"likes-section\"><i class=\"fas fa-heart\"></i> ${_.map(\n                  post.likes,\n                  (l: any) => `<span class=\"liker-name\">${l.name}</span>`,\n                ).join(', ')}</div>`\n              : '';\n\n          const commentsHtml =\n            post.comments.length > 0\n              ? `<ul class=\"comments-section\">${_.map(\n                  post.comments,\n                  (c: any) =>\n                    `<li><span class=\"comment-author\">${\n                      c.key.startsWith('USER') ? this.getDisplayName('user') : this.getDisplayName('char')\n                    }</span>: ${c.data.text}</li>`,\n                ).join('')}</ul>`\n              : '';\n\n          interactionsHtml = `<div class=\"post-interactions\">${likersHtml}${commentsHtml}</div>`;\n        }\n\n        // \n        const displayTime = this.formatMomentTime(post.data.date, post.data.time);\n        const deleteBtnHtml = `<span class=\"delete-moment-btn\" title=\"\"></span>`;\n\n        $li.html(`<img src=\"${authorAvatar}\" class=\"post-author-avatar\" />\n                 <div class=\"post-details\">\n                     <span class=\"post-author-name\">${authorName}</span>\n                     <p class=\"post-content\">${post.data.text || ''}</p>\n                     <div class=\"post-media\">${mediaHtml}</div>\n                     <div class=\"post-meta\">\n                         <div class=\"post-meta-left\">\n                             <span class=\"timestamp\">${displayTime}</span>\n                             ${deleteBtnHtml}\n                         </div>\n                         <div class=\"post-actions\">\n                             <span class=\"comment-button\" title=\"/\"><i class=\"fas fa-comment-dots\"></i></span>\n                         </div>\n                     </div>\n                     ${interactionsHtml}\n                 </div>`);\n\n        $momentsFeedList.append($li);\n      })\n      .value();\n\n    // \n    const savedCoverPhoto = this.configManager.getSavedCoverPhoto();\n    if (savedCoverPhoto) {\n      $('#moments-cover-photo').attr('src', savedCoverPhoto);\n    }\n  }\n\n  // \n  private formatMomentTime(dateString: string, timeString: string): string {\n    try {\n      // \n      const now = window.currentGameDate ? new Date(window.currentGameDate) : new Date();\n      const date = new Date(`${dateString} ${timeString}`);\n\n      const diffMs = now.getTime() - date.getTime();\n      const diffMins = Math.floor(diffMs / 60000);\n      const diffHours = Math.floor(diffMins / 60);\n      const diffDays = Math.floor(diffHours / 24);\n\n      if (diffMins < 1) {\n        return '';\n      } else if (diffMins < 60) {\n        return `${diffMins}`;\n      } else if (diffHours < 24) {\n        return `${diffHours}`;\n      } else if (diffDays === 1) {\n        return '';\n      } else if (diffDays === 2) {\n        return '';\n      } else if (diffDays < 7) {\n        return `${diffDays}`;\n      } else {\n        // \n        const month = date.getMonth() + 1;\n        const day = date.getDate();\n        return `${month}${day}`;\n      }\n    } catch (error) {\n      console.error(':', error);\n      return `${dateString} ${timeString}`;\n    }\n  }\n\n  // \n  private getDisplayName(type: 'user' | 'char'): string {\n    return this.configManager.getDisplayName(type);\n  }\n\n  // \n  private isInMomentsView(): boolean {\n    return $('#moments-view').hasClass('active');\n  }\n\n  // \n  hasMomentNotifications(): boolean {\n    return this.configManager.getMomentNotificationState();\n  }\n\n  // \n  setMomentNotification(value: boolean): void {\n    this.hasMomentNotification = value;\n    this.configManager.setMomentNotificationState(value);\n    // UI\n    this.updateMomentNotificationIndicator();\n  }\n\n  // \n  private updateMomentNotificationIndicator(): void {\n    const $optionsBtn = $('#wechat-options-btn');\n    if (this.hasMomentNotification) {\n      if (!$optionsBtn.find('.notification-dot').length) {\n        $optionsBtn.append('<span class=\"notification-dot\"></span>');\n      }\n    } else {\n      $optionsBtn.find('.notification-dot').remove();\n    }\n  }\n\n  // \n  private getLastMomentViewTimestamp(): number {\n    return this.configManager.getLastMomentViewTimestamp();\n  }\n\n  // \n  setLastMomentViewTimestamp(): void {\n    // \n    const currentLogLength = this.blmxManager.logEntries.length;\n    this.configManager.setLastMomentViewTimestamp(currentLogLength);\n  }\n\n  // \n  onEnterMomentsView(): void {\n    // console.log('[BLMX] ');\n\n    // jQuery\n    const savedCoverPhoto = this.configManager.getSavedCoverPhoto();\n    if (savedCoverPhoto) {\n      $('#moments-cover-photo').attr('src', savedCoverPhoto);\n    }\n\n    // jQuery\n    const savedSignature = this.configManager.getSavedSignature();\n    $('#user-signature-display').text(savedSignature || '');\n\n    // \n    this.setMomentNotification(false);\n\n    // \n    this.setLastMomentViewTimestamp();\n\n    // \n    // console.log('[BLMX] :', this.blmxManager.logEntries.length);\n  }\n\n  // \n  createUserMoment(text: string, image: string = '', imageType: string = 'none'): MomentEntry {\n    // \n    const now = window.currentGameDate || new Date();\n    const dateStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(\n      now.getDate(),\n    ).padStart(2, '0')}`;\n    const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;\n\n    return {\n      key: 'USER_MOMENT',\n      data: {\n        text,\n        image,\n        image_type: imageType as 'url' | 'desc' | 'none',\n        date: dateStr,\n        time: timeStr,\n      },\n    };\n  }\n\n  // \n  notifyMomentChange(type: 'name' | 'signature', _oldValue: string, newValue: string): void {\n    let text = '';\n    switch (type) {\n      case 'name':\n        text = `\"${newValue}\"`;\n        break;\n      case 'signature':\n        text = `\"${newValue}\"`;\n        break;\n    }\n\n    const momentEntry = this.createUserMoment(text);\n\n    // \n    this.blmxManager.addEntry(momentEntry);\n    this.renderMomentsFeed();\n  }\n\n  // \n  notifyRecallViaMoments(sender: 'USER' | 'CHAR', targetText: string): any {\n    // \n    const now = window.currentGameDate || new Date();\n    const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;\n\n    // \n    const recallEntry = {\n      key: 'RECALL',\n      data: {\n        sender: sender,\n        target_text: targetText,\n        timestamp: `${timeStr}`,\n      },\n    };\n\n    // \n    this.blmxManager.addEntry(recallEntry as any);\n\n    return recallEntry;\n  }\n}\n","//  - \n// jQuerylodash\nimport { Theme, ThemeManager } from './theme-manager';\n\nexport class ThemeEditor {\n  private themeManager: ThemeManager;\n  private onThemeChanged?: () => void;\n  private $modal: JQuery<HTMLElement>;\n  private checkboxHandlers: Map<string, (e: JQuery.ClickEvent) => void> = new Map();\n\n  constructor(themeManager: ThemeManager, onThemeChanged?: () => void) {\n    this.themeManager = themeManager;\n    this.onThemeChanged = onThemeChanged;\n    this.$modal = $('#theme-editor-modal');\n  }\n\n  //  - jQuery\n  setupThemeSelector(): void {\n    const $container = $('.theme-options');\n    if (!$container.length) return;\n\n    // \n    $container.empty();\n\n    // \n    const themes = this.themeManager.getThemes();\n\n    // lodash\n    _.forEach(themes, theme => {\n      const $themeButton = $('<div>').addClass('theme-option').css({\n        width: 'calc(50% - 0.5rem)',\n        'aspect-ratio': '1/1',\n        'border-radius': '8px',\n        'background-color': theme.colors.primary,\n        display: 'flex',\n        'flex-direction': 'column',\n        'align-items': 'center',\n        'justify-content': 'center',\n        cursor: 'pointer',\n        position: 'relative',\n        overflow: 'hidden',\n        'box-shadow': '0 2px 8px rgba(0,0,0,0.1)',\n      });\n\n      // \n      const $previewEl = $('<div>').css({\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        width: '100%',\n        height: '100%',\n        background: `linear-gradient(135deg, ${theme.colors.gradientStart}, ${theme.colors.gradientEnd})`,\n      });\n\n      // \n      const $bubblePreview = $('<div>').css({\n        position: 'relative',\n        width: '70%',\n        height: '60%',\n        display: 'flex',\n        'flex-direction': 'column',\n        'justify-content': 'space-between',\n        'z-index': 1,\n      });\n\n      const $themBubble = $('<div>').css({\n        'align-self': 'flex-start',\n        width: '60%',\n        height: '40%',\n        'background-color': theme.colors.bubbleThemBg,\n        'border-radius': '8px',\n      });\n\n      const $meBubble = $('<div>').css({\n        'align-self': 'flex-end',\n        width: '60%',\n        height: '40%',\n        'background-color': theme.colors.bubbleMeBg,\n        'border-radius': '8px',\n      });\n\n      $bubblePreview.append($themBubble, $meBubble);\n\n      // \n      const $nameEl = $('<div>').text(theme.displayName).css({\n        position: 'relative',\n        color: 'white',\n        'font-size': '0.8rem',\n        'font-weight': '500',\n        'margin-top': '5px',\n        'text-shadow': '0 1px 2px rgba(0,0,0,0.3)',\n        'z-index': 1,\n      });\n\n      $themeButton.append($previewEl, $bubblePreview, $nameEl);\n\n      // \n      $themeButton.on('click', () => {\n        this.themeManager.switchTheme(theme.name);\n        // \n        if (this.onThemeChanged) {\n          this.onThemeChanged();\n        }\n      });\n\n      $container.append($themeButton);\n    });\n\n    // \n    this.addCustomThemeSelector($container);\n  }\n\n  // \n  addCustomThemeEditButton(): void {\n    // \n    const $settingsPanel = $('.settings-panel');\n    if (!$settingsPanel.length) return;\n\n    // \n    const $editButton = $('<div>').addClass('custom-theme-edit-button').css({\n      width: '100%',\n      padding: '12px 16px',\n      margin: '8px 0',\n      'border-radius': '8px',\n      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n      color: 'white',\n      'font-size': '0.9rem',\n      'font-weight': '500',\n      'text-align': 'center',\n      cursor: 'pointer',\n      'box-shadow': '0 2px 8px rgba(0,0,0,0.1)',\n      transition: 'all 0.2s ease',\n      display: 'flex',\n      'align-items': 'center',\n      'justify-content': 'center',\n      gap: '8px',\n    });\n\n    const $icon = $('<span>').html('');\n    const $text = $('<span>').text('');\n\n    $editButton.append($icon, $text);\n\n    // \n    $editButton\n      .on('mouseenter', function () {\n        $(this).css('transform', 'translateY(-1px)');\n      })\n      .on('mouseleave', function () {\n        $(this).css('transform', 'translateY(0)');\n      });\n\n    // \n    $editButton.on('click', () => {\n      this.openThemeEditor();\n    });\n\n    // \n    // \n    const $themeOptions = $settingsPanel.find('.theme-options');\n    if ($themeOptions.length) {\n      $themeOptions.after($editButton);\n    } else {\n      $settingsPanel.append($editButton);\n    }\n  }\n\n  // \n  private addCustomThemeSelector($container: JQuery<HTMLElement>): void {\n    // \n    const customThemeData = this.getCustomThemeData();\n\n    const $customButton = $('<div>').addClass('theme-option custom-theme-option').css({\n      width: 'calc(50% - 0.5rem)',\n      'aspect-ratio': '1/1',\n      'border-radius': '8px',\n      background: customThemeData.background,\n      display: 'flex',\n      'flex-direction': 'column',\n      'align-items': 'center',\n      'justify-content': 'center',\n      cursor: 'pointer',\n      position: 'relative',\n      overflow: 'hidden',\n      'box-shadow': '0 2px 8px rgba(0,0,0,0.1)',\n    });\n\n    // \n    const $previewEl = $('<div>').css({\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      width: '100%',\n      height: '100%',\n      background: customThemeData.gradient,\n    });\n\n    const $iconEl = $('<div>').html('').css({\n      'font-size': '2rem',\n      'margin-bottom': '5px',\n      position: 'relative',\n      'z-index': 1,\n    });\n\n    const $nameEl = $('<div>').text(customThemeData.displayName).css({\n      color: 'white',\n      'font-size': '0.8rem',\n      'font-weight': '500',\n      'text-shadow': '0 1px 2px rgba(0,0,0,0.3)',\n      position: 'relative',\n      'z-index': 1,\n    });\n\n    $customButton.append($previewEl, $iconEl, $nameEl);\n\n    $customButton.on('click', () => {\n      // \n      this.themeManager.switchTheme('custom');\n      // \n      if (this.onThemeChanged) {\n        this.onThemeChanged();\n      }\n    });\n\n    $container.append($customButton);\n  }\n\n  // \n  private getCustomThemeData(): { displayName: string; background: string; gradient: string } {\n    try {\n      const customThemeJson = localStorage.getItem('blmx_custom_theme');\n      if (customThemeJson) {\n        const customTheme = JSON.parse(customThemeJson);\n        const primaryColor = customTheme.colors?.primary || '#667eea';\n        const gradientStart = customTheme.colors?.gradientStart || primaryColor;\n        const gradientEnd = customTheme.colors?.gradientEnd || primaryColor;\n\n        return {\n          displayName: customTheme.displayName || '',\n          background: primaryColor,\n          gradient: `linear-gradient(135deg, ${gradientStart}, ${gradientEnd})`,\n        };\n      }\n    } catch (error) {\n      console.warn('Failed to load custom theme data:', error);\n    }\n\n    // \n    return {\n      displayName: '',\n      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n      gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n    };\n  }\n\n  // \n  updateCustomThemeButton(): void {\n    const $customButton = $('.custom-theme-option');\n    if (!$customButton.length) return;\n\n    const customThemeData = this.getCustomThemeData();\n\n    // \n    const $previewEl = $customButton.children().eq(0); // \n    if ($previewEl.length) {\n      $previewEl.css('background', customThemeData.gradient);\n    }\n\n    // \n    const $nameEl = $customButton.children().last();\n    if ($nameEl.length && $nameEl.text() !== customThemeData.displayName) {\n      $nameEl.text(customThemeData.displayName);\n    }\n\n    // \n    $customButton.css('background', customThemeData.background);\n  }\n\n  //  - jQuery\n  openThemeEditor(): void {\n    if (!this.$modal.length) return;\n\n    // \n    const currentTheme = this.themeManager.getCurrentThemeWithAppliedValues();\n    this.fillThemeEditor(currentTheme);\n\n    // checkbox\n    this.setupCheckboxes();\n\n    // \n    this.$modal.show();\n  }\n\n  //  - jQuery\n  closeThemeEditor(): void {\n    this.$modal.hide();\n    // checkbox\n    this.cleanupCheckboxes();\n  }\n\n  //  - jQuery\n  private fillThemeEditor(theme: Theme): void {\n    // jQuery\n    const $nameInput = $('#theme-name-input');\n    const $darkModeToggle = $('#dark-mode-toggle');\n    const $singleColorIconsToggle = $('#single-color-icons-toggle');\n\n    //  - \n    let themeName: string;\n    if (theme.name === 'custom') {\n      // displayName\n      themeName = theme.displayName || '';\n    } else {\n      // \" + \"\n      themeName = ` ${theme.displayName}`;\n    }\n    $nameInput.val(themeName);\n\n    //  - lodash\n    const colorMappings = {\n      '#phone-frame-color': theme.colors.phoneFrame,\n      '#primary-color': theme.colors.primary,\n      '#light-color': theme.colors.light,\n      '#ultra-light-color': theme.colors.ultraLight,\n      '#deep-color': theme.colors.deep,\n      '#text-primary-color': theme.colors.textPrimary,\n      '#text-secondary-color': theme.colors.textSecondary,\n      '#bubble-me-color': theme.colors.bubbleMeBg,\n      '#bubble-me-text-color': theme.colors.bubbleMeText,\n      '#bubble-them-color': theme.colors.bubbleThemBg,\n      '#bubble-them-text-color': theme.colors.bubbleThemText,\n      '#status-bar-color': theme.colors.statusBarColor,\n      '#dynamic-island-color': theme.colors.dynamicIslandColor,\n      '#border-color': theme.colors.borderColor,\n      '#shadow-color': theme.colors.shadowColor,\n    };\n\n    // lodashforEach\n    _.forEach(colorMappings, (colorValue, selector) => {\n      $(selector).val(this.convertToHex(colorValue));\n    });\n\n    // checkbox\n    $darkModeToggle.prop('checked', theme.colors.isDarkMode);\n    $singleColorIconsToggle.prop('checked', theme.colors.useSingleColorIcons || false);\n\n    // checkboxopenThemeEditor()setupCheckboxes()\n  }\n\n  // checkbox - jQuery\n  private setupCheckboxes(): void {\n    // \n    this.cleanupCheckboxes();\n\n    // checkbox\n    this.setupSingleCheckboxWithJQuery('dark-mode-toggle', 'dark-mode-checkbox-button');\n\n    // checkbox\n    this.setupSingleCheckboxWithJQuery('single-color-icons-toggle', 'single-color-icons-checkbox-button');\n  }\n\n  // checkbox\n  private cleanupCheckboxes(): void {\n    // \n    this.checkboxHandlers.forEach((handler, id) => {\n      $(`#${id}`).off('click', handler);\n    });\n    this.checkboxHandlers.clear();\n  }\n\n  // jQuerycheckbox\n  private setupSingleCheckboxWithJQuery(checkboxId: string, buttonId: string): void {\n    const $checkbox = $(`#${checkboxId}`);\n    const $button = $(`#${buttonId}`);\n\n    if (!$checkbox.length || !$button.length) return;\n\n    // checkbox\n    const updateCheckboxState = (checked: boolean) => {\n      $button.toggleClass('checked', checked);\n    };\n\n    // \n    const handleClick = (e: JQuery.ClickEvent) => {\n      e.preventDefault();\n      e.stopPropagation();\n\n      const checkbox = $checkbox[0] as HTMLInputElement;\n      checkbox.checked = !checkbox.checked;\n      updateCheckboxState(checkbox.checked);\n    };\n\n    // \n    this.checkboxHandlers.set(buttonId, handleClick);\n\n    // \n    $button.on('click', handleClick);\n\n    // \n    const checkbox = $checkbox[0] as HTMLInputElement;\n    updateCheckboxState(checkbox.checked);\n  }\n\n  // \n  resetThemeEditor(): void {\n    // \n    const blueTheme = this.themeManager.getThemes().blue;\n    this.fillThemeEditor(blueTheme);\n\n    // \n    this.setupCheckboxes();\n  }\n\n  // JSON - \n  exportThemeAsJSON(): void {\n    try {\n      const currentTheme = this.getCurrentThemeFromEditor();\n      const wallpaperManager = this.themeManager.getWallpaperManager();\n\n      // \n      const currentWallpapers = {\n        chat: wallpaperManager.getCurrentWallpaper('chat'),\n        home: wallpaperManager.getCurrentWallpaper('home'),\n        settings: wallpaperManager.getCurrentWallpaper('settings'),\n      };\n\n      // \n      const themeData = {\n        name: currentTheme.name,\n        displayName: currentTheme.displayName,\n        version: '1.0',\n        exportDate: new Date().toISOString(),\n        colors: currentTheme.colors,\n        wallpapers: currentWallpapers, // \n      };\n\n      const jsonString = JSON.stringify(themeData, null, 2);\n      const blob = new Blob([jsonString], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n\n      // custom-.json\n      const themeName = currentTheme.displayName || '';\n      const safeThemeName = themeName.replace(/[<>:\"/\\\\|?*]/g, '_'); // \n      const fileName = `custom-${safeThemeName}.json`;\n\n      // jQuery\n      const $a = $('<a>', {\n        href: url,\n        download: fileName,\n        css: { display: 'none' },\n      });\n      $('body').append($a);\n      $a[0].click();\n      $a.remove();\n      URL.revokeObjectURL(url);\n\n      console.log(`[ThemeEditor] JSON: ${fileName}`);\n    } catch (error) {\n      console.error('[ThemeEditor] JSON:', error);\n      alert('');\n    }\n  }\n\n  // \n  importTheme(): void {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = '.json';\n    input.style.display = 'none';\n\n    input.addEventListener('change', event => {\n      const file = (event.target as HTMLInputElement).files?.[0];\n      if (!file) return;\n\n      const reader = new FileReader();\n      reader.onload = e => {\n        try {\n          const content = e.target?.result as string;\n          let themeData;\n\n          if (file.name.endsWith('.json')) {\n            themeData = JSON.parse(content);\n          } else {\n            throw new Error('JSON');\n          }\n\n          // \n          if (!this.validateThemeData(themeData)) {\n            throw new Error('');\n          }\n\n          // \n          this.applyImportedTheme(themeData);\n          console.log('[ThemeEditor] ');\n          alert('');\n        } catch (error) {\n          console.error('[ThemeEditor] :', error);\n          alert(`: ${error instanceof Error ? error.message : ''}`);\n        }\n      };\n\n      reader.readAsText(file);\n    });\n\n    // jQueryDOM\n    $('body').append(input);\n    input.click();\n    $(input).remove();\n  }\n\n  //  - jQuery\n  private getCurrentThemeFromEditor(): Theme {\n    // jQuery\n    const getValue = (selector: string, defaultValue: string = '') => ($(selector).val() as string) || defaultValue;\n    const getChecked = (selector: string) => $(selector).prop('checked') as boolean;\n\n    return this.createCustomTheme({\n      name: getValue('#theme-name-input', ''),\n      phoneFrame: getValue('#phone-frame-color', '#b4d0fa'),\n      primary: getValue('#primary-color', '#72adf3'),\n      light: getValue('#light-color', '#a8cbeb'),\n      ultraLight: getValue('#ultra-light-color', '#e8f4fd'),\n      deep: getValue('#deep-color', '#2c5282'),\n      textPrimary: getValue('#text-primary-color', 'rgb(139, 162, 186)'),\n      textSecondary: getValue('#text-secondary-color', '#64748b'),\n      bubbleMeBg: getValue('#bubble-me-color', '#a8cbeb'),\n      bubbleMeText: getValue('#bubble-me-text-color', '#ffffff'),\n      bubbleThemBg: getValue('#bubble-them-color', '#ffffff'),\n      bubbleThemText: getValue('#bubble-them-text-color', '#72adf3'),\n      appBgColor: '#ffffff',\n      settingsBgColor: '#f2f2f7',\n      settingsCardBgColor: '#ffffff',\n      statusBar: getValue('#status-bar-color', '#428af2'),\n      dynamicIsland: getValue('#dynamic-island-color', '#a0c4f4'),\n      border: getValue('#border-color', '#E0E0E0'),\n      shadow: getValue('#shadow-color', '#4a90e2'),\n      isDarkMode: getChecked('#dark-mode-toggle'),\n      useSingleColorIcons: getChecked('#single-color-icons-toggle'),\n    });\n  }\n\n  //  - jQuery\n  saveCustomTheme(): void {\n    // getCurrentThemeFromEditor\n    const customTheme = this.getCurrentThemeFromEditor();\n\n    // \n    this.themeManager.saveCustomTheme(customTheme);\n    this.themeManager.switchTheme('custom');\n\n    // \n    this.updateCustomThemeButton();\n\n    // \n    this.closeThemeEditor();\n\n    // \n    if (this.onThemeChanged) {\n      this.onThemeChanged();\n    }\n  }\n\n  // \n  private createCustomTheme(params: {\n    name: string;\n    phoneFrame: string;\n    primary: string;\n    light: string;\n    ultraLight: string;\n    deep: string;\n    textPrimary: string;\n    textSecondary: string;\n    bubbleMeBg: string;\n    bubbleMeText: string;\n    bubbleThemBg: string;\n    bubbleThemText: string;\n    appBgColor: string;\n    settingsBgColor: string;\n    settingsCardBgColor: string;\n    statusBar: string;\n    dynamicIsland: string;\n    border: string;\n    shadow: string;\n    isDarkMode: boolean;\n    useSingleColorIcons: boolean;\n  }): Theme {\n    const {\n      name,\n      phoneFrame,\n      primary,\n      light,\n      ultraLight,\n      deep,\n      textPrimary,\n      textSecondary,\n      bubbleMeBg,\n      bubbleMeText,\n      bubbleThemBg,\n      bubbleThemText,\n      appBgColor,\n      settingsBgColor,\n      settingsCardBgColor,\n      statusBar,\n      dynamicIsland,\n      border,\n      shadow,\n      isDarkMode,\n      useSingleColorIcons,\n    } = params;\n\n    // RGB\n    const r = parseInt(shadow.slice(1, 3), 16);\n    const g = parseInt(shadow.slice(3, 5), 16);\n    const b = parseInt(shadow.slice(5, 7), 16);\n    const shadowColorRgba = isDarkMode ? 'rgba(0, 0, 0, 0.5)' : `rgba(${r}, ${g}, ${b}, 0.3)`;\n    const bubbleShadow = `0 2px 8px rgba(${r}, ${g}, ${b}, 0.15)`;\n\n    // \n    const gradientStart = this.lightenDarkenColor(primary, 20);\n    const gradientEnd = this.lightenDarkenColor(primary, -10);\n\n    // \n    const soft = this.lightenDarkenColor(light, -10);\n    const textColor = '#ffffff';\n    const headerBg = isDarkMode\n      ? 'linear-gradient(315deg, #333333 0%, #444444 100%)'\n      : `linear-gradient(315deg, ${this.lightenDarkenColor(ultraLight, -5)} 0%, ${ultraLight} 100%)`;\n\n    // \n    const customTheme: Theme = {\n      name: 'custom',\n      displayName: name,\n      colors: {\n        phoneFrame: phoneFrame,\n        phoneFrameGradient: [\n          this.lightenDarkenColor(phoneFrame, -40),\n          phoneFrame,\n          this.lightenDarkenColor(phoneFrame, 20),\n          this.lightenDarkenColor(phoneFrame, -40),\n        ],\n        primary: primary,\n        light: light,\n        ultraLight: ultraLight,\n        soft: soft,\n        deep: deep,\n        textPrimary: textPrimary,\n        textSecondary: textSecondary,\n        textColor: textColor,\n        bubbleMeBg,\n        bubbleMeText,\n        bubbleThemBg,\n        bubbleThemText,\n        headerBg,\n        appBgColor,\n        settingsBgColor,\n        settingsCardBgColor,\n        gradientStart,\n        gradientEnd,\n        statusBarColor: statusBar,\n        dynamicIslandColor: dynamicIsland,\n        borderColor: border,\n        shadowColor: shadow,\n        shadowColorRgba,\n        bubbleShadow,\n        isDarkMode,\n        defaultWallpapers: {\n          chat: isDarkMode\n            ? 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg'\n            : 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_3.jpg',\n          home: isDarkMode\n            ? 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg'\n            : 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg',\n          settings: isDarkMode ? '#1a1a1a' : '#f2f7fd',\n        },\n        useSingleColorIcons,\n      },\n    };\n\n    return customTheme;\n  }\n\n  // \n  private lightenDarkenColor(col: string, amt: number): string {\n    let usePound = false;\n\n    if (col[0] === '#') {\n      col = col.slice(1);\n      usePound = true;\n    }\n\n    const num = parseInt(col, 16);\n\n    let r = (num >> 16) + amt;\n    if (r > 255) r = 255;\n    else if (r < 0) r = 0;\n\n    let b = ((num >> 8) & 0x00ff) + amt;\n    if (b > 255) b = 255;\n    else if (b < 0) b = 0;\n\n    let g = (num & 0x0000ff) + amt;\n    if (g > 255) g = 255;\n    else if (g < 0) g = 0;\n\n    return (usePound ? '#' : '') + (g | (b << 8) | (r << 16)).toString(16);\n  }\n\n  // \n  private convertToHex(color: string): string {\n    // \n    if (color.startsWith('#')) {\n      return color;\n    }\n\n    // rgb()\n    const rgbMatch = color.match(/rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/);\n    if (rgbMatch) {\n      const r = parseInt(rgbMatch[1]);\n      const g = parseInt(rgbMatch[2]);\n      const b = parseInt(rgbMatch[3]);\n      return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\n    }\n\n    // rgba()alpha\n    const rgbaMatch = color.match(/rgba\\((\\d+),\\s*(\\d+),\\s*(\\d+),\\s*[\\d.]+\\)/);\n    if (rgbaMatch) {\n      const r = parseInt(rgbaMatch[1]);\n      const g = parseInt(rgbaMatch[2]);\n      const b = parseInt(rgbaMatch[3]);\n      return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);\n    }\n\n    // \n    console.warn(`[ThemeEditor] : ${color}`);\n    return '#000000';\n  }\n\n  // \n  private validateThemeData(data: any): boolean {\n    if (!data || typeof data !== 'object') return false;\n\n    // \n    const requiredFields = ['name', 'colors'];\n    for (const field of requiredFields) {\n      if (!(field in data)) return false;\n    }\n\n    // colors\n    const colors = data.colors;\n    if (!colors || typeof colors !== 'object') return false;\n\n    // \n    const requiredColors = ['primary', 'phoneFrame', 'textPrimary', 'textSecondary'];\n    for (const color of requiredColors) {\n      if (!(color in colors)) return false;\n    }\n\n    return true;\n  }\n\n  //  - jQuery\n  private applyImportedTheme(themeData: any): void {\n    // \n    $('#theme-name-input').val(themeData.displayName || themeData.name || '');\n\n    //  - lodash\n    const colorMappings = {\n      '#phone-frame-color': themeData.colors.phoneFrame,\n      '#primary-color': themeData.colors.primary,\n      '#light-color': themeData.colors.light,\n      '#ultra-light-color': themeData.colors.ultraLight,\n      '#deep-color': themeData.colors.deep,\n      '#text-primary-color': themeData.colors.textPrimary,\n      '#text-secondary-color': themeData.colors.textSecondary,\n      '#bubble-me-color': themeData.colors.bubbleMeBg,\n      '#bubble-me-text-color': themeData.colors.bubbleMeText,\n      '#bubble-them-color': themeData.colors.bubbleThemBg,\n      '#bubble-them-text-color': themeData.colors.bubbleThemText,\n      '#status-bar-color': themeData.colors.statusBarColor,\n      '#dynamic-island-color': themeData.colors.dynamicIslandColor,\n      '#border-color': themeData.colors.borderColor,\n      '#shadow-color': themeData.colors.shadowColor,\n    };\n\n    // lodash\n    _.forEach(colorMappings, (colorValue, selector) => {\n      if (colorValue) {\n        $(selector).val(this.convertToHex(colorValue));\n      }\n    });\n\n    // checkbox\n    if ('isDarkMode' in themeData.colors) {\n      $('#dark-mode-toggle').prop('checked', themeData.colors.isDarkMode);\n    }\n\n    if ('useSingleColorIcons' in themeData.colors) {\n      $('#single-color-icons-toggle').prop('checked', themeData.colors.useSingleColorIcons);\n    }\n\n    // \n    if (themeData.wallpapers) {\n      this.applyImportedWallpapers(themeData.wallpapers);\n    }\n\n    // checkbox\n    this.setupCheckboxes();\n  }\n\n  // \n  private applyImportedWallpapers(wallpapers: any): void {\n    try {\n      const wallpaperManager = this.themeManager.getWallpaperManager();\n\n      // \n      const viewTypes: ('chat' | 'home' | 'settings')[] = ['chat', 'home', 'settings'];\n\n      viewTypes.forEach(viewType => {\n        const wallpaper = wallpapers[viewType];\n        if (wallpaper) {\n          // \n          wallpaperManager.setWallpaper(viewType, wallpaper);\n        }\n      });\n\n      console.log('[ThemeEditor] ');\n    } catch (error) {\n      console.warn('[ThemeEditor] :', error);\n    }\n  }\n}\n","// \nexport interface Theme {\n  name: string;\n  displayName: string;\n  colors: {\n    // \n    phoneFrame: string;\n    phoneFrameGradient: string[];\n\n    // \n    primary: string;\n    light: string;\n    ultraLight: string;\n    soft: string;\n    deep: string;\n\n    // \n    gradientStart: string;\n    gradientEnd: string;\n\n    // \n    textColor: string;\n    textPrimary: string;\n    textSecondary: string;\n\n    // \n    borderColor: string;\n    bubbleShadow: string;\n\n    // \n    bubbleThemBg: string;\n    bubbleMeBg: string;\n\n    // \n    bubbleThemText: string;\n    bubbleMeText: string;\n\n    // \n    headerBg: string;\n\n    // \n    statusBarColor: string;\n\n    // \n    dynamicIslandColor: string;\n\n    // \n    appBgColor: string;\n\n    // \n    settingsBgColor: string;\n\n    // \n    settingsCardBgColor: string;\n\n    // \n    shadowColor: string;\n    shadowColorRgba: string;\n\n    // \n    isDarkMode: boolean;\n\n    // \n    defaultWallpapers: {\n      chat: string; // URL\n      home: string;\n      settings: string;\n    };\n\n    // \n    useSingleColorIcons?: boolean;\n  };\n}\n\n// \nexport const APP_VERSION = '1.1.0';\n\n// \nexport const THEMES: Record<string, Theme> = {\n  blue: {\n    name: 'blue',\n    displayName: '',\n    colors: {\n      // \n      phoneFrame: '#b4d0fa',\n      phoneFrameGradient: ['#4a95ed', '#98c2f5', '#accef2', '#4a95ed'],\n\n      // \n      primary: '#72adf3',\n      light: '#a8cbeb',\n      ultraLight: '#e8f4fd',\n      soft: '#b8d4f0',\n      deep: '#2c5282',\n\n      // \n      gradientStart: '#98c2f5',\n      gradientEnd: '#accef2',\n\n      // \n      textColor: '#ffffff',\n      textPrimary: 'rgb(139, 162, 186)',\n      textSecondary: '#64748b',\n\n      // \n      borderColor: '#cbd5e1',\n      bubbleShadow: '0 2px 8px rgba(74, 144, 226, 0.15)',\n\n      // \n      bubbleThemBg: '#ffffff',\n      bubbleMeBg: '#a8cbeb',\n\n      // \n      bubbleThemText: '#72adf3',\n      bubbleMeText: '#ffffff',\n\n      // \n      headerBg: 'linear-gradient(315deg, #eef4ff 0%, #f8faff 100%)',\n\n      // \n      statusBarColor: '#428af2',\n\n      // \n      dynamicIslandColor: '#a0c4f4',\n\n      // \n      appBgColor: '#ffffff',\n\n      // \n      settingsBgColor: '#f2f2f7',\n\n      // \n      settingsCardBgColor: '#ffffff',\n\n      // \n      shadowColor: '#4a90e2',\n      shadowColorRgba: 'rgba(74, 144, 226, 0.3)',\n\n      // \n      isDarkMode: false,\n\n      // \n      defaultWallpapers: {\n        chat: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_3.jpg', // \n        home: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg', // \n        settings: '#f2f7fd',\n      },\n\n      // \n      useSingleColorIcons: true,\n    },\n  },\n\n  pink: {\n    name: 'pink',\n    displayName: '',\n    colors: {\n      // \n      phoneFrame: '#fad0e8',\n      phoneFrameGradient: ['#ed4a9e', '#f598c8', '#f2acce', '#ed4a9e'],\n\n      // \n      primary: '#f372ad',\n      light: '#eba8cb',\n      ultraLight: '#fde8f4',\n      soft: '#f0b8d4',\n      deep: '#822c5c',\n\n      // \n      gradientStart: '#f598c8',\n      gradientEnd: '#f2acce',\n\n      // \n      textColor: '#ffffff',\n      textPrimary: 'rgb(186, 139, 162)',\n      textSecondary: '#8b647a',\n\n      // \n      borderColor: '#e1cbd5',\n      bubbleShadow: '0 2px 8px rgba(226, 74, 144, 0.15)',\n\n      // \n      bubbleThemBg: '#ffffff',\n      bubbleMeBg: '#eba8cb',\n\n      // \n      bubbleThemText: '#f372ad',\n      bubbleMeText: '#ffffff',\n\n      // \n      headerBg: 'linear-gradient(315deg, #ffeeef 0%, #fff8fa 100%)',\n\n      // \n      statusBarColor: '#ed72ad',\n\n      // \n      dynamicIslandColor: '#f4a0c4',\n\n      // \n      appBgColor: '#ffffff',\n\n      // \n      settingsBgColor: '#fff2f7',\n\n      // \n      settingsCardBgColor: '#ffffff',\n\n      // \n      shadowColor: '#e24a90',\n      shadowColorRgba: 'rgba(226, 74, 144, 0.3)',\n\n      // \n      isDarkMode: false,\n\n      // \n      defaultWallpapers: {\n        chat: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg', // \n        home: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_3.jpg', // \n        settings: '#fdf2f7',\n      },\n\n      // \n      useSingleColorIcons: true,\n    },\n  },\n\n  white: {\n    name: 'white',\n    displayName: '',\n    colors: {\n      // \n      phoneFrame: '#000000',\n      phoneFrameGradient: ['#000000', '#222222', '#333333', '#000000'],\n\n      //  - \n      primary: '#999999', // \n      light: '#cccccc',\n      ultraLight: '#f8f8f8',\n      soft: '#e0e0e0',\n      deep: '#666666',\n\n      // \n      gradientStart: '#cccccc',\n      gradientEnd: '#dddddd',\n\n      // \n      textColor: '#ffffff',\n      textPrimary: '#333333',\n      textSecondary: '#909090',\n\n      // \n      borderColor: '#e0e0e0',\n      bubbleShadow: '0 2px 8px rgba(0, 0, 0, 0.08)',\n\n      // \n      bubbleThemBg: '#ffffff',\n      bubbleMeBg: '#A0E75A', // \n\n      // \n      bubbleThemText: '#333333',\n      bubbleMeText: '#333333',\n\n      // \n      headerBg: 'linear-gradient(315deg, #f5f5f5 0%, #ffffff 100%)',\n\n      // \n      statusBarColor: '#000000',\n\n      // \n      dynamicIslandColor: '#000000',\n\n      // \n      appBgColor: '#ffffff',\n\n      // \n      settingsBgColor: '#f5f5f5',\n\n      // \n      settingsCardBgColor: '#ffffff',\n\n      // \n      shadowColor: '#999999',\n      shadowColorRgba: 'rgba(0, 0, 0, 0.1)',\n\n      // \n      isDarkMode: false,\n\n      // \n      defaultWallpapers: {\n        chat: '#EDEDED', // \n        home: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg', // \n        settings: '#f5f5f5',\n      },\n\n      // \n      useSingleColorIcons: false,\n    },\n  },\n\n  dark: {\n    name: 'dark',\n    displayName: '',\n    colors: {\n      // \n      phoneFrame: '#2c2c2c',\n      phoneFrameGradient: ['#1a1a1a', '#2c2c2c', '#3c3c3c', '#1a1a1a'],\n\n      // \n      primary: '#505050',\n      light: '#3c3c3c',\n      ultraLight: '#1a1a1a',\n      soft: '#2c2c2c',\n      deep: '#c0c0c0',\n\n      // \n      gradientStart: '#3c3c3c',\n      gradientEnd: '#2c2c2c',\n\n      // \n      textColor: '#e0e0e0',\n      textPrimary: '#c0c0c0',\n      textSecondary: '#a0a0a0',\n\n      // \n      borderColor: '#3c3c3c',\n      bubbleShadow: '0 2px 8px rgba(0, 0, 0, 0.3)',\n\n      // \n      bubbleThemBg: '#2a2a2a',\n      bubbleMeBg: '#505050',\n\n      // \n      bubbleThemText: '#e0e0e0',\n      bubbleMeText: '#c0c0c0',\n\n      // \n      headerBg: 'linear-gradient(315deg, #2c2c2c 0%, #1a1a1a 100%)',\n\n      // \n      statusBarColor: '#888888',\n\n      // \n      dynamicIslandColor: '#3c3c3c',\n\n      // \n      appBgColor: '#1a1a1a',\n\n      // \n      settingsBgColor: '#1a1a1a',\n\n      // \n      settingsCardBgColor: '#2c2c2c',\n\n      // \n      shadowColor: '#000000',\n      shadowColorRgba: 'rgba(0, 0, 0, 0.5)',\n\n      // \n      isDarkMode: true,\n\n      // \n      defaultWallpapers: {\n        chat: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg', // \n        home: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg', // \n        settings: '#1a1a1a',\n      },\n\n      // \n      useSingleColorIcons: false,\n    },\n  },\n};\n\n// \nexport class ThemeManager {\n  private static THEME_STORAGE_KEY = 'blmx_theme';\n  private static CUSTOM_THEME_STORAGE_KEY = 'blmx_custom_theme';\n  private static VERSION_STORAGE_KEY = 'blmx_app_version';\n  private currentTheme: Theme;\n  private wallpaperManager: WallpaperManager;\n\n  constructor() {\n    // \n    this.checkVersion();\n\n    // \n    const savedThemeName = localStorage.getItem(ThemeManager.THEME_STORAGE_KEY) || 'white';\n\n    if (savedThemeName === 'custom') {\n      try {\n        const customThemeJson = localStorage.getItem(ThemeManager.CUSTOM_THEME_STORAGE_KEY);\n        if (customThemeJson) {\n          this.currentTheme = JSON.parse(customThemeJson);\n        } else {\n          this.currentTheme = THEMES.white;\n        }\n      } catch (e) {\n        console.error('Failed to load custom theme:', e);\n        this.currentTheme = THEMES.white;\n      }\n    } else {\n      this.currentTheme = THEMES[savedThemeName] || THEMES.white;\n    }\n\n    // \n    this.wallpaperManager = new WallpaperManager();\n\n    // \n    this.applyTheme(this.currentTheme);\n  }\n\n  // \n  private checkVersion(): void {\n    const savedVersion = localStorage.getItem(ThemeManager.VERSION_STORAGE_KEY);\n\n    // \n    if (!savedVersion || savedVersion !== APP_VERSION) {\n      console.log(`: ${savedVersion || ''} -> ${APP_VERSION}, ...`);\n      this.cleanOutdatedData();\n\n      // \n      localStorage.setItem(ThemeManager.VERSION_STORAGE_KEY, APP_VERSION);\n    }\n  }\n\n  // \n  private cleanOutdatedData(): void {\n    // \n    const keysToPreserve: string[] = [];\n\n    // \n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (\n        key &&\n        (key.startsWith('blmx_user_name_') ||\n          key.startsWith('blmx_user_avatar_') ||\n          key.startsWith('blmx_char_avatar_') ||\n          key.startsWith('blmx_remark_') ||\n          key.startsWith('blmx_signature_') ||\n          key.startsWith('blmx_cover_photo_') ||\n          key.startsWith('blmx_input_placeholder_'))\n      ) {\n        keysToPreserve.push(key);\n      }\n    }\n\n    // \n    const preservedData: Record<string, string> = {};\n    keysToPreserve.forEach(key => {\n      const value = localStorage.getItem(key);\n      if (value) preservedData[key] = value;\n    });\n\n    //  blmx_ \n    for (let i = localStorage.length - 1; i >= 0; i--) {\n      const key = localStorage.key(i);\n      if (key && key.startsWith('blmx_')) {\n        localStorage.removeItem(key);\n      }\n    }\n\n    // \n    Object.entries(preservedData).forEach(([key, value]) => {\n      localStorage.setItem(key, value);\n    });\n  }\n\n  // \n  getCurrentTheme(): Theme {\n    return this.currentTheme;\n  }\n\n  // DOMCSS\n  getCurrentThemeWithAppliedValues(): Theme {\n    const theme = { ...this.currentTheme };\n    const colors = { ...theme.colors };\n\n    // DOMCSS\n    const root = document.documentElement;\n    const computedStyle = getComputedStyle(root);\n\n    // \n    const actualValues = {\n      phoneFrame: computedStyle.getPropertyValue('--phoneFrame').trim(),\n      primary: computedStyle.getPropertyValue('--primary-blue').trim(),\n      light: computedStyle.getPropertyValue('--light-blue').trim(),\n      ultraLight: computedStyle.getPropertyValue('--ultra-light-blue').trim(),\n      soft: computedStyle.getPropertyValue('--soft-blue').trim(),\n      deep: computedStyle.getPropertyValue('--deep-blue').trim(),\n      textColor: computedStyle.getPropertyValue('--text-color').trim(),\n      textPrimary: computedStyle.getPropertyValue('--text-primary').trim(),\n      textSecondary: computedStyle.getPropertyValue('--text-secondary').trim(),\n      borderColor: computedStyle.getPropertyValue('--border-color').trim(),\n      bubbleShadow: computedStyle.getPropertyValue('--bubble-shadow').trim(),\n      bubbleThemBg: computedStyle.getPropertyValue('--wechat-bubble-them-bg').trim(),\n      bubbleMeBg: computedStyle.getPropertyValue('--wechat-bubble-me-bg').trim(),\n      bubbleThemText: computedStyle.getPropertyValue('--wechat-bubble-them-text').trim(),\n      bubbleMeText: computedStyle.getPropertyValue('--wechat-bubble-me-text').trim(),\n      headerBg: computedStyle.getPropertyValue('--header-bg').trim(),\n      statusBarColor: computedStyle.getPropertyValue('--status-bar-color').trim(),\n      dynamicIslandColor: computedStyle.getPropertyValue('--dynamic-island-color').trim(),\n      appBgColor: computedStyle.getPropertyValue('--app-bg-color').trim(),\n      settingsBgColor: computedStyle.getPropertyValue('--settings-bg-color').trim(),\n      settingsCardBgColor: computedStyle.getPropertyValue('--settings-card-bg-color').trim(),\n      shadowColor: computedStyle.getPropertyValue('--shadow-color').trim(),\n      shadowColorRgba: computedStyle.getPropertyValue('--shadow-color-rgba').trim(),\n      gradientStart:\n        computedStyle.getPropertyValue('--blue-gradient-start').trim() ||\n        computedStyle.getPropertyValue('--primary-gradient-light').trim(),\n      gradientEnd:\n        computedStyle.getPropertyValue('--blue-gradient-end').trim() ||\n        computedStyle.getPropertyValue('--primary-gradient-dark').trim(),\n    };\n\n    // CSS\n    Object.keys(actualValues).forEach(key => {\n      const value = actualValues[key as keyof typeof actualValues];\n      if (value && value !== '') {\n        (colors as any)[key] = value;\n      }\n    });\n\n    // \n    colors.isDarkMode = theme.colors.isDarkMode;\n    colors.useSingleColorIcons = theme.colors.useSingleColorIcons;\n    colors.phoneFrameGradient = theme.colors.phoneFrameGradient;\n    colors.defaultWallpapers = theme.colors.defaultWallpapers;\n\n    return {\n      ...theme,\n      colors,\n    };\n  }\n\n  // \n  getThemes(): Record<string, Theme> {\n    return THEMES;\n  }\n\n  // \n  getWallpaperManager(): WallpaperManager {\n    return this.wallpaperManager;\n  }\n\n  // \n  switchTheme(themeName: string): void {\n    if (themeName === 'custom') {\n      try {\n        const customThemeJson = localStorage.getItem(ThemeManager.CUSTOM_THEME_STORAGE_KEY);\n        if (customThemeJson) {\n          this.currentTheme = JSON.parse(customThemeJson);\n          localStorage.setItem(ThemeManager.THEME_STORAGE_KEY, 'custom');\n\n          // \n          this.wallpaperManager.setCurrentThemeName('custom');\n\n          this.applyTheme(this.currentTheme);\n\n          // \n          this.wallpaperManager.applyThemeDefaultWallpapers(this.currentTheme);\n        }\n      } catch (e) {\n        console.error('Failed to load custom theme:', e);\n      }\n    } else if (THEMES[themeName]) {\n      this.currentTheme = THEMES[themeName];\n      localStorage.setItem(ThemeManager.THEME_STORAGE_KEY, themeName);\n\n      // \n      this.wallpaperManager.setCurrentThemeName(themeName);\n\n      this.applyTheme(this.currentTheme);\n\n      // \n      this.wallpaperManager.applyThemeDefaultWallpapers(this.currentTheme);\n    }\n  }\n\n  // \n  saveCustomTheme(theme: Theme): void {\n    this.currentTheme = theme;\n    localStorage.setItem(ThemeManager.CUSTOM_THEME_STORAGE_KEY, JSON.stringify(theme));\n    localStorage.setItem(ThemeManager.THEME_STORAGE_KEY, 'custom');\n\n    // \n    this.wallpaperManager.setCurrentThemeName('custom');\n\n    this.applyTheme(theme);\n\n    // \n    this.wallpaperManager.applyThemeDefaultWallpapers(theme);\n  }\n\n  // DOM\n  private applyTheme(theme: Theme): void {\n    const colors = theme.colors;\n    const root = document.documentElement;\n\n    // CSS\n    root.style.setProperty('--phoneFrame', colors.phoneFrame);\n    root.style.setProperty('--primary-blue', colors.primary);\n    root.style.setProperty('--light-blue', colors.light);\n    root.style.setProperty('--ultra-light-blue', colors.ultraLight);\n    root.style.setProperty('--blue-gradient-start', colors.gradientStart);\n    root.style.setProperty('--blue-gradient-end', colors.gradientEnd);\n    root.style.setProperty('--soft-blue', colors.soft);\n    root.style.setProperty('--deep-blue', colors.deep);\n\n    //  - \n    root.style.setProperty('--text-color', colors.textColor);\n    root.style.setProperty('--text-primary', colors.textPrimary);\n    root.style.setProperty('--text-secondary', colors.textSecondary);\n\n    // \n    root.style.setProperty('--border-color', colors.borderColor);\n\n    // useSingleColorIcons\n    if (colors.useSingleColorIcons) {\n      // \n      document.body.classList.add('single-color-icon');\n\n      // \n      const lighterColor = this.lightenDarkenColor(colors.primary, 20);\n      const darkerColor = this.lightenDarkenColor(colors.primary, -20);\n\n      // \n      root.style.setProperty('--primary-gradient-light', lighterColor);\n      root.style.setProperty('--primary-gradient-dark', darkerColor);\n    } else {\n      // \n      document.body.classList.remove('single-color-icon');\n      root.style.setProperty('--wechat-green-icon', theme.name === 'white' ? '#07C160' : '#07C160');\n      root.style.setProperty('--settings-icon-color', theme.name === 'white' ? '#8a8a8a' : '#8a8a8a');\n    }\n\n    root.style.setProperty('--wechat-green-bubble', colors.light);\n    root.style.setProperty('--wechat-bg', colors.ultraLight);\n    root.style.setProperty('--link-color', colors.primary);\n    root.style.setProperty('--text-color', colors.textColor);\n    root.style.setProperty('--text-primary', colors.textPrimary);\n    root.style.setProperty('--text-secondary', colors.textSecondary);\n    root.style.setProperty('--border-color', colors.borderColor);\n    root.style.setProperty('--header-bg', colors.headerBg);\n    root.style.setProperty('--bubble-shadow', colors.bubbleShadow);\n    root.style.setProperty('--wechat-bubble-them-bg', colors.bubbleThemBg);\n    root.style.setProperty('--wechat-bubble-me-bg', colors.bubbleMeBg);\n\n    // \n    root.style.setProperty('--wechat-bubble-them-text', colors.bubbleThemText || colors.primary);\n    root.style.setProperty('--wechat-bubble-me-text', colors.bubbleMeText || '#ffffff');\n\n    // \n    root.style.setProperty('--status-bar-color', colors.statusBarColor);\n\n    // \n    root.style.setProperty('--dynamic-island-color', colors.dynamicIslandColor);\n\n    // \n    root.style.setProperty('--app-bg-color', colors.appBgColor);\n\n    // \n    root.style.setProperty('--settings-bg-color', colors.settingsBgColor);\n\n    // \n    root.style.setProperty('--settings-card-bg-color', colors.settingsCardBgColor);\n\n    // \n    root.style.setProperty('--input-bg', colors.isDarkMode ? '#2a2a2a' : '#ffffff');\n\n    // \n    root.style.setProperty('--shadow-color', colors.shadowColor);\n    root.style.setProperty('--shadow-color-rgba', colors.shadowColorRgba);\n\n    // RGB\n    const shadowRGB = this.extractRgbComponents(colors.shadowColor);\n    root.style.setProperty('--shadow-r', shadowRGB.r.toString());\n    root.style.setProperty('--shadow-g', shadowRGB.g.toString());\n    root.style.setProperty('--shadow-b', shadowRGB.b.toString());\n\n    // \n    if (colors.isDarkMode) {\n      document.body.classList.add('dark-mode');\n    } else {\n      document.body.classList.remove('dark-mode');\n    }\n\n    // \n    const phoneFrame = document.querySelector('.phone-frame') as HTMLElement;\n    if (phoneFrame) {\n      phoneFrame.style.background = colors.phoneFrame;\n\n      //  - \n      const gradientColors = colors.phoneFrameGradient.join(', ');\n\n      // \n      let phoneFrameStyle = document.getElementById('phone-frame-style') as HTMLStyleElement;\n      if (!phoneFrameStyle) {\n        phoneFrameStyle = document.createElement('style');\n        phoneFrameStyle.id = 'phone-frame-style';\n        document.head.appendChild(phoneFrameStyle);\n      }\n\n      // \n      phoneFrameStyle.textContent = `\n        .phone-frame::before {\n          background: linear-gradient(45deg, ${gradientColors});\n          background-size: 400% 400%;\n        }\n      `;\n    }\n\n    // \n    const dynamicIsland = document.querySelector('.dynamic-island') as HTMLElement;\n    if (dynamicIsland) {\n      dynamicIsland.style.background = colors.dynamicIslandColor;\n    }\n\n    // \n    const statusLeft = document.querySelector('.status-left') as HTMLElement;\n    const statusRight = document.querySelector('.status-right') as HTMLElement;\n    if (statusLeft && statusRight) {\n      statusLeft.style.color = colors.statusBarColor;\n      statusRight.style.color = colors.statusBarColor;\n    }\n\n    // \n    const settingsView = document.getElementById('settings-view');\n    if (settingsView) {\n      settingsView.style.backgroundColor = colors.settingsBgColor;\n    }\n\n    // \n    const settingsCards = document.querySelectorAll('.settings-card');\n    settingsCards.forEach((card: Element) => {\n      (card as HTMLElement).style.backgroundColor = colors.settingsCardBgColor;\n    });\n\n    // \n    if (phoneFrame) {\n      phoneFrame.style.boxShadow = `\n        0 15px 20px ${this.hexToRgba(colors.shadowColor, 0.25)},\n        0 8px 20px ${this.hexToRgba(colors.shadowColor, 0.15)},\n        0 3px 8px rgba(0, 0, 0, 0.1),\n        inset 0 1px 0 rgba(255, 255, 255, 0.5),\n        inset 0 -1px 0 rgba(255, 255, 255, 0.2),\n        0 5px ${this.hexToRgba(colors.shadowColor, 0.08)}\n      `;\n    }\n\n    // \n    const style = document.createElement('style');\n    style.id = 'theme-dynamic-styles';\n\n    // \n    // \n    // const isCustomBubbleColors = theme.name === 'custom';\n\n    style.textContent = `\n      /*  -  */\n      .message-row.me .message-bubble {\n        background-color: ${colors.bubbleMeBg} !important;\n        background: ${colors.bubbleMeBg} !important;\n        color: ${colors.bubbleMeText || '#ffffff'} !important;\n        box-shadow: 0 4px 12px ${this.hexToRgba(colors.shadowColor, 0.3)};\n      }\n      \n      /*  */\n      .message-row.them .message-bubble {\n        background-color: ${colors.bubbleThemBg} !important;\n        background: ${colors.bubbleThemBg} !important;\n        color: ${colors.bubbleThemText || colors.primary} !important;\n      }\n      \n      /*  */\n      .message-row.me .message-bubble.voice-bubble {\n        background: ${colors.bubbleMeBg} !important;\n        background-color: ${colors.bubbleMeBg} !important;\n        background-image: none !important;\n        color: ${colors.bubbleMeText || '#ffffff'} !important;\n      }\n      \n      .message-row.them .message-bubble.voice-bubble {\n        background: ${colors.bubbleThemBg} !important;\n        color: ${colors.bubbleThemText || colors.primary} !important;\n      }\n      \n      /*  */\n      .post-media .image-desc-content {\n        background-color: ${this.hexToRgba(colors.primary, 0.1)} !important;\n        border: 1px solid ${this.hexToRgba(colors.primary, 0.1)} !important;\n      }\n      \n      /*  */\n      .wechat-footer .send-btn {\n        box-shadow: 0 4px 12px ${this.hexToRgba(colors.shadowColor, 0.3)};\n      }\n      \n      .wechat-footer .send-btn:hover {\n        box-shadow: 0 6px 16px ${this.hexToRgba(colors.shadowColor, 0.4)};\n      }\n      \n      /*  */\n      ${\n        colors.isDarkMode\n          ? `\n        .settings-card p, \n        .settings-card a,\n        .settings-card li a,\n        .post-content,\n        .post-meta,\n        .theme-editor-modal .modal-content {\n          color: #e0e0e0 !important;\n        }\n        \n        .settings-card,\n        .theme-editor-modal .modal-content {\n          background-color: #2a2a2a !important;\n        }\n        \n        /*  */\n        .typing-indicator .message-bubble {\n          background-color: ${colors.bubbleThemBg} !important;\n          background: ${colors.bubbleThemBg} !important;\n          color: #ffffff !important;\n          border: none !important;\n        }\n        \n        .typing-dot {\n          background-color: rgba(255, 255, 255, 0.6) !important;\n        }\n        \n        .settings-card li {\n          border-bottom-color: #3c3c3c !important;\n        }\n        \n        .settings-card li a {\n          color: #a0a0a0 !important;\n        }\n        \n        #show-last-ai-response-btn,\n        #show-last-sent-prompt-btn {\n          background-color: #2c2c2c !important;\n          color: #a0a0a0 !important;\n        }\n\n        /*  */\n        #moments-view {\n          background: linear-gradient(180deg, #1a1a1a 0%, #252525 100%) !important;\n        }\n        \n        .moments-body {\n          background-color: #1a1a1a !important;\n        }\n        \n        .moment-post {\n          border-bottom-color: #2c2c2c !important;\n        }\n        \n        .post-interactions {\n          background: #2a2a2a !important;\n          border-color: #3c3c3c !important;\n        }\n        \n        .post-interactions::before {\n          border-bottom-color: #2a2a2a !important;\n        }\n        \n        .likes-section {\n          background: rgba(42, 42, 42, 0.8) !important;\n        }\n        \n        .comments-section {\n          border-top-color: #3c3c3c !important;\n        }\n        \n        .post-meta .comment-button {\n          background: #2c2c2c !important;\n        }\n\n        /*  -  */\n        .post-media .image-desc-content {\n          background-color: rgba(42, 42, 42, 0.8) !important;\n          border: 1px solid rgba(60, 60, 60, 0.4) !important;\n          color: #e0e0e0 !important;\n        }\n\n        /*  */\n        .post-author-name, \n        .liker-name, \n        .comment-author {\n          color: #a0c0e0 !important;\n        }\n        \n        .moments-header,\n        .wechat-header {\n          background: linear-gradient(315deg, #252525 0%, #1a1a1a 100%) !important;\n          border-bottom-color: #3c3c3c !important;\n        }\n        \n        .wechat-footer {\n          background: linear-gradient(315deg, #252525 0%, #1a1a1a 100%) !important;\n          border-top-color: #3c3c3c !important;\n        }\n        \n        .wechat-footer .text-input {\n          background-color: #2a2a2a !important;\n          border-color: #3c3c3c !important;\n          color: #e0e0e0 !important;\n        }\n        \n        .wechat-footer .text-input::placeholder {\n          color: #808080 !important;\n        }\n        \n        .timestamp-text,\n        .event-time-text {\n          background: linear-gradient(315deg, #505050 0%, #3c3c3c 100%) !important;\n        }\n        \n        .recall-notice-text {\n          background: linear-gradient(315deg, #505050 0%, #3c3c3c 100%) !important;\n        }\n        \n        .message-row.them .voice-bubble .voice-icon {\n          color: #a0c0e0 !important;\n        }\n        \n        .voice-text-content {\n          background-color: #2a2a2a !important;\n          border-color: #3c3c3c !important;\n          color: #e0e0e0 !important;\n        }\n        \n        .location-card,\n        .file-card {\n          background-color: #2a2a2a !important;\n        }\n        \n        .location-content .location-title {\n          color: #e0e0e0 !important;\n        }\n        \n        .file-details .file-name {\n          color: #e0e0e0 !important;\n        }\n        \n        .file-footer {\n          background-color: #252525 !important;\n          border-top-color: #3c3c3c !important;\n        }\n        \n        .panel-container {\n          background-color: #1a1a1a !important;\n        }\n        \n        .feature-icon {\n          background-color: #2a2a2a !important;\n          border-color: #3c3c3c !important;\n        }\n        \n        .feature-label {\n          color: #a0a0a0 !important;\n        }\n        \n        /* Theme-colored icons in dark mode */\n        .feature-icon .theme-icon {\n          color: var(--primary-blue) !important;\n        }\n        \n        /*  */\n        .wallpaper-container {\n          background-color: #2a2a2a !important;\n          color: #e0e0e0 !important;\n        }\n        \n        .wallpaper-container h2,\n        .wallpaper-container h3,\n        .wallpaper-container p {\n          color: #e0e0e0 !important;\n        }\n        \n        .wallpaper-container input[type=\"text\"],\n        .wallpaper-container input[type=\"file\"] {\n          background-color: #1a1a1a !important;\n          border-color: #3c3c3c !important;\n          color: #e0e0e0 !important;\n        }\n        \n        .wallpaper-item .name {\n          background-color: rgba(42, 42, 42, 0.9) !important;\n          color: #e0e0e0 !important;\n        }\n      `\n          : ''\n      }\n    `;\n\n    const oldDynamicStyles = document.getElementById('theme-dynamic-styles');\n    if (oldDynamicStyles) {\n      oldDynamicStyles.remove();\n    }\n    document.head.appendChild(style);\n  }\n\n  // HEXRGBA\n  private hexToRgba(hex: string, alpha: number): string {\n    const r = parseInt(hex.slice(1, 3), 16);\n    const g = parseInt(hex.slice(3, 5), 16);\n    const b = parseInt(hex.slice(5, 7), 16);\n\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`;\n  }\n\n  // RGB\n  private extractRgbComponents(hex: string): { r: number; g: number; b: number } {\n    const r = parseInt(hex.slice(1, 3), 16);\n    const g = parseInt(hex.slice(3, 5), 16);\n    const b = parseInt(hex.slice(5, 7), 16);\n\n    return { r, g, b };\n  }\n\n  // \n  private lightenDarkenColor(color: string, amount: number): string {\n    let hex = color.replace('#', '');\n    if (hex.length === 3) {\n      hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];\n    }\n    const num = parseInt(hex, 16);\n    let r = (num >> 16) + amount;\n    let g = ((num >> 8) & 0x00ff) + amount;\n    let b = (num & 0x0000ff) + amount;\n\n    r = Math.max(0, Math.min(255, r));\n    g = Math.max(0, Math.min(255, g));\n    b = Math.max(0, Math.min(255, b));\n\n    const rHex = r.toString(16).padStart(2, '0');\n    const gHex = g.toString(16).padStart(2, '0');\n    const bHex = b.toString(16).padStart(2, '0');\n\n    return `#${rHex}${gHex}${bHex}`;\n  }\n}\n\n// \nexport interface Wallpaper {\n  id: string;\n  type: 'color' | 'image' | 'url';\n  value: string; // URL\n  name: string;\n  thumbnail?: string; // URL\n}\n\n// \nexport class WallpaperManager {\n  private static WALLPAPER_STORAGE_KEY_PREFIX = 'blmx_wallpaper_';\n  private static CUSTOM_WALLPAPERS_KEY = 'blmx_custom_wallpapers';\n  private static THEME_WALLPAPER_KEY_PREFIX = 'blmx_theme_wallpaper_';\n  private currentThemeName: string = 'white'; // \n\n  // \n  private builtInWallpapers: Wallpaper[] = [\n    { id: 'blue_solid', type: 'color', value: '#e8f4fd', name: '' },\n    { id: 'pink_solid', type: 'color', value: '#fde8f4', name: '' },\n    { id: 'white_solid', type: 'color', value: '#f8f8f8', name: '' },\n    { id: 'dark_solid', type: 'color', value: '#1a1a1a', name: '' },\n    {\n      id: 'default_image',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '',\n    },\n    {\n      id: 'dark_image',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '',\n    },\n    {\n      id: 'blue_theme',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '',\n    },\n    {\n      id: 'pink_theme',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '',\n    },\n    {\n      id: 'kitty_theme',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '',\n    },\n    {\n      id: 'deep_stars_2',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg',\n      name: '2',\n    },\n    {\n      id: 'deep_stars_3',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_3.jpg',\n      name: '3',\n    },\n    {\n      id: 'white_stars',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '',\n    },\n    {\n      id: 'pink_stars_2',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg',\n      name: '2',\n    },\n    {\n      id: 'pink_grid_2',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_2.jpg',\n      name: '2',\n    },\n    {\n      id: 'pink_grid_4',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_4.jpg',\n      name: '4',\n    },\n    {\n      id: 'blue_1',\n      type: 'image',\n      value: 'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame//wallpaper/_1.jpg',\n      name: '1',\n    },\n  ];\n\n  // \n  private customWallpapers: Wallpaper[] = [];\n\n  constructor() {\n    this.loadCustomWallpapers();\n    // localStorage\n    const savedThemeName = localStorage.getItem('blmx_theme');\n    if (savedThemeName) {\n      this.currentThemeName = savedThemeName;\n    }\n\n    // \n    this.migrateOldWallpaperSettings();\n  }\n\n  // \n  setCurrentThemeName(themeName: string): void {\n    this.currentThemeName = themeName;\n  }\n\n  // +\n  getAllWallpapers(): Wallpaper[] {\n    return [...this.builtInWallpapers, ...this.customWallpapers];\n  }\n\n  // \n  getBuiltInWallpapers(): Wallpaper[] {\n    return this.builtInWallpapers;\n  }\n\n  // \n  getCustomWallpapers(): Wallpaper[] {\n    return this.customWallpapers;\n  }\n\n  // \n  addCustomWallpaper(wallpaper: Omit<Wallpaper, 'id'>): Wallpaper {\n    const id = `custom_${Date.now()}`;\n    const newWallpaper: Wallpaper = { ...wallpaper, id };\n\n    this.customWallpapers.push(newWallpaper);\n    this.saveCustomWallpapers();\n\n    return newWallpaper;\n  }\n\n  // \n  deleteCustomWallpaper(id: string): boolean {\n    const initialLength = this.customWallpapers.length;\n    this.customWallpapers = this.customWallpapers.filter(w => w.id !== id);\n\n    if (this.customWallpapers.length !== initialLength) {\n      this.saveCustomWallpapers();\n      return true;\n    }\n\n    return false;\n  }\n\n  // \n  setWallpaper(viewType: 'chat' | 'home' | 'settings', wallpaper: Wallpaper | null): void {\n    // \n    const storageKey = `${WallpaperManager.THEME_WALLPAPER_KEY_PREFIX}${this.currentThemeName}_${viewType}`;\n\n    if (wallpaper) {\n      localStorage.setItem(storageKey, JSON.stringify(wallpaper));\n    } else {\n      localStorage.removeItem(storageKey);\n    }\n  }\n\n  // \n  getCurrentWallpaper(viewType: 'chat' | 'home' | 'settings'): Wallpaper | null {\n    // \n    const themeStorageKey = `${WallpaperManager.THEME_WALLPAPER_KEY_PREFIX}${this.currentThemeName}_${viewType}`;\n    const savedThemeWallpaper = localStorage.getItem(themeStorageKey);\n\n    if (savedThemeWallpaper) {\n      try {\n        return JSON.parse(savedThemeWallpaper);\n      } catch (e) {\n        console.error('Failed to parse theme wallpaper:', e);\n      }\n    }\n\n    // \n    const oldStorageKey = `${WallpaperManager.WALLPAPER_STORAGE_KEY_PREFIX}${viewType}`;\n    const savedOldWallpaper = localStorage.getItem(oldStorageKey);\n\n    if (savedOldWallpaper) {\n      try {\n        return JSON.parse(savedOldWallpaper);\n      } catch (e) {\n        console.error('Failed to parse old wallpaper:', e);\n      }\n    }\n\n    return null;\n  }\n\n  // \n  private migrateOldWallpaperSettings(): void {\n    const viewTypes: Array<'chat' | 'home' | 'settings'> = ['chat', 'home', 'settings'];\n\n    viewTypes.forEach(viewType => {\n      const oldStorageKey = `${WallpaperManager.WALLPAPER_STORAGE_KEY_PREFIX}${viewType}`;\n      const savedOldWallpaper = localStorage.getItem(oldStorageKey);\n\n      if (savedOldWallpaper) {\n        try {\n          // \n          JSON.parse(savedOldWallpaper);\n          // \n          const themeStorageKey = `${WallpaperManager.THEME_WALLPAPER_KEY_PREFIX}${this.currentThemeName}_${viewType}`;\n\n          // \n          if (!localStorage.getItem(themeStorageKey)) {\n            localStorage.setItem(themeStorageKey, savedOldWallpaper);\n          }\n\n          // \n          localStorage.removeItem(oldStorageKey);\n        } catch (e) {\n          console.error('Failed to migrate old wallpaper setting:', e);\n        }\n      }\n    });\n  }\n\n  // \n  applyThemeDefaultWallpapers(theme: Theme): void {\n    // \n    this.setCurrentThemeName(theme.name);\n\n    const viewTypes: Array<'chat' | 'home' | 'settings'> = ['chat', 'home', 'settings'];\n\n    viewTypes.forEach(viewType => {\n      // \n      const themeStorageKey = `${WallpaperManager.THEME_WALLPAPER_KEY_PREFIX}${theme.name}_${viewType}`;\n      const existingWallpaper = localStorage.getItem(themeStorageKey);\n\n      if (existingWallpaper) {\n        // \n        return;\n      }\n\n      const defaultValue = theme.colors.defaultWallpapers[viewType];\n\n      // \n      const isColor = defaultValue.startsWith('#');\n\n      const wallpaper: Wallpaper = {\n        id: `theme_default_${viewType}`,\n        type: isColor ? 'color' : 'image',\n        value: defaultValue,\n        name: `${theme.displayName}${viewType === 'chat' ? '' : viewType === 'home' ? '' : ''}`,\n      };\n\n      // \n      localStorage.setItem(themeStorageKey, JSON.stringify(wallpaper));\n    });\n  }\n\n  // DOM\n  applyWallpaperToElement(element: HTMLElement, wallpaper: Wallpaper | null, defaultThemeWallpaper?: string): void {\n    if (!element) return;\n\n    // \n    element.style.backgroundImage = 'none';\n    element.style.backgroundColor = '';\n    element.style.backgroundSize = '';\n    element.style.backgroundPosition = '';\n    element.style.backgroundRepeat = '';\n\n    if (wallpaper) {\n      if (wallpaper.type === 'color') {\n        //  - \n        element.style.backgroundImage = 'none';\n        element.style.backgroundColor = wallpaper.value;\n      } else {\n        // \n        element.style.backgroundImage = `url(\"${wallpaper.value}\")`;\n        element.style.backgroundSize = 'cover';\n        element.style.backgroundPosition = 'center';\n        element.style.backgroundRepeat = 'no-repeat';\n      }\n    } else if (defaultThemeWallpaper) {\n      // \n      if (defaultThemeWallpaper.startsWith('#')) {\n        // \n        element.style.backgroundImage = 'none';\n        element.style.backgroundColor = defaultThemeWallpaper;\n      } else {\n        // URL\n        element.style.backgroundImage = `url(\"${defaultThemeWallpaper}\")`;\n        element.style.backgroundSize = 'cover';\n        element.style.backgroundPosition = 'center';\n        element.style.backgroundRepeat = 'no-repeat';\n      }\n    }\n  }\n\n  // URL\n  async createWallpaperFromUrl(url: string, name: string): Promise<Wallpaper | null> {\n    try {\n      // URL\n      new URL(url);\n\n      return this.addCustomWallpaper({\n        type: 'url',\n        value: url,\n        name: name || `URL ${new Date().toLocaleString()}`,\n      });\n    } catch (e) {\n      console.error('Invalid URL:', e);\n      return null;\n    }\n  }\n\n  // File\n  async createWallpaperFromFile(file: File): Promise<Wallpaper | null> {\n    return new Promise(resolve => {\n      if (!file.type.startsWith('image/')) {\n        resolve(null);\n        return;\n      }\n\n      const reader = new FileReader();\n      reader.onload = e => {\n        if (e.target?.result) {\n          const wallpaper = this.addCustomWallpaper({\n            type: 'image',\n            value: e.target.result as string,\n            name: file.name || ` ${new Date().toLocaleString()}`,\n          });\n          resolve(wallpaper);\n        } else {\n          resolve(null);\n        }\n      };\n\n      reader.onerror = () => resolve(null);\n      reader.readAsDataURL(file);\n    });\n  }\n\n  // \n  createSolidColorWallpaper(color: string, name?: string): Wallpaper | null {\n    // 36\n    if (!color.match(/^#([0-9A-Fa-f]{3}){1,2}$/)) {\n      console.error('Invalid color format:', color);\n      return null;\n    }\n\n    // 6\n    let normalizedColor = color;\n    if (color.length === 4) {\n      // #RGB \n      const r = color[1];\n      const g = color[2];\n      const b = color[3];\n      normalizedColor = `#${r}${r}${g}${g}${b}${b}`;\n    }\n\n    return this.addCustomWallpaper({\n      type: 'color',\n      value: normalizedColor,\n      name: name || ` ${normalizedColor}`,\n    });\n  }\n\n  // \n  private loadCustomWallpapers(): void {\n    const savedWallpapers = localStorage.getItem(WallpaperManager.CUSTOM_WALLPAPERS_KEY);\n\n    if (savedWallpapers) {\n      try {\n        this.customWallpapers = JSON.parse(savedWallpapers);\n      } catch (e) {\n        console.error('Failed to load custom wallpapers:', e);\n        this.customWallpapers = [];\n      }\n    }\n  }\n\n  // \n  private saveCustomWallpapers(): void {\n    localStorage.setItem(WallpaperManager.CUSTOM_WALLPAPERS_KEY, JSON.stringify(this.customWallpapers));\n  }\n}\n","// \n// UI\n\nimport { ConfigManager } from './config-manager';\nimport { LogEntry } from './script';\nimport { APP_VERSION } from './theme-manager';\n\nexport class UIManager {\n  private configManager: ConfigManager;\n  private onAddEntry?: (entry: LogEntry) => void;\n  private onRenderEntry?: (entry: LogEntry, index?: number, animate?: boolean) => void;\n\n  constructor(\n    configManager: ConfigManager,\n    onAddEntry?: (entry: LogEntry) => void,\n    onRenderEntry?: (entry: LogEntry, index?: number, animate?: boolean) => void,\n  ) {\n    this.configManager = configManager;\n    this.onAddEntry = onAddEntry;\n    this.onRenderEntry = onRenderEntry;\n  }\n\n  // \n  displayAppVersion(): void {\n    $('#app-version-display').text(`v${APP_VERSION}`);\n  }\n\n  // \n  checkVersionUpdateNotification(): void {\n    const lastNotifiedVersion = this.configManager.getLastNotifiedVersion();\n\n    // \n    if (lastNotifiedVersion !== APP_VERSION) {\n      this.showVersionUpdateNotification();\n      this.configManager.setLastNotifiedVersion(APP_VERSION);\n    }\n  }\n\n  // \n  private showVersionUpdateNotification(): void {\n    // \n    const updateEntry: LogEntry = {\n      type: 'message',\n      sender: 'them',\n      content: ` v${APP_VERSION}`,\n      id: `system-${Date.now()}`,\n      isSystemMessage: true,\n    };\n\n    // \n    if (this.onAddEntry) {\n      this.onAddEntry(updateEntry);\n    }\n\n    // \n    if (this.onRenderEntry) {\n      this.onRenderEntry(updateEntry, undefined, true);\n    }\n  }\n\n  // \n  updateFooterButtonsState(hasNotifications: boolean): void {\n    const $wechatInput = $('#wechat-input-field');\n    const $sendBtn = $('#send-btn');\n    const $plusBtn = $('#plus-btn');\n\n    const hasText = $wechatInput.val()?.toString().trim() !== '';\n    const shouldShowSendBtn = hasText || hasNotifications;\n\n    // jQuery\n    $sendBtn.css('display', shouldShowSendBtn ? 'flex' : 'none');\n    $plusBtn.css('display', hasText ? 'none' : 'inline-block');\n  }\n\n  // \n  togglePanel(panelToShow: string | null): void {\n    const $panelContainer = $('#panel-container');\n    const $currentActivePanel = $('.panel-view.active');\n    const isActive = $panelContainer.hasClass('active');\n\n    if (isActive && $currentActivePanel.length && $currentActivePanel.attr('id')?.startsWith(panelToShow || '')) {\n      $panelContainer.removeClass('active');\n      $currentActivePanel.removeClass('active');\n    } else if (panelToShow) {\n      if ($currentActivePanel.length) $currentActivePanel.removeClass('active');\n      $(`#${panelToShow}-panel`).addClass('active');\n      if (!isActive) $panelContainer.addClass('active');\n    } else {\n      if (isActive) $panelContainer.removeClass('active');\n      if ($currentActivePanel.length) $currentActivePanel.removeClass('active');\n    }\n  }\n\n  // \n  navigateTo(viewName: 'home' | 'wechat' | 'moments' | 'settings', onEnterMomentsView?: () => void): void {\n    const views = {\n      home: '#app-homescreen',\n      wechat: '#wechat-view',\n      moments: '#moments-view',\n      settings: '#settings-view',\n    };\n\n    // jQuery\n    $('.app-view').removeClass('active');\n    $(views[viewName]).addClass('active');\n\n    // \n    if (viewName === 'moments' && onEnterMomentsView) {\n      onEnterMomentsView();\n    }\n  }\n\n  // \n  setupInputPlaceholder(charDisplayName: string): void {\n    const savedPlaceholder = this.configManager.getSavedInputPlaceholder();\n    const $inputElement = $('#wechat-input-field');\n    $inputElement.attr('placeholder', savedPlaceholder || ` ${charDisplayName} ...`);\n    $inputElement.prop('disabled', false);\n  }\n\n  // \n  setupPhoneSizeAdjustment(): void {\n    const defaultBtn = document.getElementById('phone-size-default');\n    const mediumBtn = document.getElementById('phone-size-medium');\n    const smallBtn = document.getElementById('phone-size-small');\n    const phoneScreen = document.querySelector('.phone-screen') as HTMLElement;\n\n    if (!defaultBtn || !mediumBtn || !smallBtn || !phoneScreen) {\n      console.error('[BLMX] Phone size adjustment elements not found');\n      return;\n    }\n\n    // \n    const savedSize = this.configManager.getPhoneSize();\n    this.applyPhoneSize(savedSize, phoneScreen, [defaultBtn, mediumBtn, smallBtn]);\n\n    // \n    defaultBtn.addEventListener('click', () => {\n      this.applyPhoneSize('default', phoneScreen, [defaultBtn, mediumBtn, smallBtn]);\n    });\n\n    mediumBtn.addEventListener('click', () => {\n      this.applyPhoneSize('medium', phoneScreen, [defaultBtn, mediumBtn, smallBtn]);\n    });\n\n    smallBtn.addEventListener('click', () => {\n      this.applyPhoneSize('small', phoneScreen, [defaultBtn, mediumBtn, smallBtn]);\n    });\n  }\n\n  // \n  setupStickerSizeControl(): void {\n    const sizeSlider = document.getElementById('sticker-size-slider') as HTMLInputElement;\n    const sizeInput = document.getElementById('sticker-size-input') as HTMLInputElement;\n    const smallSizeBtn = document.getElementById('sticker-size-small');\n    const mediumSizeBtn = document.getElementById('sticker-size-medium');\n\n    if (!sizeSlider || !sizeInput || !smallSizeBtn || !mediumSizeBtn) {\n      return;\n    }\n\n    // \n    const savedSize = this.configManager.getStickerSize();\n\n    // \n    sizeSlider.value = savedSize.toString();\n    sizeInput.value = savedSize.toString();\n\n    // \n    if (savedSize === 80) {\n      smallSizeBtn.classList.add('sticker-size-active');\n      mediumSizeBtn.classList.remove('sticker-size-active');\n    } else if (savedSize === 120) {\n      smallSizeBtn.classList.remove('sticker-size-active');\n      mediumSizeBtn.classList.add('sticker-size-active');\n    } else {\n      smallSizeBtn.classList.remove('sticker-size-active');\n      mediumSizeBtn.classList.remove('sticker-size-active');\n    }\n\n    // CSS\n    this.applyStickerSize(savedSize);\n\n    // \n    sizeSlider.addEventListener('input', () => {\n      const newSize = parseInt(sizeSlider.value);\n      sizeInput.value = newSize.toString();\n      this.configManager.setStickerSize(newSize);\n      this.applyStickerSize(newSize);\n\n      // \n      this.updateStickerSizeButtonState(newSize, smallSizeBtn, mediumSizeBtn);\n    });\n\n    // \n    sizeInput.addEventListener('change', () => {\n      let newSize = parseInt(sizeInput.value);\n      // \n      if (newSize < 40) newSize = 40;\n      if (newSize > 200) newSize = 200;\n\n      const newSizeStr = newSize.toString();\n      sizeInput.value = newSizeStr;\n      sizeSlider.value = newSizeStr;\n      this.configManager.setStickerSize(newSize);\n      this.applyStickerSize(newSize);\n\n      // \n      this.updateStickerSizeButtonState(newSize, smallSizeBtn, mediumSizeBtn);\n    });\n\n    // \n    smallSizeBtn.addEventListener('click', () => {\n      this.setStickerSize(80, sizeSlider, sizeInput, smallSizeBtn, mediumSizeBtn);\n    });\n\n    // \n    mediumSizeBtn.addEventListener('click', () => {\n      this.setStickerSize(120, sizeSlider, sizeInput, smallSizeBtn, mediumSizeBtn);\n    });\n  }\n\n  // \n  private applyPhoneSize(size: 'default' | 'medium' | 'small', phoneScreen: HTMLElement, buttons: HTMLElement[]): void {\n    // \n    const PHONE_SIZES = {\n      default: '48.75rem', // : 48.75rem (780px)\n      medium: '42rem', // : 42rem (672px)\n      small: '36rem', // : 36rem (576px)\n    };\n\n    // \n    phoneScreen.style.height = PHONE_SIZES[size];\n\n    // \n    this.configManager.setPhoneSize(size);\n\n    // \n    buttons.forEach(btn => btn.classList.remove('phone-size-active'));\n\n    // \n    if (size === 'default') {\n      buttons[0].classList.add('phone-size-active');\n    } else if (size === 'medium') {\n      buttons[1].classList.add('phone-size-active');\n    } else if (size === 'small') {\n      buttons[2].classList.add('phone-size-active');\n    }\n  }\n\n  // \n  private applyStickerSize(size: number): void {\n    document.documentElement.style.setProperty('--sticker-size', `${size}px`);\n  }\n\n  // \n  private setStickerSize(\n    size: number,\n    sizeSlider: HTMLInputElement,\n    sizeInput: HTMLInputElement,\n    smallSizeBtn: HTMLElement,\n    mediumSizeBtn: HTMLElement,\n  ): void {\n    sizeSlider.value = size.toString();\n    sizeInput.value = size.toString();\n    this.configManager.setStickerSize(size);\n    this.applyStickerSize(size);\n\n    this.updateStickerSizeButtonState(size, smallSizeBtn, mediumSizeBtn);\n  }\n\n  // \n  private updateStickerSizeButtonState(size: number, smallSizeBtn: HTMLElement, mediumSizeBtn: HTMLElement): void {\n    if (size === 80) {\n      smallSizeBtn.classList.add('sticker-size-active');\n      mediumSizeBtn.classList.remove('sticker-size-active');\n    } else if (size === 120) {\n      smallSizeBtn.classList.remove('sticker-size-active');\n      mediumSizeBtn.classList.add('sticker-size-active');\n    } else {\n      smallSizeBtn.classList.remove('sticker-size-active');\n      mediumSizeBtn.classList.remove('sticker-size-active');\n    }\n  }\n\n  // \n  scrollToBottom(): void {\n    setTimeout(() => {\n      const wechatBody = document.querySelector('.wechat-body') as HTMLElement;\n      if (wechatBody) {\n        wechatBody.scrollTop = wechatBody.scrollHeight;\n      }\n    }, 300);\n  }\n\n  // \n  setupFontSelection(): void {\n    const $customFontBtn = $('#font-default');\n    const $systemFontBtn = $('#font-system');\n\n    if (!$customFontBtn.length || !$systemFontBtn.length) {\n      return;\n    }\n\n    // localStorage\n    const savedFont = localStorage.getItem('blmx_font_setting') || 'custom';\n    this.applyFontSetting(savedFont as 'custom' | 'system');\n\n    // \n    $customFontBtn.on('click', () => {\n      this.applyFontSetting('custom');\n      localStorage.setItem('blmx_font_setting', 'custom');\n    });\n\n    $systemFontBtn.on('click', () => {\n      this.applyFontSetting('system');\n      localStorage.setItem('blmx_font_setting', 'system');\n    });\n  }\n\n  // \n  private applyFontSetting(fontType: 'custom' | 'system'): void {\n    const $body = $('body');\n    const $customBtn = $('#font-default');\n    const $systemBtn = $('#font-system');\n\n    // \n    $('.font-btn').removeClass('font-active');\n\n    if (fontType === 'custom') {\n      //  - \n      this.applyCustomFont();\n      $customBtn.addClass('font-active');\n    } else {\n      //  - \n      this.applySystemFont();\n      $systemBtn.addClass('font-active');\n    }\n  }\n\n  // \n  private applyCustomFont(): void {\n    const $body = $('body');\n\n    // WebView\n    const isIOSWebView = /iPhone|iPad|iPod/.test(navigator.userAgent) && /WebKit/.test(navigator.userAgent);\n    const isHuaweiWebView = /HUAWEI/.test(navigator.userAgent);\n\n    if (isIOSWebView || isHuaweiWebView) {\n      // WebView\n      // Font Loading API\n      const fontStack =\n        \"'MyCustomFont', 'Noto Sans SC', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif\";\n      $body.css('font-family', fontStack);\n\n      // \n      $body.addClass('force-font-refresh');\n      setTimeout(() => {\n        $body.removeClass('force-font-refresh');\n      }, 50);\n\n      // \n      setTimeout(() => {\n        $body.css('font-family', fontStack);\n      }, 100);\n\n      return;\n    }\n\n    // \n    this.checkFontLoaded('MyCustomFont').then(loaded => {\n      if (loaded) {\n        // \n        $body.css('font-family', \"'MyCustomFont', 'Noto Sans SC', sans-serif\");\n      } else {\n        // \n        this.loadCustomFont()\n          .then(() => {\n            $body.css('font-family', \"'MyCustomFont', 'Noto Sans SC', sans-serif\");\n          })\n          .catch(() => {\n            // \n            $body.css('font-family', \"'Noto Sans SC', sans-serif\");\n          });\n      }\n    });\n  }\n\n  // \n  private applySystemFont(): void {\n    const $body = $('body');\n\n    // WebView\n    const isIOSWebView = /iPhone|iPad|iPod/.test(navigator.userAgent) && /WebKit/.test(navigator.userAgent);\n    const isHuaweiWebView = /HUAWEI/.test(navigator.userAgent);\n\n    let fontStack: string;\n\n    if (isIOSWebView) {\n      // iOS WebView \n      fontStack = '-apple-system, \"SF Pro Display\", \"SF Pro Text\", \"Helvetica Neue\", Helvetica, Arial, sans-serif';\n    } else if (isHuaweiWebView) {\n      //  WebView \n      fontStack = '\"HarmonyOS Sans\", \"Noto Sans SC\", \"Microsoft YaHei\", Arial, sans-serif';\n    } else {\n      // \n      fontStack =\n        '-apple-system, BlinkMacSystemFont, \"Segoe UI\", \"Helvetica Neue\", Arial, \"Noto Sans\", \"Liberation Sans\", sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\", \"Noto Color Emoji\"';\n    }\n\n    $body.css('font-family', fontStack);\n\n    // WebView\n    if (isIOSWebView || isHuaweiWebView) {\n      $body.addClass('force-font-refresh');\n      setTimeout(() => {\n        $body.removeClass('force-font-refresh');\n      }, 50);\n    }\n  }\n\n  // \n  private checkFontLoaded(fontFamily: string): Promise<boolean> {\n    return new Promise(resolve => {\n      if (!document.fonts) {\n        // Font Loading API\n        resolve(true);\n        return;\n      }\n\n      document.fonts.ready\n        .then(() => {\n          const fontFace = Array.from(document.fonts).find(\n            font => font.family === fontFamily || font.family === `'${fontFamily}'`,\n          );\n          resolve(!!fontFace && fontFace.status === 'loaded');\n        })\n        .catch(() => {\n          resolve(false);\n        });\n    });\n  }\n\n  // \n  private loadCustomFont(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      if (!document.fonts) {\n        // Font Loading API\n        const testElement = $('<div>')\n          .css({\n            position: 'absolute',\n            left: '-9999px',\n            top: '-9999px',\n            fontSize: '72px',\n            fontFamily: \"'MyCustomFont', monospace\",\n            visibility: 'hidden',\n          })\n          .text('test')\n          .appendTo('body');\n\n        // \n        setTimeout(() => {\n          testElement.remove();\n          resolve();\n        }, 1000);\n        return;\n      }\n\n      const fontFace = new FontFace('MyCustomFont', 'url(https://files.catbox.moe/er4wsg.ttf)');\n\n      fontFace\n        .load()\n        .then(loadedFace => {\n          document.fonts.add(loadedFace);\n          resolve();\n        })\n        .catch(error => {\n          reject(error);\n        });\n    });\n  }\n\n  // \n  setupFullscreenSizeAdjustment(): void {\n    // DOM\n    setTimeout(() => {\n      const $defaultBtn = $('#fullscreen-size-default');\n      const $largeBtn = $('#fullscreen-size-large');\n      const $xlargeBtn = $('#fullscreen-size-xlarge');\n      const $slider = $('#fullscreen-size-slider');\n      const $input = $('#fullscreen-size-input');\n\n      if (!$defaultBtn.length || !$largeBtn.length || !$xlargeBtn.length || !$slider.length || !$input.length) {\n        return;\n      }\n\n      this.initializeFullscreenSizeControls($defaultBtn, $largeBtn, $xlargeBtn, $slider, $input);\n    }, 100);\n  }\n\n  // \n  private initializeFullscreenSizeControls(\n    $defaultBtn: JQuery,\n    $largeBtn: JQuery,\n    $xlargeBtn: JQuery,\n    $slider: JQuery,\n    $input: JQuery,\n  ): void {\n    // localStorage\n    const savedSize = this.configManager.getFullscreenSize();\n\n    // \n    $slider.val(savedSize);\n    $input.val(savedSize);\n    this.applyFullscreenSize(savedSize);\n    this.updateFullscreenSizeButtonState(savedSize);\n\n    // \n    $defaultBtn.off('click').on('click', e => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.setFullscreenSize(100);\n    });\n\n    $largeBtn.off('click').on('click', e => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.setFullscreenSize(130);\n    });\n\n    $xlargeBtn.off('click').on('click', e => {\n      e.preventDefault();\n      e.stopPropagation();\n      this.setFullscreenSize(160);\n    });\n\n    // \n    $slider.off('input').on('input', e => {\n      const newSize = parseInt($(e.target).val() as string);\n      $input.val(newSize);\n      this.setFullscreenSize(newSize);\n    });\n\n    // \n    $input.off('change').on('change', e => {\n      let newSize = parseInt($(e.target).val() as string);\n      // \n      if (newSize < 50) newSize = 50;\n      if (newSize > 200) newSize = 200;\n\n      $input.val(newSize);\n      $slider.val(newSize);\n      this.setFullscreenSize(newSize);\n    });\n\n    // \n    this.setupFullscreenListener();\n  }\n\n  // \n  private setupFullscreenListener(): void {\n    const handleFullscreenChange = () => {\n      const isFullscreen = !!(\n        document.fullscreenElement ||\n        (document as any).webkitFullscreenElement ||\n        (document as any).mozFullScreenElement ||\n        (document as any).msFullscreenElement\n      );\n\n      if (!isFullscreen) {\n        // \n        this.resetBrowserZoom();\n      } else {\n        // \n        const currentSize = this.configManager.getFullscreenSize();\n        this.applyBrowserLikeZoom(currentSize / 100);\n      }\n    };\n\n    // \n    document.addEventListener('fullscreenchange', handleFullscreenChange);\n    document.addEventListener('webkitfullscreenchange', handleFullscreenChange);\n    document.addEventListener('mozfullscreenchange', handleFullscreenChange);\n    document.addEventListener('MSFullscreenChange', handleFullscreenChange);\n  }\n\n  // \n  private resetBrowserZoom(): void {\n    const body = document.body;\n\n    // \n    body.style.transform = '';\n    body.style.transformOrigin = '';\n    body.style.position = '';\n    body.style.width = '';\n    body.style.height = '';\n    body.style.margin = '';\n  }\n\n  // UI\n  private setFullscreenSize(size: number): void {\n    // \n    this.configManager.setFullscreenSize(size);\n\n    // \n    $('#fullscreen-size-slider').val(size);\n    $('#fullscreen-size-input').val(size);\n\n    // \n    this.applyFullscreenSize(size);\n\n    // \n    this.updateFullscreenSizeButtonState(size);\n  }\n\n  // \n  private applyFullscreenSize(size: number): void {\n    const scale = size / 100;\n\n    // \n    const isFullscreen = !!(\n      document.fullscreenElement ||\n      (document as any).webkitFullscreenElement ||\n      (document as any).mozFullScreenElement ||\n      (document as any).msFullscreenElement\n    );\n\n    if (isFullscreen) {\n      // \n      this.applyBrowserLikeZoom(scale);\n    }\n    // \n  }\n\n  // \n  private applyBrowserLikeZoom(scale: number): void {\n    const body = document.body;\n\n    if (scale !== 1) {\n      body.style.transform = `scale(${scale})`;\n      body.style.transformOrigin = 'center center';\n      body.style.position = 'relative';\n      body.style.width = `${100 / scale}%`;\n      body.style.height = `${100 / scale}%`;\n      body.style.margin = '0 auto';\n    } else {\n      body.style.transform = '';\n      body.style.transformOrigin = '';\n      body.style.position = '';\n      body.style.width = '';\n      body.style.height = '';\n      body.style.margin = '';\n    }\n  }\n\n  // \n  private updateFullscreenSizeButtonState(size: number): void {\n    // \n    $('.fullscreen-size-btn').removeClass('fullscreen-size-active');\n\n    // \n    if (size === 100) {\n      $('#fullscreen-size-default').addClass('fullscreen-size-active');\n    } else if (size === 130) {\n      $('#fullscreen-size-large').addClass('fullscreen-size-active');\n    } else if (size === 160) {\n      $('#fullscreen-size-xlarge').addClass('fullscreen-size-active');\n    }\n    // \n  }\n}\n","import { EventManager } from './event-manager';\nimport {\n  ChatEntry,\n  EventLogEntry,\n  FileMessage,\n  GiftMessage,\n  ImageMessage,\n  LocationMessage,\n  LogEntry,\n  StickerMessage,\n  TextMessage,\n  TransferMessage,\n  VoiceMessage,\n} from './script';\n\n// \ninterface Avatars {\n  user: string;\n  char: string;\n}\n\ninterface UIRendererOptions {\n  getDisplayName: (type: 'user' | 'char') => string;\n  findStickerUrlByName: (name: string) => string | undefined;\n  onTransferAccept?: (data: TransferMessage['data']) => void;\n  onGiftAction?: (data: GiftMessage['data']) => Promise<void>;\n  onRecallMessage?: (entry: ChatEntry) => Promise<void>;\n  isMessageInQueue?: (messageId: string) => boolean;\n}\n\n// UI\nexport class UIRenderer {\n  private wechatBody: HTMLElement;\n  private lastDisplayedTimeInMinutes: number = -Infinity;\n  private options: UIRendererOptions;\n  private avatars: Avatars;\n  private eventManager: EventManager;\n\n  // \n  private renderQueue: LogEntry[] = [];\n  private isRendering: boolean = false;\n  private renderThrottle: number = 16; // 60fps\n\n  constructor(wechatBodySelector: string, avatars: Avatars, options: UIRendererOptions) {\n    const $wechatBody = $(wechatBodySelector);\n    if (!$wechatBody.length) {\n      throw new Error(`Element with selector \"${wechatBodySelector}\" not found`);\n    }\n    this.wechatBody = $wechatBody[0];\n    this.avatars = avatars;\n    this.options = options;\n    this.eventManager = new EventManager();\n\n    // \n    this.startRenderLoop();\n  }\n\n  /**\n   * \n   */\n  private startRenderLoop(): void {\n    const processQueue = () => {\n      if (this.renderQueue.length > 0 && !this.isRendering) {\n        this.isRendering = true;\n        const batch = this.renderQueue.splice(0, 5); // 5\n\n        batch.forEach(entry => {\n          this.renderEntry(entry, undefined, false);\n        });\n\n        this.isRendering = false;\n      }\n\n      setTimeout(processQueue, this.renderThrottle);\n    };\n\n    processQueue();\n  }\n\n  /**\n   * \n   */\n  private queueRender(entry: LogEntry): void {\n    this.renderQueue.push(entry);\n  }\n\n  // \n  clearChat(): void {\n    this.wechatBody.innerHTML = '';\n    this.lastDisplayedTimeInMinutes = -Infinity;\n  }\n\n  // UI\n  renderEntry(entry: LogEntry, index?: number, animate: boolean = false): void {\n    if (!entry) return;\n\n    if ('type' in entry) {\n      switch (entry.type) {\n        case 'message':\n          if (entry.isSystemMessage) {\n            this.renderSystemMessage(entry as TextMessage, animate, index);\n          } else {\n            this.addMessageToWeChat(entry, index, animate);\n          }\n          break;\n        case 'time':\n          this.addTimestampToWeChat(entry.content.date, entry.content.time, true, index);\n          break;\n        case 'event':\n          this.addEventLogToWeChat(entry.content, index);\n          break;\n        default:\n          this.addMessageToWeChat(entry, index, animate);\n      }\n    }\n  }\n\n  // \n  renderRecallNotice(entry: LogEntry, elementToReplace: HTMLElement | null = null, index?: number): void {\n    const who = this.options.getDisplayName('sender' in entry && entry.sender === 'me' ? 'user' : 'char');\n    const noticeRow = document.createElement('div');\n    noticeRow.className = 'timestamp-row';\n\n    // data-log-index\n    if (index !== undefined) {\n      noticeRow.dataset.logIndex = index.toString();\n    }\n\n    // idmessage-id\n    if ('id' in entry) {\n      noticeRow.dataset.messageId = entry.id;\n    }\n\n    const recalledText =\n      typeof entry.recalled_content === 'object' && entry.recalled_content !== null\n        ? entry.recalled_content.text\n        : entry.recalled_content;\n\n    noticeRow.innerHTML = `\n      <div class=\"recall-notice-container\">\n        <div class=\"recall-notice-text\">\"${who}\" </div>\n        <div class=\"recall-content\">${recalledText || ('content' in entry ? entry.content : '')}</div>\n      </div>\n    `;\n\n    const noticeTextEl = noticeRow.querySelector('.recall-notice-text');\n    const contentEl = noticeRow.querySelector('.recall-content');\n\n    if (noticeTextEl && contentEl) {\n      noticeTextEl.addEventListener('click', () => {\n        contentEl.classList.toggle('expanded');\n      });\n    }\n\n    if (elementToReplace) {\n      elementToReplace.replaceWith(noticeRow);\n    } else {\n      this.wechatBody.appendChild(noticeRow);\n    }\n\n    this.scrollToBottom();\n  }\n\n  renderMomentsFeed(\n    logEntries: LogEntry[],\n    getDisplayName: (type: 'user' | 'char') => string,\n    avatars: { user: string; char: string },\n  ): void {\n    const momentsFeedList = $('#moments-feed-list')[0] as HTMLUListElement;\n    if (!momentsFeedList) return;\n\n    momentsFeedList.innerHTML = '';\n    const posts: { [key: number]: any } = {};\n    const momentPostLogIndices: number[] = [];\n\n    logEntries.forEach((entry, index) => {\n      if ('key' in entry && entry.key.includes('_MOMENT')) {\n        momentPostLogIndices.push(index);\n      }\n    });\n\n    momentPostLogIndices.forEach(logIndex => {\n      const entry = logEntries[logIndex];\n      posts[logIndex] = { ...(entry as any), likes: [], comments: [], id: logIndex };\n    });\n\n    logEntries.forEach((entry, index) => {\n      if ('key' in entry && (entry.key.includes('_LIKE') || entry.key.includes('_COMMENT'))) {\n        const targetPostAbsoluteIndex = momentPostLogIndices[parseInt((entry as any).data.target_post_id, 10)];\n        const targetPost = posts[targetPostAbsoluteIndex];\n\n        if (targetPost) {\n          if (entry.key.includes('_LIKE')) {\n            const likerName = entry.key.startsWith('USER') ? getDisplayName('user') : getDisplayName('char');\n            if (!targetPost.likes.some((l: any) => l.name === likerName)) {\n              targetPost.likes.push({ key: entry.key, name: likerName, originalLogIndex: index });\n            }\n          } else {\n            targetPost.comments.push({ ...(entry as any), originalLogIndex: index });\n          }\n        } else {\n          // \n        }\n      }\n    });\n\n    Object.values(posts)\n      .reverse()\n      .forEach(post => {\n        const fromUser = post.key.startsWith('USER');\n        const authorName = fromUser ? getDisplayName('user') : getDisplayName('char');\n        const authorAvatar = fromUser ? avatars.user : avatars.char;\n        const li = document.createElement('li');\n        li.className = 'moment-post';\n        li.dataset.postId = post.id;\n        const momentSequenceId = momentPostLogIndices.indexOf(post.id);\n        li.dataset.momentSequenceId = String(momentSequenceId);\n        // moment-id\n        li.dataset.momentId = String(momentSequenceId);\n\n        let mediaHtml = '';\n        if (post.data.image_type === 'url' && post.data.image) {\n          mediaHtml = `<img src=\"${post.data.image}\" class=\"post-media-image\" />`;\n        } else if (post.data.image_type === 'desc' && post.data.image) {\n          mediaHtml = `<div class=\"image-desc-content\"><div class=\"text-wrapper\">${post.data.image}</div></div>`;\n        }\n\n        let interactionsHtml = '';\n        if (post.likes.length > 0 || post.comments.length > 0) {\n          const likersHtml =\n            post.likes.length > 0\n              ? `<div class=\"likes-section\"><i class=\"fas fa-heart\"></i> ${post.likes\n                  .map((l: any) => `<span class=\"liker-name\">${l.name}</span>`)\n                  .join(', ')}</div>`\n              : '';\n          const commentsHtml =\n            post.comments.length > 0\n              ? `<ul class=\"comments-section\">${post.comments\n                  .map(\n                    (c: any) =>\n                      `<li><span class=\"comment-author\">${\n                        c.key.startsWith('USER') ? getDisplayName('user') : getDisplayName('char')\n                      }</span>: ${c.data.text}</li>`,\n                  )\n                  .join('')}</ul>`\n              : '';\n          interactionsHtml = `<div class=\"post-interactions\">${likersHtml}${commentsHtml}</div>`;\n        }\n\n        const displayTime = this.formatMomentTimestamp(post.data.date, post.data.time);\n        const deleteBtnHtml = fromUser ? `<span class=\"delete-moment-btn\" title=\"\"></span>` : '';\n\n        li.innerHTML = `<img src=\"${authorAvatar}\" class=\"post-author-avatar\" />\n                         <div class=\"post-details\">\n                             <span class=\"post-author-name\">${authorName}</span>\n                             <p class=\"post-content\">${post.data.text || ''}</p>\n                             <div class=\"post-media\">${mediaHtml}</div>\n                             <div class=\"post-meta\">\n                                 <div class=\"post-meta-left\">\n                                     <span class=\"timestamp\">${displayTime}</span>\n                                     ${deleteBtnHtml}\n                                 </div>\n                                 <div class=\"post-actions\">\n                                     <span class=\"comment-button\" title=\"/\"><i class=\"fas fa-comment-dots\"></i></span>\n                                 </div>\n                             </div>\n                             ${interactionsHtml}\n                         </div>`;\n        momentsFeedList.appendChild(li);\n      });\n  }\n\n  // \"\"\n  showTypingIndicator(): void {\n    this.hideTypingIndicator(); // \n    const indicator = document.createElement('div');\n    indicator.className = 'typing-indicator';\n    indicator.id = 'typing-indicator-id';\n    const avatarSrc = this.avatars.char;\n\n    indicator.innerHTML = `\n      <img src=\"${avatarSrc}\" class=\"message-avatar\" />\n      <div class=\"message-bubble\">\n        <span class=\"typing-dot\"></span>\n        <span class=\"typing-dot\"></span>\n        <span class=\"typing-dot\"></span>\n      </div>\n    `;\n    this.wechatBody.appendChild(indicator);\n    this.scrollToBottom();\n  }\n\n  // \"\"\n  hideTypingIndicator(): void {\n    $('#typing-indicator-id').remove();\n  }\n\n  // AI\n  showGeneratingIndicator(): void {\n    this.hideGeneratingIndicator(); // \n\n    //  - jQuery\n    const dynamicIsland = $('.dynamic-island')[0] as HTMLElement;\n    if (!dynamicIsland) return;\n\n    // \n    const loadingContainer = document.createElement('div');\n    loadingContainer.className = 'generating-indicator';\n    loadingContainer.id = 'generating-indicator-id';\n\n    // \n    loadingContainer.innerHTML = `\n      <span class=\"generating-dot\"></span>\n      <span class=\"generating-dot\"></span>\n      <span class=\"generating-dot\"></span>\n    `;\n\n    // \n    dynamicIsland.appendChild(loadingContainer);\n\n    // \n    dynamicIsland.classList.add('generating-active');\n  }\n\n  // AI\n  hideGeneratingIndicator(): void {\n    $('#generating-indicator-id').remove();\n    $('.dynamic-island').removeClass('generating-active');\n  }\n\n  // \n  calculateTypingDelay(messageContent: string | object): number {\n    // \n    if (typeof messageContent !== 'string' || messageContent.trim() === '') {\n      return 800 + Math.random() * 700; // 0.8s to 1.5s\n    }\n\n    const textLength = messageContent.length;\n    const baseDelay = 500; //  0.5s\n    const perCharDelay = 40; //  40ms\n    const randomComponent = Math.random() * 800; //  0-0.8s \n\n    const totalDelay = baseDelay + textLength * perCharDelay + randomComponent;\n\n    // 3 (3000ms)\n    return Math.min(totalDelay, 3000);\n  }\n\n  // \n  private addMessageToWeChat(entry: ChatEntry, index?: number, isNewMessage: boolean = false): void {\n    const { id, sender, type } = entry;\n    const messageRow = document.createElement('div');\n    messageRow.className = 'message-row';\n    if (index !== undefined) messageRow.dataset.logIndex = index.toString();\n    messageRow.dataset.messageId = id;\n\n    const senderClass = sender;\n    messageRow.classList.add(senderClass);\n\n    const avatarSrc = sender === 'me' ? this.avatars.user : this.avatars.char;\n    const avatarImgHtml = `<img src=\"${avatarSrc}\" class=\"message-avatar\" />`;\n\n    if (type === 'voice') {\n      this.renderVoiceMessage(messageRow, entry as VoiceMessage, avatarImgHtml);\n    } else {\n      let bubbleContent = '';\n\n      switch (type) {\n        case 'sticker':\n          bubbleContent = this.renderStickerContent(entry as StickerMessage);\n          break;\n        case 'image':\n          bubbleContent = this.renderImageContent(entry as ImageMessage);\n          break;\n        case 'location':\n          bubbleContent = this.renderLocationContent(entry as LocationMessage);\n          break;\n        case 'transfer':\n          bubbleContent = this.renderTransferContent(entry as TransferMessage);\n          break;\n        case 'file':\n          bubbleContent = this.renderFileContent(entry as FileMessage);\n          break;\n        case 'gift':\n          {\n            // \n            const giftEntry = entry as GiftMessage;\n            const isRedEnvelope =\n              giftEntry.data.name.includes('') ||\n              giftEntry.data.name.includes('') ||\n              giftEntry.data.name.includes('');\n\n            if (isRedEnvelope) {\n              bubbleContent = this.renderRedEnvelopeContent(giftEntry);\n            } else {\n              bubbleContent = this.renderGiftContent(giftEntry);\n            }\n          }\n          break;\n        default:\n          bubbleContent = (entry as TextMessage).content.replace(/</g, '&lt;').replace(/>/g, '&gt;');\n          break;\n      }\n\n      // \n      let bubbleClass = 'message-bubble';\n      if (type === 'sticker') {\n        bubbleClass += ' sticker-bubble';\n      } else if (type === 'image') {\n        bubbleClass += ' image-desc-bubble';\n      } else if (type === 'location') {\n        bubbleClass += ' location-bubble';\n      } else if (type === 'transfer') {\n        bubbleClass += ' transfer-bubble';\n      } else if (type === 'file') {\n        bubbleClass += ' file-bubble';\n      } else if (type === 'gift') {\n        bubbleClass += ' gift-bubble';\n      }\n\n      messageRow.innerHTML =\n        sender === 'me'\n          ? `<div class=\"${bubbleClass}\">${bubbleContent}</div>${avatarImgHtml}`\n          : `${avatarImgHtml}<div class=\"${bubbleClass}\">${bubbleContent}</div>`;\n\n      const bubble = messageRow.querySelector('.message-bubble');\n      if (bubble) {\n        this.applyBubbleStyles(bubble, type, entry);\n        this.setupBubbleInteractions(bubble, type, entry);\n      }\n    }\n\n    if (isNewMessage) {\n      messageRow.classList.add('new-message');\n    }\n\n    // USER\n    if (sender === 'me' && entry.type === 'message') {\n      this.setupUserMessageLongPress(messageRow, entry);\n    }\n\n    this.wechatBody.appendChild(messageRow);\n    this.scrollToBottom();\n  }\n\n  // \n  private renderVoiceMessage(messageRow: HTMLElement, entry: VoiceMessage, avatarImgHtml: string): void {\n    const contentContainer = document.createElement('div');\n    contentContainer.className = 'message-content-container';\n\n    const bubble = document.createElement('div');\n    bubble.className = 'message-bubble voice-bubble';\n    bubble.innerHTML = `<span class=\"duration\">${entry.content.duration}\"</span><i class=\"fas fa-wifi voice-icon\"></i>`;\n\n    const textRevealBox = document.createElement('div');\n    textRevealBox.className = 'voice-text-content';\n    textRevealBox.textContent = entry.content.text;\n\n    contentContainer.appendChild(bubble);\n    contentContainer.appendChild(textRevealBox);\n\n    if (entry.sender === 'me') {\n      messageRow.appendChild(contentContainer);\n      messageRow.insertAdjacentHTML('beforeend', avatarImgHtml);\n    } else {\n      messageRow.insertAdjacentHTML('afterbegin', avatarImgHtml);\n      messageRow.appendChild(contentContainer);\n    }\n\n    let longPressFired = false;\n    const timerDuration = 500;\n    let pressTimer: number;\n\n    bubble.addEventListener('pointerdown', e => {\n      if (e.pointerType === 'mouse' && (e as PointerEvent).button !== 0) return;\n      longPressFired = false;\n      pressTimer = window.setTimeout(() => {\n        messageRow.classList.add('voice-text-visible');\n        longPressFired = true;\n      }, timerDuration);\n    });\n\n    bubble.addEventListener('pointerup', () => {\n      clearTimeout(pressTimer);\n      if (!longPressFired) {\n        if (messageRow.classList.contains('voice-text-visible')) {\n          messageRow.classList.remove('voice-text-visible');\n        }\n      }\n    });\n\n    bubble.addEventListener('pointerleave', () => clearTimeout(pressTimer));\n    bubble.addEventListener('contextmenu', e => e.preventDefault());\n  }\n\n  // \n  private renderStickerContent(entry: StickerMessage): string {\n    const stickerUrl = this.options.findStickerUrlByName(entry.content);\n    if (stickerUrl) {\n      // HTML\n      return `<div class=\"sticker-container\"><img src=\"${stickerUrl}\" class=\"sticker-img\" /></div>`;\n    } else {\n      return `<div class=\"sticker-placeholder\">[]</div>`;\n    }\n  }\n\n  // \n  private renderImageContent(entry: ImageMessage): string {\n    if (entry.content.type === 'url') {\n      let imageUrl = entry.content.value;\n      if (imageUrl.startsWith('blmx-img-')) {\n        const storedImage = sessionStorage.getItem(imageUrl);\n        if (storedImage) {\n          imageUrl = storedImage;\n        } else {\n          return `<div class=\"image-desc-content\"><div class=\"text-wrapper\">[]</div></div>`;\n        }\n      }\n      return `<img src=\"${imageUrl}\" class=\"chat-image\" />`;\n    } else {\n      const descText = entry.content.value;\n      return `<div class=\"image-desc-content\"><div class=\"text-wrapper\">${String(descText)\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;')}</div></div>`;\n    }\n  }\n\n  // \n  private renderLocationContent(entry: LocationMessage): string {\n    return `<div class=\"location-card\">\n      <div class=\"location-content\">\n        <div class=\"location-title\">${entry.content}</div>\n        <div class=\"location-subtitle\"></div>\n      </div>\n      <div class=\"location-map-placeholder\"></div>\n    </div>`;\n  }\n\n  // \n  private renderTransferContent(entry: TransferMessage): string {\n    const isReceipt = entry.data.status !== 'sent';\n    const detailsHtml = isReceipt\n      ? `<div class=\"status-text\">${entry.data.status === 'accepted' ? '' : ''}</div>`\n      : `<div class=\"note\">${entry.data.note || ' '}</div>`;\n    const cardClass = isReceipt ? 'transfer-receipt' : 'transfer-initial';\n\n    return `<div class=\"transfer-card ${cardClass}\">\n      <div class=\"transfer-content\">\n        <img src=\"https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/%E7%B4%A0%E6%9D%90/arrows.png\" class=\"transfer-icon-image\">\n        <div class=\"transfer-details\">\n          <div class=\"amount\">${entry.data.amount}</div>\n          ${detailsHtml}\n        </div>\n      </div>\n      <div class=\"transfer-footer\"></div>\n    </div>`;\n  }\n\n  // \n  private renderFileContent(entry: FileMessage): string {\n    return `<div class=\"file-card\">\n      <div class=\"file-content\">\n        <i class=\"fas fa-file-alt file-icon\"></i>\n        <div class=\"file-details\">\n          <div class=\"file-name\">${entry.content.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>\n        </div>\n      </div>\n      <div class=\"file-footer\"></div>\n    </div>`;\n  }\n\n  // \n  private renderGiftContent(entry: GiftMessage): string {\n    let detailsClass = '';\n    let detailsContent = '';\n    const isReceipt = entry.data.status !== 'sent';\n    const cardClass = isReceipt ? 'gift-receipt' : 'gift-initial';\n\n    if (entry.data.status === 'sent') {\n      if (entry.data.price) {\n        detailsClass = 'gift-price';\n        detailsContent = ` ${entry.data.price}`;\n      }\n    } else {\n      detailsClass = 'gift-status-text';\n      detailsContent = entry.data.status === 'accepted' ? '' : '';\n    }\n\n    return `<div class=\"gift-card ${cardClass}\">\n      <div class=\"gift-content\">\n        <span class=\"gift-icon-emoji\"></span>\n        <div class=\"gift-details\">\n          <div class=\"gift-name\">${entry.data.name}</div>\n          ${detailsContent ? `<div class=\"${detailsClass}\">${detailsContent}</div>` : ''}\n        </div>\n      </div>\n      <div class=\"gift-footer\"></div>\n    </div>`;\n  }\n\n  // \n  private renderRedEnvelopeContent(entry: GiftMessage): string {\n    let detailsClass = '';\n    let detailsContent = '';\n    const isReceipt = entry.data.status !== 'sent';\n    const cardClass = isReceipt ? 'gift-receipt' : 'gift-initial';\n\n    if (entry.data.status === 'sent') {\n      if (entry.data.price) {\n        detailsClass = 'gift-price';\n        detailsContent = ` ${entry.data.price}`;\n      }\n    } else {\n      detailsClass = 'gift-status-text';\n      detailsContent = entry.data.status === 'accepted' ? '' : '';\n    }\n\n    return `<div class=\"gift-card ${cardClass}\">\n      <div class=\"gift-content\">\n        <img src=\"https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/%E7%B4%A0%E6%9D%90/red-envelope.png\" class=\"gift-icon-image\">\n        <div class=\"gift-details\">\n          <div class=\"gift-name\">${entry.data.name}</div>\n          ${detailsContent ? `<div class=\"${detailsClass}\">${detailsContent}</div>` : ''}\n        </div>\n      </div>\n      <div class=\"gift-footer\"></div>\n    </div>`;\n  }\n\n  // \n  private applyBubbleStyles(bubble: Element, type: string, entry: ChatEntry): void {\n    if (type === 'image') {\n      if ((entry as ImageMessage).content.type === 'url') {\n        bubble.classList.add('image-url-bubble');\n      } else {\n        bubble.classList.add('image-desc-bubble');\n      }\n    } else {\n      const bubbleTypeMap: Record<string, string> = {\n        sticker: 'sticker-bubble',\n        location: 'location-bubble',\n        transfer: 'transfer-bubble',\n        file: 'file-bubble',\n        gift: 'gift-bubble',\n      };\n\n      if (bubbleTypeMap[type]) {\n        bubble.classList.add(bubbleTypeMap[type]);\n      }\n    }\n  }\n\n  // \n  private setupBubbleInteractions(bubble: Element, type: string, entry: ChatEntry): void {\n    if (type === 'transfer') {\n      const transferCard = bubble.querySelector('.transfer-card');\n      if (!transferCard) return;\n\n      const transferEntry = entry as TransferMessage;\n      const isReceipt = transferEntry.data.status !== 'sent';\n\n      if (!isReceipt && entry.sender === 'them') {\n        transferCard.classList.add('them');\n        transferCard.addEventListener(\n          'click',\n          () => {\n            // \n            if (this.options.onTransferAccept) {\n              this.options.onTransferAccept({\n                ...transferEntry.data,\n                status: 'accepted' as 'accepted' | 'rejected',\n              });\n            }\n          },\n          { once: true },\n        );\n      }\n    }\n\n    if (type === 'gift') {\n      const giftBubble = bubble as HTMLElement;\n      const giftCard = bubble.querySelector('.gift-card');\n      const giftEntry = entry as GiftMessage;\n      const isReceipt = giftEntry.data.status !== 'sent';\n\n      if (isReceipt) {\n        // \n        return;\n      }\n\n      // AI\n      if (giftCard) giftCard.classList.add(entry.sender === 'them' ? 'them' : 'me');\n      giftBubble.classList.add('gift-clickable');\n      giftBubble.addEventListener(\n        'click',\n        async () => {\n          if (this.options.onGiftAction) {\n            await this.options.onGiftAction(giftEntry.data);\n          }\n\n          giftBubble.classList.remove('gift-clickable');\n        },\n        { once: true },\n      );\n    }\n  }\n\n  // \n  private addTimestampToWeChat(date: string, time: string, isSystemTime: boolean, index?: number): void {\n    const timeText = this.formatMomentTimestamp(date, time);\n\n    // \n    // \n    if (isSystemTime) {\n      // 10\n      const isOnlyTime = timeText === time;\n\n      if (isOnlyTime) {\n        // \n        const timeInMinutes = this.parseTimeToMinutes(timeText);\n        if (timeInMinutes !== null && timeInMinutes - this.lastDisplayedTimeInMinutes < 10) {\n          return; // \n        }\n\n        // \n        if (timeInMinutes !== null) {\n          this.lastDisplayedTimeInMinutes = timeInMinutes;\n        }\n      } else {\n        // \n        this.lastDisplayedTimeInMinutes = -Infinity;\n      }\n    }\n\n    // \n    const t = document.createElement('div');\n    t.className = 'timestamp-row';\n    if (index !== undefined) t.dataset.logIndex = index.toString();\n\n    // \n    t.dataset.originalDate = date;\n    t.dataset.originalTime = time;\n\n    t.innerHTML = `<span class=\"timestamp-text\">${timeText}</span>`;\n    this.wechatBody.appendChild(t);\n\n    this.scrollToBottom();\n  }\n\n  // \n  private addEventLogToWeChat(eventData: EventLogEntry['content'], index?: number): void {\n    // eventData\n    if (!eventData || !eventData.date || !eventData.time) {\n      console.error(':', eventData);\n      return;\n    }\n\n    // \n    const timeText = this.formatMomentTimestamp(eventData.date, eventData.time);\n\n    // \n    const row = document.createElement('div');\n    row.className = 'event-log-row';\n    if (index !== undefined) row.dataset.logIndex = index.toString();\n\n    // \n    row.dataset.originalDate = eventData.date;\n    row.dataset.originalTime = eventData.time;\n\n    // \n    if (eventData.description) {\n      row.innerHTML = `\n        <div class=\"event-log-container\">\n          <div class=\"event-time-text has-desc clickable\">${timeText}</div>\n          <div class=\"event-description\">${eventData.description}</div>\n        </div>\n      `;\n    } else {\n      row.innerHTML = `\n        <div class=\"event-log-container\">\n          <div class=\"event-time-text\">${timeText}</div>\n        </div>\n      `;\n    }\n\n    // \n    if (eventData.description) {\n      const timeEl = row.querySelector('.event-time-text');\n      const descEl = row.querySelector('.event-description');\n\n      if (timeEl && descEl) {\n        timeEl.addEventListener('click', () => {\n          // CSS/display\n          descEl.classList.toggle('expanded');\n        });\n      }\n    }\n\n    // \n    this.wechatBody.appendChild(row);\n    this.scrollToBottom();\n  }\n\n  // \n  private renderSystemMessage(entry: TextMessage, animate: boolean = false, index?: number): void {\n    const chatContainer = this.wechatBody;\n    if (!chatContainer) return;\n\n    const systemRow = document.createElement('div');\n    systemRow.className = 'event-log-row';\n    if (animate) systemRow.classList.add('new-message');\n    if (entry.id) {\n      systemRow.dataset.messageId = entry.id;\n    }\n    if (index !== undefined) {\n      systemRow.dataset.logIndex = index.toString();\n    }\n\n    const systemContainer = document.createElement('div');\n    systemContainer.className = 'event-log-container';\n\n    const systemText = document.createElement('div');\n    systemText.className = 'event-time-text system-message';\n    systemText.textContent = entry.content;\n\n    systemContainer.appendChild(systemText);\n    systemRow.appendChild(systemContainer);\n    chatContainer.appendChild(systemRow);\n\n    this.scrollToBottom();\n  }\n\n  // \n  private parseTimeToMinutes(timeString: string): number | null {\n    const match = timeString.match(/(\\d{1,2}):(\\d{2})/);\n    return match ? 60 * parseInt(match[1], 10) + parseInt(match[2], 10) : null;\n  }\n\n  // \n  private formatMomentTimestamp(dateString: string, timeString: string): string {\n    if (!dateString || !timeString) return ' ';\n\n    try {\n      // \n      const postDate = new Date(dateString);\n      // \n      const currentDate = window.currentGameDate ? new Date(window.currentGameDate) : new Date();\n\n      // \n      const postYear = postDate.getFullYear();\n      const postMonth = postDate.getMonth();\n      const postDay = postDate.getDate();\n\n      const nowYear = currentDate.getFullYear();\n      const nowMonth = currentDate.getMonth();\n      const nowDay = currentDate.getDate();\n\n      // \n      if (postYear === nowYear && postMonth === nowMonth && postDay === nowDay) {\n        return timeString;\n      }\n\n      // \n      const yesterday = new Date(currentDate);\n      yesterday.setDate(currentDate.getDate() - 1);\n      const yesterdayYear = yesterday.getFullYear();\n      const yesterdayMonth = yesterday.getMonth();\n      const yesterdayDay = yesterday.getDate();\n\n      // \n      if (postYear === yesterdayYear && postMonth === yesterdayMonth && postDay === yesterdayDay) {\n        return ` ${timeString}`;\n      }\n\n      // \n      if (postYear === nowYear) {\n        return `${postMonth + 1}${postDay} ${timeString}`;\n      }\n\n      // \n      return `${postYear}${postMonth + 1}${postDay} ${timeString}`;\n    } catch (error) {\n      console.error('Error formatting timestamp:', error);\n      return timeString; // \n    }\n  }\n\n  // \n  public refreshAllTimestamps(): void {\n    // \n    const timestampRows = $('.timestamp-row', this.wechatBody);\n    const eventLogRows = $('.event-log-row', this.wechatBody);\n\n    // \n    timestampRows.each((_, row) => {\n      const $row = $(row);\n      const $timestampText = $row.find('.timestamp-text');\n      if ($timestampText.length) {\n        const originalDate = $row.data('originalDate');\n        const originalTime = $row.data('originalTime');\n        if (originalDate && originalTime) {\n          $timestampText.text(this.formatMomentTimestamp(originalDate, originalTime));\n        }\n      }\n    });\n\n    // \n    eventLogRows.each((_, row) => {\n      const $row = $(row);\n      const $eventTimeText = $row.find('.event-time-text');\n      if ($eventTimeText.length) {\n        const originalDate = $row.data('originalDate');\n        const originalTime = $row.data('originalTime');\n        if (originalDate && originalTime) {\n          // \n          $eventTimeText.text(this.formatMomentTimestamp(originalDate, originalTime));\n        }\n      }\n    });\n  }\n\n  renderFeatureGrid(\n    gridElement: HTMLElement,\n    features: any[],\n    callbacks: {\n      onToggleDeleteMode: () => void;\n      onAddStickers: () => void;\n    },\n  ): void {\n    if (!gridElement) {\n      console.error('[BLMX] Grid element not found for renderFeatureGrid');\n      return;\n    }\n\n    gridElement.innerHTML = '';\n    const isDeleteMode = gridElement.classList.contains('sticker-delete-mode');\n\n    features.forEach(feature => {\n      const item = document.createElement('div');\n      item.className = 'feature-item';\n\n      let iconHtml = '';\n      if (feature.isAddBtn) {\n        // \n        if (feature.label === '') {\n          iconHtml = `<div class=\"feature-icon\"><i class=\"fas fa-cog\"></i></div>`;\n        } else {\n          iconHtml = `<div class=\"feature-icon\"><i class=\"fas fa-${\n            feature.label === '' ? 'plus' : 'trash-alt'\n          }\"></i></div>`;\n        }\n      } else if (feature.icon && feature.icon.startsWith('http')) {\n        // URL ()\n        iconHtml = `<div class=\"feature-icon\"><img src=\"${feature.icon}\" alt=\"${feature.label}\" class=\"feature-icon-img\"></div>`;\n      } else if (\n        feature.icon &&\n        (feature.icon.startsWith('fas ') || feature.icon.startsWith('far ') || feature.icon.startsWith('fab '))\n      ) {\n        // Font Awesome\n        iconHtml = `<div class=\"feature-icon\"><i class=\"${feature.icon} theme-icon\"></i></div>`;\n      } else if (feature.icon && feature.icon.startsWith('fa')) {\n        // Font Awesome\n        iconHtml = `<div class=\"feature-icon\"><i class=\"${feature.icon} theme-icon\"></i></div>`;\n      } else {\n        // \n        iconHtml = `<div class=\"feature-icon\"><i class=\"${feature.icon || 'fas fa-question'}\"></i></div>`;\n      }\n\n      item.innerHTML = `${iconHtml}<span class=\"feature-label\">${feature.label}</span>`;\n\n      const iconContainer = item.querySelector('.feature-icon');\n      if (isDeleteMode && !feature.isAddBtn && !feature.isDefault) {\n        // checkbox\n        const checkbox = document.createElement('input');\n        checkbox.type = 'checkbox';\n        checkbox.className = 'sticker-checkbox';\n        checkbox.dataset.stickerLabel = feature.label;\n        item.appendChild(checkbox);\n\n        // checkbox\n        const checkboxButton = document.createElement('div');\n        checkboxButton.className = 'sticker-checkbox-button';\n        checkboxButton.style.display = 'block';\n        item.appendChild(checkboxButton);\n\n        // checkbox\n        const updateCheckboxState = (checked: boolean) => {\n          if (checked) {\n            checkboxButton.classList.add('checked');\n          } else {\n            checkboxButton.classList.remove('checked');\n          }\n          iconContainer?.classList.toggle('selected-for-delete', checked);\n        };\n\n        // \n        const handleClick = (e: Event) => {\n          e.preventDefault();\n          e.stopPropagation();\n          checkbox.checked = !checkbox.checked;\n          updateCheckboxState(checkbox.checked);\n        };\n\n        item.addEventListener('click', handleClick);\n        checkboxButton.addEventListener('click', handleClick);\n\n        // \n        updateCheckboxState(checkbox.checked);\n      } else if (feature.label === '') {\n        item.addEventListener('click', callbacks.onAddStickers);\n      } else if (feature.label === '' || feature.label === '') {\n        item.addEventListener('click', callbacks.onToggleDeleteMode);\n      } else {\n        item.addEventListener('click', feature.action);\n      }\n\n      gridElement.appendChild(item);\n    });\n  }\n\n  // \n  private scrollToBottom(): void {\n    // scrollTopjQuery\n    this.wechatBody.scrollTop = this.wechatBody.scrollHeight;\n\n    // DOM\n    setTimeout(() => {\n      this.wechatBody.scrollTop = this.wechatBody.scrollHeight;\n    }, 100);\n  }\n\n  // USER - \n  private setupUserMessageLongPress(messageRow: HTMLElement, entry: ChatEntry): void {\n    const $messageRow = $(messageRow);\n    const $messageBubble = $messageRow.find('.message-bubble');\n    const $targetElement = $messageBubble.length ? $messageBubble : $messageRow;\n\n    // \n    this.addLongPressListener($targetElement[0], () => {\n      this.handleLongPressRecall(entry);\n    });\n\n    // \n    this.setupDoubleClickRecall($targetElement, entry);\n  }\n\n  //  - \n  private addLongPressListener(\n    element: HTMLElement,\n    callback: () => void,\n    options = { duration: 600, preventDefault: true },\n  ): void {\n    let timer: number;\n    let startX: number, startY: number;\n\n    const onStart = (e: PointerEvent) => {\n      if (e.pointerType === 'mouse' && e.button !== 0) return;\n      startX = e.clientX;\n      startY = e.clientY;\n      if (options.preventDefault) e.preventDefault();\n      clearTimeout(timer);\n      timer = setTimeout(() => {\n        timer = 0;\n        callback();\n      }, options.duration);\n    };\n\n    const onMove = (e: PointerEvent) => {\n      if (!timer) return;\n      const moveX = e.clientX;\n      const moveY = e.clientY;\n      if (Math.abs(moveX - startX) > 10 || Math.abs(moveY - startY) > 10) {\n        clearTimeout(timer);\n      }\n    };\n\n    const onEnd = () => clearTimeout(timer);\n\n    element.addEventListener('pointerdown', onStart);\n    element.addEventListener('pointermove', onMove);\n    element.addEventListener('pointerup', onEnd);\n    element.addEventListener('pointerleave', onEnd);\n\n    if (options.preventDefault) {\n      element.addEventListener('contextmenu', e => e.preventDefault());\n    }\n  }\n\n  //  - \n  private async handleLongPressRecall(entry: ChatEntry): Promise<void> {\n    try {\n      // \n      if (this.options.isMessageInQueue && this.options.isMessageInQueue(entry.id)) {\n        await this.handleUserMessageRecall(entry);\n      } else {\n        // jQuery UI\n        const $messageElement = $(`[data-message-id=\"${entry.id}\"]`);\n        $messageElement.effect('shake', { times: 2, distance: 5 }, 300);\n\n        const { DialogManager } = await import('./dialog-manager');\n        const dialogManager = DialogManager.getInstance();\n        await dialogManager.alert('', '');\n      }\n    } catch (error) {\n      console.error(':', error);\n\n      // \n      const $messageElement = $(`[data-message-id=\"${entry.id}\"]`);\n      $messageElement.effect('shake', { times: 2, distance: 5 }, 300);\n    }\n  }\n\n  // USER\n  private async handleUserMessageRecall(entry: ChatEntry): Promise<void> {\n    try {\n      // DialogManager\n      const { DialogManager } = await import('./dialog-manager');\n      const dialogManager = DialogManager.getInstance();\n\n      // \n      const confirmed = await dialogManager.confirm(\n        '\"\"',\n        '',\n        '',\n        '',\n      );\n\n      if (confirmed) {\n        // \n        if (this.options.onRecallMessage) {\n          await this.options.onRecallMessage(entry);\n        }\n      }\n    } catch (error) {\n      console.error(':', error);\n    }\n  }\n\n  //  - \n  private setupDoubleClickRecall($targetElement: JQuery, entry: ChatEntry): void {\n    let clickCount = 0;\n    let clickTimer: number;\n    const doubleClickDelay = 300; // 300ms\n\n    $targetElement.on('click.doubleClickRecall', e => {\n      // \n      e.stopPropagation();\n\n      clickCount++;\n\n      if (clickCount === 1) {\n        // \n        clickTimer = window.setTimeout(() => {\n          // \n          clickCount = 0;\n        }, doubleClickDelay);\n      } else if (clickCount === 2) {\n        // \n        clearTimeout(clickTimer);\n        clickCount = 0;\n\n        // \n        $targetElement.addClass('double-click-active');\n        setTimeout(() => {\n          $targetElement.removeClass('double-click-active');\n        }, 200);\n\n        // \n        if ('vibrate' in navigator) {\n          navigator.vibrate([30, 50, 30]); // \n        }\n\n        // \n        this.handleDoubleClickRecall(entry);\n      }\n    });\n  }\n\n  // \n  private async handleDoubleClickRecall(entry: ChatEntry): Promise<void> {\n    try {\n      // \n      if (this.options.isMessageInQueue && this.options.isMessageInQueue(entry.id)) {\n        await this.handleUserMessageRecall(entry);\n      } else {\n        // jQuery UI\n        const $messageElement = $(`[data-message-id=\"${entry.id}\"]`);\n        $messageElement.effect('shake', { times: 2, distance: 5 }, 300);\n\n        const { DialogManager } = await import('./dialog-manager');\n        const dialogManager = DialogManager.getInstance();\n        await dialogManager.alert('', '');\n      }\n    } catch (error) {\n      console.error(':', error);\n\n      // \n      const $messageElement = $(`[data-message-id=\"${entry.id}\"]`);\n      $messageElement.effect('shake', { times: 2, distance: 5 }, 300);\n    }\n  }\n\n  /**\n   * \n   */\n  cleanup(): void {\n    this.eventManager.cleanup();\n  }\n}\n","// \n// UI\n\nimport { Wallpaper, WallpaperManager } from './theme-manager';\n\nexport class WallpaperSelector {\n  private wallpaperManager: WallpaperManager;\n  private themeManager: any; // \n\n  constructor(wallpaperManager: WallpaperManager, themeManager: any) {\n    this.wallpaperManager = wallpaperManager;\n    this.themeManager = themeManager;\n  }\n\n  // \n  showWallpaperSelector(viewType: 'chat' | 'home' | 'settings', onApplyWallpaper: () => void): void {\n    // \n    const modal = document.createElement('div');\n    modal.className = 'wallpaper-modal';\n    modal.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background-color: rgba(0, 0, 0, 0.7);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      z-index: 1000;\n    `;\n\n    // \n    const container = document.createElement('div');\n    container.className = 'wallpaper-container';\n    container.style.cssText = `\n      background-color: white;\n      border-radius: 12px;\n      width: 90%;\n      max-width: 500px;\n      max-height: 80vh;\n      overflow-y: auto;\n      padding: 20px;\n      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);\n    `;\n\n    // \n    const title = document.createElement('h2');\n    title.textContent = `${viewType === 'chat' ? '' : viewType === 'home' ? '' : ''}`;\n    title.style.cssText = `\n      margin-top: 0;\n      color: var(--text-primary);\n      font-size: 1.2rem;\n      text-align: center;\n      margin-bottom: 20px;\n    `;\n    container.appendChild(title);\n\n    // \n    const tabs = this.createTabs(container);\n    container.appendChild(tabs);\n\n    // \n    this.createBuiltinWallpaperTab(container, viewType, modal, onApplyWallpaper);\n    this.createSolidColorTab(container, viewType, modal, onApplyWallpaper);\n    this.createCustomWallpaperTab(container, viewType, modal, onApplyWallpaper);\n    this.createUploadTab(container, viewType, modal, onApplyWallpaper);\n\n    // \n    this.createBottomButtons(container, viewType, modal, onApplyWallpaper);\n\n    modal.appendChild(container);\n    document.body.appendChild(modal);\n  }\n\n  // \n  private createTabs(container: HTMLElement): HTMLElement {\n    const tabs = document.createElement('div');\n    tabs.style.cssText = `\n      display: flex;\n      border-bottom: 1px solid ${document.body.classList.contains('dark-mode') ? '#3c3c3c' : '#eee'};\n      margin-bottom: 15px;\n    `;\n\n    const createTab = (label: string, id: string, isActive: boolean = false) => {\n      const tab = document.createElement('div');\n      tab.textContent = label;\n      tab.dataset.tabId = id;\n      tab.style.cssText = `\n        padding: 10px 15px;\n        cursor: pointer;\n        font-weight: ${isActive ? 'bold' : 'normal'};\n        color: ${isActive ? 'var(--primary-blue)' : 'var(--text-secondary)'};\n        border-bottom: ${isActive ? '2px solid var(--primary-blue)' : 'none'};\n        margin-bottom: -1px;\n      `;\n      tab.addEventListener('click', () => {\n        // \n        tabs.querySelectorAll('div').forEach(t => {\n          t.style.fontWeight = 'normal';\n          t.style.color = 'var(--text-secondary)';\n          t.style.borderBottom = 'none';\n        });\n\n        // \n        tab.style.fontWeight = 'bold';\n        tab.style.color = 'var(--primary-blue)';\n        tab.style.borderBottom = '2px solid var(--primary-blue)';\n\n        // \n        container.querySelectorAll('.tab-content').forEach(c => {\n          (c as HTMLElement).style.display = 'none';\n        });\n\n        // \n        const content = container.querySelector(`.tab-content[data-tab-id=\"${id}\"]`);\n        if (content) {\n          (content as HTMLElement).style.display = 'block';\n        }\n      });\n      return tab;\n    };\n\n    tabs.appendChild(createTab('', 'builtin', true));\n    tabs.appendChild(createTab('', 'solid'));\n    tabs.appendChild(createTab('', 'custom'));\n    tabs.appendChild(createTab('', 'upload'));\n\n    return tabs;\n  }\n\n  // \n  private createBuiltinWallpaperTab(\n    container: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const builtinContent = document.createElement('div');\n    builtinContent.className = 'tab-content';\n    builtinContent.dataset.tabId = 'builtin';\n    builtinContent.style.cssText = 'display: block;';\n\n    // \n    const builtinWallpapers = this.wallpaperManager.getBuiltInWallpapers().filter(w => w.type === 'image');\n\n    // \n    const builtinGrid = document.createElement('div');\n    builtinGrid.style.cssText = `\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 10px;\n    `;\n\n    builtinWallpapers.forEach(wallpaper => {\n      const wallpaperItem = this.createWallpaperItem(wallpaper, viewType, false, modal, onApplyWallpaper);\n      builtinGrid.appendChild(wallpaperItem);\n    });\n\n    builtinContent.appendChild(builtinGrid);\n    container.appendChild(builtinContent);\n  }\n\n  // \n  private createSolidColorTab(\n    container: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const solidContent = document.createElement('div');\n    solidContent.className = 'tab-content';\n    solidContent.dataset.tabId = 'solid';\n    solidContent.style.cssText = 'display: none;';\n\n    // \n    const solidWallpapers = this.wallpaperManager.getBuiltInWallpapers().filter(w => w.type === 'color');\n\n    // \n    const solidGrid = document.createElement('div');\n    solidGrid.style.cssText = `\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 10px;\n    `;\n\n    solidWallpapers.forEach(wallpaper => {\n      const wallpaperItem = this.createWallpaperItem(wallpaper, viewType, false, modal, onApplyWallpaper);\n      solidGrid.appendChild(wallpaperItem);\n    });\n\n    solidContent.appendChild(solidGrid);\n\n    // \n    this.addColorPicker(solidContent, viewType, modal, onApplyWallpaper);\n\n    container.appendChild(solidContent);\n  }\n\n  // \n  private createCustomWallpaperTab(\n    container: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const customContent = document.createElement('div');\n    customContent.className = 'tab-content';\n    customContent.dataset.tabId = 'custom';\n    customContent.style.cssText = 'display: none;';\n\n    // \n    const customWallpapers = this.wallpaperManager.getCustomWallpapers();\n\n    if (customWallpapers.length === 0) {\n      const noCustomWallpapers = document.createElement('p');\n      noCustomWallpapers.textContent = '\"\"';\n      noCustomWallpapers.style.cssText = `\n        text-align: center;\n        color: var(--text-secondary);\n        margin: 30px 0;\n      `;\n      customContent.appendChild(noCustomWallpapers);\n    } else {\n      // \n      const customGrid = document.createElement('div');\n      customGrid.style.cssText = `\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 10px;\n      `;\n\n      customWallpapers.forEach(wallpaper => {\n        const wallpaperItem = this.createWallpaperItem(wallpaper, viewType, true, modal, onApplyWallpaper);\n        customGrid.appendChild(wallpaperItem);\n      });\n\n      customContent.appendChild(customGrid);\n    }\n\n    container.appendChild(customContent);\n  }\n\n  // \n  private createUploadTab(\n    container: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const uploadContent = document.createElement('div');\n    uploadContent.className = 'tab-content';\n    uploadContent.dataset.tabId = 'upload';\n    uploadContent.style.cssText = 'display: none; padding: 10px 0;';\n\n    // \n    this.createLocalUploadSection(uploadContent, viewType, modal, onApplyWallpaper);\n\n    // URL\n    this.createUrlUploadSection(uploadContent, viewType, modal, onApplyWallpaper);\n\n    container.appendChild(uploadContent);\n  }\n\n  // \n  private addColorPicker(\n    solidContent: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const colorPickerContainer = document.createElement('div');\n    colorPickerContainer.style.cssText = `\n      margin-top: 20px;\n      padding-top: 15px;\n      border-top: 1px solid ${document.body.classList.contains('dark-mode') ? '#3c3c3c' : '#eee'};\n    `;\n\n    const colorPickerLabel = document.createElement('p');\n    colorPickerLabel.textContent = ':';\n    colorPickerLabel.style.cssText = `\n      margin: 0 0 10px 0;\n      font-size: 0.9rem;\n      color: var(--text-primary);\n    `;\n\n    const colorPicker = document.createElement('input');\n    colorPicker.type = 'color';\n    colorPicker.value = '#ffffff';\n    colorPicker.style.cssText = `\n      width: 100%;\n      height: 40px;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n    `;\n\n    const colorNameInput = document.createElement('input');\n    colorNameInput.type = 'text';\n    colorNameInput.placeholder = ' ()';\n    colorNameInput.style.cssText = `\n      width: 100%;\n      padding: 8px;\n      margin-top: 10px;\n      border: 1px solid #ddd;\n      border-radius: 5px;\n      box-sizing: border-box;\n    `;\n\n    const addColorBtn = document.createElement('button');\n    addColorBtn.textContent = '';\n    addColorBtn.style.cssText = `\n      width: 100%;\n      padding: 10px;\n      margin-top: 10px;\n      background: var(--primary-blue);\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    `;\n\n    addColorBtn.addEventListener('click', () => {\n      const color = colorPicker.value;\n      const name = colorNameInput.value.trim() || ` ${color}`;\n\n      const newWallpaper = this.wallpaperManager.createSolidColorWallpaper(color, name);\n\n      if (newWallpaper) {\n        // \n        this.wallpaperManager.setWallpaper(viewType, newWallpaper);\n        onApplyWallpaper();\n\n        // \n        document.body.removeChild(modal);\n      } else {\n        // \n        alert('');\n      }\n    });\n\n    colorPickerContainer.appendChild(colorPickerLabel);\n    colorPickerContainer.appendChild(colorPicker);\n    colorPickerContainer.appendChild(colorNameInput);\n    colorPickerContainer.appendChild(addColorBtn);\n\n    solidContent.appendChild(colorPickerContainer);\n  }\n\n  // \n  private createLocalUploadSection(\n    uploadContent: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const localUploadSection = document.createElement('div');\n    localUploadSection.style.cssText = 'margin-bottom: 20px;';\n\n    const localUploadTitle = document.createElement('h3');\n    localUploadTitle.textContent = '';\n    localUploadTitle.style.cssText = `\n      font-size: 1rem;\n      color: var(--text-primary);\n      margin: 0 0 10px 0;\n    `;\n\n    const fileInput = document.createElement('input');\n    fileInput.type = 'file';\n    fileInput.accept = 'image/*';\n    fileInput.style.cssText = `\n      width: 100%;\n      padding: 10px;\n      margin-bottom: 10px;\n      border: 1px solid #ddd;\n      border-radius: 5px;\n      box-sizing: border-box;\n    `;\n\n    const uploadBtn = document.createElement('button');\n    uploadBtn.textContent = '';\n    uploadBtn.style.cssText = `\n      width: 100%;\n      padding: 10px;\n      background: var(--primary-blue);\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    `;\n\n    uploadBtn.addEventListener('click', async () => {\n      if (fileInput.files && fileInput.files[0]) {\n        const file = fileInput.files[0];\n        const newWallpaper = await this.wallpaperManager.createWallpaperFromFile(file);\n\n        if (newWallpaper) {\n          // \n          this.wallpaperManager.setWallpaper(viewType, newWallpaper);\n          onApplyWallpaper();\n\n          // \n          document.body.removeChild(modal);\n        }\n      }\n    });\n\n    localUploadSection.appendChild(localUploadTitle);\n    localUploadSection.appendChild(fileInput);\n    localUploadSection.appendChild(uploadBtn);\n    uploadContent.appendChild(localUploadSection);\n  }\n\n  // URL\n  private createUrlUploadSection(\n    uploadContent: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const urlUploadSection = document.createElement('div');\n    urlUploadSection.style.cssText = `\n      margin-top: 30px;\n      padding-top: 20px;\n      border-top: 1px solid ${document.body.classList.contains('dark-mode') ? '#3c3c3c' : '#eee'};\n    `;\n\n    const urlUploadTitle = document.createElement('h3');\n    urlUploadTitle.textContent = 'URL';\n    urlUploadTitle.style.cssText = `\n      font-size: 1rem;\n      color: var(--text-primary);\n      margin: 0 0 10px 0;\n    `;\n\n    const urlInput = document.createElement('input');\n    urlInput.type = 'text';\n    urlInput.placeholder = 'URL';\n    urlInput.style.cssText = `\n      width: 100%;\n      padding: 10px;\n      margin-bottom: 10px;\n      border: 1px solid #ddd;\n      border-radius: 5px;\n      box-sizing: border-box;\n    `;\n\n    const nameInput = document.createElement('input');\n    nameInput.type = 'text';\n    nameInput.placeholder = ' ()';\n    nameInput.style.cssText = `\n      width: 100%;\n      padding: 10px;\n      margin-bottom: 10px;\n      border: 1px solid #ddd;\n      border-radius: 5px;\n      box-sizing: border-box;\n    `;\n\n    const addUrlBtn = document.createElement('button');\n    addUrlBtn.textContent = '';\n    addUrlBtn.style.cssText = `\n      width: 100%;\n      padding: 10px;\n      background: var(--primary-blue);\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    `;\n\n    addUrlBtn.addEventListener('click', async () => {\n      const url = urlInput.value.trim();\n      const name = nameInput.value.trim() || 'URL';\n\n      if (url) {\n        const newWallpaper = await this.wallpaperManager.createWallpaperFromUrl(url, name);\n\n        if (newWallpaper) {\n          // \n          this.wallpaperManager.setWallpaper(viewType, newWallpaper);\n          onApplyWallpaper();\n\n          // \n          document.body.removeChild(modal);\n        } else {\n          alert('URLURL');\n        }\n      }\n    });\n\n    urlUploadSection.appendChild(urlUploadTitle);\n    urlUploadSection.appendChild(urlInput);\n    urlUploadSection.appendChild(nameInput);\n    urlUploadSection.appendChild(addUrlBtn);\n    uploadContent.appendChild(urlUploadSection);\n  }\n\n  // \n  private createWallpaperItem(\n    wallpaper: Wallpaper,\n    viewType: 'chat' | 'home' | 'settings',\n    showDeleteButton: boolean,\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): HTMLElement {\n    const item = document.createElement('div');\n    item.style.cssText = `\n      border-radius: 8px;\n      overflow: hidden;\n      position: relative;\n      cursor: pointer;\n      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n      transition: transform 0.2s ease, box-shadow 0.2s ease;\n    `;\n\n    // \n    const preview = document.createElement('div');\n    preview.style.cssText = `\n      width: 100%;\n      height: 100px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    `;\n\n    if (wallpaper.type === 'color') {\n      // \n      preview.style.backgroundImage = 'none';\n      preview.style.backgroundColor = wallpaper.value;\n    } else {\n      preview.style.backgroundImage = `url(\"${wallpaper.value}\")`;\n      preview.style.backgroundSize = 'cover';\n      preview.style.backgroundPosition = 'center';\n    }\n\n    // \n    const name = document.createElement('div');\n    name.textContent = wallpaper.name;\n    name.style.cssText = `\n      padding: 8px;\n      text-align: center;\n      font-size: 0.8rem;\n      color: var(--text-primary);\n      background-color: ${\n        document.body.classList.contains('dark-mode') ? 'rgba(42, 42, 42, 0.9)' : 'rgba(255, 255, 255, 0.9)'\n      };\n    `;\n\n    // \n    if (showDeleteButton) {\n      const deleteBtn = document.createElement('button');\n      deleteBtn.innerHTML = '&times;';\n      deleteBtn.style.cssText = `\n        position: absolute;\n        top: 5px;\n        right: 5px;\n        width: 20px;\n        height: 20px;\n        border-radius: 50%;\n        background-color: rgba(255, 0, 0, 0.7);\n        color: white;\n        border: none;\n        font-size: 14px;\n        line-height: 1;\n        cursor: pointer;\n        z-index: 1;\n      `;\n\n      deleteBtn.addEventListener('click', e => {\n        e.stopPropagation();\n\n        if (confirm('')) {\n          this.wallpaperManager.deleteCustomWallpaper(wallpaper.id);\n\n          // \n          const currentWallpaper = this.wallpaperManager.getCurrentWallpaper(viewType);\n          if (currentWallpaper && currentWallpaper.id === wallpaper.id) {\n            this.wallpaperManager.setWallpaper(viewType, null);\n            onApplyWallpaper();\n          }\n\n          // \n          item.parentElement?.removeChild(item);\n        }\n      });\n\n      item.appendChild(deleteBtn);\n    }\n\n    // \n    item.addEventListener('click', () => {\n      // \n      const currentTheme = this.themeManager.getCurrentTheme();\n      this.wallpaperManager.setCurrentThemeName(currentTheme.name);\n\n      this.wallpaperManager.setWallpaper(viewType, wallpaper);\n      onApplyWallpaper();\n\n      // \n      document.body.removeChild(modal);\n    });\n\n    item.appendChild(preview);\n    item.appendChild(name);\n\n    return item;\n  }\n\n  // \n  private createBottomButtons(\n    container: HTMLElement,\n    viewType: 'chat' | 'home' | 'settings',\n    modal: HTMLElement,\n    onApplyWallpaper: () => void,\n  ): void {\n    const buttonsContainer = document.createElement('div');\n    buttonsContainer.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      margin-top: 20px;\n      padding-top: 15px;\n      border-top: 1px solid ${document.body.classList.contains('dark-mode') ? '#3c3c3c' : '#eee'};\n    `;\n\n    const resetBtn = document.createElement('button');\n    resetBtn.textContent = '';\n    resetBtn.style.cssText = `\n      padding: 10px 15px;\n      background: ${document.body.classList.contains('dark-mode') ? '#3c3c3c' : '#f1f5f9'};\n      color: var(--text-primary);\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    `;\n\n    resetBtn.addEventListener('click', () => {\n      // \n      this.wallpaperManager.setWallpaper(viewType, null);\n      onApplyWallpaper();\n\n      // \n      document.body.removeChild(modal);\n    });\n\n    const closeBtn = document.createElement('button');\n    closeBtn.textContent = '';\n    closeBtn.style.cssText = `\n      padding: 10px 20px;\n      background: var(--primary-blue);\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    `;\n\n    closeBtn.addEventListener('click', () => {\n      document.body.removeChild(modal);\n    });\n\n    buttonsContainer.appendChild(resetBtn);\n    buttonsContainer.appendChild(closeBtn);\n    container.appendChild(buttonsContainer);\n  }\n}\n","// \n// \n\nimport { Theme, ThemeManager, WallpaperManager } from './theme-manager';\nimport { WallpaperSelector } from './wallpaper-selector';\n\nexport class WallpaperController {\n  private wallpaperManager: WallpaperManager;\n  private themeManager: ThemeManager;\n  private wallpaperSelector: WallpaperSelector;\n\n  constructor(themeManager: ThemeManager) {\n    this.themeManager = themeManager;\n    this.wallpaperManager = themeManager.getWallpaperManager();\n    this.wallpaperSelector = new WallpaperSelector(this.wallpaperManager, this.themeManager);\n  }\n\n  // \n  applyWallpapers(): void {\n    const $chatView = $('#wechat-view');\n    const $homeScreen = $('#app-homescreen');\n    const $settingsView = $('#settings-view');\n    const currentTheme = this.themeManager.getCurrentTheme();\n\n    // \n    this.wallpaperManager.setCurrentThemeName(currentTheme.name);\n\n    // \n    const chatWallpaper = this.wallpaperManager.getCurrentWallpaper('chat');\n    this.wallpaperManager.applyWallpaperToElement(\n      $chatView[0],\n      chatWallpaper,\n      currentTheme.colors.defaultWallpapers.chat,\n    );\n\n    // \n    const homeWallpaper = this.wallpaperManager.getCurrentWallpaper('home');\n    this.wallpaperManager.applyWallpaperToElement(\n      $homeScreen[0],\n      homeWallpaper,\n      currentTheme.colors.defaultWallpapers.home,\n    );\n\n    // \n    const settingsWallpaper = this.wallpaperManager.getCurrentWallpaper('settings');\n    this.wallpaperManager.applyWallpaperToElement(\n      $settingsView[0],\n      settingsWallpaper,\n      currentTheme.colors.defaultWallpapers.settings,\n    );\n  }\n\n  // \n  changeWallpaper(viewType: 'chat' | 'home' | 'settings'): void {\n    // \n    this.wallpaperSelector.showWallpaperSelector(viewType, () => {\n      this.applyWallpapers();\n    });\n  }\n\n  // \n  initializeWallpapers(theme: Theme): void {\n    // \n    this.wallpaperManager.applyThemeDefaultWallpapers(theme);\n    this.applyWallpapers();\n  }\n\n  // \n  getWallpaperManager(): WallpaperManager {\n    return this.wallpaperManager;\n  }\n}\n","import { AiResponseManager } from './ai-response-manager';\nimport { ConfigManager } from './config-manager';\nimport { addTestEntry, clearDebugData, loadDebugData, showDebugInfo, showTestEntryTypes } from './debug-data'; // \nimport { DialogManager } from './dialog-manager';\nimport { InputHandler } from './input-handler';\nimport { MomentsManager } from './moments-manager';\nimport { BLMX_Protocol, ChatEntry, getTavernHelper, LogEntry } from './script';\nimport { ThemeEditor } from './theme-editor';\nimport { ThemeManager } from './theme-manager';\nimport { IAppController, IEventHandler } from './types';\nimport { UIManager } from './ui-manager';\nimport { UIRenderer } from './ui-renderer';\nimport { WallpaperController } from './wallpaper-controller';\n\n/**\n * \n *\n * \n * 1. \n * 2. \n * 3. \n * 4. \n *\n * \n * - ConfigManager: \n * - UIManager: \n * - MomentsManager: \n * - AiResponseManager: AI\n * - ThemeEditor: \n * - InputHandler: \n * - WallpaperController: \n */\nexport class AppController implements IAppController {\n  private blmxManager!: BLMX_Protocol;\n  private uiRenderer!: UIRenderer;\n  private eventHandler!: IEventHandler;\n  private themeManager!: ThemeManager;\n  private wallpaperController!: WallpaperController;\n  private configManager!: ConfigManager;\n  private momentsManager!: MomentsManager;\n  private aiResponseManager!: AiResponseManager;\n  private themeEditor!: ThemeEditor;\n  private inputHandler!: InputHandler;\n  private uiManager!: UIManager;\n  private dialogManager!: DialogManager;\n\n  // \n  private userMessageQueue: ChatEntry[] = [];\n\n  // \n  hasMomentNotifications(): boolean {\n    return this.momentsManager.hasMomentNotifications();\n  }\n\n  setMomentNotification(value: boolean): void {\n    this.momentsManager.setMomentNotification(value);\n  }\n\n  constructor() {\n    // \n    this.configManager = new ConfigManager();\n  }\n\n  // \n  async initialize(): Promise<void> {\n    try {\n      window.currentGameDate = new Date();\n\n      // \n      this.themeManager = new ThemeManager();\n      this.wallpaperController = new WallpaperController(this.themeManager);\n\n      // \n      const currentTheme = this.themeManager.getCurrentTheme();\n      this.wallpaperController.initializeWallpapers(currentTheme);\n\n      const charData = await getTavernHelper().getCharData();\n\n      // \n      await this.configManager.loadFromStorage(charData);\n\n      // \n      let config = this.configManager.getConfig();\n      if (!config.avatars.char) {\n        const charAvatarPath = await getTavernHelper().getCharAvatarPath();\n        this.configManager.updateAvatar('char', charAvatarPath);\n        config = this.configManager.getConfig(); // \n      }\n\n      // UI - jQuery\n      $('.contact-name').text(this.getDisplayName('char'));\n      $('#moments-user-name').text(this.getDisplayName('user'));\n      $('#moments-user-avatar').attr('src', config.avatars.user);\n\n      //  - jQuery\n      const savedCoverPhoto = this.configManager.getSavedCoverPhoto();\n      if (savedCoverPhoto) {\n        $('#moments-cover-photo').attr('src', savedCoverPhoto);\n      }\n\n      //  - jQuery\n      const savedSignature = this.configManager.getSavedSignature();\n      $('#user-signature-display').text(savedSignature);\n\n      // BLMX\n      this.blmxManager = new BLMX_Protocol(config.currentCharId);\n      await this.blmxManager.initialize();\n\n      // \n      if ((window as any).BLMX_DEV_MODE) {\n        loadDebugData(this.blmxManager);\n      }\n\n      // EventHandler\n      const EventHandler = (window as any).EventHandlerClass;\n      this.eventHandler = new EventHandler(\n        '#wechat-input-field',\n        '#send-btn',\n        '#plus-btn',\n        this.blmxManager,\n        this,\n        null, // uiRenderer \n        {\n          getDisplayName: this.getDisplayName.bind(this),\n          stageAndDisplayEntry: this.stageAndDisplayEntry.bind(this),\n          triggerAiResponse: this.triggerAiResponse.bind(this),\n          updateFooterButtonsState: this.updateFooterButtonsState.bind(this),\n          renderChatHistory: this.renderChatHistory.bind(this),\n          renderMomentsFeed: this.renderMomentsFeed.bind(this),\n          togglePanel: this.togglePanel.bind(this),\n          findStickerUrlByName: this.findStickerUrlByName.bind(this),\n        },\n      );\n\n      // UI\n      this.uiRenderer = new UIRenderer('.wechat-body', config.avatars, {\n        getDisplayName: this.getDisplayName.bind(this),\n        findStickerUrlByName: this.findStickerUrlByName.bind(this),\n        onTransferAccept: this.handleTransferAccept.bind(this),\n        onGiftAction: this.handleGiftAction.bind(this),\n        onRecallMessage: this.handleMessageRecall.bind(this),\n        isMessageInQueue: this.isMessageInQueue.bind(this),\n      });\n\n      // EventHandleruiRenderer\n      this.eventHandler.setUIRenderer(this.uiRenderer);\n\n      // \n      this.momentsManager = new MomentsManager(this.blmxManager, this.configManager, this.uiRenderer);\n\n      // AI\n      this.aiResponseManager = new AiResponseManager(\n        this.blmxManager,\n        this.uiRenderer,\n        this.eventHandler,\n        this.momentsManager,\n      );\n\n      // \n      this.themeEditor = new ThemeEditor(this.themeManager, () => {\n        this.applyWallpapers();\n      });\n\n      // \n      this.inputHandler = new InputHandler(\n        this.configManager,\n        this.stageAndDisplayEntry.bind(this),\n        this.updateFooterButtonsState.bind(this),\n      );\n\n      // UI\n      this.uiManager = new UIManager(\n        this.configManager,\n        this.blmxManager.addEntry.bind(this.blmxManager),\n        this.uiRenderer.renderEntry.bind(this.uiRenderer),\n      );\n\n      // \n      this.dialogManager = DialogManager.getInstance();\n\n      // \n      this.applyWallpapers();\n\n      // \n      this.renderChatHistory();\n      this.renderMomentsFeed();\n\n      // \n      this.uiManager.setupInputPlaceholder(this.getDisplayName('char'));\n\n      // \n      this.updateFooterButtonsState();\n\n      // UI\n      this.setupThemeSelector();\n\n      // \n      this.themeEditor.updateCustomThemeButton();\n\n      // \n      this.uiManager.setupPhoneSizeAdjustment();\n\n      // \n      this.uiManager.setupStickerSizeControl();\n\n      // \n      this.uiManager.setupFontSelection();\n\n      // \n      this.uiManager.setupFullscreenSizeAdjustment();\n\n      // \n      this.uiManager.displayAppVersion();\n\n      // \n      this.uiManager.checkVersionUpdateNotification();\n\n      // \n      //  MomentsManager \n\n      //  AiResponseManager \n    } catch (error) {\n      // console.error('[BLMX] Failed to initialize:', error);\n    }\n  }\n\n  // \n  getDisplayName(type: 'user' | 'char'): string {\n    return this.configManager.getDisplayName(type);\n  }\n\n  findStickerUrlByName(name: string): string | undefined {\n    return this.configManager.findStickerUrlByName(name);\n  }\n\n  // \n  applyWallpapers(): void {\n    this.wallpaperController.applyWallpapers();\n  }\n\n  changeWallpaper(viewType: 'chat' | 'home' | 'settings'): void {\n    this.wallpaperController.changeWallpaper(viewType);\n  }\n\n  // \n  renderChatHistory(): void {\n    this.uiRenderer.clearChat();\n    if (!this.blmxManager) return;\n\n    // \n    this.blmxManager.logEntries.forEach((entry, index) => {\n      if (entry.recalled) {\n        this.uiRenderer.renderRecallNotice(entry, null, index);\n      } else {\n        this.uiRenderer.renderEntry(entry, index, false);\n      }\n    });\n\n    // \n    this.userMessageQueue.forEach((entry, queueIndex) => {\n      //  + \n      const actualIndex = this.blmxManager.logEntries.length + queueIndex;\n      if (entry.recalled) {\n        this.uiRenderer.renderRecallNotice(entry, null, actualIndex);\n      } else {\n        this.uiRenderer.renderEntry(entry, actualIndex, false);\n      }\n    });\n\n    this.uiRenderer.refreshAllTimestamps();\n    this.uiManager.scrollToBottom();\n  }\n\n  renderMomentsFeed(): void {\n    this.momentsManager.renderMomentsFeed();\n  }\n\n  // \n  stageAndDisplayEntry(entry: LogEntry): void {\n    if ('type' in entry) {\n      if (entry.type === 'event') {\n        // event\n        this.blmxManager.addEntry(entry);\n        const entryIndex = this.blmxManager.logEntries.length - 1;\n        this.uiRenderer.renderEntry(entry, entryIndex, true);\n\n        // AI\n        if ('sender' in entry && entry.sender === 'me') {\n          this.eventHandler.setHasPendingNotifications(true);\n        }\n\n        return;\n      } else if (entry.type === 'time') {\n        // time\n        return;\n      }\n\n      if (!entry.id) {\n        entry.id = 'msg-' + Date.now() + Math.random();\n      }\n\n      // \n      if (\n        entry.type === 'image' &&\n        'content' in entry &&\n        entry.content.type === 'url' &&\n        typeof entry.content.value === 'string' &&\n        entry.content.value.startsWith('data:image')\n      ) {\n        // \n        ((entry as ChatEntry).content as any).isNewForAI = true;\n      }\n\n      // \n      if ('sender' in entry && entry.sender === 'me') {\n        this.userMessageQueue.push(entry as ChatEntry);\n        this.eventHandler.setHasPendingNotifications(true);\n\n        //  + \n        const queueIndex = this.userMessageQueue.length - 1;\n        const globalIndex = this.blmxManager.logEntries.length + queueIndex;\n        this.uiRenderer.renderEntry(entry as ChatEntry, globalIndex, true);\n      } else {\n        // \n        this.blmxManager.addEntry(entry as ChatEntry);\n        const entryIndex = this.blmxManager.logEntries.length - 1;\n        this.uiRenderer.renderEntry(entry as ChatEntry, entryIndex, true);\n      }\n      this.updateFooterButtonsState();\n    }\n  }\n\n  // AI\n  async triggerAiResponse(immediate: boolean = false): Promise<void> {\n    // \n    const hasQueuedMessages = this.userMessageQueue.length > 0;\n\n    // \n    if (!immediate && !hasQueuedMessages && !this.eventHandler.hasNotifications) {\n      return;\n    }\n\n    // AI\n    if (hasQueuedMessages) {\n      // \n      const messagesToProcess = [...this.userMessageQueue];\n\n      // \n      messagesToProcess.forEach(entry => {\n        if (entry.type === 'image' && 'content' in entry && (entry.content as any).isNewForAI) {\n          (entry.content as any).value = `[]`;\n          delete (entry.content as any).isNewForAI;\n        }\n        this.blmxManager.addEntry(entry);\n      });\n\n      //  userMessageQueue = []\n      this.userMessageQueue = [];\n    }\n\n    await this.aiResponseManager.triggerAiResponse(immediate);\n  }\n\n  // UI\n  updateFooterButtonsState(): void {\n    this.uiManager.updateFooterButtonsState(this.eventHandler.hasNotifications);\n  }\n\n  togglePanel(panelToShow: string | null): void {\n    this.uiManager.togglePanel(panelToShow);\n  }\n\n  // \n  navigateTo(viewName: 'home' | 'wechat' | 'wechatHome' | 'moments' | 'settings'): void {\n    const views = {\n      home: '#app-homescreen',\n      wechat: '#wechat-view',\n      wechatHome: '#wechat-home',\n      moments: '#moments-view',\n      settings: '#settings-view',\n    };\n\n    try {\n      // jQuery\n      if (typeof $ !== 'undefined' && typeof jQuery !== 'undefined') {\n        // jQuery\n        $('.app-view').removeClass('active');\n        $(views[viewName]).addClass('active');\n      } else {\n        // jQuery\n        $('.app-view').removeClass('active');\n        const $targetView = $(views[viewName]);\n        if ($targetView.length) {\n          $targetView.addClass('active');\n        } else {\n          console.error(`[BLMX] : ${views[viewName]}`);\n        }\n      }\n\n      // \n      if (viewName === 'moments') {\n        // \n        this.setMomentNotification(false);\n\n        // \n        this.renderMomentsFeed();\n      }\n    } catch (error) {\n      console.error(`[BLMX] :`, error);\n\n      // jQuery\n      try {\n        $('.app-view').removeClass('active');\n        const $targetElement = $(views[viewName]);\n        if ($targetElement.length) {\n          $targetElement.addClass('active');\n        }\n      } catch (e) {\n        console.error(`[BLMX] :`, e);\n      }\n    }\n  }\n\n  async updateAvatar(avatarType: 'user' | 'char'): Promise<void> {\n    const config = this.configManager.getConfig();\n    const currentUrl = config.avatars[avatarType] || '';\n    const displayName = this.getDisplayName(avatarType);\n\n    if (avatarType === 'user') {\n      // \n      await this.showUserProfileDialog(currentUrl);\n    } else {\n      // \n      const newUrl = await this.dialogManager.showInputDialog(\n        '',\n        `${displayName}URL`,\n        currentUrl,\n        '',\n        'url',\n      );\n\n      if (newUrl) {\n        this.configManager.updateAvatar(avatarType, newUrl);\n        await this.dialogManager.alert('', '');\n        this.renderChatHistory();\n        this.renderMomentsFeed();\n      }\n    }\n  }\n\n  // +\n  private async showUserProfileDialog(currentAvatarUrl: string): Promise<void> {\n    const currentSignature = this.configManager.getSavedSignature();\n\n    return new Promise(resolve => {\n      // HTML\n      const dialogHtml = `\n        <div class=\"custom-dialog-overlay\" id=\"user-profile-dialog-overlay\">\n          <div class=\"custom-dialog user-profile-dialog\">\n            <div class=\"dialog-header\">\n              <h3 class=\"dialog-title\"></h3>\n            </div>\n            <div class=\"dialog-body\">\n              <div class=\"dialog-input-container\">\n                <input type=\"url\" id=\"avatar-url-input\" value=\"${currentAvatarUrl}\" placeholder=\"\">\n              </div>\n              <div class=\"dialog-input-container\">\n                <input type=\"text\" id=\"signature-input\" value=\"${currentSignature}\" placeholder=\"\">\n              </div>\n            </div>\n            <div class=\"dialog-footer\">\n              <button class=\"dialog-button cancel-button\" id=\"user-profile-cancel\"></button>\n              <button class=\"dialog-button primary-button\" id=\"user-profile-confirm\"></button>\n            </div>\n          </div>\n        </div>\n      `;\n\n      // \n      const $phoneScreen = $('.phone-screen');\n      if ($phoneScreen.length) {\n        $phoneScreen.append(dialogHtml);\n      } else {\n        // body\n        $('body').append(dialogHtml);\n      }\n      const $overlay = $('#user-profile-dialog-overlay');\n\n      // \n      $overlay.show();\n\n      // \n      $('#user-profile-cancel').on('click', () => {\n        $overlay.remove();\n        resolve();\n      });\n\n      $('#user-profile-confirm').on('click', async () => {\n        const newAvatarUrl = ($('#avatar-url-input').val() as string).trim();\n        const newSignature = ($('#signature-input').val() as string).trim();\n\n        let hasChanges = false;\n\n        // \n        if (newAvatarUrl && newAvatarUrl !== currentAvatarUrl) {\n          this.configManager.updateAvatar('user', newAvatarUrl);\n          $('#moments-user-avatar').attr('src', newAvatarUrl);\n          hasChanges = true;\n        }\n\n        // \n        if (newSignature !== currentSignature) {\n          this.configManager.setSignature(newSignature);\n          $('#user-signature-display').text(newSignature);\n          hasChanges = true;\n\n          // \n          if (newSignature !== currentSignature) {\n            const shouldNotify = await this.dialogManager.confirm(\n              'AI',\n              '',\n            );\n            if (shouldNotify) {\n              this.momentsManager.notifyMomentChange('signature', currentSignature, newSignature);\n              this.eventHandler.setHasPendingNotifications(true);\n            }\n          }\n        }\n\n        $overlay.remove();\n\n        if (hasChanges) {\n          this.renderChatHistory();\n          this.renderMomentsFeed();\n          await this.dialogManager.alert('', '');\n        }\n\n        resolve();\n      });\n\n      // ESC\n      $(document).on('keydown.userProfile', e => {\n        if (e.key === 'Escape') {\n          $overlay.remove();\n          $(document).off('keydown.userProfile');\n          resolve();\n        }\n      });\n\n      // \n      $overlay.on('click', e => {\n        if (e.target === $overlay[0]) {\n          $overlay.remove();\n          resolve();\n        }\n      });\n\n      // \n      setTimeout(() => {\n        $('#avatar-url-input').focus();\n      }, 100);\n    });\n  }\n\n  async updateCharRemark(): Promise<void> {\n    const oldDisplayName = this.getDisplayName('char');\n    const config = this.configManager.getConfig();\n    const newRemark = await this.dialogManager.prompt(':', config.charRemark, '');\n    if (newRemark !== null) {\n      this.configManager.updateCharRemark(newRemark);\n      const newDisplayName = this.getDisplayName('char');\n\n      $('#contact-name-header').text(newDisplayName);\n      $('#wechat-input-field').attr(\n        'placeholder',\n        this.configManager.getSavedInputPlaceholder() || ` ${newDisplayName} ...`,\n      );\n\n      $('#moments-feed-list .post-author-name').each(function () {\n        if ($(this).text() === oldDisplayName) $(this).text(newDisplayName);\n      });\n\n      $('.recall-notice-text').each(function () {\n        const text = $(this).text();\n        if (text && text.includes(`\"${oldDisplayName}\"`)) {\n          $(this).text(`\"${newDisplayName}\" `);\n        }\n      });\n\n      await this.dialogManager.alert('', '');\n    }\n  }\n\n  async updateUserName(): Promise<void> {\n    const oldName = this.getDisplayName('user');\n    const newName = await this.dialogManager.showInputDialog('', '', oldName, '...');\n\n    if (newName && newName.trim() !== '' && newName !== oldName) {\n      this.configManager.updateUserName(newName);\n      $('#moments-user-name').text(newName);\n\n      // AI\n      const shouldNotify = await this.dialogManager.confirm('AI', '');\n      if (shouldNotify) {\n        this.momentsManager.notifyMomentChange('name', oldName, newName);\n        this.eventHandler.setHasPendingNotifications(true);\n      }\n\n      await this.dialogManager.alert('', '');\n    }\n  }\n\n  // updateSignature\n\n  async updateCoverPhoto(): Promise<void> {\n    const currentCover = this.configManager.getSavedCoverPhoto() || '';\n    const newCover = await this.dialogManager.showInputDialog(\n      '',\n      'URL',\n      currentCover,\n      '',\n      'url',\n    );\n    if (newCover) {\n      this.configManager.setCoverPhoto(newCover);\n      $('#moments-cover-photo').attr('src', newCover);\n    }\n  }\n\n  // \n  async handleTransferAccept(data: any): Promise<void> {\n    await this.inputHandler.handleTransferAccept(data);\n  }\n\n  async handleGiftAction(data: any): Promise<void> {\n    await this.inputHandler.handleGiftAction(data);\n    this.eventHandler.setHasPendingNotifications(true);\n  }\n\n  // \n  isMessageInQueue(messageId: string): boolean {\n    return this.userMessageQueue.some(entry => entry.id === messageId);\n  }\n\n  // \n  removeFromUserMessageQueue(index: number): void {\n    if (index >= 0 && index < this.userMessageQueue.length) {\n      this.userMessageQueue.splice(index, 1);\n    }\n  }\n\n  // \n  async handleMessageRecall(entry: ChatEntry): Promise<void> {\n    try {\n      // \n      if (entry.type !== 'message') {\n        // \n        return;\n      }\n\n      // \n      const queueIndex = this.userMessageQueue.findIndex(queueEntry => queueEntry.id === entry.id);\n\n      if (queueIndex === -1) {\n        // \n        return;\n      }\n\n      const targetEntry = this.userMessageQueue[queueIndex];\n\n      // recalled_content\n      targetEntry.recalled_content = targetEntry.content;\n\n      // \n      targetEntry.recalled_timestamp = new Date().toISOString();\n\n      // \n      targetEntry.recalled = true;\n\n      // \n      this.renderChatHistory();\n    } catch (error) {\n      console.error(':', error);\n    }\n  }\n\n  // AI\n  getLatestAiRawResponse(): string {\n    return this.aiResponseManager.getLatestAiRawResponse();\n  }\n\n  getLatestSentPrompt(): string {\n    return this.aiResponseManager.getLatestSentPrompt();\n  }\n\n  getRawAiResponse(): string {\n    return this.aiResponseManager.getRawAiResponse();\n  }\n\n  getFullPrompt(): string {\n    return this.aiResponseManager.getFullPrompt();\n  }\n\n  // \n  setupThemeSelector(): void {\n    this.themeEditor.setupThemeSelector();\n    this.themeEditor.addCustomThemeEditButton();\n    this.setupThemeEditorEvents();\n  }\n\n  private setupThemeEditorEvents(): void {\n    // jQuery\n    $('#close-theme-editor').on('click', () => this.themeEditor.closeThemeEditor());\n    $('#save-theme-btn').on('click', () => this.themeEditor.saveCustomTheme());\n    $('#reset-theme-btn').on('click', () => this.themeEditor.resetThemeEditor());\n    $('#custom-theme-btn').on('click', () => this.themeEditor.openThemeEditor());\n    $('#import-theme-btn').on('click', () => this.themeEditor.importTheme());\n    $('#export-json-btn').on('click', () => this.themeEditor.exportThemeAsJSON());\n  }\n\n  openThemeEditor(): void {\n    this.themeEditor.openThemeEditor();\n  }\n\n  closeThemeEditor(): void {\n    this.themeEditor.closeThemeEditor();\n  }\n\n  // HEXRGBA\n  hexToRgba(hex: string, alpha: number): string {\n    const r = parseInt(hex.slice(1, 3), 16);\n    const g = parseInt(hex.slice(3, 5), 16);\n    const b = parseInt(hex.slice(5, 7), 16);\n\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`;\n  }\n\n  // \n  addTestEntry(entryType: string): void {\n    addTestEntry(this.blmxManager, entryType);\n  }\n\n  clearDebugData(): void {\n    clearDebugData(this.blmxManager);\n  }\n\n  showTestEntryTypes(): void {\n    showTestEntryTypes();\n  }\n\n  showDebugInfo(): void {\n    showDebugInfo(this);\n  }\n\n  // \n  notifyRecallViaMoments(sender: 'USER' | 'CHAR', targetText: string): void {\n    // AI\n    if (confirm('AI')) {\n      this.momentsManager.notifyRecallViaMoments(sender, targetText);\n      this.eventHandler.setHasPendingNotifications(true);\n    }\n  }\n\n  /**\n   * \n   */\n  cleanup(): void {\n    // \n    if (this.aiResponseManager && typeof this.aiResponseManager.cleanup === 'function') {\n      this.aiResponseManager.cleanup();\n    }\n\n    if (this.uiRenderer && typeof this.uiRenderer.cleanup === 'function') {\n      this.uiRenderer.cleanup();\n    }\n  }\n}\n","/**\n * \n * SCSS\n */\n\n// \nimport './styles/main.scss';\n\n/**\n * \n * \n */\nexport class StyleManager {\n  private static instance: StyleManager;\n  private loadedStyles: Set<string> = new Set();\n\n  private constructor() {\n    this.initializeStyles();\n  }\n\n  /**\n   * \n   */\n  public static getInstance(): StyleManager {\n    if (!StyleManager.instance) {\n      StyleManager.instance = new StyleManager();\n    }\n    return StyleManager.instance;\n  }\n\n  /**\n   * \n   */\n  private initializeStyles(): void {\n    console.log('[StyleManager] ...');\n\n    // \n    this.loadedStyles.add('main');\n\n    // body\n    document.body.classList.add('styles-loaded');\n\n    console.log('[StyleManager] ');\n  }\n\n  /**\n   * \n   */\n  public isStyleLoaded(styleName: string): boolean {\n    return this.loadedStyles.has(styleName);\n  }\n\n  /**\n   * \n   */\n  public toggleTheme(theme: 'light' | 'dark'): void {\n    const body = document.body;\n\n    if (theme === 'dark') {\n      body.classList.add('dark-mode');\n    } else {\n      body.classList.remove('dark-mode');\n    }\n\n    console.log(`[StyleManager] : ${theme}`);\n  }\n\n  /**\n   * \n   */\n  public getCurrentTheme(): 'light' | 'dark' {\n    return document.body.classList.contains('dark-mode') ? 'dark' : 'light';\n  }\n\n  /**\n   * CSS\n   */\n  public setCSSVariable(name: string, value: string): void {\n    document.documentElement.style.setProperty(name, value);\n  }\n\n  /**\n   * CSS\n   */\n  public getCSSVariable(name: string): string {\n    return getComputedStyle(document.documentElement).getPropertyValue(name).trim();\n  }\n\n  /**\n   * CSS\n   */\n  public setCSSVariables(variables: Record<string, string>): void {\n    Object.entries(variables).forEach(([name, value]) => {\n      this.setCSSVariable(name, value);\n    });\n  }\n\n  /**\n   * CSS\n   */\n  public resetCSSVariables(): void {\n    // CSS\n    const style = document.documentElement.style;\n    const propertiesToRemove: string[] = [];\n\n    for (let i = 0; i < style.length; i++) {\n      const property = style[i];\n      if (property.startsWith('--')) {\n        propertiesToRemove.push(property);\n      }\n    }\n\n    propertiesToRemove.forEach(property => {\n      style.removeProperty(property);\n    });\n  }\n\n  /**\n   * \n   */\n  public addStyleClass(element: HTMLElement, className: string): void {\n    element.classList.add(className);\n  }\n\n  /**\n   * \n   */\n  public removeStyleClass(element: HTMLElement, className: string): void {\n    element.classList.remove(className);\n  }\n\n  /**\n   * \n   */\n  public toggleStyleClass(element: HTMLElement, className: string): boolean {\n    return element.classList.toggle(className);\n  }\n\n  /**\n   * \n   */\n  public hasStyleClass(element: HTMLElement, className: string): boolean {\n    return element.classList.contains(className);\n  }\n\n  /**\n   * \n   */\n  public getStatus(): {\n    loadedStyles: string[];\n    currentTheme: string;\n    stylesLoaded: boolean;\n  } {\n    return {\n      loadedStyles: Array.from(this.loadedStyles),\n      currentTheme: this.getCurrentTheme(),\n      stylesLoaded: document.body.classList.contains('styles-loaded'),\n    };\n  }\n}\n\n// \nexport const styleManager = StyleManager.getInstance();\n\n// \nconsole.log('[StyleManager] ');\n","import { AppController } from './app-controller';\nimport { DialogManager } from './dialog-manager';\n\ntype ConversationType = 'single' | 'group';\n\ninterface ConversationItem {\n  id: string;\n  type: ConversationType;\n  name: string;\n  avatar: string;\n  lastMessage: string;\n  time: string;\n  unread: number;\n}\n\ninterface ContactItem {\n  id: string;\n  type: ConversationType;\n  name: string;\n  avatar: string;\n  desc?: string;\n}\n\nfunction setupTabs(appController: AppController) {\n  const sectionMap: Record<string, string> = {\n    conv: '#wechat-tab-conv',\n    contacts: '#wechat-tab-contacts',\n    discover: '#wechat-tab-discover',\n    me: '#wechat-tab-me',\n  };\n\n  const activate = (key: keyof typeof sectionMap) => {\n    $('.wechat-home-section').removeClass('active');\n    $(sectionMap[key]).addClass('active');\n    $('.wechat-tab-btn').removeClass('active');\n    $(`.wechat-tab-btn[data-target=\"${key}\"]`).addClass('active');\n  };\n\n  $('.wechat-tab-btn')\n    .off('click')\n    .on('click', function () {\n      const target = ($(this).data('target') as keyof typeof sectionMap) || 'conv';\n      activate(target);\n    });\n\n  activate('conv');\n}\n\nfunction fillProfile(appController: AppController) {\n  const configManager = (appController as any).configManager;\n  const config = configManager?.getConfig?.();\n  if (config) {\n    const avatarUrl = config.avatars?.user || config.avatars?.char || '';\n    if (avatarUrl) {\n      $('#profile-avatar').css({\n        'background-image': `url(${avatarUrl})`,\n        'background-size': 'cover',\n        'background-position': 'center',\n      });\n    }\n    $('#profile-name').text(appController.getDisplayName('user'));\n    const signature =\n      configManager?.getSavedSignature?.() ||\n      (typeof localStorage !== 'undefined' ? localStorage.getItem('blmx_user_signature') : '') ||\n      '';\n    if (signature) {\n      $('#profile-signature').text(signature);\n    }\n  }\n}\n\nfunction renderConversations(appController: AppController) {\n  const configManager = (appController as any).configManager;\n  const config = configManager?.getConfig?.();\n  const defaultAvatar =\n    config?.avatars?.char ||\n    'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame///.jpg';\n\n  const conversations: ConversationItem[] = [\n    {\n      id: 'c1',\n      type: 'single',\n      name: appController.getDisplayName('char'),\n      avatar: defaultAvatar,\n      lastMessage: '...',\n      time: '08:39',\n      unread: 2,\n    },\n    {\n      id: 'g1',\n      type: 'group',\n      name: '',\n      avatar: 'https://files.catbox.moe/3j0tpc.jpeg',\n      lastMessage: '...',\n      time: '',\n      unread: 0,\n    },\n  ];\n\n  const $list = $('#conversation-list');\n  $list.empty();\n\n  if (!conversations.length) {\n    $list.append('<li class=\"conv-item placeholder\">/</li>');\n    return;\n  }\n\n  ((window as any)._?.each || ((arr: ConversationItem[], fn: any) => arr.forEach(fn)))(conversations, renderItem);\n\n  function renderItem(conv: ConversationItem) {\n    const $li = $(`\n      <li class=\"conv-item\" data-conv-id=\"${conv.id}\">\n        <div class=\"conv-avatar\" style=\"background-image: url('${conv.avatar}')\"></div>\n        <div class=\"conv-main\">\n          <div class=\"conv-row\">\n            <span class=\"conv-name\">${conv.name}</span>\n            <span class=\"conv-time\">${conv.time}</span>\n          </div>\n          <div class=\"conv-row\">\n            <span class=\"conv-desc\">${conv.lastMessage}</span>\n            ${conv.unread > 0 ? `<span class=\"conv-unread\">${conv.unread}</span>` : ''}\n          </div>\n        </div>\n      </li>\n    `);\n\n    $li.on('click', () => {\n      // \n      $li.find('.conv-unread').remove();\n      conv.unread = 0;\n      appController.navigateTo('wechat');\n    });\n\n    $list.append($li);\n  }\n}\n\nfunction renderContacts(appController: AppController) {\n  const configManager = (appController as any).configManager;\n  const config = configManager?.getConfig?.();\n  const defaultAvatar =\n    config?.avatars?.user ||\n    'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame///.jpg';\n\n  const contacts: ContactItem[] = [\n    { id: 'u1', type: 'single', name: appController.getDisplayName('char'), avatar: defaultAvatar, desc: '' },\n    { id: 'g1', type: 'group', name: '', avatar: 'https://files.catbox.moe/3j0tpc.jpeg', desc: '' },\n    { id: 'u2', type: 'single', name: '', avatar: defaultAvatar, desc: '' },\n  ];\n\n  const $list = $('#contacts-list');\n  $list.empty();\n\n  if (!contacts.length) {\n    $list.append('<li class=\"contact-item placeholder\"></li>');\n    return;\n  }\n\n  ((window as any)._?.each || ((arr: ContactItem[], fn: any) => arr.forEach(fn)))(contacts, renderItem);\n\n  function renderItem(contact: ContactItem) {\n    const $li = $(`\n      <li class=\"contact-item\" data-contact-id=\"${contact.id}\">\n        <div class=\"conv-avatar\" style=\"background-image: url('${contact.avatar}')\"></div>\n        <div class=\"conv-main\">\n          <div class=\"conv-row\">\n            <span class=\"conv-name\">${contact.name}</span>\n            <span class=\"conv-time\">${contact.type === 'group' ? '' : ''}</span>\n          </div>\n          <div class=\"conv-row\">\n            <span class=\"conv-desc\">${contact.desc || ''}</span>\n          </div>\n        </div>\n      </li>\n    `);\n\n    $li.on('click', () => {\n      appController.navigateTo('wechat');\n    });\n\n    $list.append($li);\n  }\n\n  $('#add-friend-entry')\n    .off('click')\n    .on('click', async () => {\n      await DialogManager.getInstance().alert('', '');\n    });\n\n  $('#group-list-entry')\n    .off('click')\n    .on('click', async () => {\n      await DialogManager.getInstance().alert('', '');\n    });\n}\n\nexport function initWechatHome(appController: AppController) {\n  setupTabs(appController);\n  fillProfile(appController);\n  renderConversations(appController);\n  renderContacts(appController);\n}\n","import { AppController } from './app-controller';\nimport { EventHandler } from './event-handler';\nimport { styleManager } from './style-manager';\nimport { DialogManager } from './dialog-manager';\nimport { initWechatHome } from './wechat-home';\n\n//  - false\n// window\n(window as any).BLMX_DEV_MODE = false;\n\n// EventHandler\n(window as any).EventHandlerClass = EventHandler;\n\n// AI\n(window as any).BLMX_PROCESSING_AI_RESPONSE = false;\n\n// jQuery$(async () => {})\n$(async () => {\n  try {\n    // \n    (window as any).BLMX_PROCESSING_AI_RESPONSE = false;\n\n    // \n    const appController = new AppController();\n    await appController.initialize();\n\n    // \n    (window as any).blmxApp = appController;\n    (window as any).blmxStyleManager = styleManager;\n    (window as any).dialogManager = DialogManager.getInstance();\n\n    //  Tab\n    initWechatHome(appController);\n\n    // \n    $('#app-wechat').on('click', () => appController.navigateTo('wechatHome'));\n    $('#app-settings').on('click', () => appController.navigateTo('settings'));\n\n    if ((window as any).BLMX_DEV_MODE) {\n      console.log('[BLMX] ');\n      console.log('[BLMX] :');\n      console.log('  window.blmxApp.showTestEntryTypes() - ');\n      console.log('  window.blmxApp.addTestEntry() - ');\n      console.log('  window.blmxApp.clearDebugData() - ');\n    }\n  } catch (error) {\n    console.error('[BLMX] :', error);\n\n    // alert\n    // \n    setTimeout(() => {\n      const dialogManager = DialogManager.getInstance();\n      dialogManager.alert('', '');\n    }, 500); // DOM\n  }\n});\n","import { DialogManager } from './dialog-manager';\nimport { BLMX_Protocol, ChatEntry, LogEntry } from './script';\nimport { IAppController, IEventHandler } from './types';\nimport { UIRenderer } from './ui-renderer';\nimport { safeJsonStringify, SafeStorage } from './utils';\n\n// \ninterface EventHandlerOptions {\n  getDisplayName: (type: 'user' | 'char') => string;\n  stageAndDisplayEntry: (entry: LogEntry) => void;\n  triggerAiResponse: (immediate?: boolean) => Promise<void>;\n  updateFooterButtonsState: () => void;\n  renderChatHistory: () => void;\n  renderMomentsFeed: () => void;\n  togglePanel: (panelName: string | null) => void;\n  findStickerUrlByName: (name: string) => string | undefined;\n}\n\n// \nexport class EventHandler implements IEventHandler {\n  private wechatInput: HTMLInputElement;\n  private sendBtn: HTMLElement;\n  private plusBtn: HTMLElement;\n  private uiRenderer: UIRenderer | null;\n  private options: EventHandlerOptions;\n  private blmxManager: BLMX_Protocol;\n  private appController: IAppController;\n  private hasPendingNotifications: boolean = false;\n  private dialogManager: DialogManager = DialogManager.getInstance();\n\n  // getter\n  get hasNotifications(): boolean {\n    return this.hasPendingNotifications;\n  }\n\n  // UIRenderer\n  setUIRenderer(uiRenderer: UIRenderer): void {\n    this.uiRenderer = uiRenderer;\n  }\n\n  constructor(\n    inputSelector: string,\n    sendBtnSelector: string,\n    plusBtnSelector: string,\n    blmxManager: BLMX_Protocol,\n    appController: IAppController,\n    uiRenderer: UIRenderer | null,\n    options: EventHandlerOptions,\n  ) {\n    this.wechatInput = $(inputSelector)[0] as HTMLInputElement;\n    this.sendBtn = $(sendBtnSelector)[0] as HTMLElement;\n    this.plusBtn = $(plusBtnSelector)[0] as HTMLElement;\n\n    if (!this.wechatInput || !this.sendBtn || !this.plusBtn) {\n      throw new Error('One or more required elements not found');\n    }\n\n    this.blmxManager = blmxManager;\n    this.options = options;\n    this.appController = appController;\n    this.uiRenderer = uiRenderer;\n\n    this.setupEventListeners();\n  }\n\n  // \n  setHasPendingNotifications(value: boolean): void {\n    this.hasPendingNotifications = value;\n    this.options.updateFooterButtonsState();\n  }\n\n  //  +  + \n  private updateGameTime(date: Date): void {\n    if (isNaN(date.getTime())) return;\n    window.currentGameDate = date;\n\n    const $timeElement = $('#current-time');\n    if ($timeElement.length) {\n      const formattedTime = `${date.getHours().toString().padStart(2, '0')}:${date\n        .getMinutes()\n        .toString()\n        .padStart(2, '0')}`;\n      $timeElement.text(formattedTime);\n    }\n\n    if (this.uiRenderer) {\n      this.uiRenderer.refreshAllTimestamps();\n    }\n  }\n\n  // \n  private async deleteByLogIndex(indexToDelete: number, previewText: string): Promise<void> {\n    const confirmed = await this.dialogManager.confirm(\n      `\\n\\n: \"${previewText}...\"`,\n      '',\n    );\n    if (!confirmed) return;\n\n    const mainLogLength = this.blmxManager.logEntries.length;\n    if (indexToDelete < mainLogLength) {\n      this.blmxManager.logEntries.splice(indexToDelete, 1);\n      await this.blmxManager.persistLogToStorage();\n    } else {\n      const queueIndex = indexToDelete - mainLogLength;\n      this.appController.removeFromUserMessageQueue(queueIndex);\n    }\n\n    this.options.renderChatHistory();\n    this.options.renderMomentsFeed();\n  }\n\n  //  messageId \n  private async deleteByMessageId(\n    messageId: string,\n    previewText: string,\n    $messageRow: JQuery<HTMLElement>,\n  ): Promise<void> {\n    const confirmed = await this.dialogManager.confirm(\n      `\\n\\n: \"${previewText}...\"`,\n      '',\n    );\n    if (!confirmed) return;\n\n    const indexToDelete = this.blmxManager.logEntries.findIndex(entry => 'id' in entry && entry.id === messageId);\n\n    if (indexToDelete !== -1) {\n      this.blmxManager.logEntries.splice(indexToDelete, 1);\n      await this.blmxManager.persistLogToStorage();\n      this.options.renderChatHistory();\n      this.options.renderMomentsFeed();\n    } else {\n      $messageRow.remove();\n      await this.dialogManager.alert('', '');\n    }\n  }\n\n  // \n  addLongPressListener(\n    element: HTMLElement,\n    callback: () => void,\n    options: { duration: number; preventDefault: boolean } = { duration: 600, preventDefault: true },\n  ): void {\n    let timer: number;\n    let startX: number, startY: number;\n\n    const onStart = (e: PointerEvent) => {\n      if (e.type === 'mousedown' && e.button !== 0) return;\n      startX = e.clientX;\n      startY = e.clientY;\n      if (options.preventDefault) e.preventDefault();\n      clearTimeout(timer);\n      timer = window.setTimeout(() => {\n        timer = 0;\n        callback();\n      }, options.duration);\n    };\n\n    const onMove = (e: PointerEvent) => {\n      if (!timer) return;\n      const moveX = e.clientX;\n      const moveY = e.clientY;\n      if (Math.abs(moveX - startX) > 10 || Math.abs(moveY - startY) > 10) {\n        clearTimeout(timer);\n      }\n    };\n\n    const onEnd = () => clearTimeout(timer);\n\n    element.addEventListener('pointerdown', onStart);\n    element.addEventListener('pointermove', onMove);\n    element.addEventListener('pointerup', onEnd);\n    element.addEventListener('pointerleave', onEnd);\n\n    if (options.preventDefault) {\n      element.addEventListener('contextmenu', e => e.preventDefault());\n    }\n  }\n\n  // \n  async promptForDateTime(defaultText: string): Promise<[string, string] | null> {\n    const dateTimeInput = await this.dialogManager.prompt(\n      '',\n      defaultText,\n      '',\n      '',\n      '',\n      'text',\n      'YYYY-MM-DD HH:mm',\n    );\n\n    if (!dateTimeInput || !/^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}$/.test(dateTimeInput)) {\n      if (dateTimeInput) await this.dialogManager.alert('YYYY-MM-DD HH:mm ', '');\n      return null;\n    }\n\n    const [newDate, newTime] = dateTimeInput.split(' ');\n    const parsedDate = new Date(dateTimeInput.replace(' ', 'T'));\n\n    if (isNaN(parsedDate.getTime())) {\n      await this.dialogManager.alert('', '');\n      return null;\n    }\n\n    // UI\n    this.updateGameTime(parsedDate);\n\n    return [newDate, newTime] as [string, string];\n  }\n\n  // \n  async handleMessageRecall(messageId: string): Promise<void> {\n    const entryToRecall = this.blmxManager.logEntries.find(e => 'id' in e && e.id === messageId) as\n      | ChatEntry\n      | undefined;\n\n    if (entryToRecall) {\n      const currentDate = window.currentGameDate || new Date();\n      const timeString = `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1)\n        .toString()\n        .padStart(2, '0')}-${currentDate.getDate().toString().padStart(2, '0')} ${currentDate\n        .getHours()\n        .toString()\n        .padStart(2, '0')}:${currentDate.getMinutes().toString().padStart(2, '0')}`;\n\n      const dateTimeResult = await this.promptForDateTime(timeString);\n\n      if (dateTimeResult === null) {\n        return;\n      }\n\n      const confirmed = await this.dialogManager.confirm('', '');\n\n      if (confirmed) {\n        const [newDate, newTime] = dateTimeResult;\n        // \n        entryToRecall.recalled = true;\n        entryToRecall.recalled_timestamp = `${newDate} ${newTime}`;\n        entryToRecall.recalled_content = entryToRecall.content;\n\n        // \n        this.blmxManager.persistLogToStorage().then(() => {\n          // \n          this.options.renderChatHistory();\n        });\n\n        // \n        this.options.updateFooterButtonsState();\n\n        // AI\n        if (entryToRecall.sender === 'me') {\n          // \n          const messageContent =\n            typeof entryToRecall.content === 'string'\n              ? entryToRecall.content\n              : safeJsonStringify(entryToRecall.content);\n\n          // AppController\n          this.appController.notifyRecallViaMoments('USER', messageContent);\n        }\n      }\n    } else {\n      await this.dialogManager.alert('', '');\n    }\n  }\n\n  // \n  private setupEventListeners(): void {\n    //  - jQuery\n    $(this.sendBtn).on('click', () => {\n      const text = this.wechatInput.value.trim();\n      if (text) {\n        this.options.stageAndDisplayEntry({\n          id: `msg-${Date.now()}${Math.random()}`,\n          type: 'message',\n          sender: 'me',\n          content: text,\n        });\n        this.wechatInput.value = '';\n        this.options.updateFooterButtonsState();\n      } else {\n        // AI\n        this.hasPendingNotifications = false;\n        this.options.triggerAiResponse(true); // immediate=true\n      }\n    });\n\n    $('#smile-btn').on('click', () => {\n      this.options.togglePanel('sticker');\n      this.renderStickerFeatures();\n    });\n\n    // Plus - jQuery\n    $(this.plusBtn).on('click', () => {\n      this.options.togglePanel('plus');\n      this.renderPlusFeatures();\n    });\n\n    $('#microphone-btn').on('click', async () => {\n      const result = await this.dialogManager.showVoiceDialog();\n      if (result) {\n        this.options.stageAndDisplayEntry({\n          id: `msg-${Date.now()}${Math.random()}`,\n          type: 'voice',\n          sender: 'me',\n          content: { text: result.text, duration: result.duration },\n        });\n      }\n    });\n\n    //  - jQuery\n    $(this.wechatInput).on('keydown', (e: JQuery.KeyDownEvent) => {\n      if (e.key === 'Enter' && !e.shiftKey) {\n        e.preventDefault();\n        $(this.sendBtn).trigger('click');\n      }\n    });\n\n    $(this.wechatInput).on('input', () => {\n      this.options.updateFooterButtonsState();\n    });\n\n    $(this.wechatInput).on('focus', () => {\n      this.options.togglePanel(null);\n    });\n\n    // \n    $('#app-wechat').on('click', () => this.appController.navigateTo('wechat'));\n    $('#app-settings').on('click', () => this.appController.navigateTo('settings'));\n    $('#wechat-back-btn-dummy').on('click', () => this.appController.navigateTo('home'));\n    $('#settings-back-btn').on('click', () => this.appController.navigateTo('home'));\n    $('#wechat-options-btn').on('click', () => this.appController.navigateTo('moments'));\n    $('#moments-back-btn').on('click', () => this.appController.navigateTo('wechat'));\n\n    // \n    this.renderPlusFeatures();\n    this.renderStickerFeatures();\n\n    // \n    this.setupClickListeners();\n\n    //  - jQuery\n    this.addLongPressListener(\n      $('#wechat-input-field')[0] as HTMLElement,\n      async () => {\n        // \n        const currentPlaceholder = $('#wechat-input-field').attr('placeholder') || '';\n        const newPlaceholder = await this.dialogManager.prompt(\n          ':',\n          currentPlaceholder,\n          '',\n        );\n        if (newPlaceholder !== null) {\n          $('#wechat-input-field').attr('placeholder', newPlaceholder);\n          localStorage.setItem(`blmx_input_placeholder_${this.blmxManager.getCharId()}`, newPlaceholder);\n        }\n      },\n      { duration: 5000, preventDefault: false },\n    );\n  }\n\n  private async setupClickListeners(): Promise<void> {\n    $('#hidden-send-trigger').on('click', async () => {\n      const confirmed = await this.dialogManager.confirm('AI', 'AI');\n      if (confirmed) {\n        this.options.triggerAiResponse(true);\n      }\n    });\n\n    //  - \n    $('#wechat-options-btn').on('click', () => {\n      this.appController.navigateTo('moments');\n    });\n\n    $('#delete-mode-trigger').on('click', async () => {\n      const wechatView = $('#wechat-view');\n      wechatView?.toggleClass('delete-mode');\n      if (wechatView?.hasClass('delete-mode')) {\n        await this.dialogManager.alert(\n          '',\n          '',\n        );\n      } else {\n        await this.dialogManager.alert('', '');\n      }\n    });\n\n    $('#post-moment-btn').on('click', async () => {\n      const currentDate = window.currentGameDate || new Date();\n      const timeString = `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1)\n        .toString()\n        .padStart(2, '0')}-${currentDate.getDate().toString().padStart(2, '0')} ${currentDate\n        .getHours()\n        .toString()\n        .padStart(2, '0')}:${currentDate.getMinutes().toString().padStart(2, '0')}`;\n\n      // \n      const momentData = await this.dialogManager.showMomentDialog(timeString);\n      if (!momentData) return; // \n\n      // ID\n      const momentId = `moment-${Date.now()}-${Math.random().toString(36).substring(2, 10)}`;\n      const momentEntry = {\n        key: 'USER_MOMENT',\n        id: momentId,\n        data: {\n          text: momentData.text,\n          image: momentData.image,\n          image_type: momentData.image_type,\n          image_desc: momentData.image_desc,\n          date: momentData.date,\n          time: momentData.time,\n        },\n      } as import('./script').MomentEntry;\n\n      // \n      this.blmxManager.addEntry(momentEntry);\n\n      // \n      const momentDateTime = `${momentData.date} ${momentData.time}`;\n      const momentDate = new Date(momentDateTime.replace(' ', 'T'));\n      const currentGameDate = window.currentGameDate || new Date();\n\n      // \n      if (momentDate > currentGameDate) {\n        // 300ms\n        setTimeout(async () => {\n          const shouldAdvanceTime = await this.dialogManager.confirm(\n            `${momentData.date} ${momentData.time}\\n`,\n            '',\n          );\n\n          if (shouldAdvanceTime) {\n            // \n            const parsedDate = new Date(momentDateTime.replace(' ', 'T'));\n            if (!isNaN(parsedDate.getTime())) {\n              // UI\n              this.updateGameTime(parsedDate);\n\n              // \n              const timeAdvanceEvent: import('./script').EventLogEntry = {\n                type: 'event',\n                content: {\n                  date: momentData.date,\n                  time: momentData.time,\n                  description: ` ${momentData.date} ${momentData.time}`,\n                },\n                id: `event-${Date.now()}`,\n              };\n              this.blmxManager.addEntry(timeAdvanceEvent);\n\n              // \n              this.options.renderMomentsFeed();\n            }\n          }\n        }, 300);\n      }\n\n      // \n      this.options.renderMomentsFeed();\n\n      // \n      this.setHasPendingNotifications(true);\n      this.options.updateFooterButtonsState();\n\n      // UI\n      this.blmxManager.persistLogToStorage().then(() => {});\n    });\n\n    const momentsFeedList = $('#moments-feed-list');\n    momentsFeedList?.on('click', async e => {\n      const target = $(e.target)[0] as HTMLElement;\n      const postEl = target.closest('.moment-post') as HTMLElement;\n      if (!postEl) return;\n\n      // ID\n      const momentId = postEl.dataset.momentId;\n      if (!momentId) {\n        console.error('[BLMX] IDdata-moment-id');\n        return;\n      }\n      // \n\n      if (target.closest('.delete-moment-btn')) {\n        const confirmed = await this.dialogManager.confirm(\n          '\\n',\n          '',\n        );\n        if (confirmed) {\n          // momentIdID\n          const momentPostLogIndices: number[] = [];\n          this.blmxManager.logEntries.forEach((entry, index) => {\n            if ('key' in entry && entry.key.includes('_MOMENT')) {\n              momentPostLogIndices.push(index);\n            }\n          });\n\n          const momentSequenceId = parseInt(momentId, 10);\n          const actualMomentIndex = momentPostLogIndices[momentSequenceId];\n\n          // \n\n          if (actualMomentIndex !== undefined && actualMomentIndex >= 0) {\n            // \n            const indicesToDelete: number[] = [actualMomentIndex];\n\n            // \n            this.blmxManager.logEntries.forEach((entry, index) => {\n              if (\n                'key' in entry &&\n                (entry.key === 'USER_LIKE' || entry.key === 'USER_COMMENT') &&\n                'data' in entry &&\n                'target_post_id' in entry.data &&\n                entry.data.target_post_id === momentSequenceId\n              ) {\n                indicesToDelete.push(index);\n              }\n            });\n\n            // \n            indicesToDelete.sort((a, b) => b - a);\n            for (const index of indicesToDelete) {\n              this.blmxManager.logEntries.splice(index, 1);\n            }\n\n            // \n            this.blmxManager.persistLogToStorage().then(() => {\n              // \n              this.options.renderMomentsFeed();\n            });\n          }\n        }\n      } else if (target.closest('.comment-button')) {\n        // /\n        const result = await this.dialogManager.showCommentDialog();\n        if (result) {\n          if (result.type === 'like') {\n            // \n            const likeId = `like-${Date.now()}-${Math.random().toString(36).substring(2, 10)}`;\n            const likeEntry = {\n              key: 'USER_LIKE',\n              id: likeId,\n              data: { target_post_id: parseInt(momentId, 10) },\n            } as import('./script').LikeEntry;\n\n            this.blmxManager.addEntry(likeEntry);\n            // \n          } else if (result.type === 'comment' && result.content) {\n            // \n            const commentId = `comment-${Date.now()}-${Math.random().toString(36).substring(2, 10)}`;\n            const commentEntry = {\n              key: 'USER_COMMENT',\n              id: commentId,\n              data: { text: result.content, target_post_id: parseInt(momentId, 10) },\n            } as import('./script').CommentEntry;\n\n            this.blmxManager.addEntry(commentEntry);\n            // \n          }\n\n          // \n          this.options.renderMomentsFeed();\n          this.setHasPendingNotifications(true);\n          this.options.updateFooterButtonsState();\n\n          // \n          this.blmxManager.persistLogToStorage();\n        }\n      }\n    });\n\n    $(document.body).on('click', e => {\n      const target = $(e.target)[0] as HTMLElement;\n      if (target.matches('.message-avatar')) {\n        const row = target.closest('.message-row');\n        if (row) {\n          const avatarType = row.classList.contains('me') ? 'user' : 'char';\n          this.appController.updateAvatar(avatarType);\n        }\n      }\n    });\n\n    $('#contact-name-header').on('click', () => {\n      this.appController.updateCharRemark();\n    });\n    $('#moments-user-name').on('click', () => {\n      this.appController.updateUserName();\n    });\n    $('#moments-user-avatar').on('click', () => {\n      this.appController.updateAvatar('user');\n    });\n    // \n    $('#moments-cover-photo').on('click', () => {\n      this.appController.updateCoverPhoto();\n    });\n\n    const $wechatBody = $('.wechat-body');\n    // jQueryoncapture\n    $wechatBody.on('click', async (e: JQuery.ClickEvent) => {\n      const $wechatView = $('#wechat-view');\n      if (!$wechatView.hasClass('delete-mode')) {\n        return;\n      }\n\n      // data-log-index\n      const $targetRow = $(e.target).closest('[data-log-index]');\n      if ($targetRow.length) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        //  DOM  data-log-index \n        const indexToDelete =\n          $('.wechat-body [data-log-index]').index($targetRow) !== -1\n            ? $('.wechat-body [data-log-index]').index($targetRow)\n            : parseInt($targetRow.data('logIndex'), 10);\n        const previewText = $targetRow.text().trim().replace(/\\s+/g, ' ').substring(0, 50);\n\n        await this.deleteByLogIndex(indexToDelete, previewText);\n        return;\n      }\n\n      // data-log-indexdata-message-id\n      const $messageRow = $(e.target).closest('[data-message-id]');\n      if ($messageRow.length) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        const messageId = $messageRow.data('messageId');\n        const previewText = $messageRow.text().trim().replace(/\\s+/g, ' ').substring(0, 50);\n\n        await this.deleteByMessageId(messageId, previewText, $messageRow);\n      }\n    });\n\n    $('#change-chat-wallpaper-btn').on('click', e => {\n      e.preventDefault();\n      this.appController.changeWallpaper('chat');\n    });\n    $('#change-home-wallpaper-btn').on('click', e => {\n      e.preventDefault();\n      this.appController.changeWallpaper('home');\n    });\n    $('#change-settings-wallpaper-btn').on('click', e => {\n      e.preventDefault();\n      this.appController.changeWallpaper('settings');\n    });\n\n    $('#show-last-ai-response-btn').on('click', async e => {\n      e.preventDefault();\n      const response = this.appController.getLatestAiRawResponse();\n      await this.dialogManager.showScrollableText(response || 'AI', 'AI', '');\n    });\n\n    $('#show-last-sent-prompt-btn').on('click', async e => {\n      e.preventDefault();\n      const prompt = this.appController.getLatestSentPrompt();\n      await this.dialogManager.showScrollableText(prompt || '', '', '');\n    });\n\n    // \n    $('.dynamic-island').on('click', async () => {\n      try {\n        // jQueryAPI\n        if (!document.fullscreenElement) {\n          // \n          await document.documentElement.requestFullscreen();\n        } else {\n          // \n          await document.exitFullscreen();\n        }\n      } catch (error) {\n        console.warn('[BLMX] :', error);\n        await this.dialogManager.alert('', '');\n      }\n    });\n  }\n\n  private renderPlusFeatures(): void {\n    const $plusGrid = $('#plus-grid');\n    if (!$plusGrid.length) return;\n\n    const PLUS_FEATURES = [\n      {\n        label: '',\n        icon: 'fas fa-images',\n        action: async () => {\n          const desc = await this.dialogManager.prompt(':', '', '');\n          if (desc) {\n            this.options.stageAndDisplayEntry({\n              type: 'image',\n              sender: 'me',\n              content: { type: 'desc', value: desc },\n              id: `msg-${Date.now()}`,\n            });\n            this.options.togglePanel(null);\n          }\n        },\n      },\n      {\n        label: '',\n        icon: 'fas fa-camera',\n        action: async () => {\n          const currentDate = window.currentGameDate || new Date();\n          const dateString = `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1)\n            .toString()\n            .padStart(2, '0')}-${currentDate.getDate().toString().padStart(2, '0')}`;\n          const timeString = `${currentDate.getHours().toString().padStart(2, '0')}:${currentDate\n            .getMinutes()\n            .toString()\n            .padStart(2, '0')}`;\n\n          // \n          const timeJumpData = await this.dialogManager.showTimeJumpDialog(`${dateString} ${timeString}`);\n          if (!timeJumpData) return;\n\n          const eventData = {\n            date: timeJumpData.date,\n            time: timeJumpData.time,\n            description: timeJumpData.description,\n          };\n\n          // eventlog\n          const [newDate, newTime] = [timeJumpData.date, timeJumpData.time];\n          const newGameDate = new Date(`${newDate} ${newTime}`.replace(' ', 'T'));\n          this.updateGameTime(newGameDate);\n\n          this.options.stageAndDisplayEntry({\n            type: 'event',\n            content: eventData,\n            id: `event-${Date.now()}`,\n          } as import('./script').EventLogEntry);\n          this.options.togglePanel(null);\n        },\n      },\n      {\n        label: '',\n        icon: 'fas fa-video',\n        action: async () =>\n          await this.dialogManager.alert(\n            'discordhttps://discord.com/channels/1379304008157499423/1388180976873766973https://discord.com/channels/1291925535324110879/1388182155707814009',\n            '',\n          ),\n      },\n      {\n        label: '',\n        icon: 'fas fa-map-marker-alt',\n        action: async () => {\n          const loc = await this.dialogManager.prompt(':', '', '');\n          if (loc)\n            this.options.stageAndDisplayEntry({\n              type: 'location',\n              sender: 'me',\n              content: loc,\n              id: `msg-${Date.now()}`,\n            });\n          this.options.togglePanel(null);\n        },\n      },\n      {\n        label: '',\n        icon: 'fas fa-envelope',\n        action: async () => {\n          const result = await this.dialogManager.showRedPacketDialog();\n          if (result) {\n            const giftData = {\n              name: '',\n              price: result.amount,\n              note: result.note,\n              status: 'sent' as const,\n            };\n            this.options.stageAndDisplayEntry({\n              type: 'gift',\n              sender: 'me',\n              content: safeJsonStringify(giftData),\n              data: giftData,\n              id: `msg-${Date.now()}`,\n            });\n            this.options.togglePanel(null);\n          }\n        },\n      },\n      {\n        label: '',\n        icon: 'fas fa-money-bill-wave',\n        action: async () => {\n          const result = await this.dialogManager.showTransferDialog();\n          if (result) {\n            const transferData = {\n              amount: result.amount,\n              note: result.note || ' ',\n              status: 'sent' as const,\n            };\n            this.options.stageAndDisplayEntry({\n              type: 'transfer',\n              sender: 'me',\n              content: safeJsonStringify(transferData),\n              data: transferData,\n              id: `msg-${Date.now()}`,\n            });\n            this.options.togglePanel(null);\n          }\n        },\n      },\n      {\n        label: '',\n        icon: 'fas fa-file-alt',\n        action: async () => {\n          const fileName = await this.dialogManager.prompt(':', '', '');\n          if (fileName)\n            this.options.stageAndDisplayEntry({\n              type: 'file',\n              sender: 'me',\n              content: fileName,\n              id: `msg-${Date.now()}`,\n            });\n          this.options.togglePanel(null);\n        },\n      },\n      {\n        label: '',\n        icon: 'fas fa-gift',\n        action: async () => {\n          const result = await this.dialogManager.showGiftDialog();\n          if (result) {\n            const giftData = {\n              name: result.name,\n              price: result.price,\n              status: 'sent' as const,\n            };\n            this.options.stageAndDisplayEntry({\n              type: 'gift',\n              sender: 'me',\n              content: safeJsonStringify(giftData),\n              data: giftData,\n              id: `msg-${Date.now()}`,\n            });\n            this.options.togglePanel(null);\n          }\n        },\n      },\n    ];\n\n    // uiRenderer\n    if (this.uiRenderer) {\n      // DOMjQuery\n      this.uiRenderer.renderFeatureGrid($plusGrid[0], PLUS_FEATURES, {\n        onToggleDeleteMode: () => {},\n        onAddStickers: () => {},\n      });\n    } else {\n      console.error('[BLMX] UIRenderer is not initialized');\n    }\n  }\n\n  private renderStickerFeatures(): void {\n    const $stickerGrid = $('#sticker-grid');\n    if (!$stickerGrid.length) return;\n\n    // \n    const defaultGlobalStickers = [{ label: '', url: 'https://files.catbox.moe/3j0tpc.jpeg' }];\n\n    //  - \n    const GLOBAL_STICKER_STORAGE_KEY = 'blmx_wechat_stickers_global_blmx';\n    const customStickers = SafeStorage.getItem(GLOBAL_STICKER_STORAGE_KEY, []) || [];\n    const allStickers = [...defaultGlobalStickers, ...customStickers];\n\n    // \n    const features = allStickers.map(s => ({\n      label: s.label,\n      icon: s.url,\n      isDefault: defaultGlobalStickers.some(ds => ds.label === s.label),\n      action: () => {\n        this.options.stageAndDisplayEntry({\n          type: 'sticker',\n          sender: 'me',\n          content: s.label,\n          id: `msg-${Date.now()}`,\n        });\n        this.options.togglePanel(null);\n      },\n    }));\n\n    // \"\"\n    features.unshift({\n      label: '',\n      icon: 'fas fa-cog', // \n      isAddBtn: true,\n      isDefault: false, // isDefault\n      action: () => {\n        this.showStickerManager();\n      },\n    } as {\n      label: string;\n      icon: string;\n      isAddBtn: boolean;\n      isDefault: boolean;\n      action: () => void;\n    });\n\n    // uiRenderer\n    if (this.uiRenderer) {\n      // DOMjQuery\n      this.uiRenderer.renderFeatureGrid($stickerGrid[0], features, {\n        onToggleDeleteMode: () => this.showStickerManager(),\n        onAddStickers: () => this.showStickerManager(),\n      });\n    } else {\n      console.error('[BLMX] UIRenderer is not initialized');\n    }\n  }\n\n  // \n  private showStickerManager(): void {\n    // \n    const modal = document.createElement('div');\n    modal.className = 'sticker-manager-modal';\n\n    // \n    const container = document.createElement('div');\n    container.className = 'sticker-manager-container';\n\n    // innerHTML\n    container.innerHTML = `\n      <h2></h2>\n      <div class=\"sticker-manager-tabs\">\n        <div class=\"tab-button active\" data-tab=\"add-sticker\"></div>\n        <div class=\"tab-button\" data-tab=\"batch-add\"></div>\n        <div class=\"tab-button\" data-tab=\"delete-manage\"></div>\n      </div>\n      <div class=\"sticker-manager-content\">\n        <!--  -->\n        <div class=\"tab-content active\" data-tab=\"add-sticker\">\n          <div class=\"add-sticker-section\">\n            <div class=\"add-sticker-form\">\n              <div class=\"form-group\">\n                <label for=\"sticker-label\"></label>\n                <input type=\"text\" id=\"sticker-label\" placeholder=\"/\">\n              </div>\n              <div class=\"form-group\">\n                <label for=\"sticker-url\">URL</label>\n                <input type=\"url\" id=\"sticker-url\" placeholder=\"URL\">\n              </div>\n              <div class=\"preview-container\">\n                <div class=\"preview-label\"></div>\n                <img id=\"preview-img\" class=\"preview-img\" style=\"display: none;\">\n              </div>\n              <button class=\"add-sticker-btn\"></button>\n            </div>\n          </div>\n        </div>\n\n        <!--  -->\n        <div class=\"tab-content\" data-tab=\"batch-add\">\n          <div class=\"batch-add-section\">\n            <div class=\"batch-instructions\">\n              <p></p>\n              <ul>\n                <li><strong>http://</strong></li>\n                <li><strong></strong></li>\n                <li> <strong>=http://</strong> </li>\n                <li><code>https://example.com/smile.jpg,https://example.com/cry.jpg</code></li>\n              </ul>\n            </div>\n            <div class=\"form-group\">\n              <label for=\"batch-textarea\"></label>\n              <textarea id=\"batch-textarea\" placeholder=\"...\"></textarea>\n            </div>\n            <button class=\"batch-add-btn\"></button>\n          </div>\n        </div>\n\n        <!--  -->\n        <div class=\"tab-content\" data-tab=\"delete-manage\">\n          <div class=\"delete-manage-section\">\n            <div class=\"control-bar\">\n              <div class=\"selection-controls\">\n                <button class=\"select-all-btn\"></button>\n                <button class=\"deselect-all-btn\"></button>\n              </div>\n              <button class=\"delete-selected-btn\"></button>\n            </div>\n            <div class=\"sticker-list-container\">\n              <div class=\"sticker-grid\" id=\"delete-sticker-grid\">\n                <!--  -->\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class=\"sticker-manager-footer\">\n        <button class=\"dialog-button\"></button>\n      </div>\n    `;\n\n    // DOM\n    const tabButtons = container.querySelectorAll('.tab-button') as NodeListOf<HTMLElement>;\n    const tabContents = container.querySelectorAll('.tab-content') as NodeListOf<HTMLElement>;\n    const closeBtn = container.querySelector('.dialog-button') as HTMLButtonElement;\n\n    // \n    const labelInput = container.querySelector('#sticker-label') as HTMLInputElement;\n    const urlInput = container.querySelector('#sticker-url') as HTMLInputElement;\n    const previewImg = container.querySelector('#preview-img') as HTMLImageElement;\n    const addStickerBtn = container.querySelector('.add-sticker-btn') as HTMLButtonElement;\n\n    // \n    const batchTextarea = container.querySelector('#batch-textarea') as HTMLTextAreaElement;\n    const batchAddBtn = container.querySelector('.batch-add-btn') as HTMLButtonElement;\n\n    // \n    const selectAllBtn = container.querySelector('.select-all-btn') as HTMLButtonElement;\n    const deselectAllBtn = container.querySelector('.deselect-all-btn') as HTMLButtonElement;\n    const deleteSelectedBtn = container.querySelector('.delete-selected-btn') as HTMLButtonElement;\n    const deleteStickerGrid = container.querySelector('#delete-sticker-grid') as HTMLElement;\n\n    // \n    tabButtons.forEach(button => {\n      button.addEventListener('click', () => {\n        const targetTab = button.dataset.tab;\n\n        // \n        tabButtons.forEach(btn => btn.classList.remove('active'));\n        tabContents.forEach(content => content.classList.remove('active'));\n\n        // \n        button.classList.add('active');\n        const targetContent = container.querySelector(`.tab-content[data-tab=\"${targetTab}\"]`);\n        if (targetContent) {\n          targetContent.classList.add('active');\n        }\n\n        // \n        if (targetTab === 'delete-manage') {\n          renderDeleteStickerList();\n        }\n      });\n    });\n\n    // URL\n    urlInput.addEventListener('input', () => {\n      if (urlInput.value.trim()) {\n        previewImg.src = urlInput.value.trim();\n        previewImg.style.display = 'block';\n      } else {\n        previewImg.style.display = 'none';\n      }\n    });\n\n    // \n    addStickerBtn.addEventListener('click', () => {\n      const label = labelInput.value.trim();\n      const url = urlInput.value.trim();\n\n      if (!label || !url) {\n        alert('URL');\n        return;\n      }\n\n      const GLOBAL_STICKER_STORAGE_KEY = 'blmx_wechat_stickers_global_blmx';\n      const existingStickers = SafeStorage.getItem<any[]>(GLOBAL_STICKER_STORAGE_KEY, []) || [];\n\n      const newSticker = { label, url };\n      existingStickers.push(newSticker);\n\n      SafeStorage.setItem(GLOBAL_STICKER_STORAGE_KEY, existingStickers);\n      alert('');\n\n      // \n      labelInput.value = '';\n      urlInput.value = '';\n      previewImg.style.display = 'none';\n\n      // \n      this.renderStickerFeatures();\n    });\n\n    // \n    batchAddBtn.addEventListener('click', () => {\n      const input = batchTextarea.value.trim();\n      if (!input) {\n        alert('');\n        return;\n      }\n\n      const GLOBAL_STICKER_STORAGE_KEY = 'blmx_wechat_stickers_global_blmx';\n      const pairs = input.split(',');\n      const newStickers = [];\n\n      for (const pair of pairs) {\n        // URL - httphttps\n        const urlStartIndex = pair.indexOf('http');\n\n        if (urlStartIndex > 0) {\n          const label = pair.substring(0, urlStartIndex).trim();\n          const url = pair.substring(urlStartIndex).trim();\n\n          if (label && url) {\n            newStickers.push({ label, url });\n          }\n        } else if (pair.includes('=')) {\n          // label=url\n          const [label, url] = pair.split('=').map(part => part.trim());\n          if (label && url) {\n            newStickers.push({ label, url });\n          }\n        }\n      }\n\n      if (newStickers.length > 0) {\n        const existingStickers = SafeStorage.getItem<any[]>(GLOBAL_STICKER_STORAGE_KEY, []) || [];\n        const updatedStickers = [...existingStickers, ...newStickers];\n        SafeStorage.setItem(GLOBAL_STICKER_STORAGE_KEY, updatedStickers);\n        alert(`${newStickers.length} `);\n        batchTextarea.value = '';\n\n        // \n        this.renderStickerFeatures();\n      } else {\n        alert('');\n      }\n    });\n\n    // \n    const renderDeleteStickerList = () => {\n      const GLOBAL_STICKER_STORAGE_KEY = 'blmx_wechat_stickers_global_blmx';\n      const stickers = SafeStorage.getItem<any[]>(GLOBAL_STICKER_STORAGE_KEY, []) || [];\n\n      deleteStickerGrid.innerHTML = '';\n\n      if (stickers.length === 0) {\n        const noStickersMsg = document.createElement('div');\n        noStickersMsg.textContent = '\"\"';\n        noStickersMsg.className = 'no-stickers-msg';\n        deleteStickerGrid.appendChild(noStickersMsg);\n        return;\n      }\n\n      stickers.forEach((sticker: any, index: number) => {\n        const stickerItem = document.createElement('div');\n        stickerItem.className = 'sticker-item';\n\n        // checkbox\n        const checkbox = document.createElement('input');\n        checkbox.type = 'checkbox';\n        checkbox.className = 'sticker-checkbox';\n        checkbox.dataset.index = index.toString();\n\n        // checkbox\n        const checkboxButton = document.createElement('div');\n        checkboxButton.className = 'sticker-checkbox-button';\n\n        // \n        const stickerImg = document.createElement('img');\n        stickerImg.src = sticker.url;\n        stickerImg.alt = sticker.label;\n        stickerImg.className = 'sticker-preview';\n\n        const stickerLabel = document.createElement('div');\n        stickerLabel.className = 'sticker-label';\n        stickerLabel.textContent = sticker.label;\n\n        // checkbox\n        const updateCheckboxState = (checked: boolean) => {\n          if (checked) {\n            checkboxButton.classList.add('checked');\n          } else {\n            checkboxButton.classList.remove('checked');\n          }\n        };\n\n        // \n        const handleClick = (e: Event) => {\n          e.preventDefault();\n          e.stopPropagation();\n          checkbox.checked = !checkbox.checked;\n          updateCheckboxState(checkbox.checked);\n        };\n\n        stickerItem.addEventListener('click', handleClick);\n        checkboxButton.addEventListener('click', handleClick);\n\n        // \n        stickerItem.appendChild(checkbox);\n        stickerItem.appendChild(checkboxButton);\n        stickerItem.appendChild(stickerImg);\n        stickerItem.appendChild(stickerLabel);\n\n        deleteStickerGrid.appendChild(stickerItem);\n\n        // \n        updateCheckboxState(checkbox.checked);\n      });\n    };\n\n    // \n    selectAllBtn.addEventListener('click', () => {\n      const checkboxes = deleteStickerGrid.querySelectorAll('.sticker-checkbox') as NodeListOf<HTMLInputElement>;\n      const checkboxButtons = deleteStickerGrid.querySelectorAll('.sticker-checkbox-button');\n\n      checkboxes.forEach((checkbox, index) => {\n        checkbox.checked = true;\n        checkboxButtons[index]?.classList.add('checked');\n      });\n    });\n\n    // \n    deselectAllBtn.addEventListener('click', () => {\n      const checkboxes = deleteStickerGrid.querySelectorAll('.sticker-checkbox') as NodeListOf<HTMLInputElement>;\n      const checkboxButtons = deleteStickerGrid.querySelectorAll('.sticker-checkbox-button');\n\n      checkboxes.forEach((checkbox, index) => {\n        checkbox.checked = false;\n        checkboxButtons[index]?.classList.remove('checked');\n      });\n    });\n\n    // \n    deleteSelectedBtn.addEventListener('click', () => {\n      const checkboxes = deleteStickerGrid.querySelectorAll(\n        '.sticker-checkbox:checked',\n      ) as NodeListOf<HTMLInputElement>;\n\n      if (checkboxes.length === 0) {\n        alert('');\n        return;\n      }\n\n      if (confirm(` ${checkboxes.length} `)) {\n        const GLOBAL_STICKER_STORAGE_KEY = 'blmx_wechat_stickers_global_blmx';\n        const stickers = SafeStorage.getItem<any[]>(GLOBAL_STICKER_STORAGE_KEY, []) || [];\n\n        // \n        const indicesToDelete = (window as any)._.chain(checkboxes)\n          .map((checkbox: HTMLInputElement) => parseInt(checkbox.dataset.index!))\n          .sortBy()\n          .reverse()\n          .value();\n\n        // \n        indicesToDelete.forEach((index: number) => {\n          stickers.splice(index, 1);\n        });\n\n        SafeStorage.setItem(GLOBAL_STICKER_STORAGE_KEY, stickers);\n        alert(` ${checkboxes.length} `);\n\n        // \n        renderDeleteStickerList();\n\n        // \n        this.renderStickerFeatures();\n      }\n    });\n\n    // \n    closeBtn.addEventListener('click', () => {\n      document.body.removeChild(modal);\n    });\n\n    // \n    modal.addEventListener('click', e => {\n      if (e.target === modal) {\n        document.body.removeChild(modal);\n      }\n    });\n\n    modal.appendChild(container);\n    document.body.appendChild(modal);\n  }\n}\n"],"names":["LogLevel","DialogManager","static","activeDialog","activeOverlay","getInstance","instance","escapeHtml","text","$","html","safeShowDialog","dialogFunction","this","forceCleanupDialogs","createBaseDialogElements","dialogClass","addClass","appendDialogToPage","$phoneScreen","length","append","initializeCheckboxButtons","find","each","_","button","$button","$checkbox","checkbox","updateCheckboxButtonState","checked","on","e","preventDefault","stopPropagation","disabled","changeEvent","Event","bubbles","dispatchEvent","attr","role","tabindex","toString","toggleClass","alert","message","title","confirmText","showDialog","type","confirm","cancelText","prompt","defaultValue","inputType","placeholder","inputValue","inputPlaceholder","showScrollableText","content","Promise","resolve","innerHTML","$copyBtn","$confirmBtn","handleCancel","closeDialog","async","navigator","clipboard","writeText","originalText","setTimeout","error","console","$textElement","range","document","createRange","selectNodeContents","selection","window","getSelection","removeAllRanges","addRange","key","off","options","overlay","dialog","createDialogElements","$inputEl","trigger","confirmButton","querySelector","addEventListener","inputEl","value","undefined","cancelButton","target","handleKeyDown","removeEventListener","$overlay","$dialog","className","$header","$title","$body","$message","$inputContainer","$input","val","$footer","$cancelButton","$confirmButton","showCommentDialog","$cancelBtn","$likeBtn","$commentText","handleComment","css","ctrlKey","appendChild","showTransferDialog","$amountInput","$noteInput","handleConfirm","amount","note","parseFloat","toFixed","showRedPacketDialog","showGiftDialog","cancelBtn","confirmBtn","nameInput","priceInput","name","trim","price","showInputDialog","label","$inputField","showVoiceDialog","textArea","durationInput","durationStr","duration","parseInt","isNaN","showReceiveDialog","data","isGift","icon","rejectBtn","acceptBtn","handleAccept","showMomentDialog","defaultTime","currentDate","currentGameDate","Date","defaultDateTime","getFullYear","getMonth","padStart","getDate","getHours","getMinutes","imageTypeRadios","querySelectorAll","imageContentLabel","imageContentInput","urlDescGroup","forEach","radio","isDesc","textContent","style","display","imageTypeInput","imageContentField","imageDescField","datetimeInput","imageContent","imageType","imageDesc","datetime","datetimeMatch","match","image","image_type","image_desc","date","time","$textArea","showTimeJumpDialog","descriptionInput","description","$timeInput","$container","selector","element","remove","warn","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","d","definition","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","DebugLogger","isDevelopment","logLevel","logHistory","maxHistorySize","checkDevelopmentMode","DEBUG","ERROR","BLMX_DEV_MODE","localStorage","getItem","location","hostname","search","includes","setLogLevel","level","setDevelopmentMode","enabled","setItem","removeItem","addToHistory","push","timestamp","shift","formatMessage","toISOString","substr","debug","log","info","INFO","WARN","timeStart","timeEnd","groupStart","group","groupEnd","getHistory","filterModule","filterLevel","filtered","filter","clearHistory","exportHistory","JSON","stringify","showDebugPanel","slice","levelIcon","getStatus","historyCount","logger","blmxLogger","EventManager","listeners","timers","Set","intervals","isDestroyed","addGlobalListener","event","handler","cleanup","eventOn","addDOMListener","callback","delay","timerId","delete","add","setInterval","interval","intervalId","clearTimeout","has","clearInterval","clear","listenersCount","timersCount","size","intervalsCount","isDestroyed_","globalEventManager","getTavernHelper","parent","TavernHelper","BLMX_Protocol","logEntries","messageId","charId","LOG_START_TAG","LOG_END_TAG","constructor","getCharId","initialize","lastMessageId","getLastMessageId","persistLogToStorage","latestUiMessage","previousUiMessages","i","msg","getChatMessages","id","consolidatedLogParts","latestLogStartIndex","indexOf","latestLogEndIndex","logPart","prevMsg","prevLogStartIndex","prevLogEndIndex","unshift","cleanedContent","substring","setChatMessage","refresh","finalLogString","join","_parseLogFromString","logString","_renderLogToString","existingMessage","existingContent","logStartIndex","logEndIndex","newLogBlock","fullText","split","line","separatorIndex","parse","now","String","newEntry","timeDate","getTime","timeElement","getElementById","timeString","recallData","senderToFind","sender","targetText","target_text","entryToRecall","reverse","normalizeText","replace","toLowerCase","voiceText","err","recalled","recalled_content","recalled_timestamp","recall_data","Math","random","voiceMatch","voiceData","stickerMatch","imageMatch","imgData","locationMatch","transferMatch","fileMatch","giftMatch","recallCommands","map","prefix","Boolean","addEntry","entry","some","existingEntry","entryData","existingData","target_post_id","isEqual","getContextForAI","safeJsonParse","jsonString","safeJsonStringify","SafeStorage","item","serialized","AiResponseManager","blmxManager","uiRenderer","eventHandler","momentsManager","eventManager","isGenerating","latestAiRawResponse","latestSentPrompt","rawAiResponse","fullPrompt","event_data","chat","promptLength","getIsGenerating","triggerAiResponse","_immediate","BLMX_PROCESSING_AI_RESPONSE","contextForAI","isNewForAI","setHasPendingNotifications","MAX_RETRIES","attempt","success","maxRetries","showGeneratingIndicator","stream","generate","user_input","should_stream","finalAiResponse","chunk","hideGeneratingIndicator","processedResponse","len","firstHalf","lines","uniqueLines","uniq","processAiResponse","showErrorMessage","refreshAllTimestamps","response","entriesForAnimation","hasNewCharMoments","responseLines","lineCount","valuePreview","valueLength","renderMomentsFeed","parsedMessageContent","parsedImageData","url","addStickerEntry","addJsonContentEntry","originalEntry","recallTimestamp","displayAiEntriesSequentially","hasClass","setLastMomentViewTimestamp","setMomentNotification","$errorDiv","entries","messageLikeTypes","entryIndex","findIndex","entryType","showTypingIndicator","messageText","calculateTypingDelay","hideTypingIndicator","renderEntry","entryToUpdate","recallEntryIndex","$elementToReplace","renderRecallNotice","getLatestAiRawResponse","getLatestSentPrompt","getRawAiResponse","getFullPrompt","parsedStickerContent","STORAGE_KEYS","ConfigManager","config","defaultGlobalStickers","avatars","user","char","names","charRemark","currentCharId","getConfig","setConfig","getDisplayName","updateAvatar","avatarType","newUrl","storageKey","updateCharRemark","newRemark","updateUserName","newName","findStickerUrlByName","customGlobalStickers","charStickers","oldGlobalStickers","oldCharStickers","globalStickers","s","loadFromStorage","charData","savedCharAvatar","getMomentNotificationState","setMomentNotificationState","getLastMomentViewTimestamp","lastView","getSavedCoverPhoto","setCoverPhoto","getSavedSignature","setSignature","signature","getSavedInputPlaceholder","setInputPlaceholder","getPhoneSize","savedSize","setPhoneSize","getFullscreenSize","max","min","setFullscreenSize","clampedSize","getStickerSize","setStickerSize","getLastNotifiedVersion","setLastNotifiedVersion","version","getCurrentDate","getCurrentTime","floor","debugData","status","InputHandler","configManager","onStageAndDisplayEntry","onUpdateFooterButtonsState","dialogManager","handleTransferAccept","result","acceptData","rejectData","handleGiftAction","receiptData","sendTextMessage","messageEntry","sendSticker","stickerName","stickerEntry","sendImage","imageData","imageEntry","sendVoiceMessage","voiceEntry","sendLocation","locationData","locationEntry","sendFile","fileData","fileEntry","sendTransfer","transferData","transferEntry","sendGift","giftData","giftEntry","handleFileUpload","file","startsWith","reader","FileReader","onload","readAsDataURL","handleImageUrl","URL","handleVoiceRecording","mediaDevices","getUserMedia","audio","getTracks","track","stop","handleLocationShare","geolocation","getCurrentPosition","position","latitude","longitude","coords","locationName","address","handleTransferSend","amountStr","handleGiftSend","giftName","giftImage","getStickerList","searchStickers","query","stickers","searchTerm","sticker","clearInput","inputElement","focusInput","focus","getInputText","setInputText","MomentsManager","hasMomentNotification","$momentsFeedList","isInMomentsView","empty","posts","momentPostLogIndices","reduce","index","logIndex","likes","comments","lastViewTimestamp","userInMomentsView","targetPostAbsoluteIndex","targetPost","likerName","l","originalLogIndex","keys","chain","values","post","fromUser","authorName","authorAvatar","$li","momentSequenceId","mediaHtml","interactionsHtml","c","displayTime","formatMomentTime","savedCoverPhoto","dateString","diffMs","diffMins","diffHours","diffDays","month","hasMomentNotifications","updateMomentNotificationIndicator","$optionsBtn","currentLogLength","onEnterMomentsView","savedSignature","createUserMoment","notifyMomentChange","_oldValue","newValue","momentEntry","notifyRecallViaMoments","recallEntry","ThemeEditor","themeManager","onThemeChanged","$modal","checkboxHandlers","Map","setupThemeSelector","themes","getThemes","theme","$themeButton","width","colors","primary","cursor","overflow","$previewEl","top","left","height","background","gradientStart","gradientEnd","$bubblePreview","$themBubble","bubbleThemBg","$meBubble","bubbleMeBg","$nameEl","displayName","color","switchTheme","addCustomThemeSelector","addCustomThemeEditButton","$settingsPanel","$editButton","padding","margin","transition","gap","$icon","$text","openThemeEditor","$themeOptions","after","customThemeData","getCustomThemeData","$customButton","gradient","$iconEl","customThemeJson","customTheme","primaryColor","updateCustomThemeButton","children","eq","last","currentTheme","getCurrentThemeWithAppliedValues","fillThemeEditor","setupCheckboxes","show","closeThemeEditor","hide","cleanupCheckboxes","$nameInput","$darkModeToggle","$singleColorIconsToggle","themeName","colorMappings","phoneFrame","light","ultraLight","deep","textPrimary","textSecondary","bubbleMeText","bubbleThemText","statusBarColor","dynamicIslandColor","borderColor","shadowColor","colorValue","convertToHex","isDarkMode","useSingleColorIcons","setupSingleCheckboxWithJQuery","checkboxId","buttonId","updateCheckboxState","handleClick","set","resetThemeEditor","blueTheme","blue","exportThemeAsJSON","getCurrentThemeFromEditor","wallpaperManager","getWallpaperManager","currentWallpapers","getCurrentWallpaper","home","settings","themeData","exportDate","wallpapers","blob","Blob","createObjectURL","fileName","$a","href","download","click","revokeObjectURL","importTheme","input","createElement","accept","files","endsWith","Error","validateThemeData","applyImportedTheme","readAsText","getValue","getChecked","createCustomTheme","appBgColor","settingsBgColor","settingsCardBgColor","statusBar","dynamicIsland","border","shadow","saveCustomTheme","params","r","g","b","shadowColorRgba","bubbleShadow","lightenDarkenColor","soft","headerBg","phoneFrameGradient","textColor","defaultWallpapers","col","amt","usePound","num","rgbMatch","rgbaMatch","requiredFields","field","requiredColors","applyImportedWallpapers","viewType","wallpaper","setWallpaper","APP_VERSION","THEMES","pink","white","dark","ThemeManager","checkVersion","savedThemeName","THEME_STORAGE_KEY","CUSTOM_THEME_STORAGE_KEY","WallpaperManager","applyTheme","savedVersion","VERSION_STORAGE_KEY","cleanOutdatedData","keysToPreserve","preservedData","getCurrentTheme","root","documentElement","computedStyle","getComputedStyle","actualValues","getPropertyValue","setCurrentThemeName","applyThemeDefaultWallpapers","setProperty","body","classList","lighterColor","darkerColor","shadowRGB","extractRgbComponents","gradientColors","phoneFrameStyle","head","statusLeft","statusRight","settingsView","backgroundColor","card","boxShadow","hexToRgba","oldDynamicStyles","hex","alpha","currentThemeName","builtInWallpapers","customWallpapers","loadCustomWallpapers","migrateOldWallpaperSettings","getAllWallpapers","getBuiltInWallpapers","getCustomWallpapers","addCustomWallpaper","newWallpaper","saveCustomWallpapers","deleteCustomWallpaper","initialLength","w","THEME_WALLPAPER_KEY_PREFIX","themeStorageKey","savedThemeWallpaper","oldStorageKey","WALLPAPER_STORAGE_KEY_PREFIX","savedOldWallpaper","applyWallpaperToElement","defaultThemeWallpaper","backgroundImage","backgroundSize","backgroundPosition","backgroundRepeat","createWallpaperFromUrl","toLocaleString","createWallpaperFromFile","onerror","createSolidColorWallpaper","normalizedColor","savedWallpapers","CUSTOM_WALLPAPERS_KEY","UIManager","onAddEntry","onRenderEntry","displayAppVersion","checkVersionUpdateNotification","showVersionUpdateNotification","updateEntry","isSystemMessage","updateFooterButtonsState","hasNotifications","$wechatInput","$sendBtn","$plusBtn","hasText","shouldShowSendBtn","togglePanel","panelToShow","$panelContainer","$currentActivePanel","isActive","removeClass","navigateTo","viewName","wechat","moments","setupInputPlaceholder","charDisplayName","savedPlaceholder","$inputElement","setupPhoneSizeAdjustment","defaultBtn","mediumBtn","smallBtn","phoneScreen","applyPhoneSize","setupStickerSizeControl","sizeSlider","sizeInput","smallSizeBtn","mediumSizeBtn","applyStickerSize","newSize","updateStickerSizeButtonState","newSizeStr","buttons","default","medium","small","btn","scrollToBottom","wechatBody","scrollTop","scrollHeight","setupFontSelection","$customFontBtn","$systemFontBtn","savedFont","applyFontSetting","fontType","$customBtn","$systemBtn","applyCustomFont","applySystemFont","isIOSWebView","test","userAgent","isHuaweiWebView","fontStack","checkFontLoaded","then","loaded","loadCustomFont","catch","fontFamily","fonts","ready","fontFace","Array","from","font","family","reject","testElement","fontSize","visibility","appendTo","FontFace","load","loadedFace","setupFullscreenSizeAdjustment","$defaultBtn","$largeBtn","$xlargeBtn","$slider","initializeFullscreenSizeControls","applyFullscreenSize","updateFullscreenSizeButtonState","setupFullscreenListener","handleFullscreenChange","fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement","currentSize","applyBrowserLikeZoom","resetBrowserZoom","transform","transformOrigin","scale","UIRenderer","lastDisplayedTimeInMinutes","Infinity","renderQueue","isRendering","renderThrottle","wechatBodySelector","$wechatBody","startRenderLoop","processQueue","splice","queueRender","clearChat","animate","renderSystemMessage","addMessageToWeChat","addTimestampToWeChat","addEventLogToWeChat","elementToReplace","who","noticeRow","dataset","recalledText","noticeTextEl","contentEl","toggle","replaceWith","momentsFeedList","li","postId","momentId","formatMomentTimestamp","deleteBtnHtml","indicator","avatarSrc","loadingContainer","messageContent","totalDelay","isNewMessage","messageRow","senderClass","avatarImgHtml","renderVoiceMessage","bubbleContent","renderStickerContent","renderImageContent","renderLocationContent","renderTransferContent","renderFileContent","renderRedEnvelopeContent","renderGiftContent","bubbleClass","bubble","applyBubbleStyles","setupBubbleInteractions","setupUserMessageLongPress","contentContainer","textRevealBox","insertAdjacentHTML","longPressFired","pressTimer","pointerType","contains","stickerUrl","imageUrl","storedImage","sessionStorage","descText","isReceipt","detailsHtml","detailsClass","detailsContent","cardClass","bubbleTypeMap","transfer","gift","transferCard","onTransferAccept","once","giftBubble","giftCard","onGiftAction","isSystemTime","timeText","timeInMinutes","parseTimeToMinutes","t","originalDate","originalTime","eventData","row","timeEl","descEl","chatContainer","systemRow","systemContainer","systemText","postDate","postYear","postMonth","postDay","nowYear","nowMonth","nowDay","yesterday","setDate","yesterdayYear","yesterdayMonth","yesterdayDay","timestampRows","eventLogRows","$row","$timestampText","$eventTimeText","renderFeatureGrid","gridElement","features","callbacks","isDeleteMode","feature","iconHtml","isAddBtn","iconContainer","isDefault","onAddStickers","onToggleDeleteMode","action","stickerLabel","checkboxButton","$messageRow","$messageBubble","$targetElement","addLongPressListener","handleLongPressRecall","setupDoubleClickRecall","timer","startX","startY","onEnd","clientX","clientY","moveX","moveY","abs","isMessageInQueue","handleUserMessageRecall","effect","times","distance","onRecallMessage","clickTimer","clickCount","vibrate","handleDoubleClickRecall","WallpaperSelector","showWallpaperSelector","onApplyWallpaper","modal","cssText","container","tabs","createTabs","createBuiltinWallpaperTab","createSolidColorTab","createCustomWallpaperTab","createUploadTab","createBottomButtons","createTab","tab","tabId","fontWeight","borderBottom","builtinContent","builtinWallpapers","builtinGrid","wallpaperItem","createWallpaperItem","solidContent","solidWallpapers","solidGrid","addColorPicker","customContent","noCustomWallpapers","customGrid","uploadContent","createLocalUploadSection","createUrlUploadSection","colorPickerContainer","colorPickerLabel","colorPicker","colorNameInput","addColorBtn","removeChild","localUploadSection","localUploadTitle","fileInput","uploadBtn","urlUploadSection","urlUploadTitle","urlInput","addUrlBtn","showDeleteButton","preview","deleteBtn","currentWallpaper","parentElement","buttonsContainer","resetBtn","closeBtn","WallpaperController","wallpaperSelector","applyWallpapers","$chatView","$homeScreen","$settingsView","chatWallpaper","homeWallpaper","settingsWallpaper","changeWallpaper","initializeWallpapers","AppController","wallpaperController","aiResponseManager","themeEditor","inputHandler","uiManager","userMessageQueue","getCharData","charAvatarPath","getCharAvatarPath","addBatch","requestAnimationFrame","loadDebugData","EventHandler","EventHandlerClass","bind","stageAndDisplayEntry","renderChatHistory","handleMessageRecall","setUIRenderer","queueIndex","actualIndex","globalIndex","immediate","hasQueuedMessages","views","wechatHome","jQuery","$targetView","currentUrl","showUserProfileDialog","currentAvatarUrl","currentSignature","dialogHtml","newAvatarUrl","newSignature","hasChanges","oldDisplayName","newDisplayName","oldName","updateCoverPhoto","currentCover","newCover","removeFromUserMessageQueue","queueEntry","targetEntry","setupThemeEditorEvents","addTestEntry","clearDebugData","showTestEntryTypes","showDebugInfo","appController","StyleManager","loadedStyles","initializeStyles","isStyleLoaded","styleName","toggleTheme","setCSSVariable","getCSSVariable","setCSSVariables","variables","resetCSSVariables","propertiesToRemove","property","removeProperty","addStyleClass","removeStyleClass","toggleStyleClass","hasStyleClass","stylesLoaded","styleManager","initWechatHome","sectionMap","conv","contacts","discover","me","activate","setupTabs","avatarUrl","fillProfile","defaultAvatar","conversations","avatar","lastMessage","unread","$list","arr","fn","renderConversations","desc","contact","renderContacts","wechatInput","sendBtn","plusBtn","hasPendingNotifications","inputSelector","sendBtnSelector","plusBtnSelector","setupEventListeners","updateGameTime","$timeElement","formattedTime","deleteByLogIndex","indexToDelete","previewText","mainLogLength","deleteByMessageId","promptForDateTime","defaultText","dateTimeInput","newDate","newTime","parsedDate","dateTimeResult","renderStickerFeatures","renderPlusFeatures","shiftKey","setupClickListeners","currentPlaceholder","newPlaceholder","wechatView","momentData","momentDateTime","timeAdvanceEvent","postEl","closest","actualMomentIndex","indicesToDelete","sort","a","likeEntry","commentEntry","matches","$targetRow","exitFullscreen","requestFullscreen","$plusGrid","PLUS_FEATURES","timeJumpData","newGameDate","loc","$stickerGrid","customStickers","ds","showStickerManager","tabButtons","tabContents","labelInput","previewImg","addStickerBtn","batchTextarea","batchAddBtn","selectAllBtn","deselectAllBtn","deleteSelectedBtn","deleteStickerGrid","targetTab","targetContent","renderDeleteStickerList","src","GLOBAL_STICKER_STORAGE_KEY","existingStickers","newSticker","pairs","newStickers","pair","urlStartIndex","part","updatedStickers","noStickersMsg","stickerItem","stickerImg","alt","checkboxes","checkboxButtons","sortBy","blmxApp","blmxStyleManager"],"sourceRoot":""}