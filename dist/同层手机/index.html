<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/><title>æš´åŠ›ç¾å­¦BLMXåŒå±‚æ‰‹æœº</title><script type="module">var e,t={929:(e,t,a)=>{a.d(t,{DialogManager:()=>n});class n{static instance;activeDialog=null;activeOverlay=null;constructor(){}static getInstance(){return n.instance||(n.instance=new n),n.instance}escapeHtml(e){return $('<div>').text(e).html()}async safeShowDialog(e){return this.forceCleanupDialogs(),await e()}createBaseDialogElements(e){this.activeOverlay=$('<div>').addClass('dialog-overlay mobile-dialog-overlay')[0],this.activeDialog=$('<div>').addClass(`dialog ${e} mobile-dialog`)[0]}appendDialogToPage(){if(!this.activeOverlay)return;const e=$('.phone-screen');e.length?e.append(this.activeOverlay):$('body').append(this.activeOverlay)}initializeCheckboxButtons(){this.activeDialog&&$(this.activeDialog).find('.checkbox-button').each((_,e)=>{const t=$(e),a=t.find('input[type="checkbox"]');if(!a.length)return;const n=a[0];this.updateCheckboxButtonState(e,n.checked),t.on('click',t=>{if(t.preventDefault(),t.stopPropagation(),n.disabled)return;n.checked=!n.checked,this.updateCheckboxButtonState(e,n.checked);const a=new Event('change',{bubbles:!0});n.dispatchEvent(a)}),a.on('change',()=>{this.updateCheckboxButtonState(e,n.checked)}),t.attr({role:'checkbox',tabindex:'0','aria-checked':n.checked.toString()})})}updateCheckboxButtonState(e,t){const a=$(e);a.toggleClass('checked',t),a.attr('aria-checked',t.toString())}alert(e,t='æç¤º',a='ç¡®å®š'){return this.safeShowDialog(()=>this.showDialog({type:'alert',title:t,message:e,confirmText:a}))}confirm(e,t='ç¡®è®¤',a='ç¡®å®š',n='å–æ¶ˆ'){return this.safeShowDialog(()=>this.showDialog({type:'confirm',title:t,message:e,confirmText:a,cancelText:n}))}prompt(e,t='',a='è¯·è¾“å…¥',n='ç¡®å®š',o='å–æ¶ˆ',s='text',i=''){return this.safeShowDialog(()=>this.showDialog({type:'prompt',title:a,message:e,confirmText:n,cancelText:o,inputType:s,inputValue:t,inputPlaceholder:i}))}showScrollableText(e,t='å†…å®¹',a='å…³é—­'){return this.safeShowDialog(()=>new Promise(n=>{this.createBaseDialogElements('scrollable-text-dialog'),this.activeDialog.innerHTML=`\n          <div class="dialog-header">\n            <h3>${t}</h3>\n          </div>\n          <div class="dialog-body scrollable-content">\n            <pre class="scrollable-text">${this.escapeHtml(e)}</pre>\n          </div>\n          <div class="dialog-footer">\n            <button class="dialog-button copy-btn">å¤åˆ¶</button>\n            <button class="dialog-button primary-button">${a}</button>\n          </div>\n        `;const o=$(this.activeDialog).find('.copy-btn'),s=$(this.activeDialog).find('.primary-button'),i=()=>{this.closeDialog(),n()};o.on('click',async()=>{try{await navigator.clipboard.writeText(e);const t=o.text();o.text('å·²å¤åˆ¶'),setTimeout(()=>{o.text(t)},1e3)}catch(e){console.error('å¤åˆ¶å¤±è´¥:',e);const t=$(this.activeDialog).find('.scrollable-text');if(t.length){const e=document.createRange();e.selectNodeContents(t[0]);const a=window.getSelection();a&&(a.removeAllRanges(),a.addRange(e))}}}),s.on('click',()=>{this.closeDialog(),n()}),$(document).on('keydown.dialog',e=>{'Escape'===e.key&&(i(),$(document).off('keydown.dialog'))}),$(this.activeOverlay).append(this.activeDialog),this.appendDialogToPage()}))}showDialog(e){const{overlay:t,dialog:a}=this.createDialogElements(e);if(this.activeOverlay=t,this.activeDialog=a,this.appendDialogToPage(),'prompt'===e.type){const e=$(a).find('input, textarea');e.length&&setTimeout(()=>e.trigger('focus'),100)}return new Promise(n=>{const o=a.querySelector('.primary-button');o&&o.addEventListener('click',()=>{if('prompt'===e.type){const e=a.querySelector('input, textarea'),t=e?e.value:null;this.closeDialog(),n(t)}else this.closeDialog(),n('confirm'===e.type||void 0)});const s=a.querySelector('.cancel-button');s&&s.addEventListener('click',()=>{this.closeDialog(),n('prompt'===e.type&&null)}),'alert'===e.type&&t.addEventListener('click',e=>{e.target===t&&(this.closeDialog(),n(void 0))});const i=t=>{if('Enter'===t.key){if(t.preventDefault(),'prompt'===e.type){const e=a.querySelector('input, textarea'),t=e?e.value:null;this.closeDialog(),n(t)}else'confirm'===e.type?(this.closeDialog(),n(!0)):(this.closeDialog(),n(void 0));document.removeEventListener('keydown',i)}else'Escape'===t.key&&(t.preventDefault(),this.closeDialog(),n('prompt'===e.type&&null),document.removeEventListener('keydown',i))};document.addEventListener('keydown',i)})}createDialogElements(e){const t=$('<div>').addClass('custom-dialog-overlay'),a=$('<div>').addClass(`custom-dialog ${e.className||''}`),n=$('<div>').addClass('dialog-header'),o=$('<h3>').addClass('dialog-title').text(e.title||'');n.append(o),a.append(n);const s=$('<div>').addClass('dialog-body'),i=$('<div>').text(e.message);if(s.append(i),'prompt'===e.type){const t=$('<div>').addClass('dialog-input-container'),a=$('textarea'===e.inputType?'<textarea>':'<input>');'textarea'!==e.inputType&&a.attr('type',e.inputType||'text'),e.inputValue&&a.val(e.inputValue),e.inputPlaceholder&&a.attr('placeholder',e.inputPlaceholder),t.append(a),s.append(t)}a.append(s);const r=$('<div>').addClass('dialog-footer');if('confirm'===e.type||'prompt'===e.type){const t=$('<button>').addClass('dialog-button cancel-button').text(e.cancelText||'å–æ¶ˆ');r.append(t)}const l=$('<button>').addClass('dialog-button primary-button').text(e.confirmText||'ç¡®å®š');return r.append(l),a.append(r),t.append(a),{overlay:t[0],dialog:a[0]}}showCommentDialog(){return this.safeShowDialog(()=>new Promise(e=>{this.createBaseDialogElements('comment-dialog'),this.activeDialog.innerHTML='\n        <div class="dialog-header">\n          <h3>äº’åŠ¨</h3>\n        </div>\n        <div class="dialog-body">\n          <div class="form-group">\n            <label for="comment-text">è¯„è®ºå†…å®¹</label>\n            <textarea id="comment-text" placeholder="è¯´ç‚¹ä»€ä¹ˆ..." rows="3"></textarea>\n          </div>\n        </div>\n        <div class="dialog-footer">\n          <button class="dialog-button cancel-btn">å–æ¶ˆ</button>\n          <button class="dialog-button like-btn">ç‚¹èµ</button>\n          <button class="dialog-button confirm-btn">å‘é€</button>\n        </div>\n      ';const t=$(this.activeDialog),a=t.find('.cancel-btn'),n=t.find('.like-btn'),o=t.find('.confirm-btn'),s=t.find('#comment-text'),i=()=>{this.closeDialog(),e(null)},r=()=>{const t=s.val();if(!t)return s.css('borderColor','#ff4444'),s.attr('placeholder','è¯·è¾“å…¥è¯„è®ºå†…å®¹'),void s.trigger('focus');this.closeDialog(),e({type:'comment',content:t})};a.on('click',i),n.on('click',()=>{this.closeDialog(),e({type:'like'})}),o.on('click',r);const l=e=>{'Enter'===e.key&&e.ctrlKey?(e.preventDefault(),r()):'Escape'===e.key&&(i(),document.removeEventListener('keydown',l))};document.addEventListener('keydown',l),this.activeOverlay.appendChild(this.activeDialog),this.appendDialogToPage(),setTimeout(()=>{s.trigger('focus')},100)}))}showTransferDialog(){return this.safeShowDialog(()=>new Promise(e=>{this.createBaseDialogElements('transfer-dialog'),this.activeDialog.innerHTML='\n        <div class="dialog-header">\n          <h3>è½¬è´¦</h3>\n        </div>\n        <div class="dialog-body">\n          <div class="form-group">\n            <label for="transfer-amount">è½¬è´¦é‡‘é¢ *</label>\n            <input type="number" id="transfer-amount" placeholder="è¯·è¾“å…¥è½¬è´¦é‡‘é¢" step="0.01" min="0.01">\n          </div>\n          <div class="form-group">\n            <label for="transfer-note">è½¬è´¦å¤‡æ³¨</label>\n            <input type="text" id="transfer-note" placeholder="è¯·è¾“å…¥è½¬è´¦å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰">\n          </div>\n        </div>\n        <div class="dialog-footer">\n          <button class="dialog-button cancel-btn">å–æ¶ˆ</button>\n          <button class="dialog-button confirm-btn">ç¡®è®¤è½¬è´¦</button>\n        </div>\n      ';const t=$(this.activeDialog),a=t.find('.cancel-btn'),n=t.find('.confirm-btn'),o=t.find('#transfer-amount'),s=t.find('#transfer-note'),i=()=>{this.closeDialog(),e(null)},r=()=>{const t=o.val(),a=s.val();if(!t||parseFloat(t)<=0)return o.css('borderColor','#ff4444'),o.attr('placeholder','è¯·è¾“å…¥æœ‰æ•ˆçš„è½¬è´¦é‡‘é¢'),void o.trigger('focus');this.closeDialog(),e({amount:parseFloat(t).toFixed(2),note:a||''})};a.on('click',i),n.on('click',r),$(document).on('keydown.transfer-dialog',e=>{'Enter'===e.key?r():'Escape'===e.key&&(i(),$(document).off('keydown.transfer-dialog'))}),$(this.activeOverlay).append(this.activeDialog),this.appendDialogToPage(),setTimeout(()=>{o.trigger('focus')},100)}))}showRedPacketDialog(){return this.safeShowDialog(()=>new Promise(e=>{this.createBaseDialogElements('red-packet-dialog'),this.activeDialog.innerHTML='\n        <div class="dialog-header">\n          <h3>ğŸ§§ å‘é€çº¢åŒ…</h3>\n        </div>\n        <div class="dialog-body">\n          <div class="form-group">\n            <label for="red-packet-amount">çº¢åŒ…é‡‘é¢ *</label>\n            <input type="number" id="red-packet-amount" placeholder="è¯·è¾“å…¥çº¢åŒ…é‡‘é¢" step="0.01" min="0.01">\n          </div>\n          <div class="form-group">\n            <label for="red-packet-note">çº¢åŒ…ç¥ç¦è¯­</label>\n            <input type="text" id="red-packet-note" placeholder="æ­å–œå‘è´¢ï¼Œå¤§å‰å¤§åˆ©ï¼" value="æ­å–œå‘è´¢ï¼Œå¤§å‰å¤§åˆ©ï¼">\n          </div>\n        </div>\n        <div class="dialog-footer">\n          <button class="dialog-button cancel-btn">å–æ¶ˆ</button>\n          <button class="dialog-button confirm-btn">å‘é€çº¢åŒ…</button>\n        </div>\n      ';const t=$(this.activeDialog),a=t.find('.cancel-btn'),n=t.find('.confirm-btn'),o=t.find('#red-packet-amount'),s=t.find('#red-packet-note'),i=()=>{this.closeDialog(),e(null)},r=()=>{const t=o.val(),a=s.val();if(!t||parseFloat(t)<=0)return o.css('borderColor','#ff4444'),o.attr('placeholder','è¯·è¾“å…¥æœ‰æ•ˆçš„çº¢åŒ…é‡‘é¢'),void o.trigger('focus');this.closeDialog(),e({amount:parseFloat(t).toFixed(2),note:a||'æ­å–œå‘è´¢ï¼Œå¤§å‰å¤§åˆ©ï¼'})};a.on('click',i),n.on('click',r),$(document).on('keydown.red-packet-dialog',e=>{'Enter'===e.key?r():'Escape'===e.key&&(i(),$(document).off('keydown.red-packet-dialog'))}),$(this.activeOverlay).append(this.activeDialog),this.appendDialogToPage(),setTimeout(()=>{o.trigger('focus')},100)}))}showGiftDialog(){return this.safeShowDialog(()=>new Promise(e=>{this.createBaseDialogElements('gift-dialog'),this.activeDialog.innerHTML='\n        <div class="dialog-header">\n          <h3>ğŸ å‘é€ç¤¼ç‰©</h3>\n        </div>\n        <div class="dialog-body">\n          <div class="form-group">\n            <label for="gift-name">ç¤¼ç‰©åç§° *</label>\n            <input type="text" id="gift-name" placeholder="è¯·è¾“å…¥ç¤¼ç‰©åç§°">\n          </div>\n          <div class="form-group">\n            <label for="gift-price">ç¤¼ç‰©ä»·æ ¼</label>\n            <input type="number" id="gift-price" placeholder="è¯·è¾“å…¥ä»·æ ¼ï¼ˆå¯é€‰ï¼‰" step="0.01" min="0">\n          </div>\n        </div>\n        <div class="dialog-footer">\n          <button class="dialog-button cancel-btn">å–æ¶ˆ</button>\n          <button class="dialog-button confirm-btn">å‘é€ç¤¼ç‰©</button>\n        </div>\n      ';const t=this.activeDialog.querySelector('.cancel-btn'),a=this.activeDialog.querySelector('.confirm-btn'),n=this.activeDialog.querySelector('#gift-name'),o=this.activeDialog.querySelector('#gift-price'),s=()=>{this.closeDialog(),e(null)},i=()=>{const t=n.value.trim(),a=o.value.trim();if(!t)return $(n).css('borderColor','#ff4444'),$(n).attr('placeholder','è¯·è¾“å…¥ç¤¼ç‰©åç§°'),void $(n).trigger('focus');this.closeDialog(),e({name:t,price:a&&parseFloat(a)>0?parseFloat(a).toFixed(2):void 0})};t.addEventListener('click',s),a.addEventListener('click',i);const r=e=>{'Enter'===e.key?i():'Escape'===e.key&&(s(),document.removeEventListener('keydown',r))};document.addEventListener('keydown',r),this.activeOverlay.appendChild(this.activeDialog),this.appendDialogToPage(),setTimeout(()=>{$(n).trigger('focus')},100)}))}showInputDialog(e,t,a='',n='',o='text'){return this.safeShowDialog(()=>new Promise(s=>{this.createBaseDialogElements('input-dialog'),this.activeDialog.innerHTML=`\n            <div class="dialog-header">\n              <h3>${e}</h3>\n            </div>\n            <div class="dialog-body">\n              <div class="form-group">\n                <label for="input-field">${t}</label>\n                <input type="${o}" id="input-field" placeholder="${n}" value="${a}">\n              </div>\n            </div>\n            <div class="dialog-footer">\n              <button class="dialog-button cancel-btn">å–æ¶ˆ</button>\n              <button class="dialog-button confirm-btn">ç¡®å®š</button>\n            </div>\n          `;const i=$(this.activeDialog),r=i.find('.cancel-btn'),l=i.find('.confirm-btn'),c=i.find('#input-field'),d=()=>{this.closeDialog(),s(null)},g=()=>{const e=c.val();this.closeDialog(),s(e)};r.on('click',d),l.on('click',g);const p=e=>{'Enter'===e.key?g():'Escape'===e.key&&(d(),document.removeEventListener('keydown',p))};document.addEventListener('keydown',p),this.activeOverlay.appendChild(this.activeDialog),this.appendDialogToPage(),setTimeout(()=>{c.trigger('focus'),a&&c.trigger('select')},100)}))}showVoiceDialog(){return this.safeShowDialog(()=>new Promise(e=>{this.createBaseDialogElements('voice-dialog'),this.activeDialog.innerHTML='\n        <div class="dialog-header">\n          <h3>ğŸ¤ è¯­éŸ³æ¶ˆæ¯</h3>\n        </div>\n        <div class="dialog-body">\n          <div class="form-group">\n            <label for="voice-text">è¯­éŸ³å†…å®¹</label>\n            <textarea id="voice-text" placeholder="è¯·è¾“å…¥è¯­éŸ³å†…å®¹..." rows="3"></textarea>\n          </div>\n          <div class="form-group">\n            <label for="voice-duration">è¯­éŸ³æ—¶é•¿ï¼ˆç§’ï¼‰</label>\n            <input type="number" id="voice-duration" placeholder="è¯·è¾“å…¥ç§’æ•°" min="1" max="60" value="3">\n          </div>\n        </div>\n        <div class="dialog-footer">\n          <button class="dialog-button cancel-btn">å–æ¶ˆ</button>\n          <button class="dialog-button confirm-btn">å‘é€</button>\n        </div>\n      ';const t=this.activeDialog.querySelector('.cancel-btn'),a=this.activeDialog.querySelector('.confirm-btn'),n=this.activeDialog.querySelector('#voice-text'),o=this.activeDialog.querySelector('#voice-duration'),s=()=>{this.closeDialog(),e(null)},i=()=>{const t=n.value.trim(),a=o.value.trim();if(!t)return $(n).css('borderColor','#ff4444'),$(n).attr('placeholder','è¯·è¾“å…¥è¯­éŸ³å†…å®¹'),void $(n).trigger('focus');const s=parseInt(a,10);if(!a||isNaN(s)||s<=0||s>60)return $(o).css('borderColor','#ff4444'),$(o).attr('placeholder','è¯·è¾“å…¥æœ‰æ•ˆçš„è¯­éŸ³æ—¶é•¿ï¼ˆ1-60ç§’ï¼‰'),void $(o).trigger('focus');this.closeDialog(),e({text:t,duration:s})};t.addEventListener('click',s),a.addEventListener('click',i);const r=e=>{'Enter'===e.key&&e.ctrlKey?(e.preventDefault(),i()):'Escape'===e.key&&(s(),document.removeEventListener('keydown',r))};document.addEventListener('keydown',r),this.activeOverlay.appendChild(this.activeDialog),this.appendDialogToPage(),setTimeout(()=>{$(n).trigger('focus')},100)}))}showReceiveDialog(e,t){return this.safeShowDialog(()=>new Promise(a=>{this.createBaseDialogElements('receive-dialog');const n='gift'===e,o=n?'æ”¶åˆ°ç¤¼ç‰©':'æ”¶åˆ°è½¬è´¦',s=n?'ğŸ':'ğŸ’°';let i='';i=n?`\n          <div class="receive-content">\n            <div class="receive-icon">${s}</div>\n            <div class="receive-info">\n              <div class="receive-title">${t.name}</div>\n              ${t.price?`<div class="receive-price">Â¥${t.price}</div>`:''}\n              ${t.note?`<div class="receive-note">${t.note}</div>`:''}\n            </div>\n          </div>\n        `:`\n          <div class="receive-content">\n            <div class="receive-icon">${s}</div>\n            <div class="receive-info">\n              <div class="receive-title">è½¬è´¦é‡‘é¢</div>\n              <div class="receive-price">Â¥${t.amount}</div>\n              ${t.note?`<div class="receive-note">${t.note}</div>`:''}\n            </div>\n          </div>\n        `,this.activeDialog.innerHTML=`\n        <div class="dialog-header">\n          <h3>${o}</h3>\n        </div>\n        <div class="dialog-body">\n          ${i}\n        </div>\n        <div class="dialog-footer">\n          <button class="dialog-button reject-btn">æ‹’ç»</button>\n          <button class="dialog-button accept-btn">æ¥æ”¶</button>\n        </div>\n      `;const r=this.activeDialog.querySelector('.reject-btn'),l=this.activeDialog.querySelector('.accept-btn'),c=()=>{this.closeDialog(),a('accept')},d=()=>{this.closeDialog(),a(null)};r.addEventListener('click',()=>{this.closeDialog(),a('reject')}),l.addEventListener('click',c);const g=e=>{'Enter'===e.key?(e.preventDefault(),c()):'Escape'===e.key&&(d(),document.removeEventListener('keydown',g))};document.addEventListener('keydown',g),this.activeOverlay.appendChild(this.activeDialog),this.appendDialogToPage()}))}showMomentDialog(e){return this.safeShowDialog(()=>new Promise(t=>{const a=window.currentGameDate||new Date,n=e||`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,'0')}-${a.getDate().toString().padStart(2,'0')} ${a.getHours().toString().padStart(2,'0')}:${a.getMinutes().toString().padStart(2,'0')}`;this.createBaseDialogElements('moment-dialog'),this.activeDialog.innerHTML=`\n        <div class="dialog-header">\n          <h3>å‘å¸ƒæœ‹å‹åœˆ</h3>\n        </div>\n        <div class="dialog-body">\n          <div class="form-group">\n            <label for="moment-text">è¿™ä¸€åˆ»çš„æƒ³æ³•...</label>\n            <textarea id="moment-text" placeholder="åˆ†äº«ä½ çš„æƒ³æ³•..." rows="3"></textarea>\n          </div>\n\n          <div class="form-group">\n            <label>ğŸ“· å›¾ç‰‡ç±»å‹</label>\n            <div class="radio-group">\n              <label><input type="radio" name="image-type" value="desc" checked> å›¾ç‰‡æè¿°</label>\n              <label><input type="radio" name="image-type" value="url"> å›¾ç‰‡é“¾æ¥</label>\n            </div>\n          </div>\n\n          <div class="form-group">\n            <label for="image-content" id="image-content-label">å›¾ç‰‡æè¿°ï¼ˆå¯é€‰ï¼‰</label>\n            <input type="text" id="image-content" placeholder="è¯·è¾“å…¥å›¾ç‰‡æè¿°...ï¼ˆå¯é€‰ï¼‰">\n          </div>\n\n          <div class="form-group url-desc-group" style="display: none;">\n            <label for="image-desc">å›¾ç‰‡æè¿°ï¼ˆä¾›AIè¯†åˆ«ï¼Œå¯é€‰ï¼‰</label>\n            <input type="text" id="image-desc" placeholder="æè¿°å›¾ç‰‡å†…å®¹ï¼Œä»…ä¾›AIè¯†åˆ«...ï¼ˆå¯é€‰ï¼‰">\n          </div>\n\n          <div class="form-group">\n            <label for="moment-datetime">å‘å¸ƒæ—¶é—´</label>\n            <input type="text" id="moment-datetime" value="${n}" placeholder="YYYY-MM-DD HH:MM">\n          </div>\n        </div>\n        <div class="dialog-footer">\n          <button class="dialog-btn dialog-btn-cancel">å–æ¶ˆ</button>\n          <button class="dialog-btn dialog-btn-confirm">å‘å¸ƒ</button>\n        </div>\n      `;const o=this.activeDialog.querySelectorAll('input[name="image-type"]'),s=this.activeDialog.querySelector('#image-content-label'),i=this.activeDialog.querySelector('#image-content'),r=this.activeDialog.querySelector('.url-desc-group');this.initializeCheckboxButtons(),o.forEach(e=>{e.addEventListener('change',()=>{const t='desc'===e.value;s.textContent=t?'å›¾ç‰‡æè¿°ï¼ˆå¯é€‰ï¼‰':'å›¾ç‰‡é“¾æ¥ï¼ˆå¯é€‰ï¼‰',i.placeholder=t?'è¯·è¾“å…¥å›¾ç‰‡æè¿°...ï¼ˆå¯é€‰ï¼‰':'è¯·è¾“å…¥å›¾ç‰‡é“¾æ¥...ï¼ˆå¯é€‰ï¼‰',r.style.display=t?'none':'block'})});const l=this.activeDialog.querySelector('.dialog-btn-cancel'),c=this.activeDialog.querySelector('.dialog-btn-confirm'),d=()=>{this.closeDialog(),t(null)},g=()=>{if(!this.activeDialog)return;const e=this.activeDialog.querySelector('#moment-text'),a=this.activeDialog.querySelector('input[name="image-type"]:checked'),n=this.activeDialog.querySelector('#image-content'),o=this.activeDialog.querySelector('#image-desc'),s=this.activeDialog.querySelector('#moment-datetime');if(!e||!s)return;const i=e.value,r=n?n.value.trim():'',l=''!==r&&a?a.value:'none',c='url'===l&&o?o.value.trim():r,d=s.value;if(!(i&&''!==i.trim()||r&&''!==r.trim()))return $(e).css('borderColor','#ff4444'),$(e).attr('placeholder','è¯·è¾“å…¥æœ‹å‹åœˆå†…å®¹æˆ–æ·»åŠ å›¾ç‰‡'),void $(e).trigger('focus');const g=d.match(/^(\d{4}-\d{2}-\d{2})\s+(\d{2}:\d{2})$/);if(!g)return $(s).css('borderColor','#ff4444'),$(s).attr('placeholder','æ ¼å¼ï¼šYYYY-MM-DD HH:MM'),void $(s).trigger('focus');this.closeDialog(),t({text:i.trim(),image:r.trim(),image_type:l,image_desc:c.trim(),date:g[1],time:g[2]})};l.addEventListener('click',d),c.addEventListener('click',g);const p=e=>{'Enter'===e.key&&e.ctrlKey?(e.preventDefault(),g()):'Escape'===e.key&&(d(),document.removeEventListener('keydown',p))};document.addEventListener('keydown',p),this.activeOverlay.appendChild(this.activeDialog),this.appendDialogToPage(),setTimeout(()=>{if(this.activeDialog){const e=$(this.activeDialog).find('#moment-text');e.length&&e.trigger('focus')}},100)}))}showTimeJumpDialog(e){return this.safeShowDialog(()=>new Promise(t=>{const a=window.currentGameDate||new Date,n=e||`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,'0')}-${a.getDate().toString().padStart(2,'0')} ${a.getHours().toString().padStart(2,'0')}:${a.getMinutes().toString().padStart(2,'0')}`;this.createBaseDialogElements('time-jump-dialog'),this.activeDialog.innerHTML=`\n        <div class="dialog-header">\n          <h3>æ—¶é—´è·³è·ƒ</h3>\n        </div>\n        <div class="dialog-body">\n          <div class="form-group">\n            <label for="jump-datetime">è·³è·ƒåˆ°æ—¶é—´</label>\n            <input type="text" id="jump-datetime" value="${n}" placeholder="YYYY-MM-DD HH:MM">\n          </div>\n\n          <div class="form-group">\n            <label for="event-description">ğŸ“ è®°å½•è¿™æ®µæ—¶é—´å‘ç”Ÿäº†ä»€ä¹ˆ</label>\n            <textarea id="event-description" placeholder="æè¿°è¿™æ®µæ—¶é—´å‘ç”Ÿçš„äº‹æƒ…...ï¼ˆå¯é€‰ï¼‰" rows="3"></textarea>\n          </div>\n        </div>\n        <div class="dialog-footer">\n          <button class="dialog-btn dialog-btn-cancel">å–æ¶ˆ</button>\n          <button class="dialog-btn dialog-btn-confirm">è·³è·ƒ</button>\n        </div>\n      `,this.initializeCheckboxButtons();const o=this.activeDialog.querySelector('.dialog-btn-cancel'),s=this.activeDialog.querySelector('.dialog-btn-confirm'),i=()=>{this.closeDialog(),t(null)},r=()=>{if(!this.activeDialog)return;const e=this.activeDialog.querySelector('#jump-datetime'),a=this.activeDialog.querySelector('#event-description');if(!e)return;const n=e.value,o=a?a.value.trim():'',s=n.match(/^(\d{4}-\d{2}-\d{2})\s+(\d{2}:\d{2})$/);if(!s)return $(e).css('borderColor','#ff4444'),$(e).attr('placeholder','æ ¼å¼ï¼šYYYY-MM-DD HH:MM'),void $(e).trigger('focus');this.closeDialog(),t({date:s[1],time:s[2],description:o})};o.addEventListener('click',i),s.addEventListener('click',r);const l=e=>{this.activeDialog?'Enter'===e.key?(e.preventDefault(),r(),document.removeEventListener('keydown',l)):'Escape'===e.key&&(i(),document.removeEventListener('keydown',l)):document.removeEventListener('keydown',l)};document.addEventListener('keydown',l),this.activeOverlay.appendChild(this.activeDialog),this.appendDialogToPage(),setTimeout(()=>{if(this.activeDialog){const e=$(this.activeDialog).find('#jump-datetime');e.length&&(e.trigger('focus'),e.trigger('select'))}},100)}))}forceCleanupDialogs(){const e=$('.phone-screen').length?$('.phone-screen'):$('body');['[class*="dialog-overlay"]','[class*="dialog"]','.custom-dialog-overlay','.mobile-dialog-overlay','.custom-dialog','.mobile-dialog'].forEach(t=>{e.find(t).each((_,e)=>{try{$(e).remove()}catch(e){console.warn('ç§»é™¤å¯¹è¯æ¡†å…ƒç´ æ—¶å‡ºé”™:',e)}})}),this.activeDialog=null,this.activeOverlay=null}closeDialog(){this.forceCleanupDialogs()}}}},a={};function n(e){var o=a[e];if(void 0!==o)return o.exports;var s=a[e]={exports:{}};return t[e](s,s.exports,n),s.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),function(e){e[e.DEBUG=0]='DEBUG',e[e.INFO=1]='INFO',e[e.WARN=2]='WARN',e[e.ERROR=3]='ERROR'}(e||(e={}));class o{static instance;isDevelopment;logLevel;logHistory=[];maxHistorySize=1e3;constructor(){this.isDevelopment=this.checkDevelopmentMode(),this.logLevel=this.isDevelopment?e.DEBUG:e.ERROR}static getInstance(){return o.instance||(o.instance=new o),o.instance}checkDevelopmentMode(){return!!(window.BLMX_DEV_MODE||window.DEBUG||'true'===localStorage.getItem('blmx_debug')||'localhost'===location.hostname||'127.0.0.1'===location.hostname||location.search.includes('debug=true'))}setLogLevel(e){this.logLevel=e}setDevelopmentMode(e){this.isDevelopment=e,e?localStorage.setItem('blmx_debug','true'):localStorage.removeItem('blmx_debug')}addToHistory(e,t,a,n){this.logHistory.push({timestamp:new Date,level:e,module:t,message:a,data:n}),this.logHistory.length>this.maxHistorySize&&this.logHistory.shift()}formatMessage(e,t){return`[${(new Date).toISOString().substr(11,12)}] [BLMX:${e}] ${t}`}debug(t,a,n){this.logLevel<=e.DEBUG&&this.isDevelopment&&(console.log(this.formatMessage(t,a),n||''),this.addToHistory(e.DEBUG,t,a,n))}info(t,a,n){this.logLevel<=e.INFO&&this.isDevelopment&&(console.info(this.formatMessage(t,a),n||''),this.addToHistory(e.INFO,t,a,n))}warn(t,a,n){this.logLevel<=e.WARN&&(console.warn(this.formatMessage(t,a),n||''),this.addToHistory(e.WARN,t,a,n))}error(t,a,n){console.error(this.formatMessage(t,a),n||''),this.addToHistory(e.ERROR,t,a,n)}timeStart(e,t){this.isDevelopment&&console.time(this.formatMessage(e,t))}timeEnd(e,t){this.isDevelopment&&console.timeEnd(this.formatMessage(e,t))}groupStart(e,t){this.isDevelopment&&console.group(this.formatMessage(e,t))}groupEnd(){this.isDevelopment&&console.groupEnd()}getHistory(e,t){let a=this.logHistory;return e&&(a=a.filter(t=>t.module===e)),void 0!==t&&(a=a.filter(e=>e.level>=t)),a}clearHistory(){this.logHistory=[]}exportHistory(){return JSON.stringify(this.logHistory,null,2)}showDebugPanel(){this.isDevelopment?(console.group('ğŸ› BLMX è°ƒè¯•ä¿¡æ¯'),console.log('å¼€å‘æ¨¡å¼:',this.isDevelopment),console.log('æ—¥å¿—çº§åˆ«:',e[this.logLevel]),console.log('å†å²è®°å½•æ•°é‡:',this.logHistory.length),this.logHistory.length>0&&(console.log('æœ€è¿‘çš„æ—¥å¿—:'),this.logHistory.slice(-10).forEach(e=>{const t=['ğŸ”','â„¹ï¸','âš ï¸','âŒ'][e.level];console.log(`${t} [${e.module}] ${e.message}`,e.data||'')})),console.groupEnd()):console.warn('è°ƒè¯•é¢æ¿ä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹å¯ç”¨')}getStatus(){return{isDevelopment:this.isDevelopment,logLevel:e[this.logLevel],historyCount:this.logHistory.length}}}const s=o.getInstance();'undefined'!=typeof window&&s.getStatus().isDevelopment&&(window.blmxLogger=s);class i{listeners=[];timers=new Set;intervals=new Set;isDestroyed=!1;addGlobalListener(e,t){if(this.isDestroyed)return console.warn('[EventManager] å°è¯•åœ¨å·²é”€æ¯çš„ç®¡ç†å™¨ä¸Šæ·»åŠ ç›‘å¬å™¨'),()=>{};const a=window.eventOn(e,t);return a&&'function'==typeof a?(this.listeners.push(a),a):(console.warn(`[EventManager] æ— æ³•ä¸ºäº‹ä»¶ ${e} åˆ›å»ºæ¸…ç†å‡½æ•°`),()=>{})}addDOMListener(e,t,a,n){if(this.isDestroyed)return void console.warn('[EventManager] å°è¯•åœ¨å·²é”€æ¯çš„ç®¡ç†å™¨ä¸Šæ·»åŠ DOMç›‘å¬å™¨');e.addEventListener(t,a,n);this.listeners.push(()=>{e.removeEventListener(t,a,n)})}setTimeout(e,t){if(this.isDestroyed)return console.warn('[EventManager] å°è¯•åœ¨å·²é”€æ¯çš„ç®¡ç†å™¨ä¸Šåˆ›å»ºå®šæ—¶å™¨'),-1;const a=window.setTimeout(()=>{this.timers.delete(a);try{e()}catch(e){console.error('[EventManager] å®šæ—¶å™¨å›è°ƒæ‰§è¡Œé”™è¯¯:',e)}},t);return this.timers.add(a),a}setInterval(e,t){if(this.isDestroyed)return console.warn('[EventManager] å°è¯•åœ¨å·²é”€æ¯çš„ç®¡ç†å™¨ä¸Šåˆ›å»ºé—´éš”å®šæ—¶å™¨'),-1;const a=window.setInterval(()=>{try{e()}catch(e){console.error('[EventManager] é—´éš”å®šæ—¶å™¨å›è°ƒæ‰§è¡Œé”™è¯¯:',e)}},t);return this.intervals.add(a),a}clearTimeout(e){this.timers.has(e)&&(window.clearTimeout(e),this.timers.delete(e))}clearInterval(e){this.intervals.has(e)&&(window.clearInterval(e),this.intervals.delete(e))}cleanup(){this.isDestroyed||(this.listeners.forEach(e=>{try{e()}catch(e){console.error('[EventManager] æ¸…ç†ç›‘å¬å™¨æ—¶å‡ºé”™:',e)}}),this.listeners=[],this.timers.forEach(e=>{window.clearTimeout(e)}),this.timers.clear(),this.intervals.forEach(e=>{window.clearInterval(e)}),this.intervals.clear(),this.isDestroyed=!0)}getStatus(){return{listenersCount:this.listeners.length,timersCount:this.timers.size,intervalsCount:this.intervals.size,isDestroyed:this.isDestroyed}}isDestroyed_(){return this.isDestroyed}}const r=new i;function l(){return window.parent.TavernHelper}'undefined'!=typeof window&&window.addEventListener('beforeunload',()=>{r.cleanup()});class c{logEntries=[];messageId=null;charId;LOG_START_TAG='===BLMX_LOG_BEGIN===';LOG_END_TAG='===BLMX_LOG_END===';constructor(e){this.charId=e}getCharId(){return this.charId}async initialize(){const e=await l().getLastMessageId();if(null===e)return this.messageId=0,this.logEntries=[],await this.persistLogToStorage(),!0;let t=null;const a=[];for(let n=e;n>=0;n--)try{const e=(await l().getChatMessages(n))[0];e&&e.message&&e.message.includes(this.LOG_START_TAG)&&(t?a.push({id:n,content:e.message}):t={id:n,content:e.message})}catch(e){}if(!t)return this.messageId=e,this.logEntries=[],await this.persistLogToStorage(),!0;this.messageId=t.id;const n=[],o=t.content.indexOf(this.LOG_START_TAG),s=t.content.indexOf(this.LOG_END_TAG);if(-1!==o&&-1!==s){const e=t.content.slice(o+this.LOG_START_TAG.length,s).trim();e&&n.push(e)}for(const e of a){const t=e.content.indexOf(this.LOG_START_TAG),a=e.content.indexOf(this.LOG_END_TAG);if(-1!==t&&-1!==a){const o=e.content.slice(t+this.LOG_START_TAG.length,a).trim();o&&n.unshift(o);const s=e.content.substring(0,t)+e.content.substring(a+this.LOG_END_TAG.length);await l().setChatMessage(s.trim(),e.id,{refresh:'none'})}}const i=n.join('\n');return this._parseLogFromString(i),await this.persistLogToStorage(),!0}async persistLogToStorage(){if(null!==this.messageId)try{const e=this._renderLogToString(),t=(await l().getChatMessages(this.messageId))[0],a=t?t.message:'',n=a.indexOf(this.LOG_START_TAG),o=a.indexOf(this.LOG_END_TAG),s=`${this.LOG_START_TAG}\n${e}\n${this.LOG_END_TAG}`;let i;i=-1!==n&&-1!==o?a.substring(0,n)+s+a.substring(o+this.LOG_END_TAG.length):a+'\n'+s,await l().setChatMessage(i.trim(),this.messageId,{refresh:'none'})}catch(e){console.error('Failed to save narrative log to text box:',e)}else console.warn('[BLMX] Cannot save log, message_id not initialized.')}_parseLogFromString(e){this.logEntries=[];e.split('\n').filter(e=>''!==e.trim()).forEach(e=>{const t=e.indexOf(':');if(-1===t)return;const a=e.substring(0,t).trim(),n=e.substring(t+1).trim();try{switch(a){case'USER_MOMENT':case'CHAR_MOMENT':case'USER_COMMENT':case'CHAR_COMMENT':case'USER_LIKE':case'CHAR_LIKE':try{const e=JSON.parse(n);this.logEntries.push({key:a,data:e})}catch(e){console.warn('[BLMX] è§£ææœ‹å‹åœˆæ•°æ®å¤±è´¥:',n,e)}break;case'TIME':case'EVENT_LOG':if(n)try{const e=JSON.parse(n);if(!(e.date&&e.time||(console.warn(`[BLMX] ${a}ç¼ºå°‘å¿…è¦å­—æ®µ:`,e),e.date&&e.time))){const t=new Date;e.date||(e.date=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')}`),e.time||(e.time=`${String(t.getHours()).padStart(2,'0')}:${String(t.getMinutes()).padStart(2,'0')}`)}const t={type:'TIME'===a?'time':'event',content:e};this.logEntries.push(t);const o=new Date(`${e.date} ${e.time}`);if(!isNaN(o.getTime())){window.currentGameDate=o;const e=document.getElementById('current-time');if(e){const t=`${window.currentGameDate.getHours().toString().padStart(2,'0')}:${window.currentGameDate.getMinutes().toString().padStart(2,'0')}`;e.textContent=t}}}catch(e){console.error(`[BLMX] è§£æ${a}å¤±è´¥:`,n,e)}break;case'RECALL':try{const e=JSON.parse(n),t='USER'===e.sender?'me':'them',a=e.target_text||e['target text']||e.text||'';if(!a){console.warn('[BLMX] RECALLæ•°æ®ç¼ºå°‘ç›®æ ‡æ–‡æœ¬:',e);break}const o=this.logEntries.slice().reverse().find(e=>{if(!('sender'in e)||e.sender!==t||!('content'in e))return!1;if(e.content===a)return!0;const n=e=>'string'==typeof e?e.replace(/[^\w\u4e00-\u9fa5]/g,'').toLowerCase():'';if('string'==typeof e.content){if(n(e.content)===n(a))return!0;if(e.content.includes(a)||a.includes(e.content))return!0}if('object'==typeof e.content&&null!==e.content)try{if(JSON.stringify(e.content)===a)return!0;if('text'in e.content){const t=e.content.text;if(t===a||n(t)===n(a))return!0}}catch(e){console.warn('[BLMX] æ¯”è¾ƒå¤æ‚å†…å®¹å¤±è´¥:',e)}return!1});o?(o.recalled=!0,o.recalled_content=o.content,o.recalled_timestamp=e.timestamp||(new Date).toISOString()):console.warn('[BLMX] æœªæ‰¾åˆ°è¦æ’¤å›çš„æ¶ˆæ¯:',{sender:t,target_text:a,recall_data:e})}catch(e){console.error('[BLMX] å¤„ç†RECALLæ•°æ®å¤±è´¥:',e)}break;case'USER':case'CHAR':{const e='USER'===a?'me':'them',t=`msg-${Date.now()}${Math.random()}-${e}`,o=n.match(/^\[è¯­éŸ³:\s*({.*})\]/);if(o)try{const a=JSON.parse(o[1]);return void this.logEntries.push({id:t,type:'voice',sender:e,content:a})}catch(a){return console.error('Failed to parse voice data:',o[1],a),void this.logEntries.push({id:t,type:'voice',sender:e,content:{text:'',duration:0}})}const s=n.match(/^\[è¡¨æƒ…:\s*(.*)\]/);if(s)return void this.logEntries.push({id:t,type:'sticker',sender:e,content:s[1]});const i=n.match(/^\[å›¾ç‰‡:\s*(.*)\]/);if(i){try{const a=JSON.parse(i[1]);this.logEntries.push({id:t,type:'image',sender:e,content:a})}catch(a){this.logEntries.push({id:t,type:'image',sender:e,content:{type:'desc',value:i[1]}})}return}const r=n.match(/^\[ä½ç½®:\s*(.*)\]/);if(r)return void this.logEntries.push({id:t,type:'location',sender:e,content:r[1]});const l=n.match(/^\[è½¬è´¦:\s*(.*)\]/);if(l)return void this.logEntries.push({id:t,type:'transfer',sender:e,content:l[1],data:(()=>{try{return JSON.parse(l[1])}catch(e){return console.error('Failed to parse transfer data:',l[1],e),{amount:0,message:''}}})()});const c=n.match(/^\[æ–‡ä»¶:\s*(.*)\]/);if(c)return void this.logEntries.push({id:t,type:'file',sender:e,content:c[1]});const d=n.match(/^\[ç¤¼ç‰©:\s*(.*)\]/);if(d)return void this.logEntries.push({id:t,type:'gift',sender:e,content:d[1],data:(()=>{try{return JSON.parse(d[1])}catch(e){return console.error('Failed to parse gift data:',d[1],e),{name:'',value:0}}})()});this.logEntries.push({id:t,type:'message',sender:e,content:n});break}}}catch(t){console.error('Failed to parse log line:',e,t)}})}_renderLogToString(){const e=[];return[this.logEntries.map(t=>{if(t.recalled){const a={sender:'sender'in t&&'me'===t.sender?'USER':'CHAR',target_text:'object'==typeof t.recalled_content&&null!==t.recalled_content?t.recalled_content.text:t.recalled_content,timestamp:t.recalled_timestamp};a.target_text&&e.push(`RECALL: ${JSON.stringify(a)}`)}if('key'in t)return`${t.key}: ${JSON.stringify(t.data)}`;if('type'in t){if('time'===t.type||'event'===t.type){return`${'time'===t.type?'TIME':'EVENT_LOG'}: ${JSON.stringify(t.content)}`}const e='me'===t.sender?'USER':'CHAR';let a=t.content;switch(t.type){case'sticker':a=`[è¡¨æƒ…: ${t.content}]`;break;case'voice':a=`[è¯­éŸ³: ${JSON.stringify(t.content)}]`;break;case'image':a=`[å›¾ç‰‡: ${JSON.stringify(t.content)}]`;break;case'location':a=`[ä½ç½®: ${t.content}]`;break;case'file':a=`[æ–‡ä»¶: ${t.content}]`;break;case'gift':a=`[ç¤¼ç‰©: ${t.content}]`;break;case'transfer':a=`[è½¬è´¦: ${t.content}]`}return`${e}: ${a}`}return''}).join('\n'),...e].filter(Boolean).join('\n')}addEntry(e){if(e){if('type'in e&&'sticker'===e.type)return void this.logEntries.push(e);if(this.logEntries.some(t=>{if('key'in e&&'key'in t&&e.key===t.key){if(e.key.includes('_MOMENT')){const a=e.data,n=t.data;return n.text===a.text&&n.date===a.date&&n.time===a.time}if(e.key.includes('_COMMENT')){const a=e.data,n=t.data;return n.text===a.text&&n.target_post_id===a.target_post_id}if(e.key.includes('_LIKE')){const a=e.data;return t.data.target_post_id===a.target_post_id}}if('type'in e&&'type'in t&&e.type===t.type){if('id'in e&&'id'in t&&e.id===t.id)return!0;if(('message'===e.type||'location'===e.type||'file'===e.type)&&'sender'in e&&'sender'in t&&'content'in e&&'content'in t)return e.sender===t.sender&&window._.isEqual(e.content,t.content);if(('time'===e.type||'event'===e.type)&&'content'in e&&'content'in t)return window._.isEqual(e.content,t.content);if('content'in e&&'content'in t&&('image'===e.type||'voice'===e.type||'transfer'===e.type||'gift'===e.type))return window._.isEqual(e.content,t.content)}return!1}))return;if(this.logEntries.push(e),'type'in e&&('time'===e.type||'event'===e.type)){const t=e.content,a=new Date(`${t.date} ${t.time}`);if(!isNaN(a.getTime())){window.currentGameDate=a;const e=document.getElementById('current-time');if(e){const t=`${window.currentGameDate.getHours().toString().padStart(2,'0')}:${window.currentGameDate.getMinutes().toString().padStart(2,'0')}`;e.textContent=t}}}}}getContextForAI(){return this._renderLogToString()}}function d(e,t=null){try{return JSON.parse(e)}catch(a){return s.warn('Utils','JSONè§£æå¤±è´¥',{jsonString:e.substring(0,100),error:a}),t}}function g(e,t='{}'){try{return JSON.stringify(e)}catch(e){return s.warn('Utils','JSONåºåˆ—åŒ–å¤±è´¥',{error:e}),t}}const p={getItem(e,t=null){try{const a=localStorage.getItem(e);if(null===a)return t;try{return JSON.parse(a)}catch{return a}}catch(a){return s.warn('Utils','æœ¬åœ°å­˜å‚¨è¯»å–å¤±è´¥',{key:e,error:a}),t}},setItem(e,t){try{const a='string'==typeof t?t:JSON.stringify(t);return localStorage.setItem(e,a),!0}catch(t){return s.warn('Utils','æœ¬åœ°å­˜å‚¨å†™å…¥å¤±è´¥',{key:e,error:t}),!1}},removeItem(e){try{return localStorage.removeItem(e),!0}catch(t){return s.warn('Utils','æœ¬åœ°å­˜å‚¨åˆ é™¤å¤±è´¥',{key:e,error:t}),!1}},clear(){try{return localStorage.clear(),!0}catch(e){return s.warn('Utils','æœ¬åœ°å­˜å‚¨æ¸…ç©ºå¤±è´¥',{error:e}),!1}}};class m{blmxManager;uiRenderer;eventHandler;momentsManager;eventManager;isGenerating=!1;latestAiRawResponse='è¿˜æ²¡æœ‰æ”¶åˆ°AIçš„å›å¤ã€‚';latestSentPrompt='è¿˜æ²¡æœ‰å‘é€ä»»ä½•å†…å®¹ç»™AIã€‚';rawAiResponse='';fullPrompt='';constructor(e,t,a,n){this.blmxManager=e,this.uiRenderer=t,this.eventHandler=a,this.momentsManager=n,this.eventManager=new i,this.eventManager.addGlobalListener('js_generation_ended',e=>{this.rawAiResponse=e,s.debug('AiResponseManager','åŸå§‹AIå“åº”å·²æ¥æ”¶',{length:e.length})}),this.eventManager.addGlobalListener('chat_completion_prompt_ready',e=>{this.fullPrompt=g(e.chat),s.debug('AiResponseManager','å®Œæ•´æç¤ºè¯å·²å‡†å¤‡',{promptLength:this.fullPrompt.length})})}getIsGenerating(){return this.isGenerating}async triggerAiResponse(e=!1){if(!this.isGenerating&&this.blmxManager)if(window.BLMX_PROCESSING_AI_RESPONSE)s.debug('AiResponseManager','å·²æœ‰AIå“åº”å¤„ç†è¿›è¡Œä¸­ï¼Œè·³è¿‡é‡å¤å¤„ç†');else{window.BLMX_PROCESSING_AI_RESPONSE=!0,this.isGenerating=!0;try{let e=this.blmxManager.getContextForAI();e+='\nã€BLMX_LOGä¸­çš„å†…å®¹ä¸ºç›®å‰è¿‡å¾€çº¿ä¸ŠèŠå¤©è®°å½•ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬æœ€æ–°çš„USERè¾“å…¥ï¼Œè¯·ä½ ä½œä¸ºCHARè¿›è¡Œå›åº”ã€‚ã€‘\nã€æœ¬æ¬¡å“åº”å¿…é¡»éµå¾ªçº¿ä¸Šè§„åˆ™ã€‘ã€å¿…é¡»ä½¿ç”¨ç‰¹æ®Šçº¦å®šçš„æ ¼å¼ä¸”ä¿è¯æ­£ç¡®æ¢è¡Œã€‘',this.latestSentPrompt=e,this.blmxManager.logEntries.forEach(e=>{'type'in e&&'image'===e.type&&'content'in e&&e.content.isNewForAI&&(e.content.value='[ç”¨æˆ·å‘é€çš„å›¾ç‰‡]',delete e.content.isNewForAI)}),this.eventHandler.setHasPendingNotifications(!1);const t=2;let a=0,n=!1;for(;a<=t&&!n;){a>0&&(s.warn('AiResponseManager','AIå“åº”ä¸ºç©ºï¼Œé‡è¯•ä¸­',{attempt:a+1,maxRetries:t+1}),await new Promise(e=>setTimeout(e,1e3*a)));try{this.uiRenderer.showGeneratingIndicator();const t=await l().generate({user_input:e,should_stream:!0});let a='';for await(const e of t)a+=e;this.uiRenderer.hideGeneratingIndicator(),this.latestAiRawResponse=a.trim(),this.rawAiResponse||(this.rawAiResponse=a.trim(),s.debug('AiResponseManager','ç›´æ¥è·å–çš„åŸå§‹AIå“åº”',{length:this.rawAiResponse.length}));let o=a.trim();const i=o.length;if(i>0&&i%2==0){const e=o.substring(0,i/2);e===o.substring(i/2)&&''!==e.trim()&&(s.warn('AiResponseManager','æ£€æµ‹åˆ°å®Œå…¨é‡å¤çš„AIå“åº”ï¼Œè‡ªåŠ¨ä¿®å‰ª'),o=e)}const r=o.split('\n').filter(e=>''!==e.trim());if(r.length>1){const e=window._.uniq(r);e.length<.7*r.length&&(s.warn('AiResponseManager','æ£€æµ‹åˆ°AIå“åº”ä¸­çš„æ½œåœ¨è¡Œé‡å¤ï¼Œä»…ä½¿ç”¨å”¯ä¸€è¡Œ'),o=e.join('\n'))}o.trim()&&(n=await this.processAiResponse(o.trim()))}catch(e){s.error('AiResponseManager',`å°è¯•${a}æ—¶å‡ºé”™`,{attempt:a,error:e}),this.uiRenderer.hideGeneratingIndicator(),a>=t&&this.showErrorMessage('AIä»£ç†å‡ºé”™ (è¯¦æƒ…è§F12æ§åˆ¶å°)')}a++}!n&&a>t&&(console.error(`[BLMX] AI generation failed after ${t+1} attempts (empty response).`),this.showErrorMessage('(AIå“åº”ä¸ºç©ºï¼Œè¯·ç¨åå†è¯•æˆ–æ‰‹åŠ¨è§¦å‘)'),this.latestAiRawResponse='[AIå“åº”ä¸ºç©º]'),await this.blmxManager.persistLogToStorage(),this.uiRenderer.refreshAllTimestamps()}catch(e){console.error('[BLMX] Error in triggerAiResponse:',e)}finally{this.isGenerating=!1,window.BLMX_PROCESSING_AI_RESPONSE=!1}}}async processAiResponse(e){const t=[];let a=!1;const n=e.replace(/^\s*[[{].*[\]}]\s*$/gm,e=>null!==d(e.trim())?e:'').split('\n').filter(e=>''!==e.trim());if(s.debug('AiResponseManager','å¤„ç†AIå“åº”è¡Œ',{lineCount:n.length}),n.forEach(e=>{const n=e.indexOf(':');if(-1===n)return void s.debug('AiResponseManager','è·³è¿‡æ²¡æœ‰åˆ†éš”ç¬¦çš„è¡Œ',{line:e});const o=e.substring(0,n).trim(),i=e.substring(n+1).trim();if(s.debug('AiResponseManager','è§£æå“åº”',{key:o,valuePreview:i.substring(0,50)+(i.length>50?'...':''),valueLength:i.length}),o&&i)try{let e=null;const n=`ai-${Date.now()}-${Math.random()}`;let r=null,l=null,c=null,g=null,p=null,m=null,h=null;switch(o){case'CHAR_MOMENT':case'CHAR_COMMENT':case'CHAR_LIKE':e={key:o,data:d(i)},this.blmxManager.addEntry(e),e&&(t.push(e),a=!0),this.momentsManager&&this.momentsManager.renderMomentsFeed();break;case'message':{const a=d(i);e={id:`ai-${Date.now()}-${Math.random()}`,type:'message',sender:'them',content:null!==a?a:i},this.blmxManager.addEntry(e),e&&t.push(e);break}case'CHAR':if(r=i.match(/^\[è¯­éŸ³:\s*({.*})\]/),l=i.match(/^\[è¡¨æƒ…:\s*(.*)\]/),c=i.match(/^\[å›¾ç‰‡:\s*(.*)\]/),g=i.match(/^\[ä½ç½®:\s*(.*)\]/),p=i.match(/^\[è½¬è´¦:\s*(.*)\]/),m=i.match(/^\[æ–‡ä»¶:\s*(.*)\]/),h=i.match(/^\[ç¤¼ç‰©:\s*(.*)\]/),r){e={id:n,type:'voice',sender:'them',content:d(r[1])||{text:'',duration:0}}}else if(l)e={id:n,type:'sticker',sender:'them',content:l[1]};else if(c){const t=d(c[1]);e=null!==t?{id:n,type:'image',sender:'them',content:t}:{id:n,type:'image',sender:'them',content:{type:'desc',value:c[1]}}}else if(g)e={id:n,type:'location',sender:'them',content:g[1]};else if(p)try{e={id:n,type:'transfer',sender:'them',content:p[1],data:d(p[1])||{amount:0,message:''}}}catch(e){console.error('Failed to parse transfer data:',p[1],e)}else if(m)try{e={id:n,type:'file',sender:'them',content:m[1],data:d(m[1])||{name:'',size:0,url:''}}}catch(e){console.error('Failed to parse file data:',m[1],e)}else if(h)try{e={id:n,type:'gift',sender:'them',content:h[1],data:d(h[1])||{name:'',value:0}}}catch(e){console.error('Failed to parse gift data:',h[1],e)}else e={id:n,type:'message',sender:'them',content:i};e&&(this.blmxManager.addEntry(e),t.push(e));break;case'sticker':this.addStickerEntry(i,t);break;case'voice':this.addJsonContentEntry('voice',i,t);break;case'image':this.addJsonContentEntry('image',i,t);break;case'location':this.addJsonContentEntry('location',i,t);break;case'transfer':this.addJsonContentEntry('transfer',i,t);break;case'file':this.addJsonContentEntry('file',i,t);break;case'gift':this.addJsonContentEntry('gift',i,t);break;case'RECALL':{const e=d(i),a='USER'===e.sender?'me':'them',n=this.blmxManager.logEntries.slice().reverse().find(t=>'sender'in t&&t.sender===a&&'content'in t&&t.content===e.target_text);n&&t.push({type:'recall_instruction',content:{originalEntry:n,recallTimestamp:e.timestamp}});break}case'EVENT_LOG':case'TIME':e={type:'TIME'===o?'time':'event',content:d(i)},this.blmxManager.addEntry(e),e&&t.push(e);break;default:s.warn('AiResponseManager','æœªçŸ¥çš„AIå“åº”é”®',{key:o})}}catch(t){console.error(`[BLMX] Error processing AI response line "${e}":`,t)}}),t.length>0){if(await this.displayAiEntriesSequentially(t),a&&this.momentsManager){$('#moments-view').hasClass('active')?this.momentsManager.setLastMomentViewTimestamp():this.momentsManager.setMomentNotification(!0)}return!0}return!1}showErrorMessage(e){const t=$('<div>').addClass('ai-error-message').text(e);$('.wechat-body').append(t),setTimeout(()=>{t.remove()},5e3)}async displayAiEntriesSequentially(e){const t=['message','sticker','voice','image','location','transfer','file','gift'];for(const a of e){const e=this.blmxManager.logEntries.findIndex(e=>{if('id'in e&&'id'in a&&e.id===a.id)return!0;if('key'in e&&'key'in a&&e.key===a.key){if(a.key.includes('_MOMENT'))return window._.isEqual(e.data,a.data);if(a.key.includes('_LIKE')||a.key.includes('_COMMENT'))return window._.isEqual(e.data,a.data)}return!(!('type'in e)||!('type'in a)||'time'!==e.type&&'event'!==e.type||e.type!==a.type||!window._.isEqual(e.content,a.content))||'type'in e&&'type'in a&&'sender'in e&&'sender'in a&&'content'in e&&'content'in a&&e.type===a.type&&e.sender===a.sender&&('string'==typeof e.content&&'string'==typeof a.content?e.content===a.content:window._.isEqual(e.content,a.content))});if(-1!==e&&s.debug('AiResponseManager','æ‰¾åˆ°å·²å­˜åœ¨çš„æ¡ç›®',{entryIndex:e,entryType:'type'in a?a.type:'unknown'}),'type'in a&&t.includes(a.type)){this.uiRenderer.showTypingIndicator();const t='message'===a.type?a.content:'voice'===a.type?a.content.text:'',n=this.uiRenderer.calculateTypingDelay(t);await new Promise(e=>setTimeout(e,n)),this.uiRenderer.hideTypingIndicator(),this.uiRenderer.renderEntry(a,-1!==e?e:void 0,!0)}else if('type'in a&&'recall_instruction'===a.type){const{originalEntry:e,recallTimestamp:t}=a.content,n=this.blmxManager.logEntries.find(t=>'id'in t&&t.id===e.id);if(n){n.recalled=!0,n.recalled_content=e.content,n.recalled_timestamp=t;const a=this.blmxManager.logEntries.indexOf(n),o=$(`[data-message-id="${e.id}"]`);o.length&&(await new Promise(e=>setTimeout(e,500)),this.uiRenderer.renderRecallNotice(n,o[0],a))}}else this.uiRenderer.renderEntry(a,-1!==e?e:void 0,!0);await new Promise(e=>setTimeout(e,800))}this.uiRenderer.refreshAllTimestamps()}cleanup(){this.eventManager.cleanup()}getLatestAiRawResponse(){return this.latestAiRawResponse}getLatestSentPrompt(){return this.latestSentPrompt}getRawAiResponse(){return this.rawAiResponse}getFullPrompt(){return this.fullPrompt}addStickerEntry(e,t){const a=d(e),n={id:`ai-sticker-${Date.now()}-${Math.random()}`,type:'sticker',sender:'them',content:null!==a?a:e};this.blmxManager.addEntry(n),t.push(n)}addJsonContentEntry(e,t,a){const n={id:`ai-${e}-${Date.now()}-${Math.random()}`,type:e,sender:'them',content:JSON.parse(t)};this.blmxManager.addEntry(n),a.push(n)}}const h='blmx_wechat_stickers_global_blmx',u='blmx_char_stickers_blmx_',f='blmx_phone_size',b='blmx_fullscreen_size',y='blmx_sticker_size',v='blmx_moment_notification',w='blmx_moment_last_view',S='blmx_user_name_',M='blmx_user_avatar_',x='blmx_char_avatar_',k='blmx_remark_',E='blmx_cover_photo_',C='blmx_signature_',T='blmx_input_placeholder_',D='blmx_last_notified_version';class I{config;defaultGlobalStickers=[{label:'å¥½çš„',url:'https://files.catbox.moe/3j0tpc.jpeg'}];constructor(){this.config={avatars:{user:'',char:''},names:{user:'User',char:'Character'},charRemark:'',currentCharId:''}}getConfig(){return this.config}setConfig(e){this.config={...this.config,...e}}getDisplayName(e){return'char'===e?this.config.charRemark||this.config.names.char:this.config.names.user}updateAvatar(e,t){this.config.avatars[e]=t;const a='user'===e?`${M}${this.config.currentCharId}`:`${x}${this.config.currentCharId}`;localStorage.setItem(a,t)}updateCharRemark(e){this.config.charRemark=e,localStorage.setItem(`${k}${this.config.currentCharId}`,e)}updateUserName(e){this.config.names.user=e,localStorage.setItem(`${S}${this.config.currentCharId}`,e)}findStickerUrlByName(e){let t=p.getItem(h,[])||[],a=p.getItem(`${u}${this.config.currentCharId}`,[])||[];if(0===t.length){const e=p.getItem('blmx_wechat_stickers_global',[])||[];e.length>0&&(p.setItem(h,e),t=e,console.log('[BLMX] å·²è¿ç§»å…¨å±€è¡¨æƒ…åŒ…æ•°æ®åˆ°æ–°å­˜å‚¨é”®'))}if(0===a.length){const e=p.getItem(`blmx_char_stickers_${this.config.currentCharId}`,[])||[];e.length>0&&(p.setItem(`${u}${this.config.currentCharId}`,e),a=e,console.log('[BLMX] å·²è¿ç§»è§’è‰²è¡¨æƒ…åŒ…æ•°æ®åˆ°æ–°å­˜å‚¨é”®'))}const n=[...this.defaultGlobalStickers,...t];return[...n,...a].find(t=>t.label===e)?.url}async loadFromStorage(e){this.config.currentCharId=e.name,this.config.names.char=e.name,this.config.charRemark=localStorage.getItem(`${k}${this.config.currentCharId}`)||'',this.config.names.user=localStorage.getItem(`${S}${this.config.currentCharId}`)||'User',this.config.avatars.user=localStorage.getItem(`${M}${this.config.currentCharId}`)||'';const t=localStorage.getItem(`${x}${this.config.currentCharId}`);this.config.avatars.char=t||''}getMomentNotificationState(){return'true'===localStorage.getItem(`${v}_${this.config.currentCharId}`)}setMomentNotificationState(e){localStorage.setItem(`${v}_${this.config.currentCharId}`,e.toString())}getLastMomentViewTimestamp(){const e=localStorage.getItem(`${w}_${this.config.currentCharId}`);return e?parseInt(e,10):0}setLastMomentViewTimestamp(e){localStorage.setItem(`${w}_${this.config.currentCharId}`,e.toString())}getSavedCoverPhoto(){return localStorage.getItem(`${E}${this.config.currentCharId}`)}setCoverPhoto(e){localStorage.setItem(`${E}${this.config.currentCharId}`,e)}getSavedSignature(){return localStorage.getItem(`${C}${this.config.currentCharId}`)||''}setSignature(e){localStorage.setItem(`${C}${this.config.currentCharId}`,e)}getSavedInputPlaceholder(){return localStorage.getItem(`${T}${this.config.currentCharId}`)}setInputPlaceholder(e){localStorage.setItem(`${T}${this.config.currentCharId}`,e)}getPhoneSize(){const e=localStorage.getItem(f)||'default';return'medium'===e?'medium':'small'===e?'small':'default'}setPhoneSize(e){localStorage.setItem(f,e)}getFullscreenSize(){const e=localStorage.getItem(b)||'100',t=parseInt(e,10);return Math.max(50,Math.min(200,t))}setFullscreenSize(e){const t=Math.max(50,Math.min(200,e));localStorage.setItem(b,t.toString())}getStickerSize(){const e=localStorage.getItem(y)||'120';return parseInt(e,10)}setStickerSize(e){localStorage.setItem(y,e.toString())}getLastNotifiedVersion(){return localStorage.getItem(D)}setLastNotifiedVersion(e){localStorage.setItem(D,e)}}const L=()=>{const e=new Date;return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,'0')}-${e.getDate().toString().padStart(2,'0')}`},R=()=>{const e=new Date;return`${e.getHours().toString().padStart(2,'0')}:${e.getMinutes().toString().padStart(2,'0')}`},A=e=>`${e}_${Date.now()}_${Math.floor(1e3*Math.random())}`,N=[{type:'time',content:{date:L(),time:R()}},{type:'event',content:{date:L(),time:R(),description:'è°ƒè¯•æ¨¡å¼å·²å¯ç”¨'}},{id:A('msg'),type:'message',sender:'me',content:'ä½ å¥½ï¼Œè¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯'},{id:A('msg'),type:'message',sender:'them',content:'ä½ å¥½ï¼å¾ˆé«˜å…´è§åˆ°ä½ ï¼Œè¿™æ˜¯ä¸€æ¡AIå›å¤çš„æµ‹è¯•æ¶ˆæ¯ã€‚'},{id:A('sticker'),type:'sticker',sender:'me',content:'å¥½çš„'},{id:A('sticker'),type:'sticker',sender:'them',content:'å¥½çš„'},{id:A('img'),type:'image',sender:'me',content:{type:'url',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/è“è‰²_1.jpg'}},{id:A('img'),type:'image',sender:'them',content:{type:'url',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç²‰è‰²æ˜Ÿæ˜Ÿ_1.jpg'}},{id:A('img'),type:'image',sender:'them',content:{type:'desc',value:'è¿™æ˜¯ä¸€å¼ æè¿°ç±»å‹çš„å›¾ç‰‡ï¼Œå®é™…ä¸Šä¸ä¼šæ˜¾ç¤ºå›¾ç‰‡å†…å®¹'}},{id:A('voice'),type:'voice',sender:'me',content:{text:'è¿™æ˜¯ä¸€æ¡æµ‹è¯•è¯­éŸ³æ¶ˆæ¯çš„æ–‡æœ¬å†…å®¹',duration:5}},{id:A('voice'),type:'voice',sender:'them',content:{text:'è¿™æ˜¯AIå›å¤çš„è¯­éŸ³æ¶ˆæ¯æ–‡æœ¬å†…å®¹',duration:8}},{id:A('loc'),type:'location',sender:'me',content:'åŒ—äº¬å¸‚æœé˜³åŒºä¸‰é‡Œå±¯'},{id:A('loc'),type:'location',sender:'them',content:'ä¸Šæµ·å¸‚æµ¦ä¸œæ–°åŒºé™†å®¶å˜´'},{id:A('transfer'),type:'transfer',sender:'me',content:JSON.stringify({amount:'88.88',note:'æµ‹è¯•è½¬è´¦',status:'sent'}),data:{amount:'88.88',note:'æµ‹è¯•è½¬è´¦',status:'sent'}},{id:A('transfer'),type:'transfer',sender:'them',content:JSON.stringify({amount:'88.88',note:'æµ‹è¯•è½¬è´¦',status:'accepted'}),data:{amount:'88.88',note:'æµ‹è¯•è½¬è´¦',status:'accepted'}},{id:A('transfer'),type:'transfer',sender:'them',content:JSON.stringify({amount:'66.66',note:'AIæµ‹è¯•è½¬è´¦',status:'sent'}),data:{amount:'66.66',note:'AIæµ‹è¯•è½¬è´¦',status:'sent'}},{id:A('transfer'),type:'transfer',sender:'me',content:JSON.stringify({amount:'66.66',note:'AIæµ‹è¯•è½¬è´¦',status:'accepted'}),data:{amount:'66.66',note:'AIæµ‹è¯•è½¬è´¦',status:'accepted'}},{id:A('gift'),type:'gift',sender:'me',content:JSON.stringify({name:'ç”Ÿæ—¥è›‹ç³•',price:'99.99',status:'sent'}),data:{name:'ç”Ÿæ—¥è›‹ç³•',price:'99.99',status:'sent'}},{id:A('gift'),type:'gift',sender:'them',content:JSON.stringify({name:'ç”Ÿæ—¥è›‹ç³•',status:'accepted'}),data:{name:'ç”Ÿæ—¥è›‹ç³•',status:'accepted'}},{id:A('gift'),type:'gift',sender:'them',content:JSON.stringify({name:'å·§å…‹åŠ›',price:'39.99',status:'sent'}),data:{name:'å·§å…‹åŠ›',price:'39.99',status:'sent'}},{id:A('gift'),type:'gift',sender:'me',content:JSON.stringify({name:'å·§å…‹åŠ›',status:'accepted'}),data:{name:'å·§å…‹åŠ›',status:'accepted'}},{id:A('file'),type:'file',sender:'me',content:'æµ‹è¯•æ–‡æ¡£.docx'},{id:A('file'),type:'file',sender:'them',content:'é‡è¦èµ„æ–™.pdf'},{key:'USER_MOMENT',data:{text:'è¿™æ˜¯ç”¨æˆ·å‘å¸ƒçš„æœ‹å‹åœˆæµ‹è¯•å†…å®¹',image:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/è“è‰²_2.jpg',image_type:'url',date:L(),time:R()}},{key:'CHAR_MOMENT',data:{text:'è¿™æ˜¯AIå‘å¸ƒçš„æœ‹å‹åœˆæµ‹è¯•å†…å®¹',image:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç²‰è‰²å°çŒ«_1.jpg',image_type:'url',date:L(),time:R()}},{key:'CHAR_MOMENT',data:{text:'è¿™æ˜¯ä¸€æ¡æ²¡æœ‰å›¾ç‰‡çš„æœ‹å‹åœˆ',image:'',image_type:'none',date:L(),time:R()}},{key:'USER_MOMENT',data:{text:'è¿™æ˜¯å¸¦æœ‰å›¾ç‰‡æè¿°çš„æœ‹å‹åœˆ',image:'ä¸€å¼ ç¾ä¸½çš„é£æ™¯ç…§ç‰‡',image_type:'desc',image_desc:'ä¸€å¼ ç¾ä¸½çš„é£æ™¯ç…§ç‰‡',date:L(),time:R()}},{key:'USER_COMMENT',data:{text:'è¿™æ˜¯ç”¨æˆ·çš„è¯„è®º',target_post_id:1}},{key:'CHAR_COMMENT',data:{text:'è¿™æ˜¯AIçš„è¯„è®º',target_post_id:0}},{key:'USER_LIKE',data:{target_post_id:1}},{key:'CHAR_LIKE',data:{target_post_id:0}},{id:A('msg'),type:'message',sender:'them',content:'è¿™æ¡æ¶ˆæ¯å°†è¢«æ’¤å›',recalled:!0,recalled_content:'è¿™æ¡æ¶ˆæ¯å°†è¢«æ’¤å›',recalled_timestamp:R()}];var B=n(929);class P{configManager;onStageAndDisplayEntry;onUpdateFooterButtonsState;dialogManager;constructor(e,t,a){this.configManager=e,this.onStageAndDisplayEntry=t,this.onUpdateFooterButtonsState=a,this.dialogManager=B.DialogManager.getInstance()}async handleTransferAccept(e){const t=await this.dialogManager.showReceiveDialog('transfer',e);if('accept'===t){const t={...e,status:'accepted'};this.onStageAndDisplayEntry({type:'transfer',sender:'me',content:JSON.stringify(t),data:t,id:`transfer-${Date.now()}`})}else if('reject'===t){const t={...e,status:'rejected'};this.onStageAndDisplayEntry({type:'transfer',sender:'me',content:JSON.stringify(t),data:t,id:`transfer-${Date.now()}`})}}async handleGiftAction(e){const t=await this.dialogManager.showReceiveDialog('gift',e);if('accept'===t){const t={name:e.name,status:'accepted'};this.onStageAndDisplayEntry({type:'gift',sender:'me',content:JSON.stringify(t),data:t,id:`gift-${Date.now()}`})}else if('reject'===t){const t={name:e.name,status:'rejected'};this.onStageAndDisplayEntry({type:'gift',sender:'me',content:JSON.stringify(t),data:t,id:`gift-${Date.now()}`})}this.onUpdateFooterButtonsState()}sendTextMessage(e){if(!e.trim())return;const t={type:'message',sender:'me',content:e.trim(),id:`msg-${Date.now()}-${Math.random()}`,timestamp:Date.now()};this.onStageAndDisplayEntry(t),this.onUpdateFooterButtonsState()}sendSticker(e){if(!this.configManager.findStickerUrlByName(e))return void console.error(`[BLMX] æœªæ‰¾åˆ°è¡¨æƒ…åŒ…: ${e}`);const t={type:'sticker',sender:'me',content:e,id:`sticker-${Date.now()}-${Math.random()}`,timestamp:Date.now()};this.onStageAndDisplayEntry(t),this.onUpdateFooterButtonsState()}sendImage(e){const t={type:'image',sender:'me',content:e,id:`image-${Date.now()}-${Math.random()}`,timestamp:Date.now()};this.onStageAndDisplayEntry(t),this.onUpdateFooterButtonsState()}sendVoiceMessage(e){const t={type:'voice',sender:'me',content:e,id:`voice-${Date.now()}-${Math.random()}`,timestamp:Date.now()};this.onStageAndDisplayEntry(t),this.onUpdateFooterButtonsState()}sendLocation(e){const t={type:'location',sender:'me',content:e,id:`location-${Date.now()}-${Math.random()}`,timestamp:Date.now()};this.onStageAndDisplayEntry(t),this.onUpdateFooterButtonsState()}sendFile(e){const t={type:'file',sender:'me',content:e,id:`file-${Date.now()}-${Math.random()}`,timestamp:Date.now()};this.onStageAndDisplayEntry(t),this.onUpdateFooterButtonsState()}sendTransfer(e){const t={type:'transfer',sender:'me',content:e,id:`transfer-${Date.now()}-${Math.random()}`,timestamp:Date.now()};this.onStageAndDisplayEntry(t),this.onUpdateFooterButtonsState()}sendGift(e){const t={type:'gift',sender:'me',content:e,id:`gift-${Date.now()}-${Math.random()}`,timestamp:Date.now()};this.onStageAndDisplayEntry(t),this.onUpdateFooterButtonsState()}async handleFileUpload(e){try{if(e.type.startsWith('image/')){const t=new FileReader;t.onload=t=>{const a=t.target?.result;this.sendImage({type:'file',value:a,name:e.name})},t.readAsDataURL(e)}else this.sendFile({name:e.name,size:e.size,type:e.type})}catch(e){console.error('[BLMX] æ–‡ä»¶ä¸Šä¼ å¤±è´¥:',e);const t=B.DialogManager.getInstance();await t.alert('æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚','ä¸Šä¼ å¤±è´¥')}}async handleImageUrl(e){if(e.trim())try{new URL(e),this.sendImage({type:'url',value:e.trim()})}catch(e){const t=B.DialogManager.getInstance();await t.alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å›¾ç‰‡URL','URLæ ¼å¼é”™è¯¯')}}async handleVoiceRecording(){try{const e=B.DialogManager.getInstance();if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void await e.alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³å½•åˆ¶åŠŸèƒ½','ä¸æ”¯æŒè¯­éŸ³å½•åˆ¶');const t=await navigator.mediaDevices.getUserMedia({audio:!0}),a=await e.prompt('è¯·è¾“å…¥è¯­éŸ³å†…å®¹ï¼ˆæ¨¡æ‹Ÿè¯­éŸ³è½¬æ–‡å­—ï¼‰:','','è¯­éŸ³å½•åˆ¶');a&&this.sendVoiceMessage({text:a.trim(),duration:Math.floor(30*Math.random())+5}),t.getTracks().forEach(e=>e.stop())}catch(e){console.error('[BLMX] è¯­éŸ³å½•åˆ¶å¤±è´¥:',e);const t=B.DialogManager.getInstance();await t.alert('è¯­éŸ³å½•åˆ¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥éº¦å…‹é£æƒé™ã€‚','å½•åˆ¶å¤±è´¥')}}handleLocationShare(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{const{latitude:t,longitude:a}=e.coords,n=prompt('è¯·è¾“å…¥ä½ç½®åç§°:')||'æˆ‘çš„ä½ç½®',o=prompt('è¯·è¾“å…¥è¯¦ç»†åœ°å€:')||`çº¬åº¦: ${t.toFixed(6)}, ç»åº¦: ${a.toFixed(6)}`;this.sendLocation({name:n,address:o,latitude:t,longitude:a})},e=>{console.error('[BLMX] è·å–ä½ç½®å¤±è´¥:',e);const t=prompt('æ— æ³•è·å–å½“å‰ä½ç½®ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥ä½ç½®åç§°:'),a=prompt('è¯·è¾“å…¥è¯¦ç»†åœ°å€:');t&&a&&this.sendLocation({name:t,address:a})}):alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†ä½ç½®åŠŸèƒ½')}handleTransferSend(){const e=prompt('è¯·è¾“å…¥è½¬è´¦é‡‘é¢:');if(!e)return;const t=parseFloat(e);if(isNaN(t)||t<=0)return void alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‘é¢');const a=prompt('è¯·è¾“å…¥è½¬è´¦å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰:')||'';this.sendTransfer({amount:t,note:a})}handleGiftSend(){const e=prompt('è¯·è¾“å…¥ç¤¼ç‰©åç§°:');if(!e)return;const t=prompt('è¯·è¾“å…¥ç¤¼ç‰©å›¾ç‰‡URLï¼ˆå¯é€‰ï¼‰:')||'',a=prompt('è¯·è¾“å…¥ç¤¼ç‰©æè¿°ï¼ˆå¯é€‰ï¼‰:')||'';this.sendGift({name:e,image:t,description:a})}getStickerList(){let e=JSON.parse(localStorage.getItem('blmx_wechat_stickers_global_blmx')||'[]'),t=JSON.parse(localStorage.getItem(`blmx_char_stickers_blmx_${this.configManager.getConfig().currentCharId}`)||'[]');if(0===e.length){const t=JSON.parse(localStorage.getItem('blmx_wechat_stickers_global')||'[]');t.length>0&&(e=t)}if(0===t.length){const e=JSON.parse(localStorage.getItem(`blmx_char_stickers_${this.configManager.getConfig().currentCharId}`)||'[]');e.length>0&&(t=e)}return[...e,...t]}searchStickers(e){const t=this.getStickerList();if(!e.trim())return t;const a=e.toLowerCase();return t.filter(e=>e.label.toLowerCase().includes(a))}clearInput(){const e=document.getElementById('wechat-input-field');e&&(e.value='',this.onUpdateFooterButtonsState())}focusInput(){const e=document.getElementById('wechat-input-field');e&&e.focus()}getInputText(){const e=document.getElementById('wechat-input-field');return e?e.value:''}setInputText(e){const t=document.getElementById('wechat-input-field');t&&(t.value=e,this.onUpdateFooterButtonsState())}}class F{blmxManager;configManager;uiRenderer;hasMomentNotification=!1;constructor(e,t,a){this.blmxManager=e,this.configManager=t,this.uiRenderer=a,this.hasMomentNotification=this.configManager.getMomentNotificationState()}renderMomentsFeed(){if(!this.blmxManager||!this.uiRenderer)return;const e=this.blmxManager.logEntries,t=this.configManager.getConfig().avatars,a=$('#moments-feed-list');if(!a.length)return;this.isInMomentsView()&&(this.setLastMomentViewTimestamp(),this.setMomentNotification(!1)),a.empty();const n={},o=_.reduce(e,(e,t,a)=>('key'in t&&t.key.includes('_MOMENT')&&e.push(a),e),[]);_.forEach(o,t=>{const a=e[t];n[t]={...a,likes:[],comments:[],id:t}});let s=!1;const i=this.getLastMomentViewTimestamp(),r=this.isInMomentsView();_.forEach(e,(e,t)=>{if('key'in e&&(e.key.includes('_LIKE')||e.key.includes('_COMMENT'))){const a=o[parseInt(e.data.target_post_id,10)],l=n[a];if(l){if(e.key.includes('_LIKE')){const a=e.key.startsWith('USER')?this.getDisplayName('user'):this.getDisplayName('char');if(!_.some(l.likes,e=>e.name===a)&&(l.likes.push({key:e.key,name:a,originalLogIndex:t}),e.key.startsWith('CHAR')&&!r)){t>i&&(s=!0)}}else if(l.comments.push({...e,originalLogIndex:t}),e.key.startsWith('CHAR')&&!r){t>i&&(s=!0)}}else console.warn(`[BLMX] Could not find target post for interaction. target_post_id: ${e.data.target_post_id}, available posts: ${Object.keys(n).join(', ')}`,e)}if('key'in e&&'CHAR_MOMENT'===e.key){t>i&&!r&&(s=!0)}}),r||this.setMomentNotification(s),_.chain(n).values().reverse().forEach(e=>{const n=e.key.startsWith('USER'),s=n?this.getDisplayName('user'):this.getDisplayName('char'),i=n?t.user:t.char,r=$('<li>').addClass('moment-post').attr('data-post-id',e.id),l=o.indexOf(e.id);r.attr('data-moment-sequence-id',String(l)),r.attr('data-moment-id',String(l));let c='';'url'===e.data.image_type&&e.data.image?c=`<img src="${e.data.image}" class="post-media-image" />`:'desc'===e.data.image_type&&e.data.image&&(c=`<div class="image-desc-content"><div class="text-wrapper">${e.data.image}</div></div>`);let d='';if(e.likes.length>0||e.comments.length>0){d=`<div class="post-interactions">${e.likes.length>0?`<div class="likes-section"><i class="fas fa-heart"></i> ${_.map(e.likes,e=>`<span class="liker-name">${e.name}</span>`).join(', ')}</div>`:''}${e.comments.length>0?`<ul class="comments-section">${_.map(e.comments,e=>`<li><span class="comment-author">${e.key.startsWith('USER')?this.getDisplayName('user'):this.getDisplayName('char')}</span>: ${e.data.text}</li>`).join('')}</ul>`:''}</div>`}const g=this.formatMomentTime(e.data.date,e.data.time);r.html(`<img src="${i}" class="post-author-avatar" />\n                 <div class="post-details">\n                     <span class="post-author-name">${s}</span>\n                     <p class="post-content">${e.data.text||''}</p>\n                     <div class="post-media">${c}</div>\n                     <div class="post-meta">\n                         <div class="post-meta-left">\n                             <span class="timestamp">${g}</span>\n                             <span class="delete-moment-btn" title="åˆ é™¤">åˆ é™¤</span>\n                         </div>\n                         <div class="post-actions">\n                             <span class="comment-button" title="è¯„è®º/ç‚¹èµ"><i class="fas fa-comment-dots"></i></span>\n                         </div>\n                     </div>\n                     ${d}\n                 </div>`),a.append(r)}).value();const l=this.configManager.getSavedCoverPhoto();l&&$('#moments-cover-photo').attr('src',l)}formatMomentTime(e,t){try{const a=window.currentGameDate?new Date(window.currentGameDate):new Date,n=new Date(`${e} ${t}`),o=a.getTime()-n.getTime(),s=Math.floor(o/6e4),i=Math.floor(s/60),r=Math.floor(i/24);if(s<1)return'åˆšåˆš';if(s<60)return`${s}åˆ†é’Ÿå‰`;if(i<24)return`${i}å°æ—¶å‰`;if(1===r)return'æ˜¨å¤©';if(2===r)return'å‰å¤©';if(r<7)return`${r}å¤©å‰`;{const e=n.getMonth()+1;return`${e}æœˆ${n.getDate()}æ—¥`}}catch(a){return console.error('æ—¶é—´æ ¼å¼åŒ–é”™è¯¯:',a),`${e} ${t}`}}getDisplayName(e){return this.configManager.getDisplayName(e)}isInMomentsView(){return $('#moments-view').hasClass('active')}hasMomentNotifications(){return this.configManager.getMomentNotificationState()}setMomentNotification(e){this.hasMomentNotification=e,this.configManager.setMomentNotificationState(e),this.updateMomentNotificationIndicator()}updateMomentNotificationIndicator(){const e=$('#wechat-options-btn');this.hasMomentNotification?e.find('.notification-dot').length||e.append('<span class="notification-dot"></span>'):e.find('.notification-dot').remove()}getLastMomentViewTimestamp(){return this.configManager.getLastMomentViewTimestamp()}setLastMomentViewTimestamp(){const e=this.blmxManager.logEntries.length;this.configManager.setLastMomentViewTimestamp(e)}onEnterMomentsView(){const e=this.configManager.getSavedCoverPhoto();e&&$('#moments-cover-photo').attr('src',e);const t=this.configManager.getSavedSignature();$('#user-signature-display').text(t||'ç‚¹å‡»å¤´åƒè®¾ç½®ä¸ªæ€§ç­¾å'),this.setMomentNotification(!1),this.setLastMomentViewTimestamp()}createUserMoment(e,t='',a='none'){const n=window.currentGameDate||new Date;return{key:'USER_MOMENT',data:{text:e,image:t,image_type:a,date:`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,'0')}-${String(n.getDate()).padStart(2,'0')}`,time:`${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')}`}}}notifyMomentChange(e,t,a){let n='';switch(e){case'name':n=`æˆ‘æ”¹åå­—å•¦ï¼Œæ–°åå­—æ˜¯"${a}"`;break;case'signature':n=`æˆ‘çš„ä¸ªæ€§ç­¾åå·²æ›´æ”¹ä¸ºï¼š"${a}"`}const o=this.createUserMoment(n);this.blmxManager.addEntry(o),this.renderMomentsFeed()}notifyRecallViaMoments(e,t){const a=window.currentGameDate||new Date,n={key:'RECALL',data:{sender:e,target_text:t,timestamp:`${`${String(a.getHours()).padStart(2,'0')}:${String(a.getMinutes()).padStart(2,'0')}`}`}};return this.blmxManager.addEntry(n),n}}class O{themeManager;onThemeChanged;$modal;checkboxHandlers=new Map;constructor(e,t){this.themeManager=e,this.onThemeChanged=t,this.$modal=$('#theme-editor-modal')}setupThemeSelector(){const e=$('.theme-options');if(!e.length)return;e.empty();const t=this.themeManager.getThemes();_.forEach(t,t=>{const a=$('<div>').addClass('theme-option').css({width:'calc(50% - 0.5rem)','aspect-ratio':'1/1','border-radius':'8px','background-color':t.colors.primary,display:'flex','flex-direction':'column','align-items':'center','justify-content':'center',cursor:'pointer',position:'relative',overflow:'hidden','box-shadow':'0 2px 8px rgba(0,0,0,0.1)'}),n=$('<div>').css({position:'absolute',top:0,left:0,width:'100%',height:'100%',background:`linear-gradient(135deg, ${t.colors.gradientStart}, ${t.colors.gradientEnd})`}),o=$('<div>').css({position:'relative',width:'70%',height:'60%',display:'flex','flex-direction':'column','justify-content':'space-between','z-index':1}),s=$('<div>').css({'align-self':'flex-start',width:'60%',height:'40%','background-color':t.colors.bubbleThemBg,'border-radius':'8px'}),i=$('<div>').css({'align-self':'flex-end',width:'60%',height:'40%','background-color':t.colors.bubbleMeBg,'border-radius':'8px'});o.append(s,i);const r=$('<div>').text(t.displayName).css({position:'relative',color:'white','font-size':'0.8rem','font-weight':'500','margin-top':'5px','text-shadow':'0 1px 2px rgba(0,0,0,0.3)','z-index':1});a.append(n,o,r),a.on('click',()=>{this.themeManager.switchTheme(t.name),this.onThemeChanged&&this.onThemeChanged()}),e.append(a)}),this.addCustomThemeSelector(e)}addCustomThemeEditButton(){const e=$('.settings-panel');if(!e.length)return;const t=$('<div>').addClass('custom-theme-edit-button').css({width:'100%',padding:'12px 16px',margin:'8px 0','border-radius':'8px',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',color:'white','font-size':'0.9rem','font-weight':'500','text-align':'center',cursor:'pointer','box-shadow':'0 2px 8px rgba(0,0,0,0.1)',transition:'all 0.2s ease',display:'flex','align-items':'center','justify-content':'center',gap:'8px'}),a=$('<span>').html('ğŸ¨'),n=$('<span>').text('è‡ªå®šä¹‰ä¸»é¢˜è®¾ç½®');t.append(a,n),t.on('mouseenter',function(){$(this).css('transform','translateY(-1px)')}).on('mouseleave',function(){$(this).css('transform','translateY(0)')}),t.on('click',()=>{this.openThemeEditor()});const o=e.find('.theme-options');o.length?o.after(t):e.append(t)}addCustomThemeSelector(e){const t=this.getCustomThemeData(),a=$('<div>').addClass('theme-option custom-theme-option').css({width:'calc(50% - 0.5rem)','aspect-ratio':'1/1','border-radius':'8px',background:t.background,display:'flex','flex-direction':'column','align-items':'center','justify-content':'center',cursor:'pointer',position:'relative',overflow:'hidden','box-shadow':'0 2px 8px rgba(0,0,0,0.1)'}),n=$('<div>').css({position:'absolute',top:0,left:0,width:'100%',height:'100%',background:t.gradient}),o=$('<div>').html('âœ¨').css({'font-size':'2rem','margin-bottom':'5px',position:'relative','z-index':1}),s=$('<div>').text(t.displayName).css({color:'white','font-size':'0.8rem','font-weight':'500','text-shadow':'0 1px 2px rgba(0,0,0,0.3)',position:'relative','z-index':1});a.append(n,o,s),a.on('click',()=>{this.themeManager.switchTheme('custom'),this.onThemeChanged&&this.onThemeChanged()}),e.append(a)}getCustomThemeData(){try{const e=localStorage.getItem('blmx_custom_theme');if(e){const t=JSON.parse(e),a=t.colors?.primary||'#667eea',n=t.colors?.gradientStart||a,o=t.colors?.gradientEnd||a;return{displayName:t.displayName||'è‡ªå®šä¹‰ä¸»é¢˜',background:a,gradient:`linear-gradient(135deg, ${n}, ${o})`}}}catch(e){console.warn('Failed to load custom theme data:',e)}return{displayName:'è‡ªå®šä¹‰ä¸»é¢˜',background:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',gradient:'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'}}updateCustomThemeButton(){const e=$('.custom-theme-option');if(!e.length)return;const t=this.getCustomThemeData(),a=e.children().eq(0);a.length&&a.css('background',t.gradient);const n=e.children().last();n.length&&n.text()!==t.displayName&&n.text(t.displayName),e.css('background',t.background)}openThemeEditor(){if(!this.$modal.length)return;const e=this.themeManager.getCurrentThemeWithAppliedValues();this.fillThemeEditor(e),this.setupCheckboxes(),this.$modal.show()}closeThemeEditor(){this.$modal.hide(),this.cleanupCheckboxes()}fillThemeEditor(e){const t=$('#theme-name-input'),a=$('#dark-mode-toggle'),n=$('#single-color-icons-toggle');let o;o='custom'===e.name?e.displayName||'æˆ‘çš„è‡ªå®šä¹‰ä¸»é¢˜':`è‡ªå®šä¹‰ ${e.displayName}`,t.val(o);const s={'#phone-frame-color':e.colors.phoneFrame,'#primary-color':e.colors.primary,'#light-color':e.colors.light,'#ultra-light-color':e.colors.ultraLight,'#deep-color':e.colors.deep,'#text-primary-color':e.colors.textPrimary,'#text-secondary-color':e.colors.textSecondary,'#bubble-me-color':e.colors.bubbleMeBg,'#bubble-me-text-color':e.colors.bubbleMeText,'#bubble-them-color':e.colors.bubbleThemBg,'#bubble-them-text-color':e.colors.bubbleThemText,'#status-bar-color':e.colors.statusBarColor,'#dynamic-island-color':e.colors.dynamicIslandColor,'#border-color':e.colors.borderColor,'#shadow-color':e.colors.shadowColor};_.forEach(s,(e,t)=>{$(t).val(this.convertToHex(e))}),a.prop('checked',e.colors.isDarkMode),n.prop('checked',e.colors.useSingleColorIcons||!1)}setupCheckboxes(){this.cleanupCheckboxes(),this.setupSingleCheckboxWithJQuery('dark-mode-toggle','dark-mode-checkbox-button'),this.setupSingleCheckboxWithJQuery('single-color-icons-toggle','single-color-icons-checkbox-button')}cleanupCheckboxes(){this.checkboxHandlers.forEach((e,t)=>{$(`#${t}`).off('click',e)}),this.checkboxHandlers.clear()}setupSingleCheckboxWithJQuery(e,t){const a=$(`#${e}`),n=$(`#${t}`);if(!a.length||!n.length)return;const o=e=>{n.toggleClass('checked',e)},s=e=>{e.preventDefault(),e.stopPropagation();const t=a[0];t.checked=!t.checked,o(t.checked)};this.checkboxHandlers.set(t,s),n.on('click',s);const i=a[0];o(i.checked)}resetThemeEditor(){const e=this.themeManager.getThemes().blue;this.fillThemeEditor(e),this.setupCheckboxes()}exportThemeAsJSON(){try{const e=this.getCurrentThemeFromEditor(),t=this.themeManager.getWallpaperManager(),a={chat:t.getCurrentWallpaper('chat'),home:t.getCurrentWallpaper('home'),settings:t.getCurrentWallpaper('settings')},n={name:e.name,displayName:e.displayName,version:'1.0',exportDate:(new Date).toISOString(),colors:e.colors,wallpapers:a},o=JSON.stringify(n,null,2),s=new Blob([o],{type:'application/json'}),i=URL.createObjectURL(s),r=e.displayName||'è‡ªå®šä¹‰ä¸»é¢˜',l=`custom-${r.replace(/[<>:"/\\|?*]/g,'_')}.json`,c=$('<a>',{href:i,download:l,css:{display:'none'}});$('body').append(c),c[0].click(),c.remove(),URL.revokeObjectURL(i),console.log(`[ThemeEditor] ä¸»é¢˜å·²å¯¼å‡ºä¸ºJSON: ${l}`)}catch(e){console.error('[ThemeEditor] å¯¼å‡ºJSONå¤±è´¥:',e),alert('å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•')}}importTheme(){const e=document.createElement('input');e.type='file',e.accept='.json',e.style.display='none',e.addEventListener('change',e=>{const t=e.target.files?.[0];if(!t)return;const a=new FileReader;a.onload=e=>{try{const a=e.target?.result;let n;if(!t.name.endsWith('.json'))throw new Error('åªæ”¯æŒJSONæ ¼å¼çš„ä¸»é¢˜æ–‡ä»¶');if(n=JSON.parse(a),!this.validateThemeData(n))throw new Error('ä¸»é¢˜æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');this.applyImportedTheme(n),console.log('[ThemeEditor] ä¸»é¢˜å¯¼å…¥æˆåŠŸ'),alert('ä¸»é¢˜å¯¼å…¥æˆåŠŸï¼')}catch(e){console.error('[ThemeEditor] å¯¼å…¥å¤±è´¥:',e),alert(`å¯¼å…¥å¤±è´¥: ${e instanceof Error?e.message:'æœªçŸ¥é”™è¯¯'}`)}},a.readAsText(t)}),$('body').append(e),e.click(),$(e).remove()}getCurrentThemeFromEditor(){const e=(e,t='')=>$(e).val()||t,t=e=>$(e).prop('checked');return this.createCustomTheme({name:e('#theme-name-input','è‡ªå®šä¹‰ä¸»é¢˜'),phoneFrame:e('#phone-frame-color','#b4d0fa'),primary:e('#primary-color','#72adf3'),light:e('#light-color','#a8cbeb'),ultraLight:e('#ultra-light-color','#e8f4fd'),deep:e('#deep-color','#2c5282'),textPrimary:e('#text-primary-color','rgb(139, 162, 186)'),textSecondary:e('#text-secondary-color','#64748b'),bubbleMeBg:e('#bubble-me-color','#a8cbeb'),bubbleMeText:e('#bubble-me-text-color','#ffffff'),bubbleThemBg:e('#bubble-them-color','#ffffff'),bubbleThemText:e('#bubble-them-text-color','#72adf3'),appBgColor:'#ffffff',settingsBgColor:'#f2f2f7',settingsCardBgColor:'#ffffff',statusBar:e('#status-bar-color','#428af2'),dynamicIsland:e('#dynamic-island-color','#a0c4f4'),border:e('#border-color','#E0E0E0'),shadow:e('#shadow-color','#4a90e2'),isDarkMode:t('#dark-mode-toggle'),useSingleColorIcons:t('#single-color-icons-toggle')})}saveCustomTheme(){const e=this.getCurrentThemeFromEditor();this.themeManager.saveCustomTheme(e),this.themeManager.switchTheme('custom'),this.updateCustomThemeButton(),this.closeThemeEditor(),this.onThemeChanged&&this.onThemeChanged()}createCustomTheme(e){const{name:t,phoneFrame:a,primary:n,light:o,ultraLight:s,deep:i,textPrimary:r,textSecondary:l,bubbleMeBg:c,bubbleMeText:d,bubbleThemBg:g,bubbleThemText:p,appBgColor:m,settingsBgColor:h,settingsCardBgColor:u,statusBar:f,dynamicIsland:b,border:y,shadow:v,isDarkMode:w,useSingleColorIcons:S}=e,M=parseInt(v.slice(1,3),16),x=parseInt(v.slice(3,5),16),k=parseInt(v.slice(5,7),16),E=w?'rgba(0, 0, 0, 0.5)':`rgba(${M}, ${x}, ${k}, 0.3)`,C=`0 2px 8px rgba(${M}, ${x}, ${k}, 0.15)`,T=this.lightenDarkenColor(n,20),D=this.lightenDarkenColor(n,-10),I=this.lightenDarkenColor(o,-10),L=w?'linear-gradient(315deg, #333333 0%, #444444 100%)':`linear-gradient(315deg, ${this.lightenDarkenColor(s,-5)} 0%, ${s} 100%)`;return{name:'custom',displayName:t,colors:{phoneFrame:a,phoneFrameGradient:[this.lightenDarkenColor(a,-40),a,this.lightenDarkenColor(a,20),this.lightenDarkenColor(a,-40)],primary:n,light:o,ultraLight:s,soft:I,deep:i,textPrimary:r,textSecondary:l,textColor:'#ffffff',bubbleMeBg:c,bubbleMeText:d,bubbleThemBg:g,bubbleThemText:p,headerBg:L,appBgColor:m,settingsBgColor:h,settingsCardBgColor:u,gradientStart:T,gradientEnd:D,statusBarColor:f,dynamicIslandColor:b,borderColor:y,shadowColor:v,shadowColorRgba:E,bubbleShadow:C,isDarkMode:w,defaultWallpapers:{chat:w?'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/æ·±è‰²æ˜Ÿæ˜Ÿ_1.jpg':'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/è“è‰²_3.jpg',home:w?'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/æ·±è‰²æ˜Ÿæ˜Ÿ_1.jpg':'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/è“è‰²_2.jpg',settings:w?'#1a1a1a':'#f2f7fd'},useSingleColorIcons:S}}}lightenDarkenColor(e,t){let a=!1;'#'===e[0]&&(e=e.slice(1),a=!0);const n=parseInt(e,16);let o=(n>>16)+t;o>255?o=255:o<0&&(o=0);let s=(n>>8&255)+t;s>255?s=255:s<0&&(s=0);let i=(255&n)+t;return i>255?i=255:i<0&&(i=0),(a?'#':'')+(i|s<<8|o<<16).toString(16)}convertToHex(e){if(e.startsWith('#'))return e;const t=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(t){return'#'+((1<<24)+(parseInt(t[1])<<16)+(parseInt(t[2])<<8)+parseInt(t[3])).toString(16).slice(1)}const a=e.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*[\d.]+\)/);if(a){return'#'+((1<<24)+(parseInt(a[1])<<16)+(parseInt(a[2])<<8)+parseInt(a[3])).toString(16).slice(1)}return console.warn(`[ThemeEditor] æ— æ³•è½¬æ¢é¢œè‰²æ ¼å¼: ${e}`),'#000000'}validateThemeData(e){if(!e||'object'!=typeof e)return!1;const t=['name','colors'];for(const a of t)if(!(a in e))return!1;const a=e.colors;if(!a||'object'!=typeof a)return!1;const n=['primary','phoneFrame','textPrimary','textSecondary'];for(const e of n)if(!(e in a))return!1;return!0}applyImportedTheme(e){$('#theme-name-input').val(e.displayName||e.name||'å¯¼å…¥çš„ä¸»é¢˜');const t={'#phone-frame-color':e.colors.phoneFrame,'#primary-color':e.colors.primary,'#light-color':e.colors.light,'#ultra-light-color':e.colors.ultraLight,'#deep-color':e.colors.deep,'#text-primary-color':e.colors.textPrimary,'#text-secondary-color':e.colors.textSecondary,'#bubble-me-color':e.colors.bubbleMeBg,'#bubble-me-text-color':e.colors.bubbleMeText,'#bubble-them-color':e.colors.bubbleThemBg,'#bubble-them-text-color':e.colors.bubbleThemText,'#status-bar-color':e.colors.statusBarColor,'#dynamic-island-color':e.colors.dynamicIslandColor,'#border-color':e.colors.borderColor,'#shadow-color':e.colors.shadowColor};_.forEach(t,(e,t)=>{e&&$(t).val(this.convertToHex(e))}),'isDarkMode'in e.colors&&$('#dark-mode-toggle').prop('checked',e.colors.isDarkMode),'useSingleColorIcons'in e.colors&&$('#single-color-icons-toggle').prop('checked',e.colors.useSingleColorIcons),e.wallpapers&&this.applyImportedWallpapers(e.wallpapers),this.setupCheckboxes()}applyImportedWallpapers(e){try{const t=this.themeManager.getWallpaperManager();['chat','home','settings'].forEach(a=>{const n=e[a];n&&t.setWallpaper(a,n)}),console.log('[ThemeEditor] å£çº¸è®¾ç½®å·²å¯¼å…¥')}catch(e){console.warn('[ThemeEditor] å¯¼å…¥å£çº¸è®¾ç½®å¤±è´¥:',e)}}}const W='1.1.0',H={blue:{name:'blue',displayName:'è“è‰²ä¸»é¢˜',colors:{phoneFrame:'#b4d0fa',phoneFrameGradient:['#4a95ed','#98c2f5','#accef2','#4a95ed'],primary:'#72adf3',light:'#a8cbeb',ultraLight:'#e8f4fd',soft:'#b8d4f0',deep:'#2c5282',gradientStart:'#98c2f5',gradientEnd:'#accef2',textColor:'#ffffff',textPrimary:'rgb(139, 162, 186)',textSecondary:'#64748b',borderColor:'#cbd5e1',bubbleShadow:'0 2px 8px rgba(74, 144, 226, 0.15)',bubbleThemBg:'#ffffff',bubbleMeBg:'#a8cbeb',bubbleThemText:'#72adf3',bubbleMeText:'#ffffff',headerBg:'linear-gradient(315deg, #eef4ff 0%, #f8faff 100%)',statusBarColor:'#428af2',dynamicIslandColor:'#a0c4f4',appBgColor:'#ffffff',settingsBgColor:'#f2f2f7',settingsCardBgColor:'#ffffff',shadowColor:'#4a90e2',shadowColorRgba:'rgba(74, 144, 226, 0.3)',isDarkMode:!1,defaultWallpapers:{chat:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/è“è‰²_3.jpg',home:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/è“è‰²_2.jpg',settings:'#f2f7fd'},useSingleColorIcons:!0}},pink:{name:'pink',displayName:'ç²‰è‰²ä¸»é¢˜',colors:{phoneFrame:'#fad0e8',phoneFrameGradient:['#ed4a9e','#f598c8','#f2acce','#ed4a9e'],primary:'#f372ad',light:'#eba8cb',ultraLight:'#fde8f4',soft:'#f0b8d4',deep:'#822c5c',gradientStart:'#f598c8',gradientEnd:'#f2acce',textColor:'#ffffff',textPrimary:'rgb(186, 139, 162)',textSecondary:'#8b647a',borderColor:'#e1cbd5',bubbleShadow:'0 2px 8px rgba(226, 74, 144, 0.15)',bubbleThemBg:'#ffffff',bubbleMeBg:'#eba8cb',bubbleThemText:'#f372ad',bubbleMeText:'#ffffff',headerBg:'linear-gradient(315deg, #ffeeef 0%, #fff8fa 100%)',statusBarColor:'#ed72ad',dynamicIslandColor:'#f4a0c4',appBgColor:'#ffffff',settingsBgColor:'#fff2f7',settingsCardBgColor:'#ffffff',shadowColor:'#e24a90',shadowColorRgba:'rgba(226, 74, 144, 0.3)',isDarkMode:!1,defaultWallpapers:{chat:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç²‰è‰²æ˜Ÿæ˜Ÿ_1.jpg',home:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç²‰è‰²æ ¼å­_3.jpg',settings:'#fdf2f7'},useSingleColorIcons:!0}},white:{name:'white',displayName:'å¾®ä¿¡ä¸»é¢˜',colors:{phoneFrame:'#000000',phoneFrameGradient:['#000000','#222222','#333333','#000000'],primary:'#999999',light:'#cccccc',ultraLight:'#f8f8f8',soft:'#e0e0e0',deep:'#666666',gradientStart:'#cccccc',gradientEnd:'#dddddd',textColor:'#ffffff',textPrimary:'#333333',textSecondary:'#909090',borderColor:'#e0e0e0',bubbleShadow:'0 2px 8px rgba(0, 0, 0, 0.08)',bubbleThemBg:'#ffffff',bubbleMeBg:'#A0E75A',bubbleThemText:'#333333',bubbleMeText:'#333333',headerBg:'linear-gradient(315deg, #f5f5f5 0%, #ffffff 100%)',statusBarColor:'#000000',dynamicIslandColor:'#000000',appBgColor:'#ffffff',settingsBgColor:'#f5f5f5',settingsCardBgColor:'#ffffff',shadowColor:'#999999',shadowColorRgba:'rgba(0, 0, 0, 0.1)',isDarkMode:!1,defaultWallpapers:{chat:'#EDEDED',home:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç™½è‰²_1.jpg',settings:'#f5f5f5'},useSingleColorIcons:!1}},dark:{name:'dark',displayName:'å¤œé—´æ¨¡å¼',colors:{phoneFrame:'#2c2c2c',phoneFrameGradient:['#1a1a1a','#2c2c2c','#3c3c3c','#1a1a1a'],primary:'#505050',light:'#3c3c3c',ultraLight:'#1a1a1a',soft:'#2c2c2c',deep:'#c0c0c0',gradientStart:'#3c3c3c',gradientEnd:'#2c2c2c',textColor:'#e0e0e0',textPrimary:'#c0c0c0',textSecondary:'#a0a0a0',borderColor:'#3c3c3c',bubbleShadow:'0 2px 8px rgba(0, 0, 0, 0.3)',bubbleThemBg:'#2a2a2a',bubbleMeBg:'#505050',bubbleThemText:'#e0e0e0',bubbleMeText:'#c0c0c0',headerBg:'linear-gradient(315deg, #2c2c2c 0%, #1a1a1a 100%)',statusBarColor:'#888888',dynamicIslandColor:'#3c3c3c',appBgColor:'#1a1a1a',settingsBgColor:'#1a1a1a',settingsCardBgColor:'#2c2c2c',shadowColor:'#000000',shadowColorRgba:'rgba(0, 0, 0, 0.5)',isDarkMode:!0,defaultWallpapers:{chat:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/æ·±è‰²æ˜Ÿæ˜Ÿ_1.jpg',home:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/æ·±è‰²æ˜Ÿæ˜Ÿ_1.jpg',settings:'#1a1a1a'},useSingleColorIcons:!1}}};class U{static THEME_STORAGE_KEY='blmx_theme';static CUSTOM_THEME_STORAGE_KEY='blmx_custom_theme';static VERSION_STORAGE_KEY='blmx_app_version';currentTheme;wallpaperManager;constructor(){this.checkVersion();const e=localStorage.getItem(U.THEME_STORAGE_KEY)||'white';if('custom'===e)try{const e=localStorage.getItem(U.CUSTOM_THEME_STORAGE_KEY);this.currentTheme=e?JSON.parse(e):H.white}catch(e){console.error('Failed to load custom theme:',e),this.currentTheme=H.white}else this.currentTheme=H[e]||H.white;this.wallpaperManager=new G,this.applyTheme(this.currentTheme)}checkVersion(){const e=localStorage.getItem(U.VERSION_STORAGE_KEY);e&&e===W||(console.log(`ç‰ˆæœ¬æ›´æ–°: ${e||'åˆæ¬¡å®‰è£…'} -> ${W}, æ¸…ç†è¿‡æ—¶æ•°æ®...`),this.cleanOutdatedData(),localStorage.setItem(U.VERSION_STORAGE_KEY,W))}cleanOutdatedData(){const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a&&(a.startsWith('blmx_user_name_')||a.startsWith('blmx_user_avatar_')||a.startsWith('blmx_char_avatar_')||a.startsWith('blmx_remark_')||a.startsWith('blmx_signature_')||a.startsWith('blmx_cover_photo_')||a.startsWith('blmx_input_placeholder_'))&&e.push(a)}const t={};e.forEach(e=>{const a=localStorage.getItem(e);a&&(t[e]=a)});for(let e=localStorage.length-1;e>=0;e--){const t=localStorage.key(e);t&&t.startsWith('blmx_')&&localStorage.removeItem(t)}Object.entries(t).forEach(([e,t])=>{localStorage.setItem(e,t)})}getCurrentTheme(){return this.currentTheme}getCurrentThemeWithAppliedValues(){const e={...this.currentTheme},t={...e.colors},a=document.documentElement,n=getComputedStyle(a),o={phoneFrame:n.getPropertyValue('--phoneFrame').trim(),primary:n.getPropertyValue('--primary-blue').trim(),light:n.getPropertyValue('--light-blue').trim(),ultraLight:n.getPropertyValue('--ultra-light-blue').trim(),soft:n.getPropertyValue('--soft-blue').trim(),deep:n.getPropertyValue('--deep-blue').trim(),textColor:n.getPropertyValue('--text-color').trim(),textPrimary:n.getPropertyValue('--text-primary').trim(),textSecondary:n.getPropertyValue('--text-secondary').trim(),borderColor:n.getPropertyValue('--border-color').trim(),bubbleShadow:n.getPropertyValue('--bubble-shadow').trim(),bubbleThemBg:n.getPropertyValue('--wechat-bubble-them-bg').trim(),bubbleMeBg:n.getPropertyValue('--wechat-bubble-me-bg').trim(),bubbleThemText:n.getPropertyValue('--wechat-bubble-them-text').trim(),bubbleMeText:n.getPropertyValue('--wechat-bubble-me-text').trim(),headerBg:n.getPropertyValue('--header-bg').trim(),statusBarColor:n.getPropertyValue('--status-bar-color').trim(),dynamicIslandColor:n.getPropertyValue('--dynamic-island-color').trim(),appBgColor:n.getPropertyValue('--app-bg-color').trim(),settingsBgColor:n.getPropertyValue('--settings-bg-color').trim(),settingsCardBgColor:n.getPropertyValue('--settings-card-bg-color').trim(),shadowColor:n.getPropertyValue('--shadow-color').trim(),shadowColorRgba:n.getPropertyValue('--shadow-color-rgba').trim(),gradientStart:n.getPropertyValue('--blue-gradient-start').trim()||n.getPropertyValue('--primary-gradient-light').trim(),gradientEnd:n.getPropertyValue('--blue-gradient-end').trim()||n.getPropertyValue('--primary-gradient-dark').trim()};return Object.keys(o).forEach(e=>{const a=o[e];a&&''!==a&&(t[e]=a)}),t.isDarkMode=e.colors.isDarkMode,t.useSingleColorIcons=e.colors.useSingleColorIcons,t.phoneFrameGradient=e.colors.phoneFrameGradient,t.defaultWallpapers=e.colors.defaultWallpapers,{...e,colors:t}}getThemes(){return H}getWallpaperManager(){return this.wallpaperManager}switchTheme(e){if('custom'===e)try{const e=localStorage.getItem(U.CUSTOM_THEME_STORAGE_KEY);e&&(this.currentTheme=JSON.parse(e),localStorage.setItem(U.THEME_STORAGE_KEY,'custom'),this.wallpaperManager.setCurrentThemeName('custom'),this.applyTheme(this.currentTheme),this.wallpaperManager.applyThemeDefaultWallpapers(this.currentTheme))}catch(e){console.error('Failed to load custom theme:',e)}else H[e]&&(this.currentTheme=H[e],localStorage.setItem(U.THEME_STORAGE_KEY,e),this.wallpaperManager.setCurrentThemeName(e),this.applyTheme(this.currentTheme),this.wallpaperManager.applyThemeDefaultWallpapers(this.currentTheme))}saveCustomTheme(e){this.currentTheme=e,localStorage.setItem(U.CUSTOM_THEME_STORAGE_KEY,JSON.stringify(e)),localStorage.setItem(U.THEME_STORAGE_KEY,'custom'),this.wallpaperManager.setCurrentThemeName('custom'),this.applyTheme(e),this.wallpaperManager.applyThemeDefaultWallpapers(e)}applyTheme(e){const t=e.colors,a=document.documentElement;if(a.style.setProperty('--phoneFrame',t.phoneFrame),a.style.setProperty('--primary-blue',t.primary),a.style.setProperty('--light-blue',t.light),a.style.setProperty('--ultra-light-blue',t.ultraLight),a.style.setProperty('--blue-gradient-start',t.gradientStart),a.style.setProperty('--blue-gradient-end',t.gradientEnd),a.style.setProperty('--soft-blue',t.soft),a.style.setProperty('--deep-blue',t.deep),a.style.setProperty('--text-color',t.textColor),a.style.setProperty('--text-primary',t.textPrimary),a.style.setProperty('--text-secondary',t.textSecondary),a.style.setProperty('--border-color',t.borderColor),t.useSingleColorIcons){document.body.classList.add('single-color-icon');const e=this.lightenDarkenColor(t.primary,20),n=this.lightenDarkenColor(t.primary,-20);a.style.setProperty('--primary-gradient-light',e),a.style.setProperty('--primary-gradient-dark',n)}else document.body.classList.remove('single-color-icon'),a.style.setProperty('--wechat-green-icon',(e.name,'#07C160')),a.style.setProperty('--settings-icon-color',(e.name,'#8a8a8a'));a.style.setProperty('--wechat-green-bubble',t.light),a.style.setProperty('--wechat-bg',t.ultraLight),a.style.setProperty('--link-color',t.primary),a.style.setProperty('--text-color',t.textColor),a.style.setProperty('--text-primary',t.textPrimary),a.style.setProperty('--text-secondary',t.textSecondary),a.style.setProperty('--border-color',t.borderColor),a.style.setProperty('--header-bg',t.headerBg),a.style.setProperty('--bubble-shadow',t.bubbleShadow),a.style.setProperty('--wechat-bubble-them-bg',t.bubbleThemBg),a.style.setProperty('--wechat-bubble-me-bg',t.bubbleMeBg),a.style.setProperty('--wechat-bubble-them-text',t.bubbleThemText||t.primary),a.style.setProperty('--wechat-bubble-me-text',t.bubbleMeText||'#ffffff'),a.style.setProperty('--status-bar-color',t.statusBarColor),a.style.setProperty('--dynamic-island-color',t.dynamicIslandColor),a.style.setProperty('--app-bg-color',t.appBgColor),a.style.setProperty('--settings-bg-color',t.settingsBgColor),a.style.setProperty('--settings-card-bg-color',t.settingsCardBgColor),a.style.setProperty('--input-bg',t.isDarkMode?'#2a2a2a':'#ffffff'),a.style.setProperty('--shadow-color',t.shadowColor),a.style.setProperty('--shadow-color-rgba',t.shadowColorRgba);const n=this.extractRgbComponents(t.shadowColor);a.style.setProperty('--shadow-r',n.r.toString()),a.style.setProperty('--shadow-g',n.g.toString()),a.style.setProperty('--shadow-b',n.b.toString()),t.isDarkMode?document.body.classList.add('dark-mode'):document.body.classList.remove('dark-mode');const o=document.querySelector('.phone-frame');if(o){o.style.background=t.phoneFrame;const e=t.phoneFrameGradient.join(', ');let a=document.getElementById('phone-frame-style');a||(a=document.createElement('style'),a.id='phone-frame-style',document.head.appendChild(a)),a.textContent=`\n        .phone-frame::before {\n          background: linear-gradient(45deg, ${e});\n          background-size: 400% 400%;\n        }\n      `}const s=document.querySelector('.dynamic-island');s&&(s.style.background=t.dynamicIslandColor);const i=document.querySelector('.status-left'),r=document.querySelector('.status-right');i&&r&&(i.style.color=t.statusBarColor,r.style.color=t.statusBarColor);const l=document.getElementById('settings-view');l&&(l.style.backgroundColor=t.settingsBgColor);document.querySelectorAll('.settings-card').forEach(e=>{e.style.backgroundColor=t.settingsCardBgColor}),o&&(o.style.boxShadow=`\n        0 15px 20px ${this.hexToRgba(t.shadowColor,.25)},\n        0 8px 20px ${this.hexToRgba(t.shadowColor,.15)},\n        0 3px 8px rgba(0, 0, 0, 0.1),\n        inset 0 1px 0 rgba(255, 255, 255, 0.5),\n        inset 0 -1px 0 rgba(255, 255, 255, 0.2),\n        0 5px ${this.hexToRgba(t.shadowColor,.08)}\n      `);const c=document.createElement('style');c.id='theme-dynamic-styles',c.textContent=`\n      /* å¾®ä¿¡ä¸»é¢˜ä¸‹çš„æ°”æ³¡æ ·å¼ - ç›´æ¥åº”ç”¨ç»¿è‰² */\n      .message-row.me .message-bubble {\n        background-color: ${t.bubbleMeBg} !important;\n        background: ${t.bubbleMeBg} !important;\n        color: ${t.bubbleMeText||'#ffffff'} !important;\n        box-shadow: 0 4px 12px ${this.hexToRgba(t.shadowColor,.3)};\n      }\n      \n      /* å¯¹æ–¹æ°”æ³¡æ ·å¼ */\n      .message-row.them .message-bubble {\n        background-color: ${t.bubbleThemBg} !important;\n        background: ${t.bubbleThemBg} !important;\n        color: ${t.bubbleThemText||t.primary} !important;\n      }\n      \n      /* ç¡®ä¿è¯­éŸ³æ°”æ³¡ä¹Ÿä½¿ç”¨æ­£ç¡®çš„é¢œè‰² */\n      .message-row.me .message-bubble.voice-bubble {\n        background: ${t.bubbleMeBg} !important;\n        background-color: ${t.bubbleMeBg} !important;\n        background-image: none !important;\n        color: ${t.bubbleMeText||'#ffffff'} !important;\n      }\n      \n      .message-row.them .message-bubble.voice-bubble {\n        background: ${t.bubbleThemBg} !important;\n        color: ${t.bubbleThemText||t.primary} !important;\n      }\n      \n      /* æœ‹å‹åœˆæ–‡å­—æè¿°å›¾ç‰‡æ ·å¼ */\n      .post-media .image-desc-content {\n        background-color: ${this.hexToRgba(t.primary,.1)} !important;\n        border: 1px solid ${this.hexToRgba(t.primary,.1)} !important;\n      }\n      \n      /* å‘é€æŒ‰é’®æ ·å¼ */\n      .wechat-footer .send-btn {\n        box-shadow: 0 4px 12px ${this.hexToRgba(t.shadowColor,.3)};\n      }\n      \n      .wechat-footer .send-btn:hover {\n        box-shadow: 0 6px 16px ${this.hexToRgba(t.shadowColor,.4)};\n      }\n      \n      /* å¤œé—´æ¨¡å¼ç‰¹æ®Šå¤„ç† */\n      ${t.isDarkMode?`\n        .settings-card p, \n        .settings-card a,\n        .settings-card li a,\n        .post-content,\n        .post-meta,\n        .theme-editor-modal .modal-content {\n          color: #e0e0e0 !important;\n        }\n        \n        .settings-card,\n        .theme-editor-modal .modal-content {\n          background-color: #2a2a2a !important;\n        }\n        \n        /* ä¿®æ”¹å¤œé—´æ¨¡å¼ä¸‹æ­£åœ¨è¾“å…¥æŒ‡ç¤ºå™¨æ ·å¼ */\n        .typing-indicator .message-bubble {\n          background-color: ${t.bubbleThemBg} !important;\n          background: ${t.bubbleThemBg} !important;\n          color: #ffffff !important;\n          border: none !important;\n        }\n        \n        .typing-dot {\n          background-color: rgba(255, 255, 255, 0.6) !important;\n        }\n        \n        .settings-card li {\n          border-bottom-color: #3c3c3c !important;\n        }\n        \n        .settings-card li a {\n          color: #a0a0a0 !important;\n        }\n        \n        #show-last-ai-response-btn,\n        #show-last-sent-prompt-btn {\n          background-color: #2c2c2c !important;\n          color: #a0a0a0 !important;\n        }\n\n        /* æœ‹å‹åœˆæš—è‰²æ¨¡å¼ */\n        #moments-view {\n          background: linear-gradient(180deg, #1a1a1a 0%, #252525 100%) !important;\n        }\n        \n        .moments-body {\n          background-color: #1a1a1a !important;\n        }\n        \n        .moment-post {\n          border-bottom-color: #2c2c2c !important;\n        }\n        \n        .post-interactions {\n          background: #2a2a2a !important;\n          border-color: #3c3c3c !important;\n        }\n        \n        .post-interactions::before {\n          border-bottom-color: #2a2a2a !important;\n        }\n        \n        .likes-section {\n          background: rgba(42, 42, 42, 0.8) !important;\n        }\n        \n        .comments-section {\n          border-top-color: #3c3c3c !important;\n        }\n        \n        .post-meta .comment-button {\n          background: #2c2c2c !important;\n        }\n\n        /* æœ‹å‹åœˆæ–‡å­—æè¿°å›¾ç‰‡æ ·å¼ - å¤œé—´æ¨¡å¼ */\n        .post-media .image-desc-content {\n          background-color: rgba(42, 42, 42, 0.8) !important;\n          border: 1px solid rgba(60, 60, 60, 0.4) !important;\n          color: #e0e0e0 !important;\n        }\n\n        /* æ›´å¤šå¤œé—´æ¨¡å¼æ ·å¼ */\n        .post-author-name, \n        .liker-name, \n        .comment-author {\n          color: #a0c0e0 !important;\n        }\n        \n        .moments-header,\n        .wechat-header {\n          background: linear-gradient(315deg, #252525 0%, #1a1a1a 100%) !important;\n          border-bottom-color: #3c3c3c !important;\n        }\n        \n        .wechat-footer {\n          background: linear-gradient(315deg, #252525 0%, #1a1a1a 100%) !important;\n          border-top-color: #3c3c3c !important;\n        }\n        \n        .wechat-footer .text-input {\n          background-color: #2a2a2a !important;\n          border-color: #3c3c3c !important;\n          color: #e0e0e0 !important;\n        }\n        \n        .wechat-footer .text-input::placeholder {\n          color: #808080 !important;\n        }\n        \n        .timestamp-text,\n        .event-time-text {\n          background: linear-gradient(315deg, #505050 0%, #3c3c3c 100%) !important;\n        }\n        \n        .recall-notice-text {\n          background: linear-gradient(315deg, #505050 0%, #3c3c3c 100%) !important;\n        }\n        \n        .message-row.them .voice-bubble .voice-icon {\n          color: #a0c0e0 !important;\n        }\n        \n        .voice-text-content {\n          background-color: #2a2a2a !important;\n          border-color: #3c3c3c !important;\n          color: #e0e0e0 !important;\n        }\n        \n        .location-card,\n        .file-card {\n          background-color: #2a2a2a !important;\n        }\n        \n        .location-content .location-title {\n          color: #e0e0e0 !important;\n        }\n        \n        .file-details .file-name {\n          color: #e0e0e0 !important;\n        }\n        \n        .file-footer {\n          background-color: #252525 !important;\n          border-top-color: #3c3c3c !important;\n        }\n        \n        .panel-container {\n          background-color: #1a1a1a !important;\n        }\n        \n        .feature-icon {\n          background-color: #2a2a2a !important;\n          border-color: #3c3c3c !important;\n        }\n        \n        .feature-label {\n          color: #a0a0a0 !important;\n        }\n        \n        /* Theme-colored icons in dark mode */\n        .feature-icon .theme-icon {\n          color: var(--primary-blue) !important;\n        }\n        \n        /* å£çº¸é€‰æ‹©å™¨æš—è‰²æ¨¡å¼ */\n        .wallpaper-container {\n          background-color: #2a2a2a !important;\n          color: #e0e0e0 !important;\n        }\n        \n        .wallpaper-container h2,\n        .wallpaper-container h3,\n        .wallpaper-container p {\n          color: #e0e0e0 !important;\n        }\n        \n        .wallpaper-container input[type="text"],\n        .wallpaper-container input[type="file"] {\n          background-color: #1a1a1a !important;\n          border-color: #3c3c3c !important;\n          color: #e0e0e0 !important;\n        }\n        \n        .wallpaper-item .name {\n          background-color: rgba(42, 42, 42, 0.9) !important;\n          color: #e0e0e0 !important;\n        }\n      `:''}\n    `;const d=document.getElementById('theme-dynamic-styles');d&&d.remove(),document.head.appendChild(c)}hexToRgba(e,t){return`rgba(${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}, ${t})`}extractRgbComponents(e){return{r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}}lightenDarkenColor(e,t){let a=e.replace('#','');3===a.length&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);const n=parseInt(a,16);let o=(n>>16)+t,s=(n>>8&255)+t,i=(255&n)+t;o=Math.max(0,Math.min(255,o)),s=Math.max(0,Math.min(255,s)),i=Math.max(0,Math.min(255,i));return`#${o.toString(16).padStart(2,'0')}${s.toString(16).padStart(2,'0')}${i.toString(16).padStart(2,'0')}`}}class G{static WALLPAPER_STORAGE_KEY_PREFIX='blmx_wallpaper_';static CUSTOM_WALLPAPERS_KEY='blmx_custom_wallpapers';static THEME_WALLPAPER_KEY_PREFIX='blmx_theme_wallpaper_';currentThemeName='white';builtInWallpapers=[{id:'blue_solid',type:'color',value:'#e8f4fd',name:'è“è‰²çº¯è‰²'},{id:'pink_solid',type:'color',value:'#fde8f4',name:'ç²‰è‰²çº¯è‰²'},{id:'white_solid',type:'color',value:'#f8f8f8',name:'ç™½è‰²çº¯è‰²'},{id:'dark_solid',type:'color',value:'#1a1a1a',name:'é»‘è‰²çº¯è‰²'},{id:'default_image',type:'image',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç™½è‰²_1.jpg',name:'ç™½è‰²å£çº¸'},{id:'dark_image',type:'image',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/æ·±è‰²æ˜Ÿæ˜Ÿ_1.jpg',name:'æ·±è‰²æ˜Ÿæ˜Ÿå£çº¸'},{id:'blue_theme',type:'image',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/è“è‰²æ˜Ÿæ˜Ÿ_1.jpg',name:'è“è‰²æ˜Ÿæ˜Ÿå£çº¸'},{id:'pink_theme',type:'image',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç²‰è‰²æ˜Ÿæ˜Ÿ_1.jpg',name:'ç²‰è‰²æ˜Ÿæ˜Ÿå£çº¸'},{id:'kitty_theme',type:'image',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç²‰è‰²å°çŒ«_1.jpg',name:'ç²‰è‰²å°çŒ«å£çº¸'},{id:'deep_stars_2',type:'image',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/æ·±è‰²æ˜Ÿæ˜Ÿ_2.jpg',name:'æ·±è‰²æ˜Ÿæ˜Ÿå£çº¸2'},{id:'deep_stars_3',type:'image',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/æ·±è‰²æ˜Ÿæ˜Ÿ_3.jpg',name:'æ·±è‰²æ˜Ÿæ˜Ÿå£çº¸3'},{id:'white_stars',type:'image',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç™½è‰²æ˜Ÿæ˜Ÿ_1.jpg',name:'ç™½è‰²æ˜Ÿæ˜Ÿå£çº¸'},{id:'pink_stars_2',type:'image',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç²‰è‰²æ˜Ÿæ˜Ÿ_2.jpg',name:'ç²‰è‰²æ˜Ÿæ˜Ÿå£çº¸2'},{id:'pink_grid_2',type:'image',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç²‰è‰²æ ¼å­_2.jpg',name:'ç²‰è‰²æ ¼å­å£çº¸2'},{id:'pink_grid_4',type:'image',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç²‰è‰²æ ¼å­_4.jpg',name:'ç²‰è‰²æ ¼å­å£çº¸4'},{id:'blue_1',type:'image',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/è“è‰²_1.jpg',name:'è“è‰²å£çº¸1'}];customWallpapers=[];constructor(){this.loadCustomWallpapers();const e=localStorage.getItem('blmx_theme');e&&(this.currentThemeName=e),this.migrateOldWallpaperSettings()}setCurrentThemeName(e){this.currentThemeName=e}getAllWallpapers(){return[...this.builtInWallpapers,...this.customWallpapers]}getBuiltInWallpapers(){return this.builtInWallpapers}getCustomWallpapers(){return this.customWallpapers}addCustomWallpaper(e){const t={...e,id:`custom_${Date.now()}`};return this.customWallpapers.push(t),this.saveCustomWallpapers(),t}deleteCustomWallpaper(e){const t=this.customWallpapers.length;return this.customWallpapers=this.customWallpapers.filter(t=>t.id!==e),this.customWallpapers.length!==t&&(this.saveCustomWallpapers(),!0)}setWallpaper(e,t){const a=`${G.THEME_WALLPAPER_KEY_PREFIX}${this.currentThemeName}_${e}`;t?localStorage.setItem(a,JSON.stringify(t)):localStorage.removeItem(a)}getCurrentWallpaper(e){const t=`${G.THEME_WALLPAPER_KEY_PREFIX}${this.currentThemeName}_${e}`,a=localStorage.getItem(t);if(a)try{return JSON.parse(a)}catch(e){console.error('Failed to parse theme wallpaper:',e)}const n=`${G.WALLPAPER_STORAGE_KEY_PREFIX}${e}`,o=localStorage.getItem(n);if(o)try{return JSON.parse(o)}catch(e){console.error('Failed to parse old wallpaper:',e)}return null}migrateOldWallpaperSettings(){['chat','home','settings'].forEach(e=>{const t=`${G.WALLPAPER_STORAGE_KEY_PREFIX}${e}`,a=localStorage.getItem(t);if(a)try{JSON.parse(a);const n=`${G.THEME_WALLPAPER_KEY_PREFIX}${this.currentThemeName}_${e}`;localStorage.getItem(n)||localStorage.setItem(n,a),localStorage.removeItem(t)}catch(e){console.error('Failed to migrate old wallpaper setting:',e)}})}applyThemeDefaultWallpapers(e){this.setCurrentThemeName(e.name);['chat','home','settings'].forEach(t=>{const a=`${G.THEME_WALLPAPER_KEY_PREFIX}${e.name}_${t}`;if(localStorage.getItem(a))return;const n=e.colors.defaultWallpapers[t],o={id:`theme_default_${t}`,type:n.startsWith('#')?'color':'image',value:n,name:`${e.displayName}é»˜è®¤${'chat'===t?'èŠå¤©':'home'===t?'ä¸»å±å¹•':'è®¾ç½®'}å£çº¸`};localStorage.setItem(a,JSON.stringify(o))})}applyWallpaperToElement(e,t,a){e&&(e.style.backgroundImage='none',e.style.backgroundColor='',e.style.backgroundSize='',e.style.backgroundPosition='',e.style.backgroundRepeat='',t?'color'===t.type?(e.style.backgroundImage='none',e.style.backgroundColor=t.value):(e.style.backgroundImage=`url("${t.value}")`,e.style.backgroundSize='cover',e.style.backgroundPosition='center',e.style.backgroundRepeat='no-repeat'):a&&(a.startsWith('#')?(e.style.backgroundImage='none',e.style.backgroundColor=a):(e.style.backgroundImage=`url("${a}")`,e.style.backgroundSize='cover',e.style.backgroundPosition='center',e.style.backgroundRepeat='no-repeat')))}async createWallpaperFromUrl(e,t){try{return new URL(e),this.addCustomWallpaper({type:'url',value:e,name:t||`URLå£çº¸ ${(new Date).toLocaleString()}`})}catch(e){return console.error('Invalid URL:',e),null}}async createWallpaperFromFile(e){return new Promise(t=>{if(!e.type.startsWith('image/'))return void t(null);const a=new FileReader;a.onload=a=>{if(a.target?.result){const n=this.addCustomWallpaper({type:'image',value:a.target.result,name:e.name||`ä¸Šä¼ çš„å£çº¸ ${(new Date).toLocaleString()}`});t(n)}else t(null)},a.onerror=()=>t(null),a.readAsDataURL(e)})}createSolidColorWallpaper(e,t){if(!e.match(/^#([0-9A-Fa-f]{3}){1,2}$/))return console.error('Invalid color format:',e),null;let a=e;if(4===e.length){const t=e[1],n=e[2],o=e[3];a=`#${t}${t}${n}${n}${o}${o}`}return this.addCustomWallpaper({type:'color',value:a,name:t||`çº¯è‰²å£çº¸ ${a}`})}loadCustomWallpapers(){const e=localStorage.getItem(G.CUSTOM_WALLPAPERS_KEY);if(e)try{this.customWallpapers=JSON.parse(e)}catch(e){console.error('Failed to load custom wallpapers:',e),this.customWallpapers=[]}}saveCustomWallpapers(){localStorage.setItem(G.CUSTOM_WALLPAPERS_KEY,JSON.stringify(this.customWallpapers))}}class j{configManager;onAddEntry;onRenderEntry;constructor(e,t,a){this.configManager=e,this.onAddEntry=t,this.onRenderEntry=a}displayAppVersion(){$('#app-version-display').text(`v${W}`)}checkVersionUpdateNotification(){this.configManager.getLastNotifiedVersion()!==W&&(this.showVersionUpdateNotification(),this.configManager.setLastNotifiedVersion(W))}showVersionUpdateNotification(){const e={type:'message',sender:'them',content:`ç³»ç»Ÿæ¶ˆæ¯ï¼šåº”ç”¨å·²æ›´æ–°åˆ° v${W}ï¼Œå·²è‡ªåŠ¨æ¸…ç†è¿‡æ—¶æ•°æ®ä»¥ç¡®ä¿åŠŸèƒ½æ­£å¸¸è¿è¡Œã€‚æ‚¨æ— éœ€æ‰‹åŠ¨æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ã€‚`,id:`system-${Date.now()}`,isSystemMessage:!0};this.onAddEntry&&this.onAddEntry(e),this.onRenderEntry&&this.onRenderEntry(e,void 0,!0)}updateFooterButtonsState(e){const t=$('#wechat-input-field'),a=$('#send-btn'),n=$('#plus-btn'),o=''!==t.val()?.toString().trim(),s=o||e;a.css('display',s?'flex':'none'),n.css('display',o?'none':'inline-block')}togglePanel(e){const t=$('#panel-container'),a=$('.panel-view.active'),n=t.hasClass('active');n&&a.length&&a.attr('id')?.startsWith(e||'')?(t.removeClass('active'),a.removeClass('active')):e?(a.length&&a.removeClass('active'),$(`#${e}-panel`).addClass('active'),n||t.addClass('active')):(n&&t.removeClass('active'),a.length&&a.removeClass('active'))}navigateTo(e,t){$('.app-view').removeClass('active'),$({home:'#app-homescreen',wechat:'#wechat-view',moments:'#moments-view',settings:'#settings-view'}[e]).addClass('active'),'moments'===e&&t&&t()}setupInputPlaceholder(e){const t=this.configManager.getSavedInputPlaceholder(),a=$('#wechat-input-field');a.attr('placeholder',t||`ä¸ ${e} å¯¹è¯...`),a.prop('disabled',!1)}setupPhoneSizeAdjustment(){const e=document.getElementById('phone-size-default'),t=document.getElementById('phone-size-medium'),a=document.getElementById('phone-size-small'),n=document.querySelector('.phone-screen');if(!(e&&t&&a&&n))return void console.error('[BLMX] Phone size adjustment elements not found');const o=this.configManager.getPhoneSize();this.applyPhoneSize(o,n,[e,t,a]),e.addEventListener('click',()=>{this.applyPhoneSize('default',n,[e,t,a])}),t.addEventListener('click',()=>{this.applyPhoneSize('medium',n,[e,t,a])}),a.addEventListener('click',()=>{this.applyPhoneSize('small',n,[e,t,a])})}setupStickerSizeControl(){const e=document.getElementById('sticker-size-slider'),t=document.getElementById('sticker-size-input'),a=document.getElementById('sticker-size-small'),n=document.getElementById('sticker-size-medium');if(!(e&&t&&a&&n))return;const o=this.configManager.getStickerSize();e.value=o.toString(),t.value=o.toString(),80===o?(a.classList.add('sticker-size-active'),n.classList.remove('sticker-size-active')):120===o?(a.classList.remove('sticker-size-active'),n.classList.add('sticker-size-active')):(a.classList.remove('sticker-size-active'),n.classList.remove('sticker-size-active')),this.applyStickerSize(o),e.addEventListener('input',()=>{const o=parseInt(e.value);t.value=o.toString(),this.configManager.setStickerSize(o),this.applyStickerSize(o),this.updateStickerSizeButtonState(o,a,n)}),t.addEventListener('change',()=>{let o=parseInt(t.value);o<40&&(o=40),o>200&&(o=200);const s=o.toString();t.value=s,e.value=s,this.configManager.setStickerSize(o),this.applyStickerSize(o),this.updateStickerSizeButtonState(o,a,n)}),a.addEventListener('click',()=>{this.setStickerSize(80,e,t,a,n)}),n.addEventListener('click',()=>{this.setStickerSize(120,e,t,a,n)})}applyPhoneSize(e,t,a){t.style.height={default:'48.75rem',medium:'42rem',small:'36rem'}[e],this.configManager.setPhoneSize(e),a.forEach(e=>e.classList.remove('phone-size-active')),'default'===e?a[0].classList.add('phone-size-active'):'medium'===e?a[1].classList.add('phone-size-active'):'small'===e&&a[2].classList.add('phone-size-active')}applyStickerSize(e){document.documentElement.style.setProperty('--sticker-size',`${e}px`)}setStickerSize(e,t,a,n,o){t.value=e.toString(),a.value=e.toString(),this.configManager.setStickerSize(e),this.applyStickerSize(e),this.updateStickerSizeButtonState(e,n,o)}updateStickerSizeButtonState(e,t,a){80===e?(t.classList.add('sticker-size-active'),a.classList.remove('sticker-size-active')):120===e?(t.classList.remove('sticker-size-active'),a.classList.add('sticker-size-active')):(t.classList.remove('sticker-size-active'),a.classList.remove('sticker-size-active'))}scrollToBottom(){setTimeout(()=>{const e=document.querySelector('.wechat-body');e&&(e.scrollTop=e.scrollHeight)},300)}setupFontSelection(){const e=$('#font-default'),t=$('#font-system');if(!e.length||!t.length)return;const a=localStorage.getItem('blmx_font_setting')||'custom';this.applyFontSetting(a),e.on('click',()=>{this.applyFontSetting('custom'),localStorage.setItem('blmx_font_setting','custom')}),t.on('click',()=>{this.applyFontSetting('system'),localStorage.setItem('blmx_font_setting','system')})}applyFontSetting(e){$('body');const t=$('#font-default'),a=$('#font-system');$('.font-btn').removeClass('font-active'),'custom'===e?(this.applyCustomFont(),t.addClass('font-active')):(this.applySystemFont(),a.addClass('font-active'))}applyCustomFont(){const e=$('body'),t=/iPhone|iPad|iPod/.test(navigator.userAgent)&&/WebKit/.test(navigator.userAgent),a=/HUAWEI/.test(navigator.userAgent);if(t||a){const t='\'MyCustomFont\', \'Noto Sans SC\', -apple-system, BlinkMacSystemFont, \'Segoe UI\', \'Helvetica Neue\', Arial, sans-serif';return e.css('font-family',t),e.addClass('force-font-refresh'),setTimeout(()=>{e.removeClass('force-font-refresh')},50),void setTimeout(()=>{e.css('font-family',t)},100)}this.checkFontLoaded('MyCustomFont').then(t=>{t?e.css('font-family','\'MyCustomFont\', \'Noto Sans SC\', sans-serif'):this.loadCustomFont().then(()=>{e.css('font-family','\'MyCustomFont\', \'Noto Sans SC\', sans-serif')}).catch(()=>{e.css('font-family','\'Noto Sans SC\', sans-serif')})})}applySystemFont(){const e=$('body'),t=/iPhone|iPad|iPod/.test(navigator.userAgent)&&/WebKit/.test(navigator.userAgent),a=/HUAWEI/.test(navigator.userAgent);let n;n=t?'-apple-system, "SF Pro Display", "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif':a?'"HarmonyOS Sans", "Noto Sans SC", "Microsoft YaHei", Arial, sans-serif':'-apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"',e.css('font-family',n),(t||a)&&(e.addClass('force-font-refresh'),setTimeout(()=>{e.removeClass('force-font-refresh')},50))}checkFontLoaded(e){return new Promise(t=>{document.fonts?document.fonts.ready.then(()=>{const a=Array.from(document.fonts).find(t=>t.family===e||t.family===`'${e}'`);t(!!a&&'loaded'===a.status)}).catch(()=>{t(!1)}):t(!0)})}loadCustomFont(){return new Promise((e,t)=>{if(!document.fonts){const t=$('<div>').css({position:'absolute',left:'-9999px',top:'-9999px',fontSize:'72px',fontFamily:'\'MyCustomFont\', monospace',visibility:'hidden'}).text('test').appendTo('body');return void setTimeout(()=>{t.remove(),e()},1e3)}new FontFace('MyCustomFont','url(https://files.catbox.moe/er4wsg.ttf)').load().then(t=>{document.fonts.add(t),e()}).catch(e=>{t(e)})})}setupFullscreenSizeAdjustment(){setTimeout(()=>{const e=$('#fullscreen-size-default'),t=$('#fullscreen-size-large'),a=$('#fullscreen-size-xlarge'),n=$('#fullscreen-size-slider'),o=$('#fullscreen-size-input');e.length&&t.length&&a.length&&n.length&&o.length&&this.initializeFullscreenSizeControls(e,t,a,n,o)},100)}initializeFullscreenSizeControls(e,t,a,n,o){const s=this.configManager.getFullscreenSize();n.val(s),o.val(s),this.applyFullscreenSize(s),this.updateFullscreenSizeButtonState(s),e.off('click').on('click',e=>{e.preventDefault(),e.stopPropagation(),this.setFullscreenSize(100)}),t.off('click').on('click',e=>{e.preventDefault(),e.stopPropagation(),this.setFullscreenSize(130)}),a.off('click').on('click',e=>{e.preventDefault(),e.stopPropagation(),this.setFullscreenSize(160)}),n.off('input').on('input',e=>{const t=parseInt($(e.target).val());o.val(t),this.setFullscreenSize(t)}),o.off('change').on('change',e=>{let t=parseInt($(e.target).val());t<50&&(t=50),t>200&&(t=200),o.val(t),n.val(t),this.setFullscreenSize(t)}),this.setupFullscreenListener()}setupFullscreenListener(){const e=()=>{if(!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)){const e=this.configManager.getFullscreenSize();this.applyBrowserLikeZoom(e/100)}else this.resetBrowserZoom()};document.addEventListener('fullscreenchange',e),document.addEventListener('webkitfullscreenchange',e),document.addEventListener('mozfullscreenchange',e),document.addEventListener('MSFullscreenChange',e)}resetBrowserZoom(){const e=document.body;e.style.transform='',e.style.transformOrigin='',e.style.position='',e.style.width='',e.style.height='',e.style.margin=''}setFullscreenSize(e){this.configManager.setFullscreenSize(e),$('#fullscreen-size-slider').val(e),$('#fullscreen-size-input').val(e),this.applyFullscreenSize(e),this.updateFullscreenSizeButtonState(e)}applyFullscreenSize(e){const t=e/100;!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&this.applyBrowserLikeZoom(t)}applyBrowserLikeZoom(e){const t=document.body;1!==e?(t.style.transform=`scale(${e})`,t.style.transformOrigin='center center',t.style.position='relative',t.style.width=100/e+'%',t.style.height=100/e+'%',t.style.margin='0 auto'):(t.style.transform='',t.style.transformOrigin='',t.style.position='',t.style.width='',t.style.height='',t.style.margin='')}updateFullscreenSizeButtonState(e){$('.fullscreen-size-btn').removeClass('fullscreen-size-active'),100===e?$('#fullscreen-size-default').addClass('fullscreen-size-active'):130===e?$('#fullscreen-size-large').addClass('fullscreen-size-active'):160===e&&$('#fullscreen-size-xlarge').addClass('fullscreen-size-active')}}class V{wechatBody;lastDisplayedTimeInMinutes=-1/0;options;avatars;eventManager;renderQueue=[];isRendering=!1;renderThrottle=16;constructor(e,t,a){const n=$(e);if(!n.length)throw new Error(`Element with selector "${e}" not found`);this.wechatBody=n[0],this.avatars=t,this.options=a,this.eventManager=new i,this.startRenderLoop()}startRenderLoop(){const e=()=>{if(this.renderQueue.length>0&&!this.isRendering){this.isRendering=!0;this.renderQueue.splice(0,5).forEach(e=>{this.renderEntry(e,void 0,!1)}),this.isRendering=!1}setTimeout(e,this.renderThrottle)};e()}queueRender(e){this.renderQueue.push(e)}clearChat(){this.wechatBody.innerHTML='',this.lastDisplayedTimeInMinutes=-1/0}renderEntry(e,t,a=!1){if(e&&'type'in e)switch(e.type){case'message':e.isSystemMessage?this.renderSystemMessage(e,a,t):this.addMessageToWeChat(e,t,a);break;case'time':this.addTimestampToWeChat(e.content.date,e.content.time,!0,t);break;case'event':this.addEventLogToWeChat(e.content,t);break;default:this.addMessageToWeChat(e,t,a)}}renderRecallNotice(e,t=null,a){const n=this.options.getDisplayName('sender'in e&&'me'===e.sender?'user':'char'),o=document.createElement('div');o.className='timestamp-row',void 0!==a&&(o.dataset.logIndex=a.toString()),'id'in e&&(o.dataset.messageId=e.id);const s='object'==typeof e.recalled_content&&null!==e.recalled_content?e.recalled_content.text:e.recalled_content;o.innerHTML=`\n      <div class="recall-notice-container">\n        <div class="recall-notice-text">"${n}" æ’¤å›äº†ä¸€æ¡æ¶ˆæ¯</div>\n        <div class="recall-content">${s||('content'in e?e.content:'')}</div>\n      </div>\n    `;const i=o.querySelector('.recall-notice-text'),r=o.querySelector('.recall-content');i&&r&&i.addEventListener('click',()=>{r.classList.toggle('expanded')}),t?t.replaceWith(o):this.wechatBody.appendChild(o),this.scrollToBottom()}renderMomentsFeed(e,t,a){const n=$('#moments-feed-list')[0];if(!n)return;n.innerHTML='';const o={},s=[];e.forEach((e,t)=>{'key'in e&&e.key.includes('_MOMENT')&&s.push(t)}),s.forEach(t=>{const a=e[t];o[t]={...a,likes:[],comments:[],id:t}}),e.forEach((e,a)=>{if('key'in e&&(e.key.includes('_LIKE')||e.key.includes('_COMMENT'))){const n=s[parseInt(e.data.target_post_id,10)],i=o[n];if(i)if(e.key.includes('_LIKE')){const n=e.key.startsWith('USER')?t('user'):t('char');i.likes.some(e=>e.name===n)||i.likes.push({key:e.key,name:n,originalLogIndex:a})}else i.comments.push({...e,originalLogIndex:a})}}),Object.values(o).reverse().forEach(e=>{const o=e.key.startsWith('USER'),i=t(o?'user':'char'),r=o?a.user:a.char,l=document.createElement('li');l.className='moment-post',l.dataset.postId=e.id;const c=s.indexOf(e.id);l.dataset.momentSequenceId=String(c),l.dataset.momentId=String(c);let d='';'url'===e.data.image_type&&e.data.image?d=`<img src="${e.data.image}" class="post-media-image" />`:'desc'===e.data.image_type&&e.data.image&&(d=`<div class="image-desc-content"><div class="text-wrapper">${e.data.image}</div></div>`);let g='';if(e.likes.length>0||e.comments.length>0){g=`<div class="post-interactions">${e.likes.length>0?`<div class="likes-section"><i class="fas fa-heart"></i> ${e.likes.map(e=>`<span class="liker-name">${e.name}</span>`).join(', ')}</div>`:''}${e.comments.length>0?`<ul class="comments-section">${e.comments.map(e=>`<li><span class="comment-author">${e.key.startsWith('USER')?t('user'):t('char')}</span>: ${e.data.text}</li>`).join('')}</ul>`:''}</div>`}const p=this.formatMomentTimestamp(e.data.date,e.data.time),m=o?'<span class="delete-moment-btn" title="åˆ é™¤">åˆ é™¤</span>':'';l.innerHTML=`<img src="${r}" class="post-author-avatar" />\n                         <div class="post-details">\n                             <span class="post-author-name">${i}</span>\n                             <p class="post-content">${e.data.text||''}</p>\n                             <div class="post-media">${d}</div>\n                             <div class="post-meta">\n                                 <div class="post-meta-left">\n                                     <span class="timestamp">${p}</span>\n                                     ${m}\n                                 </div>\n                                 <div class="post-actions">\n                                     <span class="comment-button" title="è¯„è®º/ç‚¹èµ"><i class="fas fa-comment-dots"></i></span>\n                                 </div>\n                             </div>\n                             ${g}\n                         </div>`,n.appendChild(l)})}showTypingIndicator(){this.hideTypingIndicator();const e=document.createElement('div');e.className='typing-indicator',e.id='typing-indicator-id';const t=this.avatars.char;e.innerHTML=`\n      <img src="${t}" class="message-avatar" />\n      <div class="message-bubble">\n        <span class="typing-dot"></span>\n        <span class="typing-dot"></span>\n        <span class="typing-dot"></span>\n      </div>\n    `,this.wechatBody.appendChild(e),this.scrollToBottom()}hideTypingIndicator(){$('#typing-indicator-id').remove()}showGeneratingIndicator(){this.hideGeneratingIndicator();const e=$('.dynamic-island')[0];if(!e)return;const t=document.createElement('div');t.className='generating-indicator',t.id='generating-indicator-id',t.innerHTML='\n      <span class="generating-dot"></span>\n      <span class="generating-dot"></span>\n      <span class="generating-dot"></span>\n    ',e.appendChild(t),e.classList.add('generating-active')}hideGeneratingIndicator(){$('#generating-indicator-id').remove(),$('.dynamic-island').removeClass('generating-active')}calculateTypingDelay(e){if('string'!=typeof e||''===e.trim())return 800+700*Math.random();const t=500+40*e.length+800*Math.random();return Math.min(t,3e3)}addMessageToWeChat(e,t,a=!1){const{id:n,sender:o,type:s}=e,i=document.createElement('div');i.className='message-row',void 0!==t&&(i.dataset.logIndex=t.toString()),i.dataset.messageId=n;const r=o;i.classList.add(r);const l=`<img src="${'me'===o?this.avatars.user:this.avatars.char}" class="message-avatar" />`;if('voice'===s)this.renderVoiceMessage(i,e,l);else{let t='';switch(s){case'sticker':t=this.renderStickerContent(e);break;case'image':t=this.renderImageContent(e);break;case'location':t=this.renderLocationContent(e);break;case'transfer':t=this.renderTransferContent(e);break;case'file':t=this.renderFileContent(e);break;case'gift':{const a=e;t=a.data.name.includes('çº¢åŒ…')||a.data.name.includes('å‹å²é’±')||a.data.name.includes('çº¢åˆ©')?this.renderRedEnvelopeContent(a):this.renderGiftContent(a)}break;default:t=e.content.replace(/</g,'&lt;').replace(/>/g,'&gt;')}let a='message-bubble';'sticker'===s?a+=' sticker-bubble':'image'===s?a+=' image-desc-bubble':'location'===s?a+=' location-bubble':'transfer'===s?a+=' transfer-bubble':'file'===s?a+=' file-bubble':'gift'===s&&(a+=' gift-bubble'),i.innerHTML='me'===o?`<div class="${a}">${t}</div>${l}`:`${l}<div class="${a}">${t}</div>`;const n=i.querySelector('.message-bubble');n&&(this.applyBubbleStyles(n,s,e),this.setupBubbleInteractions(n,s,e))}a&&i.classList.add('new-message'),'me'===o&&'message'===e.type&&this.setupUserMessageLongPress(i,e),this.wechatBody.appendChild(i),this.scrollToBottom()}renderVoiceMessage(e,t,a){const n=document.createElement('div');n.className='message-content-container';const o=document.createElement('div');o.className='message-bubble voice-bubble',o.innerHTML=`<span class="duration">${t.content.duration}"</span><i class="fas fa-wifi voice-icon"></i>`;const s=document.createElement('div');s.className='voice-text-content',s.textContent=t.content.text,n.appendChild(o),n.appendChild(s),'me'===t.sender?(e.appendChild(n),e.insertAdjacentHTML('beforeend',a)):(e.insertAdjacentHTML('afterbegin',a),e.appendChild(n));let i=!1;let r;o.addEventListener('pointerdown',t=>{'mouse'===t.pointerType&&0!==t.button||(i=!1,r=window.setTimeout(()=>{e.classList.add('voice-text-visible'),i=!0},500))}),o.addEventListener('pointerup',()=>{clearTimeout(r),i||e.classList.contains('voice-text-visible')&&e.classList.remove('voice-text-visible')}),o.addEventListener('pointerleave',()=>clearTimeout(r)),o.addEventListener('contextmenu',e=>e.preventDefault())}renderStickerContent(e){const t=this.options.findStickerUrlByName(e.content);return t?`<div class="sticker-container"><img src="${t}" class="sticker-img" /></div>`:'<div class="sticker-placeholder">[è¡¨æƒ…]</div>'}renderImageContent(e){if('url'===e.content.type){let t=e.content.value;if(t.startsWith('blmx-img-')){const e=sessionStorage.getItem(t);if(!e)return'<div class="image-desc-content"><div class="text-wrapper">[å›¾ç‰‡å·²è¿‡æœŸ]</div></div>';t=e}return`<img src="${t}" class="chat-image" />`}{const t=e.content.value;return`<div class="image-desc-content"><div class="text-wrapper">${String(t).replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div></div>`}}renderLocationContent(e){return`<div class="location-card">\n      <div class="location-content">\n        <div class="location-title">${e.content}</div>\n        <div class="location-subtitle">å…±äº«å®æ—¶ä½ç½®</div>\n      </div>\n      <div class="location-map-placeholder"></div>\n    </div>`}renderTransferContent(e){const t='sent'!==e.data.status,a=t?`<div class="status-text">${'accepted'===e.data.status?'å·²æ¥æ”¶':'å·²é€€è¿˜'}</div>`:`<div class="note">${e.data.note||' '}</div>`;return`<div class="transfer-card ${t?'transfer-receipt':'transfer-initial'}">\n      <div class="transfer-content">\n        <img src="https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/%E7%B4%A0%E6%9D%90/arrows.png" class="transfer-icon-image">\n        <div class="transfer-details">\n          <div class="amount">Â¥${e.data.amount}</div>\n          ${a}\n        </div>\n      </div>\n      <div class="transfer-footer">è½¬è´¦</div>\n    </div>`}renderFileContent(e){return`<div class="file-card">\n      <div class="file-content">\n        <i class="fas fa-file-alt file-icon"></i>\n        <div class="file-details">\n          <div class="file-name">${e.content.replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div>\n        </div>\n      </div>\n      <div class="file-footer">æ–‡ä»¶</div>\n    </div>`}renderGiftContent(e){let t='',a='';const n='sent'!==e.data.status?'gift-receipt':'gift-initial';return'sent'===e.data.status?e.data.price&&(t='gift-price',a=`Â¥ ${e.data.price}`):(t='gift-status-text',a='accepted'===e.data.status?'å·²æ”¶ä¸‹':'å·²æ‹’æ”¶'),`<div class="gift-card ${n}">\n      <div class="gift-content">\n        <span class="gift-icon-emoji">ğŸ</span>\n        <div class="gift-details">\n          <div class="gift-name">${e.data.name}</div>\n          ${a?`<div class="${t}">${a}</div>`:''}\n        </div>\n      </div>\n      <div class="gift-footer">ç¤¼ç‰©</div>\n    </div>`}renderRedEnvelopeContent(e){let t='',a='';const n='sent'!==e.data.status?'gift-receipt':'gift-initial';return'sent'===e.data.status?e.data.price&&(t='gift-price',a=`Â¥ ${e.data.price}`):(t='gift-status-text',a='accepted'===e.data.status?'å·²é¢†å–':'å·²æ‹’æ”¶'),`<div class="gift-card ${n}">\n      <div class="gift-content">\n        <img src="https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/%E7%B4%A0%E6%9D%90/red-envelope.png" class="gift-icon-image">\n        <div class="gift-details">\n          <div class="gift-name">${e.data.name}</div>\n          ${a?`<div class="${t}">${a}</div>`:''}\n        </div>\n      </div>\n      <div class="gift-footer">çº¢åŒ…</div>\n    </div>`}applyBubbleStyles(e,t,a){if('image'===t)'url'===a.content.type?e.classList.add('image-url-bubble'):e.classList.add('image-desc-bubble');else{const a={sticker:'sticker-bubble',location:'location-bubble',transfer:'transfer-bubble',file:'file-bubble',gift:'gift-bubble'};a[t]&&e.classList.add(a[t])}}setupBubbleInteractions(e,t,a){if('transfer'===t){const t=e.querySelector('.transfer-card');if(!t)return;const n=a;'sent'!==n.data.status||'them'!==a.sender||(t.classList.add('them'),t.addEventListener('click',()=>{this.options.onTransferAccept&&this.options.onTransferAccept({...n.data,status:'accepted'})},{once:!0}))}if('gift'===t){const t=e,n=e.querySelector('.gift-card'),o=a;if('sent'!==o.data.status)return;n&&n.classList.add('them'===a.sender?'them':'me'),t.classList.add('gift-clickable'),t.addEventListener('click',async()=>{this.options.onGiftAction&&await this.options.onGiftAction(o.data),t.classList.remove('gift-clickable')},{once:!0})}}addTimestampToWeChat(e,t,a,n){const o=this.formatMomentTimestamp(e,t);if(a){if(o===t){const e=this.parseTimeToMinutes(o);if(null!==e&&e-this.lastDisplayedTimeInMinutes<10)return;null!==e&&(this.lastDisplayedTimeInMinutes=e)}else this.lastDisplayedTimeInMinutes=-1/0}const s=document.createElement('div');s.className='timestamp-row',void 0!==n&&(s.dataset.logIndex=n.toString()),s.dataset.originalDate=e,s.dataset.originalTime=t,s.innerHTML=`<span class="timestamp-text">${o}</span>`,this.wechatBody.appendChild(s),this.scrollToBottom()}addEventLogToWeChat(e,t){if(!e||!e.date||!e.time)return void console.error('äº‹ä»¶æ—¥å¿—æ•°æ®ä¸å®Œæ•´:',e);const a=this.formatMomentTimestamp(e.date,e.time),n=document.createElement('div');if(n.className='event-log-row',void 0!==t&&(n.dataset.logIndex=t.toString()),n.dataset.originalDate=e.date,n.dataset.originalTime=e.time,e.description?n.innerHTML=`\n        <div class="event-log-container">\n          <div class="event-time-text has-desc clickable">${a}</div>\n          <div class="event-description">${e.description}</div>\n        </div>\n      `:n.innerHTML=`\n        <div class="event-log-container">\n          <div class="event-time-text">${a}</div>\n        </div>\n      `,e.description){const e=n.querySelector('.event-time-text'),t=n.querySelector('.event-description');e&&t&&e.addEventListener('click',()=>{t.classList.toggle('expanded')})}this.wechatBody.appendChild(n),this.scrollToBottom()}renderSystemMessage(e,t=!1,a){const n=this.wechatBody;if(!n)return;const o=document.createElement('div');o.className='event-log-row',t&&o.classList.add('new-message'),e.id&&(o.dataset.messageId=e.id),void 0!==a&&(o.dataset.logIndex=a.toString());const s=document.createElement('div');s.className='event-log-container';const i=document.createElement('div');i.className='event-time-text system-message',i.textContent=e.content,s.appendChild(i),o.appendChild(s),n.appendChild(o),this.scrollToBottom()}parseTimeToMinutes(e){const t=e.match(/(\d{1,2}):(\d{2})/);return t?60*parseInt(t[1],10)+parseInt(t[2],10):null}formatMomentTimestamp(e,t){if(!e||!t)return' ';try{const a=new Date(e),n=window.currentGameDate?new Date(window.currentGameDate):new Date,o=a.getFullYear(),s=a.getMonth(),i=a.getDate(),r=n.getFullYear(),l=n.getMonth(),c=n.getDate();if(o===r&&s===l&&i===c)return t;const d=new Date(n);d.setDate(n.getDate()-1);const g=d.getFullYear(),p=d.getMonth(),m=d.getDate();return o===g&&s===p&&i===m?`æ˜¨å¤© ${t}`:o===r?`${s+1}æœˆ${i}æ—¥ ${t}`:`${o}å¹´${s+1}æœˆ${i}æ—¥ ${t}`}catch(e){return console.error('Error formatting timestamp:',e),t}}refreshAllTimestamps(){const e=$('.timestamp-row',this.wechatBody),t=$('.event-log-row',this.wechatBody);e.each((_,e)=>{const t=$(e),a=t.find('.timestamp-text');if(a.length){const e=t.data('originalDate'),n=t.data('originalTime');e&&n&&a.text(this.formatMomentTimestamp(e,n))}}),t.each((_,e)=>{const t=$(e),a=t.find('.event-time-text');if(a.length){const e=t.data('originalDate'),n=t.data('originalTime');e&&n&&a.text(this.formatMomentTimestamp(e,n))}})}renderFeatureGrid(e,t,a){if(!e)return void console.error('[BLMX] Grid element not found for renderFeatureGrid');e.innerHTML='';const n=e.classList.contains('sticker-delete-mode');t.forEach(t=>{const o=document.createElement('div');o.className='feature-item';let s='';s=t.isAddBtn?'è¡¨æƒ…ç®¡ç†'===t.label?'<div class="feature-icon"><i class="fas fa-cog"></i></div>':`<div class="feature-icon"><i class="fas fa-${'æ·»åŠ '===t.label?'plus':'trash-alt'}"></i></div>`:t.icon&&t.icon.startsWith('http')?`<div class="feature-icon"><img src="${t.icon}" alt="${t.label}" class="feature-icon-img"></div>`:t.icon&&(t.icon.startsWith('fas ')||t.icon.startsWith('far ')||t.icon.startsWith('fab '))||t.icon&&t.icon.startsWith('fa')?`<div class="feature-icon"><i class="${t.icon} theme-icon"></i></div>`:`<div class="feature-icon"><i class="${t.icon||'fas fa-question'}"></i></div>`,o.innerHTML=`${s}<span class="feature-label">${t.label}</span>`;const i=o.querySelector('.feature-icon');if(!n||t.isAddBtn||t.isDefault)'æ·»åŠ '===t.label?o.addEventListener('click',a.onAddStickers):'åˆ é™¤'===t.label||'è¡¨æƒ…ç®¡ç†'===t.label?o.addEventListener('click',a.onToggleDeleteMode):o.addEventListener('click',t.action);else{const e=document.createElement('input');e.type='checkbox',e.className='sticker-checkbox',e.dataset.stickerLabel=t.label,o.appendChild(e);const a=document.createElement('div');a.className='sticker-checkbox-button',a.style.display='block',o.appendChild(a);const n=e=>{e?a.classList.add('checked'):a.classList.remove('checked'),i?.classList.toggle('selected-for-delete',e)},s=t=>{t.preventDefault(),t.stopPropagation(),e.checked=!e.checked,n(e.checked)};o.addEventListener('click',s),a.addEventListener('click',s),n(e.checked)}e.appendChild(o)})}scrollToBottom(){this.wechatBody.scrollTop=this.wechatBody.scrollHeight,setTimeout(()=>{this.wechatBody.scrollTop=this.wechatBody.scrollHeight},100)}setupUserMessageLongPress(e,t){const a=$(e),n=a.find('.message-bubble'),o=n.length?n:a;this.addLongPressListener(o[0],()=>{this.handleLongPressRecall(t)}),this.setupDoubleClickRecall(o,t)}addLongPressListener(e,t,a={duration:600,preventDefault:!0}){let n,o,s;const i=()=>clearTimeout(n);e.addEventListener('pointerdown',e=>{'mouse'===e.pointerType&&0!==e.button||(o=e.clientX,s=e.clientY,a.preventDefault&&e.preventDefault(),clearTimeout(n),n=setTimeout(()=>{n=0,t()},a.duration))}),e.addEventListener('pointermove',e=>{if(!n)return;const t=e.clientX,a=e.clientY;(Math.abs(t-o)>10||Math.abs(a-s)>10)&&clearTimeout(n)}),e.addEventListener('pointerup',i),e.addEventListener('pointerleave',i),a.preventDefault&&e.addEventListener('contextmenu',e=>e.preventDefault())}async handleLongPressRecall(e){try{if(this.options.isMessageInQueue&&this.options.isMessageInQueue(e.id))await this.handleUserMessageRecall(e);else{$(`[data-message-id="${e.id}"]`).effect('shake',{times:2,distance:5},300);const{DialogManager:t}=await Promise.resolve().then(n.bind(n,929)),a=t.getInstance();await a.alert('æ¶ˆæ¯å·²åˆå¹¶å‘é€ï¼Œæ— æ³•æ’¤å›ã€‚','æ— æ³•æ’¤å›')}}catch(t){console.error('é•¿æŒ‰æ’¤å›å¤±è´¥:',t);$(`[data-message-id="${e.id}"]`).effect('shake',{times:2,distance:5},300)}}async handleUserMessageRecall(e){try{const{DialogManager:t}=await Promise.resolve().then(n.bind(n,929)),a=t.getInstance();await a.confirm('ç¡®å®šè¦æ’¤å›è¿™æ¡æ–‡å­—æ¶ˆæ¯å—ï¼Ÿæ’¤å›åå¯¹æ–¹å°†çœ‹åˆ°"ä½ æ’¤å›äº†ä¸€æ¡æ¶ˆæ¯"ã€‚','æ’¤å›æ–‡å­—æ¶ˆæ¯','æ’¤å›','å–æ¶ˆ')&&this.options.onRecallMessage&&await this.options.onRecallMessage(e)}catch(e){console.error('æ’¤å›æ¶ˆæ¯æ—¶å‡ºé”™:',e)}}setupDoubleClickRecall(e,t){let a,n=0;e.on('click.doubleClickRecall',o=>{o.stopPropagation(),n++,1===n?a=window.setTimeout(()=>{n=0},300):2===n&&(clearTimeout(a),n=0,e.addClass('double-click-active'),setTimeout(()=>{e.removeClass('double-click-active')},200),'vibrate'in navigator&&navigator.vibrate([30,50,30]),this.handleDoubleClickRecall(t))})}async handleDoubleClickRecall(e){try{if(this.options.isMessageInQueue&&this.options.isMessageInQueue(e.id))await this.handleUserMessageRecall(e);else{$(`[data-message-id="${e.id}"]`).effect('shake',{times:2,distance:5},300);const{DialogManager:t}=await Promise.resolve().then(n.bind(n,929)),a=t.getInstance();await a.alert('æ¶ˆæ¯å·²åˆå¹¶å‘é€ï¼Œæ— æ³•æ’¤å›ã€‚','æ— æ³•æ’¤å›')}}catch(t){console.error('åŒå‡»æ’¤å›å¤±è´¥:',t);$(`[data-message-id="${e.id}"]`).effect('shake',{times:2,distance:5},300)}}cleanup(){this.eventManager.cleanup()}}class q{wallpaperManager;themeManager;constructor(e,t){this.wallpaperManager=e,this.themeManager=t}showWallpaperSelector(e,t){const a=document.createElement('div');a.className='wallpaper-modal',a.style.cssText='\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background-color: rgba(0, 0, 0, 0.7);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      z-index: 1000;\n    ';const n=document.createElement('div');n.className='wallpaper-container',n.style.cssText='\n      background-color: white;\n      border-radius: 12px;\n      width: 90%;\n      max-width: 500px;\n      max-height: 80vh;\n      overflow-y: auto;\n      padding: 20px;\n      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);\n    ';const o=document.createElement('h2');o.textContent=`é€‰æ‹©${'chat'===e?'èŠå¤©':'home'===e?'ä¸»å±å¹•':'è®¾ç½®'}å£çº¸`,o.style.cssText='\n      margin-top: 0;\n      color: var(--text-primary);\n      font-size: 1.2rem;\n      text-align: center;\n      margin-bottom: 20px;\n    ',n.appendChild(o);const s=this.createTabs(n);n.appendChild(s),this.createBuiltinWallpaperTab(n,e,a,t),this.createSolidColorTab(n,e,a,t),this.createCustomWallpaperTab(n,e,a,t),this.createUploadTab(n,e,a,t),this.createBottomButtons(n,e,a,t),a.appendChild(n),document.body.appendChild(a)}createTabs(e){const t=document.createElement('div');t.style.cssText=`\n      display: flex;\n      border-bottom: 1px solid ${document.body.classList.contains('dark-mode')?'#3c3c3c':'#eee'};\n      margin-bottom: 15px;\n    `;const a=(a,n,o=!1)=>{const s=document.createElement('div');return s.textContent=a,s.dataset.tabId=n,s.style.cssText=`\n        padding: 10px 15px;\n        cursor: pointer;\n        font-weight: ${o?'bold':'normal'};\n        color: ${o?'var(--primary-blue)':'var(--text-secondary)'};\n        border-bottom: ${o?'2px solid var(--primary-blue)':'none'};\n        margin-bottom: -1px;\n      `,s.addEventListener('click',()=>{t.querySelectorAll('div').forEach(e=>{e.style.fontWeight='normal',e.style.color='var(--text-secondary)',e.style.borderBottom='none'}),s.style.fontWeight='bold',s.style.color='var(--primary-blue)',s.style.borderBottom='2px solid var(--primary-blue)',e.querySelectorAll('.tab-content').forEach(e=>{e.style.display='none'});const a=e.querySelector(`.tab-content[data-tab-id="${n}"]`);a&&(a.style.display='block')}),s};return t.appendChild(a('å†…ç½®å£çº¸','builtin',!0)),t.appendChild(a('çº¯è‰²å£çº¸','solid')),t.appendChild(a('è‡ªå®šä¹‰å£çº¸','custom')),t.appendChild(a('ä¸Šä¼ å£çº¸','upload')),t}createBuiltinWallpaperTab(e,t,a,n){const o=document.createElement('div');o.className='tab-content',o.dataset.tabId='builtin',o.style.cssText='display: block;';const s=this.wallpaperManager.getBuiltInWallpapers().filter(e=>'image'===e.type),i=document.createElement('div');i.style.cssText='\n      display: grid;\n      grid-template-columns: repeat(2, 1fr);\n      gap: 10px;\n    ',s.forEach(e=>{const o=this.createWallpaperItem(e,t,!1,a,n);i.appendChild(o)}),o.appendChild(i),e.appendChild(o)}createSolidColorTab(e,t,a,n){const o=document.createElement('div');o.className='tab-content',o.dataset.tabId='solid',o.style.cssText='display: none;';const s=this.wallpaperManager.getBuiltInWallpapers().filter(e=>'color'===e.type),i=document.createElement('div');i.style.cssText='\n      display: grid;\n      grid-template-columns: repeat(4, 1fr);\n      gap: 10px;\n    ',s.forEach(e=>{const o=this.createWallpaperItem(e,t,!1,a,n);i.appendChild(o)}),o.appendChild(i),this.addColorPicker(o,t,a,n),e.appendChild(o)}createCustomWallpaperTab(e,t,a,n){const o=document.createElement('div');o.className='tab-content',o.dataset.tabId='custom',o.style.cssText='display: none;';const s=this.wallpaperManager.getCustomWallpapers();if(0===s.length){const e=document.createElement('p');e.textContent='æ²¡æœ‰è‡ªå®šä¹‰å£çº¸ã€‚è¯·åœ¨"ä¸Šä¼ å£çº¸"é€‰é¡¹å¡ä¸­æ·»åŠ ã€‚',e.style.cssText='\n        text-align: center;\n        color: var(--text-secondary);\n        margin: 30px 0;\n      ',o.appendChild(e)}else{const e=document.createElement('div');e.style.cssText='\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 10px;\n      ',s.forEach(o=>{const s=this.createWallpaperItem(o,t,!0,a,n);e.appendChild(s)}),o.appendChild(e)}e.appendChild(o)}createUploadTab(e,t,a,n){const o=document.createElement('div');o.className='tab-content',o.dataset.tabId='upload',o.style.cssText='display: none; padding: 10px 0;',this.createLocalUploadSection(o,t,a,n),this.createUrlUploadSection(o,t,a,n),e.appendChild(o)}addColorPicker(e,t,a,n){const o=document.createElement('div');o.style.cssText=`\n      margin-top: 20px;\n      padding-top: 15px;\n      border-top: 1px solid ${document.body.classList.contains('dark-mode')?'#3c3c3c':'#eee'};\n    `;const s=document.createElement('p');s.textContent='è‡ªå®šä¹‰é¢œè‰²:',s.style.cssText='\n      margin: 0 0 10px 0;\n      font-size: 0.9rem;\n      color: var(--text-primary);\n    ';const i=document.createElement('input');i.type='color',i.value='#ffffff',i.style.cssText='\n      width: 100%;\n      height: 40px;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n    ';const r=document.createElement('input');r.type='text',r.placeholder='é¢œè‰²åç§° (å¯é€‰)',r.style.cssText='\n      width: 100%;\n      padding: 8px;\n      margin-top: 10px;\n      border: 1px solid #ddd;\n      border-radius: 5px;\n      box-sizing: border-box;\n    ';const l=document.createElement('button');l.textContent='æ·»åŠ æ­¤é¢œè‰²',l.style.cssText='\n      width: 100%;\n      padding: 10px;\n      margin-top: 10px;\n      background: var(--primary-blue);\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    ',l.addEventListener('click',()=>{const e=i.value,o=r.value.trim()||`é¢œè‰² ${e}`,s=this.wallpaperManager.createSolidColorWallpaper(e,o);s?(this.wallpaperManager.setWallpaper(t,s),n(),document.body.removeChild(a)):alert('åˆ›å»ºçº¯è‰²å£çº¸å¤±è´¥ï¼Œè¯·ç¡®ä¿é¢œè‰²æ ¼å¼æ­£ç¡®ã€‚')}),o.appendChild(s),o.appendChild(i),o.appendChild(r),o.appendChild(l),e.appendChild(o)}createLocalUploadSection(e,t,a,n){const o=document.createElement('div');o.style.cssText='margin-bottom: 20px;';const s=document.createElement('h3');s.textContent='ä»æœ¬åœ°ä¸Šä¼ ',s.style.cssText='\n      font-size: 1rem;\n      color: var(--text-primary);\n      margin: 0 0 10px 0;\n    ';const i=document.createElement('input');i.type='file',i.accept='image/*',i.style.cssText='\n      width: 100%;\n      padding: 10px;\n      margin-bottom: 10px;\n      border: 1px solid #ddd;\n      border-radius: 5px;\n      box-sizing: border-box;\n    ';const r=document.createElement('button');r.textContent='ä¸Šä¼ å¹¶åº”ç”¨',r.style.cssText='\n      width: 100%;\n      padding: 10px;\n      background: var(--primary-blue);\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    ',r.addEventListener('click',async()=>{if(i.files&&i.files[0]){const e=i.files[0],o=await this.wallpaperManager.createWallpaperFromFile(e);o&&(this.wallpaperManager.setWallpaper(t,o),n(),document.body.removeChild(a))}}),o.appendChild(s),o.appendChild(i),o.appendChild(r),e.appendChild(o)}createUrlUploadSection(e,t,a,n){const o=document.createElement('div');o.style.cssText=`\n      margin-top: 30px;\n      padding-top: 20px;\n      border-top: 1px solid ${document.body.classList.contains('dark-mode')?'#3c3c3c':'#eee'};\n    `;const s=document.createElement('h3');s.textContent='ä»URLæ·»åŠ ',s.style.cssText='\n      font-size: 1rem;\n      color: var(--text-primary);\n      margin: 0 0 10px 0;\n    ';const i=document.createElement('input');i.type='text',i.placeholder='è¾“å…¥å›¾ç‰‡URL',i.style.cssText='\n      width: 100%;\n      padding: 10px;\n      margin-bottom: 10px;\n      border: 1px solid #ddd;\n      border-radius: 5px;\n      box-sizing: border-box;\n    ';const r=document.createElement('input');r.type='text',r.placeholder='å£çº¸åç§° (å¯é€‰)',r.style.cssText='\n      width: 100%;\n      padding: 10px;\n      margin-bottom: 10px;\n      border: 1px solid #ddd;\n      border-radius: 5px;\n      box-sizing: border-box;\n    ';const l=document.createElement('button');l.textContent='æ·»åŠ å¹¶åº”ç”¨',l.style.cssText='\n      width: 100%;\n      padding: 10px;\n      background: var(--primary-blue);\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    ',l.addEventListener('click',async()=>{const e=i.value.trim(),o=r.value.trim()||'URLå£çº¸';if(e){const s=await this.wallpaperManager.createWallpaperFromUrl(e,o);s?(this.wallpaperManager.setWallpaper(t,s),n(),document.body.removeChild(a)):alert('æ— æ•ˆçš„URLã€‚è¯·è¾“å…¥æœ‰æ•ˆçš„å›¾ç‰‡URLã€‚')}}),o.appendChild(s),o.appendChild(i),o.appendChild(r),o.appendChild(l),e.appendChild(o)}createWallpaperItem(e,t,a,n,o){const s=document.createElement('div');s.style.cssText='\n      border-radius: 8px;\n      overflow: hidden;\n      position: relative;\n      cursor: pointer;\n      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n      transition: transform 0.2s ease, box-shadow 0.2s ease;\n    ';const i=document.createElement('div');i.style.cssText='\n      width: 100%;\n      height: 100px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    ','color'===e.type?(i.style.backgroundImage='none',i.style.backgroundColor=e.value):(i.style.backgroundImage=`url("${e.value}")`,i.style.backgroundSize='cover',i.style.backgroundPosition='center');const r=document.createElement('div');if(r.textContent=e.name,r.style.cssText=`\n      padding: 8px;\n      text-align: center;\n      font-size: 0.8rem;\n      color: var(--text-primary);\n      background-color: ${document.body.classList.contains('dark-mode')?'rgba(42, 42, 42, 0.9)':'rgba(255, 255, 255, 0.9)'};\n    `,a){const a=document.createElement('button');a.innerHTML='&times;',a.style.cssText='\n        position: absolute;\n        top: 5px;\n        right: 5px;\n        width: 20px;\n        height: 20px;\n        border-radius: 50%;\n        background-color: rgba(255, 0, 0, 0.7);\n        color: white;\n        border: none;\n        font-size: 14px;\n        line-height: 1;\n        cursor: pointer;\n        z-index: 1;\n      ',a.addEventListener('click',a=>{if(a.stopPropagation(),confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå£çº¸å—ï¼Ÿ')){this.wallpaperManager.deleteCustomWallpaper(e.id);const a=this.wallpaperManager.getCurrentWallpaper(t);a&&a.id===e.id&&(this.wallpaperManager.setWallpaper(t,null),o()),s.parentElement?.removeChild(s)}}),s.appendChild(a)}return s.addEventListener('click',()=>{const a=this.themeManager.getCurrentTheme();this.wallpaperManager.setCurrentThemeName(a.name),this.wallpaperManager.setWallpaper(t,e),o(),document.body.removeChild(n)}),s.appendChild(i),s.appendChild(r),s}createBottomButtons(e,t,a,n){const o=document.createElement('div');o.style.cssText=`\n      display: flex;\n      justify-content: space-between;\n      margin-top: 20px;\n      padding-top: 15px;\n      border-top: 1px solid ${document.body.classList.contains('dark-mode')?'#3c3c3c':'#eee'};\n    `;const s=document.createElement('button');s.textContent='æ¢å¤é»˜è®¤',s.style.cssText=`\n      padding: 10px 15px;\n      background: ${document.body.classList.contains('dark-mode')?'#3c3c3c':'#f1f5f9'};\n      color: var(--text-primary);\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    `,s.addEventListener('click',()=>{this.wallpaperManager.setWallpaper(t,null),n(),document.body.removeChild(a)});const i=document.createElement('button');i.textContent='å…³é—­',i.style.cssText='\n      padding: 10px 20px;\n      background: var(--primary-blue);\n      color: white;\n      border: none;\n      border-radius: 5px;\n      cursor: pointer;\n      font-weight: 500;\n    ',i.addEventListener('click',()=>{document.body.removeChild(a)}),o.appendChild(s),o.appendChild(i),e.appendChild(o)}}class J{wallpaperManager;themeManager;wallpaperSelector;constructor(e){this.themeManager=e,this.wallpaperManager=e.getWallpaperManager(),this.wallpaperSelector=new q(this.wallpaperManager,this.themeManager)}applyWallpapers(){const e=$('#wechat-view'),t=$('#app-homescreen'),a=$('#settings-view'),n=this.themeManager.getCurrentTheme();this.wallpaperManager.setCurrentThemeName(n.name);const o=this.wallpaperManager.getCurrentWallpaper('chat');this.wallpaperManager.applyWallpaperToElement(e[0],o,n.colors.defaultWallpapers.chat);const s=this.wallpaperManager.getCurrentWallpaper('home');this.wallpaperManager.applyWallpaperToElement(t[0],s,n.colors.defaultWallpapers.home);const i=this.wallpaperManager.getCurrentWallpaper('settings');this.wallpaperManager.applyWallpaperToElement(a[0],i,n.colors.defaultWallpapers.settings)}changeWallpaper(e){this.wallpaperSelector.showWallpaperSelector(e,()=>{this.applyWallpapers()})}initializeWallpapers(e){this.wallpaperManager.applyThemeDefaultWallpapers(e),this.applyWallpapers()}getWallpaperManager(){return this.wallpaperManager}}class Y{blmxManager;uiRenderer;eventHandler;themeManager;wallpaperController;configManager;momentsManager;aiResponseManager;themeEditor;inputHandler;uiManager;dialogManager;userMessageQueue=[];hasMomentNotifications(){return this.momentsManager.hasMomentNotifications()}setMomentNotification(e){this.momentsManager.setMomentNotification(e)}constructor(){this.configManager=new I}async initialize(){try{window.currentGameDate=new Date,this.themeManager=new U,this.wallpaperController=new J(this.themeManager);const e=this.themeManager.getCurrentTheme();this.wallpaperController.initializeWallpapers(e);const t=await l().getCharData();await this.configManager.loadFromStorage(t);let a=this.configManager.getConfig();if(!a.avatars.char){const e=await l().getCharAvatarPath();this.configManager.updateAvatar('char',e),a=this.configManager.getConfig()}$('.contact-name').text(this.getDisplayName('char')),$('#moments-user-name').text(this.getDisplayName('user')),$('#moments-user-avatar').attr('src',a.avatars.user);const n=this.configManager.getSavedCoverPhoto();n&&$('#moments-cover-photo').attr('src',n);const o=this.configManager.getSavedSignature();$('#user-signature-display').text(o),this.blmxManager=new c(a.currentCharId),await this.blmxManager.initialize(),window.BLMX_DEV_MODE&&function(e){if('localhost'!==window.location.hostname&&!window.location.search.includes('debug=true'))return void console.log('[DEBUG] ç”Ÿäº§æ¨¡å¼ï¼Œè·³è¿‡è°ƒè¯•æ•°æ®åŠ è½½');console.log('[DEBUG] æ­£åœ¨åŠ è½½è°ƒè¯•æ•°æ®...');let t=0;const a=()=>{N.slice(t,t+10).forEach(t=>{e.addEntry(t)}),t+=10,t<N.length?requestAnimationFrame(a):console.log('[DEBUG] è°ƒè¯•æ•°æ®åŠ è½½å®Œæˆï¼Œå…±åŠ è½½',N.length,'æ¡æ•°æ®')};a()}(this.blmxManager);const s=window.EventHandlerClass;this.eventHandler=new s('#wechat-input-field','#send-btn','#plus-btn',this.blmxManager,this,null,{getDisplayName:this.getDisplayName.bind(this),stageAndDisplayEntry:this.stageAndDisplayEntry.bind(this),triggerAiResponse:this.triggerAiResponse.bind(this),updateFooterButtonsState:this.updateFooterButtonsState.bind(this),renderChatHistory:this.renderChatHistory.bind(this),renderMomentsFeed:this.renderMomentsFeed.bind(this),togglePanel:this.togglePanel.bind(this),findStickerUrlByName:this.findStickerUrlByName.bind(this)}),this.uiRenderer=new V('.wechat-body',a.avatars,{getDisplayName:this.getDisplayName.bind(this),findStickerUrlByName:this.findStickerUrlByName.bind(this),onTransferAccept:this.handleTransferAccept.bind(this),onGiftAction:this.handleGiftAction.bind(this),onRecallMessage:this.handleMessageRecall.bind(this),isMessageInQueue:this.isMessageInQueue.bind(this)}),this.eventHandler.setUIRenderer(this.uiRenderer),this.momentsManager=new F(this.blmxManager,this.configManager,this.uiRenderer),this.aiResponseManager=new m(this.blmxManager,this.uiRenderer,this.eventHandler,this.momentsManager),this.themeEditor=new O(this.themeManager,()=>{this.applyWallpapers()}),this.inputHandler=new P(this.configManager,this.stageAndDisplayEntry.bind(this),this.updateFooterButtonsState.bind(this)),this.uiManager=new j(this.configManager,this.blmxManager.addEntry.bind(this.blmxManager),this.uiRenderer.renderEntry.bind(this.uiRenderer)),this.dialogManager=B.DialogManager.getInstance(),this.applyWallpapers(),this.renderChatHistory(),this.renderMomentsFeed(),this.uiManager.setupInputPlaceholder(this.getDisplayName('char')),this.updateFooterButtonsState(),this.setupThemeSelector(),this.themeEditor.updateCustomThemeButton(),this.uiManager.setupPhoneSizeAdjustment(),this.uiManager.setupStickerSizeControl(),this.uiManager.setupFontSelection(),this.uiManager.setupFullscreenSizeAdjustment(),this.uiManager.displayAppVersion(),this.uiManager.checkVersionUpdateNotification()}catch(e){}}getDisplayName(e){return this.configManager.getDisplayName(e)}findStickerUrlByName(e){return this.configManager.findStickerUrlByName(e)}applyWallpapers(){this.wallpaperController.applyWallpapers()}changeWallpaper(e){this.wallpaperController.changeWallpaper(e)}renderChatHistory(){this.uiRenderer.clearChat(),this.blmxManager&&(this.blmxManager.logEntries.forEach((e,t)=>{e.recalled?this.uiRenderer.renderRecallNotice(e,null,t):this.uiRenderer.renderEntry(e,t,!1)}),this.userMessageQueue.forEach((e,t)=>{const a=this.blmxManager.logEntries.length+t;e.recalled?this.uiRenderer.renderRecallNotice(e,null,a):this.uiRenderer.renderEntry(e,a,!1)}),this.uiRenderer.refreshAllTimestamps(),this.uiManager.scrollToBottom())}renderMomentsFeed(){this.momentsManager.renderMomentsFeed()}stageAndDisplayEntry(e){if('type'in e){if('event'===e.type){this.blmxManager.addEntry(e);const t=this.blmxManager.logEntries.length-1;return this.uiRenderer.renderEntry(e,t,!0),void('sender'in e&&'me'===e.sender&&this.eventHandler.setHasPendingNotifications(!0))}if('time'===e.type)return;if(e.id||(e.id='msg-'+Date.now()+Math.random()),'image'===e.type&&'content'in e&&'url'===e.content.type&&'string'==typeof e.content.value&&e.content.value.startsWith('data:image')&&(e.content.isNewForAI=!0),'sender'in e&&'me'===e.sender){this.userMessageQueue.push(e),this.eventHandler.setHasPendingNotifications(!0);const t=this.userMessageQueue.length-1,a=this.blmxManager.logEntries.length+t;this.uiRenderer.renderEntry(e,a,!0)}else{this.blmxManager.addEntry(e);const t=this.blmxManager.logEntries.length-1;this.uiRenderer.renderEntry(e,t,!0)}this.updateFooterButtonsState()}}async triggerAiResponse(e=!1){const t=this.userMessageQueue.length>0;if(e||t||this.eventHandler.hasNotifications){if(t){[...this.userMessageQueue].forEach(e=>{'image'===e.type&&'content'in e&&e.content.isNewForAI&&(e.content.value='[ç”¨æˆ·å‘é€çš„å›¾ç‰‡]',delete e.content.isNewForAI),this.blmxManager.addEntry(e)}),this.userMessageQueue=[]}await this.aiResponseManager.triggerAiResponse(e)}}updateFooterButtonsState(){this.uiManager.updateFooterButtonsState(this.eventHandler.hasNotifications)}togglePanel(e){this.uiManager.togglePanel(e)}navigateTo(e){const t={home:'#app-homescreen',wechat:'#wechat-view',wechatHome:'#wechat-home',moments:'#moments-view',settings:'#settings-view'};try{if('undefined'!=typeof $&&'undefined'!=typeof jQuery)$('.app-view').removeClass('active'),$(t[e]).addClass('active');else{$('.app-view').removeClass('active');const a=$(t[e]);a.length?a.addClass('active'):console.error(`[BLMX] æ‰¾ä¸åˆ°ç›®æ ‡è§†å›¾: ${t[e]}`)}'moments'===e&&(this.setMomentNotification(!1),this.renderMomentsFeed())}catch(a){console.error('[BLMX] å¯¼èˆªé”™è¯¯:',a);try{$('.app-view').removeClass('active');const a=$(t[e]);a.length&&a.addClass('active')}catch(e){console.error('[BLMX] æœ€ç»ˆå¯¼èˆªå¤±è´¥:',e)}}}async updateAvatar(e){const t=this.configManager.getConfig().avatars[e]||'',a=this.getDisplayName(e);if('user'===e)await this.showUserProfileDialog(t);else{const n=await this.dialogManager.showInputDialog('æ›´æ¢å¤´åƒ',`${a}å¤´åƒURL`,t,'è¯·è¾“å…¥å¤´åƒå›¾ç‰‡é“¾æ¥','url');n&&(this.configManager.updateAvatar(e,n),await this.dialogManager.alert('å¤´åƒå·²æ›´æ–°ï¼','æ›´æ–°æˆåŠŸ'),this.renderChatHistory(),this.renderMomentsFeed())}}async showUserProfileDialog(e){const t=this.configManager.getSavedSignature();return new Promise(a=>{const n=`\n        <div class="custom-dialog-overlay" id="user-profile-dialog-overlay">\n          <div class="custom-dialog user-profile-dialog">\n            <div class="dialog-header">\n              <h3 class="dialog-title">ä¸ªäººèµ„æ–™è®¾ç½®</h3>\n            </div>\n            <div class="dialog-body">\n              <div class="dialog-input-container">\n                <input type="url" id="avatar-url-input" value="${e}" placeholder="è¯·è¾“å…¥å¤´åƒå›¾ç‰‡é“¾æ¥">\n              </div>\n              <div class="dialog-input-container">\n                <input type="text" id="signature-input" value="${t}" placeholder="è¯·è¾“å…¥ä¸ªæ€§ç­¾å">\n              </div>\n            </div>\n            <div class="dialog-footer">\n              <button class="dialog-button cancel-button" id="user-profile-cancel">å–æ¶ˆ</button>\n              <button class="dialog-button primary-button" id="user-profile-confirm">ç¡®å®š</button>\n            </div>\n          </div>\n        </div>\n      `,o=$('.phone-screen');o.length?o.append(n):$('body').append(n);const s=$('#user-profile-dialog-overlay');s.show(),$('#user-profile-cancel').on('click',()=>{s.remove(),a()}),$('#user-profile-confirm').on('click',async()=>{const n=$('#avatar-url-input').val().trim(),o=$('#signature-input').val().trim();let i=!1;if(n&&n!==e&&(this.configManager.updateAvatar('user',n),$('#moments-user-avatar').attr('src',n),i=!0),o!==t&&(this.configManager.setSignature(o),$('#user-signature-display').text(o),i=!0,o!==t)){await this.dialogManager.confirm('æ˜¯å¦è¦å‘é€æœ‹å‹åœˆåŠ¨æ€é€šçŸ¥AIä½ æ›´æ”¹äº†ä¸ªæ€§ç­¾åï¼Ÿ','æœ‹å‹åœˆé€šçŸ¥')&&(this.momentsManager.notifyMomentChange('signature',t,o),this.eventHandler.setHasPendingNotifications(!0))}s.remove(),i&&(this.renderChatHistory(),this.renderMomentsFeed(),await this.dialogManager.alert('ä¸ªäººèµ„æ–™å·²æ›´æ–°ï¼','æ›´æ–°æˆåŠŸ')),a()}),$(document).on('keydown.userProfile',e=>{'Escape'===e.key&&(s.remove(),$(document).off('keydown.userProfile'),a())}),s.on('click',e=>{e.target===s[0]&&(s.remove(),a())}),setTimeout(()=>{$('#avatar-url-input').focus()},100)})}async updateCharRemark(){const e=this.getDisplayName('char'),t=this.configManager.getConfig(),a=await this.dialogManager.prompt('è¯·è¾“å…¥æ–°çš„å¤‡æ³¨:',t.charRemark,'ä¿®æ”¹å¤‡æ³¨');if(null!==a){this.configManager.updateCharRemark(a);const t=this.getDisplayName('char');$('#contact-name-header').text(t),$('#wechat-input-field').attr('placeholder',this.configManager.getSavedInputPlaceholder()||`ä¸ ${t} å¯¹è¯...`),$('#moments-feed-list .post-author-name').each(function(){$(this).text()===e&&$(this).text(t)}),$('.recall-notice-text').each(function(){const a=$(this).text();a&&a.includes(`"${e}"`)&&$(this).text(`"${t}" æ’¤å›äº†ä¸€æ¡æ¶ˆæ¯`)}),await this.dialogManager.alert('å¤‡æ³¨å·²æ›´æ–°ï¼','æ›´æ–°æˆåŠŸ')}}async updateUserName(){const e=this.getDisplayName('user'),t=await this.dialogManager.showInputDialog('æ›´æ”¹åå­—','è¯·è¾“å…¥ä½ çš„æ–°åå­—',e,'è¾“å…¥æ–°åå­—...');if(t&&''!==t.trim()&&t!==e){this.configManager.updateUserName(t),$('#moments-user-name').text(t);await this.dialogManager.confirm('æ˜¯å¦è¦å‘é€æœ‹å‹åœˆåŠ¨æ€é€šçŸ¥AIä½ æ›´æ”¹äº†åå­—ï¼Ÿ','æœ‹å‹åœˆé€šçŸ¥')&&(this.momentsManager.notifyMomentChange('name',e,t),this.eventHandler.setHasPendingNotifications(!0)),await this.dialogManager.alert('åå­—å·²æ›´æ–°ï¼','æ›´æ–°æˆåŠŸ')}}async updateCoverPhoto(){const e=this.configManager.getSavedCoverPhoto()||'',t=await this.dialogManager.showInputDialog('æœ‹å‹åœˆå°é¢','æœ‹å‹åœˆå°é¢URL',e,'è¯·è¾“å…¥å°é¢å›¾ç‰‡é“¾æ¥','url');t&&(this.configManager.setCoverPhoto(t),$('#moments-cover-photo').attr('src',t))}async handleTransferAccept(e){await this.inputHandler.handleTransferAccept(e)}async handleGiftAction(e){await this.inputHandler.handleGiftAction(e),this.eventHandler.setHasPendingNotifications(!0)}isMessageInQueue(e){return this.userMessageQueue.some(t=>t.id===e)}removeFromUserMessageQueue(e){e>=0&&e<this.userMessageQueue.length&&this.userMessageQueue.splice(e,1)}async handleMessageRecall(e){try{if('message'!==e.type)return;const t=this.userMessageQueue.findIndex(t=>t.id===e.id);if(-1===t)return;const a=this.userMessageQueue[t];a.recalled_content=a.content,a.recalled_timestamp=(new Date).toISOString(),a.recalled=!0,this.renderChatHistory()}catch(e){console.error('æ’¤å›æ¶ˆæ¯æ—¶å‡ºé”™:',e)}}getLatestAiRawResponse(){return this.aiResponseManager.getLatestAiRawResponse()}getLatestSentPrompt(){return this.aiResponseManager.getLatestSentPrompt()}getRawAiResponse(){return this.aiResponseManager.getRawAiResponse()}getFullPrompt(){return this.aiResponseManager.getFullPrompt()}setupThemeSelector(){this.themeEditor.setupThemeSelector(),this.themeEditor.addCustomThemeEditButton(),this.setupThemeEditorEvents()}setupThemeEditorEvents(){$('#close-theme-editor').on('click',()=>this.themeEditor.closeThemeEditor()),$('#save-theme-btn').on('click',()=>this.themeEditor.saveCustomTheme()),$('#reset-theme-btn').on('click',()=>this.themeEditor.resetThemeEditor()),$('#custom-theme-btn').on('click',()=>this.themeEditor.openThemeEditor()),$('#import-theme-btn').on('click',()=>this.themeEditor.importTheme()),$('#export-json-btn').on('click',()=>this.themeEditor.exportThemeAsJSON())}openThemeEditor(){this.themeEditor.openThemeEditor()}closeThemeEditor(){this.themeEditor.closeThemeEditor()}hexToRgba(e,t){return`rgba(${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}, ${t})`}addTestEntry(e){!function(e,t){let a=null;switch(t){case'text-user':a={id:A('msg'),type:'message',sender:'me',content:'è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ–‡æœ¬æ¶ˆæ¯'};break;case'text-char':a={id:A('msg'),type:'message',sender:'them',content:'è¿™æ˜¯ä¸€æ¡AIå›å¤çš„æµ‹è¯•æ¶ˆæ¯'};break;case'sticker-user':a={id:A('sticker'),type:'sticker',sender:'me',content:'å¥½çš„'};break;case'sticker-char':a={id:A('sticker'),type:'sticker',sender:'them',content:'å¥½çš„'};break;case'image-user':a={id:A('img'),type:'image',sender:'me',content:{type:'url',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/è“è‰²_1.jpg'}};break;case'image-char':a={id:A('img'),type:'image',sender:'them',content:{type:'url',value:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç²‰è‰²æ˜Ÿæ˜Ÿ_1.jpg'}};break;case'voice-user':a={id:A('voice'),type:'voice',sender:'me',content:{text:'è¿™æ˜¯ä¸€æ¡æµ‹è¯•è¯­éŸ³æ¶ˆæ¯',duration:3}};break;case'voice-char':a={id:A('voice'),type:'voice',sender:'them',content:{text:'è¿™æ˜¯AIçš„æµ‹è¯•è¯­éŸ³æ¶ˆæ¯',duration:4}};break;case'transfer-user':a={id:A('transfer'),type:'transfer',sender:'me',content:JSON.stringify({amount:'88.88',note:'æµ‹è¯•è½¬è´¦',status:'sent'}),data:{amount:'88.88',note:'æµ‹è¯•è½¬è´¦',status:'sent'}};break;case'transfer-char':a={id:A('transfer'),type:'transfer',sender:'them',content:JSON.stringify({amount:'66.66',note:'AIæµ‹è¯•è½¬è´¦',status:'sent'}),data:{amount:'66.66',note:'AIæµ‹è¯•è½¬è´¦',status:'sent'}};break;case'gift-user':a={id:A('gift'),type:'gift',sender:'me',content:JSON.stringify({name:'ç”Ÿæ—¥è›‹ç³•',price:'99.99',status:'sent'}),data:{name:'ç”Ÿæ—¥è›‹ç³•',price:'99.99',status:'sent'}};break;case'gift-char':a={id:A('gift'),type:'gift',sender:'them',content:JSON.stringify({name:'å·§å…‹åŠ›',price:'39.99',status:'sent'}),data:{name:'å·§å…‹åŠ›',price:'39.99',status:'sent'}};break;case'moment-user':a={key:'USER_MOMENT',data:{text:'ç”¨æˆ·æœ‹å‹åœˆæµ‹è¯•',image:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/è“è‰²_2.jpg',image_type:'url',date:L(),time:R()}};break;case'moment-char':a={key:'CHAR_MOMENT',data:{text:'AIæœ‹å‹åœˆæµ‹è¯•',image:'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç²‰è‰²å°çŒ«_1.jpg',image_type:'url',date:L(),time:R()}};break;case'event-short':a={type:'event',content:{date:L(),time:R(),description:'è¿™æ˜¯ä¸€ä¸ªç®€çŸ­çš„äº‹ä»¶æ—¥å¿—æµ‹è¯•'}};break;case'event-long':a={type:'event',content:{date:L(),time:R(),description:'è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„äº‹ä»¶æ—¥å¿—æµ‹è¯•ï¼Œç”¨æ¥éªŒè¯é•¿æ–‡æœ¬çš„æ˜¾ç¤ºæ•ˆæœã€‚åœ¨ç‰©è¯­ä¸–ç•Œçš„æ·±å¤„ï¼Œéšè—ç€æ— æ•°çš„ç§˜å¯†å’Œä¼ è¯´ã€‚æ¯å½“å¤œå¹•é™ä¸´ï¼Œæ˜Ÿå…‰æ´’å‘å¤§åœ°ï¼Œé‚£äº›å¤è€çš„æ•…äº‹ä¾¿ä¼šåœ¨é£ä¸­è½»å£°è¯‰è¯´ã€‚ä¸»è§’è¸ä¸Šäº†å¯»æ‰¾çœŸç›¸çš„æ—…ç¨‹ï¼Œç©¿è¶Šäº†æ£®æ—ã€å±±å·å’Œæµ·æ´‹ï¼Œé‡åˆ°äº†å„ç§å„æ ·çš„äººç‰©å’ŒæŒ‘æˆ˜ã€‚è¿™æ®µæ—…ç¨‹ä¸ä»…æ˜¯å¯¹å¤–åœ¨ä¸–ç•Œçš„æ¢ç´¢ï¼Œæ›´æ˜¯å¯¹å†…å¿ƒæ·±å¤„çš„è‡ªæˆ‘å‘ç°ã€‚'}};break;case'time':a={type:'time',content:{date:L(),time:R()}};break;default:return void console.error('[DEBUG] æœªçŸ¥çš„æµ‹è¯•æ•°æ®ç±»å‹:',t)}a&&(e.addEntry(a),e.persistLogToStorage(),console.log(`[DEBUG] å·²æ·»åŠ æµ‹è¯•æ•°æ®: ${t}`,a))}(this.blmxManager,e)}clearDebugData(){var e;e=this.blmxManager,console.log('[DEBUG] æ­£åœ¨æ¸…é™¤è°ƒè¯•æ•°æ®...'),e.logEntries=[],console.log('[DEBUG] è°ƒè¯•æ•°æ®å·²æ¸…é™¤')}showTestEntryTypes(){console.log('[BLMX Debug] å¯ç”¨çš„æµ‹è¯•æ¡ç›®ç±»å‹:'),console.log('- text-user: ç”¨æˆ·æ–‡æœ¬æ¶ˆæ¯'),console.log('- text-char: AIæ–‡æœ¬æ¶ˆæ¯'),console.log('- sticker-user: ç”¨æˆ·è¡¨æƒ…æ¶ˆæ¯'),console.log('- sticker-char: AIè¡¨æƒ…æ¶ˆæ¯'),console.log('- image-user: ç”¨æˆ·å›¾ç‰‡æ¶ˆæ¯'),console.log('- image-char: AIå›¾ç‰‡æ¶ˆæ¯'),console.log('- voice-user: ç”¨æˆ·è¯­éŸ³æ¶ˆæ¯'),console.log('- voice-char: AIè¯­éŸ³æ¶ˆæ¯'),console.log('- transfer-user: ç”¨æˆ·è½¬è´¦æ¶ˆæ¯'),console.log('- gift-user: ç”¨æˆ·ç¤¼ç‰©æ¶ˆæ¯'),console.log('- moment-user: ç”¨æˆ·æœ‹å‹åœˆåŠ¨æ€'),console.log('- moment-char: AIæœ‹å‹åœˆåŠ¨æ€'),console.log('- event-short: çŸ­äº‹ä»¶æ—¥å¿—'),console.log('- event-long: é•¿äº‹ä»¶æ—¥å¿—ï¼ˆæµ‹è¯•é•¿æ–‡æœ¬æ˜¾ç¤ºï¼‰'),console.log('- time: æ—¶é—´æˆ³')}showDebugInfo(){!function(e){console.log('[BLMX Debug] è°ƒè¯•ä¿¡æ¯:');try{const t=e.getRawAiResponse?e.getRawAiResponse():'æ— æ³•è·å–',a=e.getFullPrompt?e.getFullPrompt():'æ— æ³•è·å–',n=e.getLatestAiRawResponse?e.getLatestAiRawResponse():'æ— æ³•è·å–',o=e.getLatestSentPrompt?e.getLatestSentPrompt():'æ— æ³•è·å–';console.log('- åŸå§‹AIå“åº”:',t),console.log('- å®Œæ•´æç¤ºè¯:',a),console.log('- æœ€æ–°å¤„ç†åçš„AIå“åº”:',n),console.log('- æœ€æ–°å‘é€ç»™AIçš„æç¤º:',o)}catch(e){console.error('[BLMX Debug] è·å–è°ƒè¯•ä¿¡æ¯æ—¶å‡ºé”™:',e)}}(this)}notifyRecallViaMoments(e,t){confirm('æ˜¯å¦è¦å‘é€æœ‹å‹åœˆåŠ¨æ€é€šçŸ¥AIä½ æ’¤å›äº†æ¶ˆæ¯ï¼Ÿ')&&(this.momentsManager.notifyRecallViaMoments(e,t),this.eventHandler.setHasPendingNotifications(!0))}cleanup(){this.aiResponseManager&&'function'==typeof this.aiResponseManager.cleanup&&this.aiResponseManager.cleanup(),this.uiRenderer&&'function'==typeof this.uiRenderer.cleanup&&this.uiRenderer.cleanup()}}class X{static instance;loadedStyles=new Set;constructor(){this.initializeStyles()}static getInstance(){return X.instance||(X.instance=new X),X.instance}initializeStyles(){console.log('[StyleManager] æ­£åœ¨åŠ è½½æ ·å¼æ–‡ä»¶...'),this.loadedStyles.add('main'),document.body.classList.add('styles-loaded'),console.log('[StyleManager] æ ·å¼æ–‡ä»¶åŠ è½½å®Œæˆ')}isStyleLoaded(e){return this.loadedStyles.has(e)}toggleTheme(e){const t=document.body;'dark'===e?t.classList.add('dark-mode'):t.classList.remove('dark-mode'),console.log(`[StyleManager] ä¸»é¢˜å·²åˆ‡æ¢åˆ°: ${e}`)}getCurrentTheme(){return document.body.classList.contains('dark-mode')?'dark':'light'}setCSSVariable(e,t){document.documentElement.style.setProperty(e,t)}getCSSVariable(e){return getComputedStyle(document.documentElement).getPropertyValue(e).trim()}setCSSVariables(e){Object.entries(e).forEach(([e,t])=>{this.setCSSVariable(e,t)})}resetCSSVariables(){const e=document.documentElement.style,t=[];for(let a=0;a<e.length;a++){const n=e[a];n.startsWith('--')&&t.push(n)}t.forEach(t=>{e.removeProperty(t)})}addStyleClass(e,t){e.classList.add(t)}removeStyleClass(e,t){e.classList.remove(t)}toggleStyleClass(e,t){return e.classList.toggle(t)}hasStyleClass(e,t){return e.classList.contains(t)}getStatus(){return{loadedStyles:Array.from(this.loadedStyles),currentTheme:this.getCurrentTheme(),stylesLoaded:document.body.classList.contains('styles-loaded')}}}const K=X.getInstance();function Q(e){!function(){const e={conv:'#wechat-tab-conv',contacts:'#wechat-tab-contacts',discover:'#wechat-tab-discover',me:'#wechat-tab-me'},t=t=>{$('.wechat-home-section').removeClass('active'),$(e[t]).addClass('active'),$('.wechat-tab-btn').removeClass('active'),$(`.wechat-tab-btn[data-target="${t}"]`).addClass('active')};$('.wechat-tab-btn').off('click').on('click',function(){const e=$(this).data('target')||'conv';t(e)}),t('conv')}(),function(e){const t=e.configManager,a=t?.getConfig?.();if(a){const n=a.avatars?.user||a.avatars?.char||'';n&&$('#profile-avatar').css({'background-image':`url(${n})`,'background-size':'cover','background-position':'center'}),$('#profile-name').text(e.getDisplayName('user'));const o=t?.getSavedSignature?.()||('undefined'!=typeof localStorage?localStorage.getItem('blmx_user_signature'):'')||'';o&&$('#profile-signature').text(o)}}(e),function(e){const t=e.configManager,a=t?.getConfig?.(),n=a?.avatars?.char||'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/å¤´åƒ/é»˜è®¤å¤´åƒ.jpg',o=[{id:'c1',type:'single',name:e.getDisplayName('char'),avatar:n,lastMessage:'è¿™é‡Œæ˜¾ç¤ºæœ€è¿‘ä¸€æ¡æ¶ˆæ¯æ‘˜è¦...',time:'08:39',unread:2},{id:'g1',type:'group',name:'ç¾¤èŠç¤ºä¾‹',avatar:'https://files.catbox.moe/3j0tpc.jpeg',lastMessage:'ç¾¤èŠæœ€è¿‘æ¶ˆæ¯æ‘˜è¦...',time:'æ˜¨æ™š',unread:0}],s=$('#conversation-list');s.empty(),o.length?(window._?.each||((e,t)=>e.forEach(t)))(o,function(t){const a=$(`\n      <li class="conv-item" data-conv-id="${t.id}">\n        <div class="conv-avatar" style="background-image: url('${t.avatar}')"></div>\n        <div class="conv-main">\n          <div class="conv-row">\n            <span class="conv-name">${t.name}</span>\n            <span class="conv-time">${t.time}</span>\n          </div>\n          <div class="conv-row">\n            <span class="conv-desc">${t.lastMessage}</span>\n            ${t.unread>0?`<span class="conv-unread">${t.unread}</span>`:''}\n          </div>\n        </div>\n      </li>\n    `);a.on('click',()=>{a.find('.conv-unread').remove(),t.unread=0,e.navigateTo('wechat')}),s.append(a)}):s.append('<li class="conv-item placeholder">æš‚æ— ä¼šè¯ï¼Œåç»­å±•ç¤ºå•èŠ/ç¾¤èŠ</li>')}(e),function(e){const t=e.configManager,a=t?.getConfig?.(),n=a?.avatars?.user||'https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/å¤´åƒ/é»˜è®¤å¤´åƒ.jpg',o=[{id:'u1',type:'single',name:e.getDisplayName('char'),avatar:n,desc:'å¥½å‹'},{id:'g1',type:'group',name:'ç¾¤èŠç¤ºä¾‹',avatar:'https://files.catbox.moe/3j0tpc.jpeg',desc:'ç¾¤èŠ'},{id:'u2',type:'single',name:'æ–°è”ç³»äºº',avatar:n,desc:'å¥½å‹å ä½'}],s=$('#contacts-list');s.empty(),o.length?((window._?.each||((e,t)=>e.forEach(t)))(o,function(t){const a=$(`\n      <li class="contact-item" data-contact-id="${t.id}">\n        <div class="conv-avatar" style="background-image: url('${t.avatar}')"></div>\n        <div class="conv-main">\n          <div class="conv-row">\n            <span class="conv-name">${t.name}</span>\n            <span class="conv-time">${'group'===t.type?'ç¾¤èŠ':'å¥½å‹'}</span>\n          </div>\n          <div class="conv-row">\n            <span class="conv-desc">${t.desc||''}</span>\n          </div>\n        </div>\n      </li>\n    `);a.on('click',()=>{e.navigateTo('wechat')}),s.append(a)}),$('#add-friend-entry').off('click').on('click',async()=>{await B.DialogManager.getInstance().alert('æ·»åŠ æœ‹å‹åŠŸèƒ½å ä½ï¼Œåç»­æ¥å…¥ã€‚','æç¤º')}),$('#group-list-entry').off('click').on('click',async()=>{await B.DialogManager.getInstance().alert('ç¾¤èŠåˆ—è¡¨å…¥å£å ä½ï¼Œåç»­æ¥å…¥ã€‚','æç¤º')})):s.append('<li class="contact-item placeholder">è”ç³»äººåˆ—è¡¨å ä½</li>')}(e)}console.log('[StyleManager] æ ·å¼ç®¡ç†å™¨å·²åˆå§‹åŒ–'),window.BLMX_DEV_MODE=!1,window.EventHandlerClass=class{wechatInput;sendBtn;plusBtn;uiRenderer;options;blmxManager;appController;hasPendingNotifications=!1;dialogManager=B.DialogManager.getInstance();get hasNotifications(){return this.hasPendingNotifications}setUIRenderer(e){this.uiRenderer=e}constructor(e,t,a,n,o,s,i){if(this.wechatInput=$(e)[0],this.sendBtn=$(t)[0],this.plusBtn=$(a)[0],!this.wechatInput||!this.sendBtn||!this.plusBtn)throw new Error('One or more required elements not found');this.blmxManager=n,this.options=i,this.appController=o,this.uiRenderer=s,this.setupEventListeners()}setHasPendingNotifications(e){this.hasPendingNotifications=e,this.options.updateFooterButtonsState()}updateGameTime(e){if(isNaN(e.getTime()))return;window.currentGameDate=e;const t=$('#current-time');if(t.length){const a=`${e.getHours().toString().padStart(2,'0')}:${e.getMinutes().toString().padStart(2,'0')}`;t.text(a)}this.uiRenderer&&this.uiRenderer.refreshAllTimestamps()}async deleteByLogIndex(e,t){if(!await this.dialogManager.confirm(`ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ\n\né¢„è§ˆ: "${t}..."`,'åˆ é™¤è®°å½•'))return;const a=this.blmxManager.logEntries.length;if(e<a)this.blmxManager.logEntries.splice(e,1),await this.blmxManager.persistLogToStorage();else{const t=e-a;this.appController.removeFromUserMessageQueue(t)}this.options.renderChatHistory(),this.options.renderMomentsFeed()}async deleteByMessageId(e,t,a){if(!await this.dialogManager.confirm(`ç¡®å®šè¦åˆ é™¤è¿™æ¡æ¶ˆæ¯å—ï¼Ÿ\n\né¢„è§ˆ: "${t}..."`,'åˆ é™¤æ¶ˆæ¯'))return;const n=this.blmxManager.logEntries.findIndex(t=>'id'in t&&t.id===e);-1!==n?(this.blmxManager.logEntries.splice(n,1),await this.blmxManager.persistLogToStorage(),this.options.renderChatHistory(),this.options.renderMomentsFeed()):(a.remove(),await this.dialogManager.alert('æ— æ³•æ‰¾åˆ°å¯¹åº”çš„æ—¥å¿—æ¡ç›®ï¼Œå·²ä»ç•Œé¢ç§»é™¤è¯¥æ¶ˆæ¯','é”™è¯¯'))}addLongPressListener(e,t,a={duration:600,preventDefault:!0}){let n,o,s;const i=()=>clearTimeout(n);e.addEventListener('pointerdown',e=>{'mousedown'===e.type&&0!==e.button||(o=e.clientX,s=e.clientY,a.preventDefault&&e.preventDefault(),clearTimeout(n),n=window.setTimeout(()=>{n=0,t()},a.duration))}),e.addEventListener('pointermove',e=>{if(!n)return;const t=e.clientX,a=e.clientY;(Math.abs(t-o)>10||Math.abs(a-s)>10)&&clearTimeout(n)}),e.addEventListener('pointerup',i),e.addEventListener('pointerleave',i),a.preventDefault&&e.addEventListener('contextmenu',e=>e.preventDefault())}async promptForDateTime(e){const t=await this.dialogManager.prompt('è¯·è¾“å…¥æ—¥æœŸå’Œæ—¶é—´',e,'æ—¥æœŸæ—¶é—´è®¾ç½®','ç¡®å®š','å–æ¶ˆ','text','æ ¼å¼YYYY-MM-DD HH:mm');if(!t||!/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/.test(t))return t&&await this.dialogManager.alert('æ ¼å¼é”™è¯¯ï¼Œè¯·è¾“å…¥YYYY-MM-DD HH:mm æ ¼å¼ã€‚','æ ¼å¼é”™è¯¯'),null;const[a,n]=t.split(' '),o=new Date(t.replace(' ','T'));return isNaN(o.getTime())?(await this.dialogManager.alert('æ— æ•ˆçš„æ—¥æœŸæ—¶é—´æ ¼å¼ã€‚','æ ¼å¼é”™è¯¯'),null):(this.updateGameTime(o),[a,n])}async handleMessageRecall(e){const t=this.blmxManager.logEntries.find(t=>'id'in t&&t.id===e);if(t){const e=window.currentGameDate||new Date,a=`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,'0')}-${e.getDate().toString().padStart(2,'0')} ${e.getHours().toString().padStart(2,'0')}:${e.getMinutes().toString().padStart(2,'0')}`,n=await this.promptForDateTime(a);if(null===n)return;if(await this.dialogManager.confirm('æ˜¯å¦è¦æ’¤å›è¿™æ¡æ¶ˆæ¯ï¼Ÿ','ç¡®è®¤æ’¤å›')){const[e,a]=n;if(t.recalled=!0,t.recalled_timestamp=`${e} ${a}`,t.recalled_content=t.content,this.blmxManager.persistLogToStorage().then(()=>{this.options.renderChatHistory()}),this.options.updateFooterButtonsState(),'me'===t.sender){const e='string'==typeof t.content?t.content:g(t.content);this.appController.notifyRecallViaMoments('USER',e)}}}else await this.dialogManager.alert('æ‰¾ä¸åˆ°è¯¥æ¶ˆæ¯ï¼Œæ— æ³•æ’¤å›ã€‚','é”™è¯¯')}setupEventListeners(){$(this.sendBtn).on('click',()=>{const e=this.wechatInput.value.trim();e?(this.options.stageAndDisplayEntry({id:`msg-${Date.now()}${Math.random()}`,type:'message',sender:'me',content:e}),this.wechatInput.value='',this.options.updateFooterButtonsState()):(this.hasPendingNotifications=!1,this.options.triggerAiResponse(!0))}),$('#smile-btn').on('click',()=>{this.options.togglePanel('sticker'),this.renderStickerFeatures()}),$(this.plusBtn).on('click',()=>{this.options.togglePanel('plus'),this.renderPlusFeatures()}),$('#microphone-btn').on('click',async()=>{const e=await this.dialogManager.showVoiceDialog();e&&this.options.stageAndDisplayEntry({id:`msg-${Date.now()}${Math.random()}`,type:'voice',sender:'me',content:{text:e.text,duration:e.duration}})}),$(this.wechatInput).on('keydown',e=>{'Enter'!==e.key||e.shiftKey||(e.preventDefault(),$(this.sendBtn).trigger('click'))}),$(this.wechatInput).on('input',()=>{this.options.updateFooterButtonsState()}),$(this.wechatInput).on('focus',()=>{this.options.togglePanel(null)}),$('#app-wechat').on('click',()=>this.appController.navigateTo('wechat')),$('#app-settings').on('click',()=>this.appController.navigateTo('settings')),$('#wechat-back-btn-dummy').on('click',()=>this.appController.navigateTo('home')),$('#settings-back-btn').on('click',()=>this.appController.navigateTo('home')),$('#wechat-options-btn').on('click',()=>this.appController.navigateTo('moments')),$('#moments-back-btn').on('click',()=>this.appController.navigateTo('wechat')),this.renderPlusFeatures(),this.renderStickerFeatures(),this.setupClickListeners(),this.addLongPressListener($('#wechat-input-field')[0],async()=>{const e=$('#wechat-input-field').attr('placeholder')||'',t=await this.dialogManager.prompt('ä¿®æ”¹è¾“å…¥æ¡†æç¤ºæ–‡å­—:',e,'ä¿®æ”¹æç¤ºæ–‡å­—');null!==t&&($('#wechat-input-field').attr('placeholder',t),localStorage.setItem(`blmx_input_placeholder_${this.blmxManager.getCharId()}`,t))},{duration:5e3,preventDefault:!1})}async setupClickListeners(){$('#hidden-send-trigger').on('click',async()=>{await this.dialogManager.confirm('æ˜¯å¦è¦ç«‹å³è§¦å‘AIå“åº”ï¼ˆå³ä½¿æ²¡æœ‰æ–°æ¶ˆæ¯ï¼‰ï¼Ÿ','è§¦å‘AIå“åº”')&&this.options.triggerAiResponse(!0)}),$('#wechat-options-btn').on('click',()=>{this.appController.navigateTo('moments')}),$('#delete-mode-trigger').on('click',async()=>{const e=$('#wechat-view');e?.toggleClass('delete-mode'),e?.hasClass('delete-mode')?await this.dialogManager.alert('å·²è¿›å…¥åˆ é™¤æ¨¡å¼ã€‚ç‚¹å‡»ä»»æ„æ¶ˆæ¯æˆ–æ—¶é—´æˆ³å¯å°†å…¶åˆ é™¤ã€‚å†æ¬¡ç‚¹å‡»å·¦ä¸Šè§’å¯é€€å‡ºã€‚','åˆ é™¤æ¨¡å¼'):await this.dialogManager.alert('å·²é€€å‡ºåˆ é™¤æ¨¡å¼ã€‚','åˆ é™¤æ¨¡å¼')}),$('#post-moment-btn').on('click',async()=>{const e=window.currentGameDate||new Date,t=`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,'0')}-${e.getDate().toString().padStart(2,'0')} ${e.getHours().toString().padStart(2,'0')}:${e.getMinutes().toString().padStart(2,'0')}`,a=await this.dialogManager.showMomentDialog(t);if(!a)return;const n={key:'USER_MOMENT',id:`moment-${Date.now()}-${Math.random().toString(36).substring(2,10)}`,data:{text:a.text,image:a.image,image_type:a.image_type,image_desc:a.image_desc,date:a.date,time:a.time}};this.blmxManager.addEntry(n);const o=`${a.date} ${a.time}`;new Date(o.replace(' ','T'))>(window.currentGameDate||new Date)&&setTimeout(async()=>{if(await this.dialogManager.confirm(`æœ‹å‹åœˆå‘å¸ƒæ—¶é—´ï¼ˆ${a.date} ${a.time}ï¼‰æ™šäºå½“å‰æ¸¸æˆæ—¶é—´ã€‚\næ˜¯å¦è¦å°†æ¸¸æˆæ—¶é—´æ¨è¿›åˆ°æœ‹å‹åœˆå‘å¸ƒæ—¶é—´ï¼Ÿ`,'æ—¶é—´æ¨è¿›ç¡®è®¤')){const e=new Date(o.replace(' ','T'));if(!isNaN(e.getTime())){this.updateGameTime(e);const t={type:'event',content:{date:a.date,time:a.time,description:`æ—¶é—´æ¥åˆ°äº† ${a.date} ${a.time}`},id:`event-${Date.now()}`};this.blmxManager.addEntry(t),this.options.renderMomentsFeed()}}},300),this.options.renderMomentsFeed(),this.setHasPendingNotifications(!0),this.options.updateFooterButtonsState(),this.blmxManager.persistLogToStorage().then(()=>{})});const e=$('#moments-feed-list');e?.on('click',async e=>{const t=$(e.target)[0],a=t.closest('.moment-post');if(!a)return;const n=a.dataset.momentId;if(n){if(t.closest('.delete-moment-btn')){if(await this.dialogManager.confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æœ‹å‹åœˆå—ï¼Ÿ\næ­¤æ“ä½œä¹Ÿä¼šåˆ é™¤ç›¸å…³çš„ç‚¹èµå’Œè¯„è®ºã€‚','åˆ é™¤æœ‹å‹åœˆ')){const e=[];this.blmxManager.logEntries.forEach((t,a)=>{'key'in t&&t.key.includes('_MOMENT')&&e.push(a)});const t=parseInt(n,10),a=e[t];if(void 0!==a&&a>=0){const e=[a];this.blmxManager.logEntries.forEach((a,n)=>{'key'in a&&('USER_LIKE'===a.key||'USER_COMMENT'===a.key)&&'data'in a&&'target_post_id'in a.data&&a.data.target_post_id===t&&e.push(n)}),e.sort((e,t)=>t-e);for(const t of e)this.blmxManager.logEntries.splice(t,1);this.blmxManager.persistLogToStorage().then(()=>{this.options.renderMomentsFeed()})}}}else if(t.closest('.comment-button')){const e=await this.dialogManager.showCommentDialog();if(e){if('like'===e.type){const e={key:'USER_LIKE',id:`like-${Date.now()}-${Math.random().toString(36).substring(2,10)}`,data:{target_post_id:parseInt(n,10)}};this.blmxManager.addEntry(e)}else if('comment'===e.type&&e.content){const t={key:'USER_COMMENT',id:`comment-${Date.now()}-${Math.random().toString(36).substring(2,10)}`,data:{text:e.content,target_post_id:parseInt(n,10)}};this.blmxManager.addEntry(t)}this.options.renderMomentsFeed(),this.setHasPendingNotifications(!0),this.options.updateFooterButtonsState(),this.blmxManager.persistLogToStorage()}}}else console.error('[BLMX] æ— æ³•è·å–æœ‹å‹åœˆIDï¼Œdata-moment-idå±æ€§ç¼ºå¤±')}),$(document.body).on('click',e=>{const t=$(e.target)[0];if(t.matches('.message-avatar')){const e=t.closest('.message-row');if(e){const t=e.classList.contains('me')?'user':'char';this.appController.updateAvatar(t)}}}),$('#contact-name-header').on('click',()=>{this.appController.updateCharRemark()}),$('#moments-user-name').on('click',()=>{this.appController.updateUserName()}),$('#moments-user-avatar').on('click',()=>{this.appController.updateAvatar('user')}),$('#moments-cover-photo').on('click',()=>{this.appController.updateCoverPhoto()});$('.wechat-body').on('click',async e=>{if(!$('#wechat-view').hasClass('delete-mode'))return;const t=$(e.target).closest('[data-log-index]');if(t.length){e.preventDefault(),e.stopPropagation();const a=-1!==$('.wechat-body [data-log-index]').index(t)?$('.wechat-body [data-log-index]').index(t):parseInt(t.data('logIndex'),10),n=t.text().trim().replace(/\s+/g,' ').substring(0,50);return void await this.deleteByLogIndex(a,n)}const a=$(e.target).closest('[data-message-id]');if(a.length){e.preventDefault(),e.stopPropagation();const t=a.data('messageId'),n=a.text().trim().replace(/\s+/g,' ').substring(0,50);await this.deleteByMessageId(t,n,a)}}),$('#change-chat-wallpaper-btn').on('click',e=>{e.preventDefault(),this.appController.changeWallpaper('chat')}),$('#change-home-wallpaper-btn').on('click',e=>{e.preventDefault(),this.appController.changeWallpaper('home')}),$('#change-settings-wallpaper-btn').on('click',e=>{e.preventDefault(),this.appController.changeWallpaper('settings')}),$('#show-last-ai-response-btn').on('click',async e=>{e.preventDefault();const t=this.appController.getLatestAiRawResponse();await this.dialogManager.showScrollableText(t||'æš‚æ— AIå›å¤å†…å®¹','AIåŸå§‹å›å¤','å…³é—­')}),$('#show-last-sent-prompt-btn').on('click',async e=>{e.preventDefault();const t=this.appController.getLatestSentPrompt();await this.dialogManager.showScrollableText(t||'æš‚æ— å‘é€çš„æç¤ºå†…å®¹','å‘é€çš„æç¤º','å…³é—­')}),$('.dynamic-island').on('click',async()=>{try{document.fullscreenElement?await document.exitFullscreen():await document.documentElement.requestFullscreen()}catch(e){console.warn('[BLMX] å…¨å±åŠŸèƒ½ä¸æ”¯æŒæˆ–è¢«é˜»æ­¢:',e),await this.dialogManager.alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒå…¨å±åŠŸèƒ½æˆ–è¢«é˜»æ­¢','å…¨å±åŠŸèƒ½')}})}renderPlusFeatures(){const e=$('#plus-grid');if(!e.length)return;const t=[{label:'ç›¸å†Œ',icon:'fas fa-images',action:async()=>{const e=await this.dialogManager.prompt('è¯·è¾“å…¥å›¾ç‰‡æè¿°:','','æ·»åŠ å›¾ç‰‡');e&&(this.options.stageAndDisplayEntry({type:'image',sender:'me',content:{type:'desc',value:e},id:`msg-${Date.now()}`}),this.options.togglePanel(null))}},{label:'æ‹æ‘„',icon:'fas fa-camera',action:async()=>{const e=window.currentGameDate||new Date,t=`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,'0')}-${e.getDate().toString().padStart(2,'0')}`,a=`${e.getHours().toString().padStart(2,'0')}:${e.getMinutes().toString().padStart(2,'0')}`,n=await this.dialogManager.showTimeJumpDialog(`${t} ${a}`);if(!n)return;const o={date:n.date,time:n.time,description:n.description},[s,i]=[n.date,n.time],r=new Date(`${s} ${i}`.replace(' ','T'));this.updateGameTime(r),this.options.stageAndDisplayEntry({type:'event',content:o,id:`event-${Date.now()}`}),this.options.togglePanel(null)}},{label:'è§†é¢‘é€šè¯',icon:'fas fa-video',action:async()=>await this.dialogManager.alert('æœ¬åŒå±‚æ‰‹æœºåªã€å…è´¹å‘å¸ƒäºdiscordçš„å°¾å·´é•‡ç¤¾åŒºå’Œæ—…ç¨‹ç¤¾åŒºï¼Œä½œè€…æš´åŠ›ç¾å­¦ï¼Œç‚¹å‡»é“¾æ¥å³å¯å…è´¹è·å–https://discord.com/channels/1379304008157499423/1388180976873766973ã€‚https://discord.com/channels/1291925535324110879/1388182155707814009','å…³äºä½œè€…')},{label:'ä½ç½®',icon:'fas fa-map-marker-alt',action:async()=>{const e=await this.dialogManager.prompt('è¯·è¾“å…¥ä½ç½®:','','å‘é€ä½ç½®');e&&this.options.stageAndDisplayEntry({type:'location',sender:'me',content:e,id:`msg-${Date.now()}`}),this.options.togglePanel(null)}},{label:'çº¢åŒ…',icon:'fas fa-envelope',action:async()=>{const e=await this.dialogManager.showRedPacketDialog();if(e){const t={name:'çº¢åŒ…',price:e.amount,note:e.note,status:'sent'};this.options.stageAndDisplayEntry({type:'gift',sender:'me',content:g(t),data:t,id:`msg-${Date.now()}`}),this.options.togglePanel(null)}}},{label:'è½¬è´¦',icon:'fas fa-money-bill-wave',action:async()=>{const e=await this.dialogManager.showTransferDialog();if(e){const t={amount:e.amount,note:e.note||' ',status:'sent'};this.options.stageAndDisplayEntry({type:'transfer',sender:'me',content:g(t),data:t,id:`msg-${Date.now()}`}),this.options.togglePanel(null)}}},{label:'æ–‡ä»¶',icon:'fas fa-file-alt',action:async()=>{const e=await this.dialogManager.prompt('è¯·è¾“å…¥æ–‡ä»¶å:','','å‘é€æ–‡ä»¶');e&&this.options.stageAndDisplayEntry({type:'file',sender:'me',content:e,id:`msg-${Date.now()}`}),this.options.togglePanel(null)}},{label:'ç¤¼ç‰©',icon:'fas fa-gift',action:async()=>{const e=await this.dialogManager.showGiftDialog();if(e){const t={name:e.name,price:e.price,status:'sent'};this.options.stageAndDisplayEntry({type:'gift',sender:'me',content:g(t),data:t,id:`msg-${Date.now()}`}),this.options.togglePanel(null)}}}];this.uiRenderer?this.uiRenderer.renderFeatureGrid(e[0],t,{onToggleDeleteMode:()=>{},onAddStickers:()=>{}}):console.error('[BLMX] UIRenderer is not initialized')}renderStickerFeatures(){const e=$('#sticker-grid');if(!e.length)return;const t=[{label:'å¥½çš„',url:'https://files.catbox.moe/3j0tpc.jpeg'}],a=p.getItem('blmx_wechat_stickers_global_blmx',[])||[],n=[...t,...a].map(e=>({label:e.label,icon:e.url,isDefault:t.some(t=>t.label===e.label),action:()=>{this.options.stageAndDisplayEntry({type:'sticker',sender:'me',content:e.label,id:`msg-${Date.now()}`}),this.options.togglePanel(null)}}));n.unshift({label:'è¡¨æƒ…ç®¡ç†',icon:'fas fa-cog',isAddBtn:!0,isDefault:!1,action:()=>{this.showStickerManager()}}),this.uiRenderer?this.uiRenderer.renderFeatureGrid(e[0],n,{onToggleDeleteMode:()=>this.showStickerManager(),onAddStickers:()=>this.showStickerManager()}):console.error('[BLMX] UIRenderer is not initialized')}showStickerManager(){const e=document.createElement('div');e.className='sticker-manager-modal';const t=document.createElement('div');t.className='sticker-manager-container',t.innerHTML='\n      <h2>è¡¨æƒ…åŒ…ç®¡ç†</h2>\n      <div class="sticker-manager-tabs">\n        <div class="tab-button active" data-tab="add-sticker">æ·»åŠ è¡¨æƒ…</div>\n        <div class="tab-button" data-tab="batch-add">æ‰¹é‡æ·»åŠ </div>\n        <div class="tab-button" data-tab="delete-manage">åˆ é™¤ç®¡ç†</div>\n      </div>\n      <div class="sticker-manager-content">\n        \x3c!-- æ·»åŠ å•ä¸ªè¡¨æƒ…æ ‡ç­¾é¡µ --\x3e\n        <div class="tab-content active" data-tab="add-sticker">\n          <div class="add-sticker-section">\n            <div class="add-sticker-form">\n              <div class="form-group">\n                <label for="sticker-label">è¡¨æƒ…åŒ…åç§°</label>\n                <input type="text" id="sticker-label" placeholder="è¡¨æƒ…æè¿°/åç§°">\n              </div>\n              <div class="form-group">\n                <label for="sticker-url">è¡¨æƒ…åŒ…URL</label>\n                <input type="url" id="sticker-url" placeholder="è¡¨æƒ…å›¾ç‰‡URLé“¾æ¥">\n              </div>\n              <div class="preview-container">\n                <div class="preview-label">é¢„è§ˆ</div>\n                <img id="preview-img" class="preview-img" style="display: none;">\n              </div>\n              <button class="add-sticker-btn">æ·»åŠ è¡¨æƒ…åŒ…</button>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- æ‰¹é‡æ·»åŠ æ ‡ç­¾é¡µ --\x3e\n        <div class="tab-content" data-tab="batch-add">\n          <div class="batch-add-section">\n            <div class="batch-instructions">\n              <p>æ‰¹é‡æ·»åŠ æ ¼å¼è¯´æ˜ï¼š</p>\n              <ul>\n                <li>æ¯ä¸ªè¡¨æƒ…åŒ…æ ¼å¼ï¼š<strong>è¡¨æƒ…åç§°http://å›¾ç‰‡é“¾æ¥</strong></li>\n                <li>å¤šä¸ªè¡¨æƒ…åŒ…ç”¨<strong>è‹±æ–‡é€—å·</strong>åˆ†éš”</li>\n                <li>ä¹Ÿæ”¯æŒ <strong>è¡¨æƒ…åç§°=http://å›¾ç‰‡é“¾æ¥</strong> æ ¼å¼</li>\n                <li>ç¤ºä¾‹ï¼š<code>ç¬‘è„¸https://example.com/smile.jpg,å“­è„¸https://example.com/cry.jpg</code></li>\n              </ul>\n            </div>\n            <div class="form-group">\n              <label for="batch-textarea">æ‰¹é‡è¡¨æƒ…åŒ…æ•°æ®</label>\n              <textarea id="batch-textarea" placeholder="è¯·æŒ‰ç…§ä¸Šè¿°æ ¼å¼è¾“å…¥å¤šä¸ªè¡¨æƒ…åŒ…..."></textarea>\n            </div>\n            <button class="batch-add-btn">æ‰¹é‡æ·»åŠ è¡¨æƒ…åŒ…</button>\n          </div>\n        </div>\n\n        \x3c!-- åˆ é™¤ç®¡ç†æ ‡ç­¾é¡µ --\x3e\n        <div class="tab-content" data-tab="delete-manage">\n          <div class="delete-manage-section">\n            <div class="control-bar">\n              <div class="selection-controls">\n                <button class="select-all-btn">å…¨é€‰</button>\n                <button class="deselect-all-btn">å–æ¶ˆé€‰æ‹©</button>\n              </div>\n              <button class="delete-selected-btn">åˆ é™¤é€‰ä¸­</button>\n            </div>\n            <div class="sticker-list-container">\n              <div class="sticker-grid" id="delete-sticker-grid">\n                \x3c!-- è¡¨æƒ…åŒ…åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ --\x3e\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="sticker-manager-footer">\n        <button class="dialog-button">å…³é—­</button>\n      </div>\n    ';const a=t.querySelectorAll('.tab-button'),n=t.querySelectorAll('.tab-content'),o=t.querySelector('.dialog-button'),s=t.querySelector('#sticker-label'),i=t.querySelector('#sticker-url'),r=t.querySelector('#preview-img'),l=t.querySelector('.add-sticker-btn'),c=t.querySelector('#batch-textarea'),d=t.querySelector('.batch-add-btn'),g=t.querySelector('.select-all-btn'),m=t.querySelector('.deselect-all-btn'),h=t.querySelector('.delete-selected-btn'),u=t.querySelector('#delete-sticker-grid');a.forEach(e=>{e.addEventListener('click',()=>{const o=e.dataset.tab;a.forEach(e=>e.classList.remove('active')),n.forEach(e=>e.classList.remove('active')),e.classList.add('active');const s=t.querySelector(`.tab-content[data-tab="${o}"]`);s&&s.classList.add('active'),'delete-manage'===o&&f()})}),i.addEventListener('input',()=>{i.value.trim()?(r.src=i.value.trim(),r.style.display='block'):r.style.display='none'}),l.addEventListener('click',()=>{const e=s.value.trim(),t=i.value.trim();if(!e||!t)return void alert('è¯·è¾“å…¥è¡¨æƒ…åç§°å’ŒURL');const a='blmx_wechat_stickers_global_blmx',n=p.getItem(a,[])||[],o={label:e,url:t};n.push(o),p.setItem(a,n),alert('è¡¨æƒ…åŒ…æ·»åŠ æˆåŠŸï¼'),s.value='',i.value='',r.style.display='none',this.renderStickerFeatures()}),d.addEventListener('click',()=>{const e=c.value.trim();if(!e)return void alert('è¯·è¾“å…¥è¡¨æƒ…åŒ…æ•°æ®');const t='blmx_wechat_stickers_global_blmx',a=e.split(','),n=[];for(const e of a){const t=e.indexOf('http');if(t>0){const a=e.substring(0,t).trim(),o=e.substring(t).trim();a&&o&&n.push({label:a,url:o})}else if(e.includes('=')){const[t,a]=e.split('=').map(e=>e.trim());t&&a&&n.push({label:t,url:a})}}if(n.length>0){const e=[...p.getItem(t,[])||[],...n];p.setItem(t,e),alert(`${n.length} ä¸ªè¡¨æƒ…åŒ…å·²æ·»åŠ ï¼`),c.value='',this.renderStickerFeatures()}else alert('æœªæ‰¾åˆ°æœ‰æ•ˆçš„è¡¨æƒ…åŒ…æ ¼å¼ã€‚è¯·æŒ‰ç…§ä¸Šæ–¹çš„æ ¼å¼è¯´æ˜è¾“å…¥ã€‚')});const f=()=>{const e=p.getItem('blmx_wechat_stickers_global_blmx',[])||[];if(u.innerHTML='',0===e.length){const e=document.createElement('div');return e.textContent='æ²¡æœ‰è¡¨æƒ…åŒ…ï¼Œè¯·ç‚¹å‡»"æ·»åŠ è¡¨æƒ…"æ ‡ç­¾æ·»åŠ ã€‚',e.className='no-stickers-msg',void u.appendChild(e)}e.forEach((e,t)=>{const a=document.createElement('div');a.className='sticker-item';const n=document.createElement('input');n.type='checkbox',n.className='sticker-checkbox',n.dataset.index=t.toString();const o=document.createElement('div');o.className='sticker-checkbox-button';const s=document.createElement('img');s.src=e.url,s.alt=e.label,s.className='sticker-preview';const i=document.createElement('div');i.className='sticker-label',i.textContent=e.label;const r=e=>{e?o.classList.add('checked'):o.classList.remove('checked')},l=e=>{e.preventDefault(),e.stopPropagation(),n.checked=!n.checked,r(n.checked)};a.addEventListener('click',l),o.addEventListener('click',l),a.appendChild(n),a.appendChild(o),a.appendChild(s),a.appendChild(i),u.appendChild(a),r(n.checked)})};g.addEventListener('click',()=>{const e=u.querySelectorAll('.sticker-checkbox'),t=u.querySelectorAll('.sticker-checkbox-button');e.forEach((e,a)=>{e.checked=!0,t[a]?.classList.add('checked')})}),m.addEventListener('click',()=>{const e=u.querySelectorAll('.sticker-checkbox'),t=u.querySelectorAll('.sticker-checkbox-button');e.forEach((e,a)=>{e.checked=!1,t[a]?.classList.remove('checked')})}),h.addEventListener('click',()=>{const e=u.querySelectorAll('.sticker-checkbox:checked');if(0!==e.length){if(confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${e.length} ä¸ªè¡¨æƒ…åŒ…å—ï¼Ÿ`)){const t='blmx_wechat_stickers_global_blmx',a=p.getItem(t,[])||[];window._.chain(e).map(e=>parseInt(e.dataset.index)).sortBy().reverse().value().forEach(e=>{a.splice(e,1)}),p.setItem(t,a),alert(`å·²åˆ é™¤ ${e.length} ä¸ªè¡¨æƒ…åŒ…`),f(),this.renderStickerFeatures()}}else alert('è¯·é€‰æ‹©è¦åˆ é™¤çš„è¡¨æƒ…åŒ…')}),o.addEventListener('click',()=>{document.body.removeChild(e)}),e.addEventListener('click',t=>{t.target===e&&document.body.removeChild(e)}),e.appendChild(t),document.body.appendChild(e)}},window.BLMX_PROCESSING_AI_RESPONSE=!1,$(async()=>{try{window.BLMX_PROCESSING_AI_RESPONSE=!1;const e=new Y;await e.initialize(),window.blmxApp=e,window.blmxStyleManager=K,window.dialogManager=B.DialogManager.getInstance(),Q(e),$('#app-wechat').on('click',()=>e.navigateTo('wechatHome')),$('#app-settings').on('click',()=>e.navigateTo('settings')),window.BLMX_DEV_MODE&&(console.log('[BLMX] å¼€å‘æ¨¡å¼å·²å¯ç”¨ï¼Œå·²åŠ è½½æµ‹è¯•æ•°æ®'),console.log('[BLMX] å¯ç”¨çš„è°ƒè¯•å‘½ä»¤:'),console.log('  window.blmxApp.showTestEntryTypes() - æ˜¾ç¤ºå¯ç”¨çš„æµ‹è¯•æ•°æ®ç±»å‹'),console.log('  window.blmxApp.addTestEntry(ç±»å‹) - æ·»åŠ æŒ‡å®šç±»å‹çš„æµ‹è¯•æ•°æ®'),console.log('  window.blmxApp.clearDebugData() - æ¸…é™¤æ‰€æœ‰æ•°æ®'))}catch(e){console.error('[BLMX] åˆå§‹åŒ–å¤±è´¥:',e),setTimeout(()=>{B.DialogManager.getInstance().alert('åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯ã€‚','é”™è¯¯')},500)}});
//# sourceMappingURL=index.js.map</script><style>@import url(https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap);
@import url(https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css);
/*! tailwindcss v4.1.17 | MIT License | https://tailwindcss.com */@font-face {font-family:"MyCustomFont";src:url("https://files.catbox.moe/er4wsg.ttf") format("truetype");font-display:swap;font-weight:normal;font-style:normal}:root{--text-color:#ffffff;--primary-blue:#72adf3;--light-blue:#a8cbeb;--ultra-light-blue:#e8f4fd;--blue-gradient-start:#accef2;--blue-gradient-end:#98c2f5;--soft-blue:#b8d4f0;--deep-blue:#2c5282;--wechat-green-icon:var(--primary-blue);--wechat-green-bubble:var(--light-blue);--wechat-bg:var(--ultra-light-blue);--link-color:var(--primary-blue);--footer-height:2.8125rem;--panel-height:14.0625rem;--sticker-size:120px;--bubble-shadow:0 2px 8px rgba(74,144,226,0.15);--text-primary:rgb(139,162,186);--text-secondary:#64748b;--border-color:#cbd5e1;--header-bg:linear-gradient(135deg,#f8faff 0%,#eef4ff 100%);--wechat-bubble-them-bg:#ffffff;--wechat-bubble-me-bg:var(--light-blue);--wechat-bubble-them-text:#333333;--wechat-bubble-me-text:#ffffff;--status-bar-color:#428af2;--checkbox-bg-unchecked:#ffffff;--checkbox-border-unchecked:var(--border-color);--checkbox-border-checked:var(--primary-blue);--checkbox-text-unchecked:var(--text-primary);--checkbox-shadow-unchecked:0 2px 6px var(--shadow-color-rgba);--checkbox-shadow-checked:0 4px 12px var(--shadow-color-rgba);--checkbox-hover-bg:var(--ultra-light-blue);--dynamic-island-color:#a0c4f4;--app-bg-color:#ffffff;--settings-bg-color:#f2f2f7;--settings-card-bg-color:#ffffff;--input-bg:#ffffff;--dialog-border-radius:1rem;--input-border-radius:0.5rem;--button-border-radius:0.5rem;--element-border-radius:0.5rem;--small-border-radius:0.25rem;--shadow-color:#4a90e2;--shadow-color-rgba:rgba(74,144,226,0.3);--settings-icon-color:#999999;--primary-gradient-light:#accef2;--primary-gradient-dark:#98c2f5;--shadow-r:74;--shadow-g:144;--shadow-b:226}@keyframes fadeIn{to{opacity:1}}@keyframes slideInUp{to{transform:translateY(0);opacity:1}}@keyframes slideInDown{to{transform:translateY(0);opacity:1}}@keyframes slideInLeft{to{transform:translateX(0);opacity:1}}@keyframes slideInRight{to{transform:translateX(0);opacity:1}}html{font-size:16px}@media (max-width:360px){html{font-size:4.4444444444vw}}body{margin:0;padding:.25rem;min-height:100vh;display:flex;justify-content:center;align-items:center;box-sizing:border-box;background:rgba(0,0,0,0);font-family:"MyCustomFont","Noto Sans SC",-apple-system,BlinkMacSystemFont,"Segoe UI","Helvetica Neue",Arial,sans-serif}body.force-font-refresh{transform:translateZ(0);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}*{box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);transition-timing-function:ease}.performance-optimized{will-change:transform,opacity;transform:translateZ(0);backface-visibility:hidden}@media (prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:.01ms !important;animation-iteration-count:1 !important;transition-duration:.01ms !important}}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}@keyframes fadeOut{from{opacity:1}to{opacity:0}}@keyframes slideIn{from{opacity:0;transform:translateY(25px)}to{opacity:1;transform:translateY(0)}}@keyframes messageSlideIn{from{opacity:0;transform:translateY(25px)}to{opacity:1;transform:translateY(0)}}.fade-out{animation:fadeOut .5s forwards}.new-message{animation:slideIn .5s cubic-bezier(0.22,0.61,0.36,1)}.hidden{display:none !important}.invisible{visibility:hidden;opacity:0}.visible{visibility:visible;opacity:1}a,button,div[onclick],span[onclick],.clickable,.btn,.dialog-btn,.app-icon,.message-bubble,.contact-item,.moment-item,.sticker-item,.checkbox-btn{-webkit-tap-highlight-color:rgba(0,0,0,0) !important;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.phone-frame{max-width:360px;width:100%;padding:.6rem;background:var(--phoneFrame,var(--primary-blue));border-radius:3.125rem;position:relative;box-shadow:0 15px 20px var(--shadow-color-rgba),0 8px 20px var(--shadow-color-rgba),0 3px 8px rgba(0,0,0,.1),inset 0 1px 0 hsla(0,0%,100%,.5),inset 0 -1px 0 hsla(0,0%,100%,.2),0 5px var(--shadow-color-rgba);transition:all .2s ease;transition:box-shadow .3s ease,background .3s ease}.phone-frame::before{content:"";position:absolute;top:-2px;left:-2px;right:-2px;bottom:-2px;border-radius:3.125rem;background:linear-gradient(45deg,var(--primary-blue),var(--blue-gradient-end),var(--blue-gradient-start),var(--primary-blue));background-size:400% 400%;animation:gradientFlow 3s ease infinite;z-index:-1}@keyframes gradientFlow{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}@media (max-width:480px),(prefers-reduced-motion:reduce){.phone-frame::before{animation:none !important;background:var(--primary-blue) !important}}.phone-screen{height:48.75rem;border-radius:2.8rem;overflow:hidden;position:relative;display:flex;flex-direction:column;background-color:var(--wechat-bg);box-shadow:inset 0 0 0 1px rgba(0,0,0,.08),inset 0 0 15px rgba(0,0,0,.03)}.phone-screen::before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;border-radius:2.25rem;box-shadow:inset 0 1px 0 hsla(0,0%,100%,.2),inset 0 -1px 0 rgba(0,0,0,.1),inset 1px 0 0 hsla(0,0%,100%,.1),inset -1px 0 0 rgba(0,0,0,.1);pointer-events:none;z-index:1000}.dynamic-island{position:absolute;top:.625rem;left:50%;transform:translateX(-50%);width:8.4375rem;height:2rem;background:var(--dynamic-island-color);border-radius:1rem;z-index:100;cursor:pointer;transition:all .2s ease}.dynamic-island:hover{transform:translateX(-50%) scale(1.05);box-shadow:0 2px 8px var(--shadow-color-rgba)}.dynamic-island.generating-active{box-shadow:0 0 15px var(--shadow-color-rgba);animation:pulse-generating 1.5s infinite ease-in-out}.dynamic-island.fullscreen-active{animation:pulse-expand .6s ease-in-out}.dynamic-island.fullscreen-inactive{animation:pulse-contract .6s ease-in-out}@keyframes pulse-generating{0%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.05);box-shadow:0 0 20px var(--shadow-color-rgba)}100%{transform:translateX(-50%) scale(1)}}@keyframes pulse-expand{0%{transform:translateX(-50%) scale(1);box-shadow:0 0 0 rgba(0,0,0,0)}50%{transform:translateX(-50%) scale(1.2);box-shadow:0 0 20px var(--shadow-color-rgba)}100%{transform:translateX(-50%) scale(1);box-shadow:0 0 0 rgba(0,0,0,0)}}@keyframes pulse-contract{0%{transform:translateX(-50%) scale(1);box-shadow:0 0 0 rgba(0,0,0,0)}50%{transform:translateX(-50%) scale(0.8);box-shadow:0 0 20px var(--shadow-color-rgba)}100%{transform:translateX(-50%) scale(1);box-shadow:0 0 0 rgba(0,0,0,0)}}.generating-indicator{display:flex;justify-content:center;align-items:center;height:100%;gap:5px}.generating-dot{width:6px;height:6px;background-color:#fff;border-radius:50%;opacity:.8;animation:generating-dot-pulse 1.4s infinite ease-in-out}.generating-dot:nth-child(1){animation-delay:0s}.generating-dot:nth-child(2){animation-delay:.2s}.generating-dot:nth-child(3){animation-delay:.4s}@keyframes generating-dot-pulse{0%,100%{transform:scale(1);opacity:.6}50%{transform:scale(1.5);opacity:1}}:fullscreen body,:-webkit-full-screen body,:-moz-full-screen body,:-ms-fullscreen body{background:var(--background-color);margin:0;padding:0;overflow:hidden;display:flex;align-items:center;justify-content:center;min-height:100vh}@media (min-width:1920px)and (min-height:1080px){:fullscreen .phone-frame,:-webkit-full-screen .phone-frame,:-moz-full-screen .phone-frame,:-ms-fullscreen .phone-frame{width:max(650px,(100vh - 2rem)*.46);max-width:900px}}@media (max-width:360px){:fullscreen .phone-frame,:-webkit-full-screen .phone-frame,:-moz-full-screen .phone-frame,:-ms-fullscreen .phone-frame{margin:0;width:100%;height:100%;max-width:100%;max-height:100%}}:fullscreen .phone-frame::before,:-webkit-full-screen .phone-frame::before,:-moz-full-screen .phone-frame::before,:-ms-fullscreen .phone-frame::before{border-radius:3.125rem}@media (max-width:360px){:fullscreen .phone-frame::before,:-webkit-full-screen .phone-frame::before,:-moz-full-screen .phone-frame::before,:-ms-fullscreen .phone-frame::before{border-radius:1.5rem}}.phone-status-bar{position:absolute;top:.625rem;left:0;right:0;height:2rem;z-index:102;display:flex;justify-content:space-between;align-items:center;padding:0 1.5rem;pointer-events:none}.status-left{display:flex;align-items:center;gap:.4rem;color:var(--status-bar-color);font-size:.9em;font-weight:600}#current-time{display:inline-flex;align-items:center;height:1em;line-height:1}.status-right{display:flex;align-items:center;gap:.4rem;color:var(--status-bar-color);font-size:.9em;font-weight:600}.moon-icon,.signal-bars,.wifi-icon,.battery-icon{font-size:.85em;display:flex;align-items:center;justify-content:center;height:1em;line-height:1}.moon-icon{transform:translateY(0.5px)}#hidden-send-trigger{position:absolute;top:.625rem;right:1rem;width:80px;height:2rem;z-index:103;cursor:pointer}#delete-mode-trigger{position:absolute;top:.625rem;left:1rem;width:60px;height:2rem;z-index:103;cursor:pointer}#wechat-view{background-image:url("https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç™½è‰²_1.jpg");background-size:cover;background-position:center;background-repeat:no-repeat;display:flex;flex-direction:column;height:100%}.wechat-header{flex-shrink:0;display:flex;justify-content:space-between;align-items:center;padding:.5rem .75rem;background:var(--header-bg);border-bottom:1px solid var(--border-color);padding-top:2.8125rem;position:relative;z-index:10}.wechat-header .back-btn,.wechat-header .options-btn{font-size:1.2em;color:var(--primary-blue);cursor:pointer;transition:all .2s ease}.wechat-header .back-btn:hover,.wechat-header .options-btn:hover{color:var(--deep-blue)}.wechat-header .options-btn{position:relative;display:inline-block}.wechat-header .contact-name{font-weight:600;background:var(--primary-blue);-webkit-background-clip:text;-webkit-text-fill-color:rgba(0,0,0,0);background-clip:text;font-size:1em;cursor:pointer;left:50%}.notification-dot{position:absolute;top:-4px;right:-4px;width:8px;height:8px;background-color:#ff3b30;border-radius:50%;border:1px solid #fff}.wechat-body{flex:1 1 auto;overflow-y:auto;padding:.9375rem .5rem;overflow-x:hidden;-webkit-overflow-scrolling:touch}.message-row{display:flex;margin-bottom:1.125rem;align-items:flex-start}.message-row.me{justify-content:flex-end}.message-row.new-message{animation:messageSlideIn .5s cubic-bezier(0.22,0.61,0.36,1)}.message-row.fade-out{animation:fadeOut .5s forwards}.message-row.long-press-active{transform:scale(0.95);transition:all .15s ease-out;z-index:100}.message-row.long-press-active .message-bubble{box-shadow:0 0 0 3px var(--primary-blue),0 8px 25px rgba(114,173,243,.4),inset 0 0 20px rgba(114,173,243,.1);background:linear-gradient(135deg,rgba(114,173,243,0.15) 0%,rgba(114,173,243,0.08) 100%);animation:longPressPulse .6s ease-in-out;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-webkit-user-drag:none;-khtml-user-drag:none;-moz-user-drag:none;-o-user-drag:none}.message-row.me.long-press-active::after{content:"ğŸ”„ æ¾å¼€æ’¤å›";position:absolute;top:-3rem;right:0;background:linear-gradient(135deg,rgba(0,0,0,0.9) 0%,rgba(0,0,0,0.8) 100%);color:#fff;padding:.5rem .75rem;border-radius:.5rem;font-size:.8rem;font-weight:600;white-space:nowrap;z-index:1000;box-shadow:0 4px 12px rgba(0,0,0,.3);animation:longPressTooltip .3s cubic-bezier(0.68,-0.55,0.265,1.55)}.message-row.me.long-press-active::after::before{content:"";position:absolute;bottom:-0.25rem;right:1rem;width:0;height:0;border-left:.25rem solid rgba(0,0,0,0);border-right:.25rem solid rgba(0,0,0,0);border-top:.25rem solid rgba(0,0,0,.9)}.message-row.double-click-active{transform:scale(1.05);transition:all .1s ease-out;z-index:100}.message-row.double-click-active .message-bubble{box-shadow:0 0 0 2px var(--primary-blue),0 4px 15px rgba(114,173,243,.3);background:linear-gradient(135deg,rgba(114,173,243,0.1) 0%,rgba(114,173,243,0.05) 100%);animation:doubleClickPulse .2s ease-in-out}.message-row.me.double-click-active::after{content:"ğŸ”„ åŒå‡»æ’¤å›";position:absolute;top:-2.5rem;right:0;background:linear-gradient(135deg,rgba(114,173,243,0.95) 0%,rgba(114,173,243,0.85) 100%);color:#fff;padding:.4rem .6rem;border-radius:.4rem;font-size:.75rem;font-weight:600;white-space:nowrap;z-index:1000;box-shadow:0 2px 8px rgba(114,173,243,.4);animation:doubleClickTooltip .2s ease-out}.message-row.me.double-click-active::after::before{content:"";position:absolute;bottom:-0.2rem;right:.8rem;width:0;height:0;border-left:.2rem solid rgba(0,0,0,0);border-right:.2rem solid rgba(0,0,0,0);border-top:.2rem solid rgba(114,173,243,.95)}@keyframes longPressPulse{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}@keyframes longPressTooltip{0%{opacity:0;transform:translateY(0.5rem) scale(0.8)}100%{opacity:1;transform:translateY(0) scale(1)}}@keyframes messageSlideIn{from{opacity:0;transform:translateY(25px)}to{opacity:1;transform:translateY(0)}}.message-avatar{width:2.25rem;height:2.25rem;border-radius:50%;flex-shrink:0;object-fit:cover;background-color:#ccc;cursor:pointer}.message-row.them .message-avatar{margin-right:.625rem}.message-row.me .message-avatar{margin-left:.625rem}.timestamp-row{text-align:center;margin:.5rem 0}.timestamp-text{display:inline-block;background:linear-gradient(135deg,var(--soft-blue) 0%,var(--light-blue) 100%);color:#fff;font-size:.7em;padding:.3rem .8rem;border-radius:1rem;font-weight:500;box-shadow:0 2px 6px var(--shadow-color-rgba)}.typing-indicator{display:flex;margin-bottom:1.125rem;align-items:flex-start}.typing-indicator .message-avatar{margin-right:.625rem;width:2.25rem;height:2.25rem;border-radius:50%;flex-shrink:0}.typing-indicator .message-bubble{display:flex;align-items:center;justify-content:center;padding:.75rem 1rem;background:linear-gradient(135deg,#ffffff 0%,#f8faff 100%);color:var(--text-primary);border:1px solid var(--border-color);border-bottom-left-radius:.4rem;box-shadow:var(--bubble-shadow)}.typing-dot{display:inline-block;width:8px;height:8px;border-radius:50%;background-color:var(--text-secondary);margin:0 2px;animation:typing-bounce 1.4s infinite ease-in-out both}.typing-dot:nth-child(1){animation-delay:-0.32s}.typing-dot:nth-child(2){animation-delay:-0.16s}.typing-dot:nth-child(3){animation-delay:0s}@keyframes typing-bounce{0%,80%,100%{transform:scale(0)}40%{transform:scale(1)}}.message-content-container{display:flex;flex-direction:column}.message-row.me .message-content-container{align-items:flex-end}.message-row.them .message-content-container{align-items:flex-start}#wechat-view.delete-mode .wechat-body{padding-left:25px;padding-right:25px}#wechat-view.delete-mode .message-row,#wechat-view.delete-mode .timestamp-row,#wechat-view.delete-mode .event-log-row{cursor:pointer;position:relative}#wechat-view.delete-mode [data-log-index]::before{content:"Ã—";position:absolute;left:-22px;top:50%;transform:translateY(-50%);background:linear-gradient(135deg,var(--blue-gradient-start) 0%,var(--primary-blue) 100%);color:#fff;border-radius:50%;width:16px;height:16px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:normal;box-shadow:0 2px 4px var(--shadow-color-rgba);transition:all .2s ease;z-index:10;text-align:center;font-family:Arial,sans-serif}#wechat-view.delete-mode .message-row.me[data-log-index]::before{left:auto;right:-22px}#wechat-view.delete-mode [data-log-index]:hover::before{transform:translateY(-50%) scale(1.1);box-shadow:0 4px 8px var(--shadow-color-rgba)}.event-log-row{text-align:center;margin:.5rem 0;width:100%}.event-log-container{display:inline-flex;flex-direction:column;align-items:center;max-width:90%;margin:0 auto}.event-time-text{background:linear-gradient(135deg,var(--soft-blue) 0%,var(--light-blue) 100%);color:#fff;font-weight:500;box-shadow:0 2px 6px var(--shadow-color-rgba);display:inline-flex;align-items:center;justify-content:center;font-size:.7em;padding:.3rem .8rem;border-radius:1rem;-webkit-user-select:none;user-select:none;margin-bottom:.25rem;position:relative;z-index:2;transition:none}.event-time-text.has-desc{position:relative;padding-right:1.55em;display:flex;align-items:center}.event-time-text.has-desc::after{content:"ïƒ—";font-family:"Font Awesome 6 Free";font-weight:900;position:absolute;right:.4rem;font-size:.75em;opacity:.9;margin-top:0;transform:translateY(-1px);transition:transform .3s ease}.event-time-text.clickable{cursor:pointer;position:relative}.event-time-text.clickable:hover{box-shadow:0 3px 8px var(--shadow-color-rgba)}.event-time-text.clickable:hover::after{opacity:1}.event-time-text.clickable::before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;border-radius:1rem;box-shadow:inset 0 0 3px hsla(0,0%,100%,.35);opacity:.6;transition:opacity .2s ease;pointer-events:none}.event-time-text.clickable:active{transform:scale(0.98);box-shadow:0 1px 4px var(--shadow-color-rgba)}.event-time-text.clickable:active::before{opacity:.9;box-shadow:inset 0 0 5px hsla(0,0%,100%,.7)}.event-time-text.clickable:hover::before{opacity:.75;box-shadow:inset 0 0 4px hsla(0,0%,100%,.5)}.event-time-text.has-desc+.event-description.expanded~.event-time-text.has-desc::after,.event-time-text.has-desc:has(+.event-description.expanded)::after{transform:rotate(180deg) translateY(1px)}.event-description{font-size:.75em;color:var(--text-secondary);background:hsla(0,0%,100%,.9);padding:.5rem .75rem;border-radius:.5rem;margin-top:.25rem;width:auto;min-width:-moz-fit-content;min-width:fit-content;max-width:100%;text-align:center;line-height:1.5;box-shadow:0 1px 3px rgba(0,0,0,.1);display:none;position:relative;z-index:1;white-space:normal;word-wrap:break-word;word-break:break-word;overflow-wrap:break-word;overflow:visible;text-overflow:unset}.event-description.expanded{display:block}body[data-theme=custom] .event-description{background:var(--settings-card-bg-color);color:var(--text-primary);border:1px solid var(--border-color);backdrop-filter:blur(2px);box-shadow:0 2px 8px var(--shadow-color-rgba)}body.dark-mode[data-theme=custom] .event-description{background:var(--settings-card-bg-color);color:var(--text-primary);border:1px solid var(--border-color);backdrop-filter:blur(4px);box-shadow:0 2px 8px var(--shadow-color-rgba)}@keyframes doubleClickPulse{0%{transform:scale(1)}50%{transform:scale(1.03)}100%{transform:scale(1)}}@keyframes doubleClickTooltip{0%{opacity:0;transform:translateY(0.3rem) scale(0.9)}100%{opacity:1;transform:translateY(0) scale(1)}}.message-bubble{position:relative;padding:.75rem 1rem;border-radius:1.2rem;max-width:75%;font-size:.9em;line-height:1.4;word-wrap:normal;overflow-wrap:break-word;-webkit-user-select:none;user-select:none;box-shadow:var(--bubble-shadow);transition:all .2s ease}.message-bubble::after{display:none}.message-bubble img:not(.sticker-img){max-width:10rem;max-height:10rem;display:block;border-radius:.5rem}.message-row.them .message-bubble{background:linear-gradient(315deg,#f8faff 0%,#ffffff 100%);color:var(--wechat-bubble-them-text);border:1px solid var(--border-color);border-bottom-left-radius:.4rem}.message-row.me .message-bubble{background:linear-gradient(315deg,var(--blue-gradient-end) 0%,var(--blue-gradient-start) 100%);color:var(--wechat-bubble-me-text);border-bottom-right-radius:.4rem;box-shadow:0 4px 12px var(--shadow-color-rgba)}.recall-notice-container{display:inline-flex;flex-direction:column;align-items:center}.recall-notice-text{background:linear-gradient(135deg,var(--soft-blue) 0%,var(--light-blue) 100%);color:#fff;font-size:.7em;padding:.3rem .8rem;border-radius:1rem;cursor:pointer;transition:all .2s ease}.recall-notice-text:hover{transform:translateY(-1px);box-shadow:0 4px 8px var(--shadow-color-rgba)}.recall-content{color:#888;font-size:.75em;padding:0;max-height:0;overflow:hidden;transition:max-height .3s ease-out,padding .3s ease-out}.recall-content.expanded{max-height:6.25rem;padding:.3125rem 0 0 0}.event-log-row{text-align:center;margin:.5rem 0}.event-log-container{display:inline-flex;flex-direction:column;align-items:center}.event-time-text{background:linear-gradient(135deg,var(--soft-blue) 0%,var(--light-blue) 100%);color:#fff;font-weight:500;box-shadow:0 2px 6px var(--shadow-color-rgba);display:inline-flex;align-items:center;justify-content:center;font-size:.7em;padding:.3rem .8rem;border-radius:1rem;transition:all .2s ease}.event-time-text.blue-theme{box-shadow:0 2px 6px rgba(114,173,243,.4)}.event-time-text.pink-theme{box-shadow:0 2px 6px rgba(243,114,182,.4)}.event-time-text.green-theme{box-shadow:0 2px 6px rgba(72,187,120,.4)}.event-time-text.purple-theme{box-shadow:0 2px 6px rgba(159,122,234,.4)}.event-time-text.orange-theme{box-shadow:0 2px 6px rgba(237,137,54,.4)}.event-time-text.system-message{background:linear-gradient(135deg,#6b7280 0%,#4b5563 100%);padding:.5rem 1rem;border-radius:1rem;color:#fff;font-size:.85em;max-width:80%;text-align:center}.event-time-text.has-desc{cursor:pointer}.message-row .message-bubble.sticker-bubble,.message-row .message-bubble.image-desc-bubble,.message-row .message-bubble.image-url-bubble,.message-row .message-bubble.location-bubble,.message-row .message-bubble.transfer-bubble,.message-row .message-bubble.file-bubble{content:none;background:rgba(0,0,0,0) !important;padding:0;border:none;box-shadow:none}.message-row .message-bubble.location-bubble,.message-row .message-bubble.transfer-bubble,.message-row .message-bubble.file-bubble,.message-row .message-bubble.gift-bubble{width:12.5rem;max-width:12.5rem}.message-row .message-bubble.sticker-bubble img{border-radius:1.2rem}.sticker-container{display:inline-flex;justify-content:center;align-items:center;width:auto;height:auto;max-width:var(--sticker-size);max-height:var(--sticker-size)}.sticker-img{display:block;max-width:100%;max-height:100%;object-fit:contain}.message-bubble.voice-bubble{display:flex;align-items:center;cursor:pointer;min-width:5rem;padding:.75rem 1rem}.message-row.them .message-bubble.voice-bubble{background:linear-gradient(315deg,#f8faff 0%,#ffffff 100%) !important;border:1px solid var(--border-color) !important}body.dark-mode .message-row.them .message-bubble.voice-bubble{background:linear-gradient(135deg,#3c3c3c 0%,#2c2c2c 100%) !important;border:1px solid var(--border-color) !important;color:#f0f0f0}body.dark-mode .message-row.them .voice-bubble .voice-icon{color:var(--light-blue)}.voice-bubble .voice-icon{font-size:1.1em;margin:0 .5rem}.message-row.them .voice-bubble .voice-icon{color:var(--primary-blue);transform:rotate(90deg)}.message-row.me .voice-bubble .voice-icon{color:var(--wechat-bubble-me-text);transform:rotate(270deg)}.voice-text-content{display:none;background-color:#fff;padding:.5rem .625rem;border-radius:.3125rem;border:.0625rem solid #e5e5e5;max-width:75%;font-size:.9em;line-height:1.4;color:var(--text-primary);word-wrap:normal;overflow-wrap:break-word;-webkit-user-select:text;user-select:text;margin-top:.3125rem;box-shadow:0 .0625rem .125rem rgba(0,0,0,.1)}.message-row.voice-text-visible .voice-text-content{display:block}.image-desc-content{width:8.4375rem;height:8.4375rem;backdrop-filter:blur(10px);background-color:hsla(0,0%,100%,.5);border:.0625rem solid hsla(0,0%,100%,.2);border-radius:1.2rem;padding:.5rem;color:var(--text-primary);font-weight:normal;overflow-y:auto;box-sizing:border-box;font-size:.9em;display:flex;flex-direction:column;box-shadow:0 4px 12px var(--shadow-color-rgba),0 2px 6px var(--shadow-color-rgba);transition:all .2s ease}.text-wrapper{margin:auto;text-align:center;line-height:1.4;word-wrap:break-word;max-height:100%}.location-bubble .location-card{background-color:#fff;border-radius:1.2rem;overflow:hidden;box-shadow:0 4px 12px var(--shadow-color-rgba),0 2px 6px var(--shadow-color-rgba);transition:all .2s ease}.location-content{padding:.5rem}.location-content .location-title{font-size:1em;color:var(--text-primary);font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.location-content .location-subtitle{font-size:.75em;color:#888}.location-map-placeholder{height:5.625rem;position:relative;background-color:#f0f8ff;overflow:hidden}.location-map-placeholder::before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background-image:repeating-linear-gradient(45deg,#d2e1f2 0,#d2e1f2 4px,transparent 4px,transparent 8px),repeating-linear-gradient(135deg,#9bdaf7 0,#9bdaf7 3px,transparent 3px,transparent 7px),linear-gradient(to bottom,#bad8fb 0%,#bad8fb 100%),linear-gradient(to bottom,#d0daf4 0%,#d0daf4 100%),linear-gradient(to right,#bad8fb 0%,#bad8fb 100%),linear-gradient(to right,#d0daf4 0%,#dbe8f3 100%),radial-gradient(ellipse at 20% 85%,#daf9f3 30%,transparent 31%),radial-gradient(ellipse at 80% 30%,#d0ecf4 40%,transparent 41%);background-size:40% 35%,30% 30%,10px 100%,6px 100%,100% 10px,100% 6px,100% 100%,100% 100%;background-position:-5% 110%,100% 0%,70% center,70% center,center 35%,center 35%,0 0,0 0;background-repeat:no-repeat}.location-map-placeholder::after{content:"ï…";font-family:"Font Awesome 6 Free";font-weight:900;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:1.8em;color:var(--primary-blue);filter:drop-shadow(0 0 8px rgba(114,173,243,0.6)) drop-shadow(0 0 4px rgba(114,173,243,0.4)) drop-shadow(0 2px 4px rgba(255,255,255,0.8));z-index:10;animation:pinPulse 2s ease-in-out infinite}.location-map-placeholder:hover::before{opacity:.9;transition:opacity .3s ease}@keyframes pinPulse{0%,100%{transform:translate(-50%,-50%) scale(1);filter:drop-shadow(0 0 8px rgba(114,173,243,0.6)) drop-shadow(0 0 4px rgba(114,173,243,0.4)) drop-shadow(0 2px 4px rgba(255,255,255,0.8))}50%{transform:translate(-50%,-50%) scale(1.1);filter:drop-shadow(0 0 12px rgba(114,173,243,0.8)) drop-shadow(0 0 6px rgba(114,173,243,0.6)) drop-shadow(0 3px 6px rgba(255,255,255,0.9))}}.transfer-bubble .transfer-card{border-radius:1.2rem;overflow:hidden;width:100%}.transfer-bubble .transfer-card.transfer-initial{background:linear-gradient(135deg,#fa9e3b 0%,#f8802a 50%,#f76a1c 100%);box-shadow:0 4px 15px rgba(247,106,28,.3),0 2px 8px rgba(247,106,28,.2),inset 0 1px 0 hsla(0,0%,100%,.2);color:#fff}.transfer-bubble .transfer-card.them{cursor:pointer;transition:all .2s ease}.transfer-bubble .transfer-card.them:hover{transform:translateY(-1px);box-shadow:0 6px 12px rgba(247,106,28,.4)}.transfer-bubble .transfer-card.transfer-receipt{background:linear-gradient(135deg,#ffd0a1 0%,#ffbe80 30%,#ffbe80 45%,#ffd0a1 100%);color:#fff;box-shadow:0 4px 16px rgba(247,106,28,.25),0 2px 6px rgba(247,106,28,.15),inset 0 1px 1px hsla(0,0%,100%,.2)}.transfer-content{display:flex;align-items:center;padding:.75rem}.transfer-icon-image{width:2.25rem;height:2.25rem;flex-shrink:0;filter:brightness(0) invert(1)}.transfer-details{margin-left:.75rem;flex-grow:1}.transfer-details .amount{font-size:1.1em;font-weight:bold}.transfer-details .note,.transfer-details .status-text{font-size:.8em;opacity:.9}.transfer-footer{font-size:.75em;padding:.1875rem .75rem;color:hsla(0,0%,100%,.9);border-top:1px solid hsla(0,0%,100%,.15);background:hsla(0,0%,100%,.05)}.transfer-initial .transfer-footer{color:hsla(0,0%,100%,.85);border-top:1px solid hsla(0,0%,100%,.2);background:hsla(0,0%,100%,.05)}.transfer-receipt .transfer-footer{color:#f5faff;border-top:1px solid hsla(0,0%,100%,.2);background:hsla(0,0%,100%,.05)}.message-row .message-bubble.gift-bubble{padding:0;width:12.5rem;max-width:12.5rem;overflow:hidden;border-radius:1.2rem}.gift-bubble .gift-card{border-radius:1.2rem;overflow:hidden;width:100%}.gift-bubble .gift-card.gift-initial{background:linear-gradient(135deg,#fa9e3b 0%,#f8802a 50%,#f76a1c 100%);box-shadow:0 4px 15px rgba(247,106,28,.3),0 2px 8px rgba(247,106,28,.2),inset 0 1px 0 hsla(0,0%,100%,.2);color:#fff;animation:transferGlow 3s ease-in-out infinite alternate}.gift-bubble .gift-card.them{cursor:pointer;transition:all .2s ease}.gift-bubble .gift-card.them:hover{transform:translateY(-1px);box-shadow:0 6px 12px rgba(247,106,28,.4)}.gift-bubble .gift-card.gift-receipt{background:linear-gradient(135deg,#ffd0a1 0%,#ffbe80 30%,#ffbe80 45%,#ffd0a1 100%);color:#fff;box-shadow:0 4px 16px rgba(247,106,28,.25),0 2px 6px rgba(247,106,28,.15),inset 0 1px 1px hsla(0,0%,100%,.2)}.gift-clickable{cursor:pointer}.gift-accepted{background-color:#355a96 !important}.gift-content{padding:.75rem;display:flex;align-items:center;gap:.75rem;color:#fff}.gift-icon-emoji{font-size:2.2em;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.2))}.gift-icon-image{width:2.25rem;height:2.25rem;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.2))}.gift-details{flex-grow:1}.gift-details .gift-name{font-weight:500}.gift-details .gift-price,.gift-details .gift-status-text{font-size:.8em;opacity:.9}.gift-footer{color:hsla(0,0%,100%,.9);font-size:.75em;padding:.1875rem .75rem;border-top:1px solid hsla(0,0%,100%,.15);background:hsla(0,0%,100%,.05)}.gift-receipt .gift-footer{color:#f5faff;border-top:1px solid hsla(0,0%,100%,.2);background:hsla(0,0%,100%,.05)}@keyframes transferGlow{from{box-shadow:0 4px 15px rgba(247,106,28,.3),0 2px 8px rgba(247,106,28,.2),inset 0 1px 0 hsla(0,0%,100%,.2)}to{box-shadow:0 6px 20px rgba(247,106,28,.4),0 3px 12px rgba(247,106,28,.3),inset 0 1px 0 hsla(0,0%,100%,.3)}}.file-bubble .file-card{background-color:#fff;border-radius:1.2rem;overflow:hidden;width:100%;box-shadow:0 4px 12px var(--shadow-color-rgba),0 2px 6px var(--shadow-color-rgba);transition:all .2s ease}.file-content{display:flex;align-items:center;padding:.75rem;gap:.75rem}.file-icon{font-size:2.5em;color:var(--primary-blue);flex-shrink:0}.file-details .file-name{font-size:.9em;color:var(--text-primary);font-weight:500;word-break:break-all}.file-footer{background-color:#f7fafc;color:#888;font-size:.75em;padding:.1875rem .75rem;border-top:.0625rem solid #eaeaea}body.dark-mode .message-row.them .voice-bubble .voice-icon{color:var(--light-blue)}body.dark-mode .voice-text-content{background-color:#2c2c2c;border-color:#3c3c3c;color:#f0f0f0;box-shadow:0 .0625rem .125rem rgba(0,0,0,.3)}body.dark-mode .image-desc-content{background-color:rgba(30,30,30,.7);border:.0625rem solid rgba(60,60,60,.4);color:#f0f0f0;box-shadow:0 4px 12px rgba(0,0,0,.25),0 2px 6px rgba(0,0,0,.2)}body.dark-mode .location-bubble .location-card{background-color:#2c2c2c;box-shadow:0 4px 12px rgba(0,0,0,.25),0 2px 6px rgba(0,0,0,.15)}body.dark-mode .location-content .location-title{color:#f0f0f0}body.dark-mode .location-content .location-subtitle{color:#aaa}body.dark-mode .file-bubble .file-card{background-color:#2c2c2c;box-shadow:0 4px 12px rgba(0,0,0,.25),0 2px 6px rgba(0,0,0,.15)}body.dark-mode .file-details .file-name{color:#f0f0f0}body.dark-mode .file-footer{background-color:#232323;color:#aaa;border-top:.0625rem solid #3c3c3c}body.dark-mode .event-description.expanded{background-color:rgba(50,50,50,.9);color:#f0f0f0;box-shadow:0 1px 4px rgba(0,0,0,.3)}.wechat-input-area{flex-shrink:0;background:var(--header-bg);position:relative;z-index:10}.wechat-footer{display:flex;align-items:center;gap:.5rem;padding:.75rem;border-top:1px solid var(--border-color);box-sizing:border-box;flex-shrink:0;background:var(--header-bg);position:relative;z-index:10}.wechat-footer .footer-icon{font-size:1.4em;color:var(--primary-blue) !important;cursor:pointer;transition:all .2s ease;padding:.3rem;border-radius:.5rem;flex-shrink:0}.wechat-footer .footer-icon:hover{background:var(--ultra-light-blue);transform:scale(1.1)}.wechat-footer .text-input{flex-grow:1;border:1px solid var(--border-color);background:#fff;padding:.75rem 1rem;border-radius:1.5rem;font-size:.9em;transition:all .2s ease;color:var(--text-primary);min-width:0}.wechat-footer .text-input:focus{outline:none;border-color:var(--primary-blue);box-shadow:0 0 0 3px var(--shadow-color-rgba)}.wechat-footer .text-input::placeholder{color:var(--text-secondary)}.wechat-footer .send-btn{background:var(--primary-blue);color:#fff;border:none;width:2rem;height:2rem;border-radius:50%;font-size:1em;cursor:pointer;box-shadow:0 4px 12px var(--shadow-color-rgba);transition:all .2s ease;display:flex;align-items:center;justify-content:center;padding:0;line-height:1;flex-shrink:0}.wechat-footer .send-btn:hover{transform:translateY(-2px);box-shadow:0 6px 16px var(--shadow-color-rgba)}.wechat-footer .send-btn{background:linear-gradient(135deg,#09e675 0%,#07c160 50%,#06ad56 100%)}.single-color-icon .wechat-footer .send-btn{background:linear-gradient(135deg,var(--primary-gradient-light) 0%,var(--primary-blue) 50%,var(--primary-gradient-dark) 100%)}.panel-container{height:0;overflow:hidden;transition:height .3s ease}.panel-container.active{height:var(--panel-height)}.panel-view{display:none;height:100%;overflow-y:auto;padding:1.125rem .75rem;box-sizing:border-box;position:relative}.panel-view.active{display:block}.features-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1.125rem}.feature-item{display:flex;flex-direction:column;align-items:center;cursor:pointer;position:relative}.feature-item:hover .feature-icon{transform:translateY(-2px);box-shadow:0 4px 12px var(--shadow-color-rgba);border-color:var(--primary-blue)}.feature-icon{width:3.375rem;height:3.375rem;background-color:#fff;border-radius:.5rem;display:flex;align-items:center;justify-content:center;border:1px solid var(--border-color);box-shadow:0 2px 8px var(--shadow-color-rgba);transition:all .2s ease;margin-bottom:.4375rem}.feature-icon img,.feature-icon .fas,.feature-icon .far,.feature-icon .fab{max-width:100%;max-height:100%;border-radius:.5rem;object-fit:cover;font-size:1.8em}.feature-icon .theme-icon{color:var(--primary-blue);font-size:1.8em}.feature-icon .fa-plus,.feature-icon .fa-trash-alt{color:var(--primary-blue) !important}.feature-label{font-size:.75em;color:#888}.feature-item .sticker-checkbox{position:absolute;opacity:0;width:0;height:0;pointer-events:none}.feature-item .sticker-checkbox-button{position:absolute;top:.25rem;right:.25rem;width:1.5rem;height:1.5rem;border:1px solid var(--checkbox-border-unchecked);border-radius:.375rem;background:var(--checkbox-bg-unchecked);cursor:pointer;transition:all .2s ease;display:none;z-index:10}.feature-item .sticker-checkbox-button.checked{border:2px solid var(--checkbox-border-checked);background:var(--checkbox-bg-unchecked)}.feature-item .sticker-checkbox-button.checked::after{content:"âœ“";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:.75rem;font-weight:bold;color:var(--checkbox-border-checked)}@media (hover:hover){.feature-item .sticker-checkbox-button:hover{border-color:var(--checkbox-border-checked);background:var(--checkbox-hover-bg)}}.feature-item:has(.sticker-checkbox:checked) .feature-icon{border:2px solid var(--checkbox-border-checked);box-shadow:0 0 0 2px var(--shadow-color-rgba);transform:scale(0.95);opacity:.8}.feature-item:has(.sticker-checkbox:checked) .feature-label{color:var(--checkbox-border-checked);font-weight:600}#wechat-view.delete-mode .wechat-body{padding-left:25px;padding-right:25px}#wechat-view.delete-mode .message-row,#wechat-view.delete-mode .timestamp-row,#wechat-view.delete-mode .event-log-row{cursor:pointer;position:relative}#wechat-view.delete-mode [data-log-index]::before{content:"Ã—";position:absolute;left:-22px;top:50%;transform:translateY(-50%);background:linear-gradient(135deg,var(--blue-gradient-start) 0%,var(--primary-blue) 100%);color:#fff;border-radius:50%;width:16px;height:16px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:normal;box-shadow:0 2px 6px var(--shadow-color-rgba);transition:all .2s ease;line-height:1;text-align:center;font-family:Arial,sans-serif}#wechat-view.delete-mode .message-row.me[data-log-index]::before{left:auto;right:-22px}#wechat-view.delete-mode [data-log-index]:hover::before{transform:translateY(-50%) scale(1.1);box-shadow:0 4px 8px var(--shadow-color-rgba)}.app-view{position:absolute;top:0;left:0;right:0;bottom:0;z-index:60;border-radius:2.25rem;visibility:hidden;opacity:0;transition:opacity .3s ease,visibility .3s ease;display:flex;flex-direction:column;backface-visibility:hidden}.app-view.active{visibility:visible;opacity:1;z-index:80}.app-screen{padding:3.75rem 1rem 1.375rem 1rem;flex-grow:1;background-image:url("https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç™½è‰²_1.jpg");background-size:cover;background-position:center}.app-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem}.app-icon{display:flex;flex-direction:column;align-items:center;text-align:center;text-decoration:none;cursor:pointer}.app-icon:hover .icon-image{transform:scale(1.05)}.app-icon .icon-image{width:4.0625rem;height:4.0625rem;background-color:var(--primary-blue);border-radius:22.5%;margin-bottom:.4375rem;background-size:cover;background-position:center;display:flex;align-items:center;justify-content:center;font-size:2.2em;transition:all .2s ease}.app-icon .app-name{color:var(--text-color);font-size:.75em;font-weight:400;text-shadow:0 .0625rem .125rem rgba(0,0,0,.5)}.icon-wechat,.icon-settings{background:linear-gradient(135deg,var(--blue-gradient-start) 0%,var(--blue-gradient-end) 100%);color:#fff;box-shadow:0 4px 12px var(--shadow-color-rgba)}.icon-wechat{background:linear-gradient(135deg,#09e675 0%,#07c160 50%,#06ad56 100%) !important}.icon-settings{background:linear-gradient(135deg,#a8a8a8 0%,#8a8a8a 50%,#777777 100%) !important}.single-color-icon .icon-wechat,.single-color-icon .icon-settings{background:linear-gradient(135deg,var(--primary-gradient-light) 0%,var(--primary-blue) 50%,var(--primary-gradient-dark) 100%) !important}#settings-view{background-color:var(--settings-bg-color)}.settings-header{flex-shrink:0;display:flex;justify-content:space-between;align-items:center;padding:.5rem .75rem;background:var(--header-bg);border-bottom:1px solid var(--border-color);padding-top:2.8125rem;position:relative;z-index:10}.settings-header .back-btn{font-size:1.2em;color:var(--primary-blue);cursor:pointer}.settings-header .title{font-weight:600;color:var(--text-primary);font-size:1em;position:absolute;left:50%;transform:translateX(-50%)}.settings-body{flex-grow:1;padding:1.25rem;overflow-y:auto}.settings-card{background-color:var(--settings-card-bg-color);border-radius:var(--element-border-radius);padding:1rem;box-shadow:0 2px 8px rgba(0,0,0,.05)}.settings-card p{font-size:.9em;line-height:1.6;color:var(--text-primary);margin:0 0 1rem 0}.settings-card p:last-child{margin-bottom:0}.settings-card .highlight{color:#e6a23c;font-weight:bold}.settings-card a{color:var(--primary-blue)}.settings-card a:hover{text-decoration:underline}.settings-card li{border-bottom-color:var(--border-color)}.settings-card li a{color:var(--text-primary)}#show-last-ai-response-btn,#show-last-sent-prompt-btn{background-color:var(--settings-card-bg-color);color:var(--text-primary)}#custom-theme-btn{transition:all .2s ease;position:relative;z-index:10}#custom-theme-btn:hover{background:var(--deep-blue) !important;transform:translateY(-1px);box-shadow:0 4px 12px var(--shadow-color-rgba)}#custom-theme-btn:active{transform:translateY(0)}body.dark-mode{background-color:rgba(0,0,0,0)}body.dark-mode .app-view{background-color:var(--app-bg-color)}body.dark-mode .settings-card{background-color:var(--settings-card-bg-color)}body.dark-mode .settings-card p,body.dark-mode .settings-card a{color:var(--text-primary)}body.dark-mode .settings-card li{border-bottom-color:var(--border-color)}body.dark-mode .settings-card li a{color:var(--text-primary)}body.dark-mode #show-last-ai-response-btn,body.dark-mode #show-last-sent-prompt-btn{background-color:var(--settings-card-bg-color);color:var(--text-primary)}.phone-size-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:var(--settings-card-bg-color);border:1px solid var(--border-color);border-radius:var(--element-border-radius);padding:.75rem .5rem;cursor:pointer;transition:all .2s ease;gap:.5rem;color:var(--text-primary)}.phone-size-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px var(--shadow-color-rgba)}.phone-size-btn.phone-size-active{border-color:var(--primary-blue);background-color:rgba(var(--shadow-r),var(--shadow-g),var(--shadow-b),0.05);box-shadow:0 2px 8px var(--shadow-color-rgba)}body.dark-mode .phone-size-btn{background-color:#3c3c3c;border-color:#505050;color:silver}body.dark-mode .phone-size-btn:hover{background-color:#4a4a4a;border-color:#606060}body.dark-mode .phone-size-btn.phone-size-active{background-color:#505050;border-color:var(--primary-blue);color:#e0e0e0}body[data-theme=custom] .phone-size-btn{background-color:var(--settings-card-bg-color);border-color:var(--border-color);color:var(--text-primary)}body[data-theme=custom] .phone-size-btn:hover{background-color:var(--ultra-light-blue);border-color:var(--primary-blue)}body[data-theme=custom] .phone-size-btn.phone-size-active{background-color:rgba(var(--shadow-r),var(--shadow-g),var(--shadow-b),0.1);border-color:var(--primary-blue);color:var(--primary-blue)}.size-icon{width:1.5rem;background-color:var(--text-secondary);border-radius:.125rem;transition:all .2s ease}body.dark-mode .size-icon{background-color:silver}body.dark-mode .phone-size-active .size-icon{background-color:var(--primary-blue)}body[data-theme=custom] .size-icon{background-color:var(--text-secondary)}body[data-theme=custom] .phone-size-active .size-icon{background-color:var(--primary-blue)}.size-label{font-size:.8em;font-weight:500;text-align:center}.sticker-size-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:var(--settings-card-bg-color);border:1px solid var(--border-color);border-radius:var(--element-border-radius);padding:.75rem .5rem;cursor:pointer;transition:all .2s ease;gap:.5rem;color:var(--text-primary)}.sticker-size-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px var(--shadow-color-rgba)}.sticker-size-btn.sticker-size-active{border-color:var(--primary-blue);background-color:rgba(var(--shadow-r),var(--shadow-g),var(--shadow-b),0.05);box-shadow:0 2px 8px var(--shadow-color-rgba)}.sticker-size-icon{width:10px;background-color:var(--primary-blue);border-radius:var(--small-border-radius)}.sticker-size-label{font-size:.8em;color:var(--text-primary);font-weight:500}body.dark-mode .sticker-size-btn{background-color:#3c3c3c;border-color:#505050;color:silver}body.dark-mode .sticker-size-btn:hover{background-color:#4a4a4a;border-color:#606060}body.dark-mode .sticker-size-btn.sticker-size-active{background-color:#505050;border-color:var(--primary-blue);color:#e0e0e0}body.dark-mode .sticker-size-icon{background-color:silver}body.dark-mode .sticker-size-active .sticker-size-icon{background-color:var(--primary-blue)}body[data-theme=custom] .sticker-size-btn{background-color:var(--settings-card-bg-color);border-color:var(--border-color);color:var(--text-primary)}body[data-theme=custom] .sticker-size-btn:hover{background-color:var(--ultra-light-blue);border-color:var(--primary-blue)}body[data-theme=custom] .sticker-size-btn.sticker-size-active{background-color:rgba(var(--shadow-r),var(--shadow-g),var(--shadow-b),0.1);border-color:var(--primary-blue);color:var(--primary-blue)}body[data-theme=custom] .sticker-size-icon{background-color:var(--text-secondary)}body[data-theme=custom] .sticker-size-active .sticker-size-icon{background-color:var(--primary-blue)}.font-btn{flex:1;display:flex;flex-direction:column;align-items:center;gap:.5rem;padding:.75rem .5rem;border:2px solid #e0e0e0;border-radius:var(--element-border-radius);background:#f8f9fa;cursor:pointer;transition:all .3s ease;min-height:4rem}.font-btn:hover{border-color:var(--primary-blue);background:#f0f7ff}.font-btn.font-active{border-color:var(--primary-blue);background:#e8f4fd}.font-btn.font-active .font-label{color:var(--primary-blue);font-weight:600}.font-icon{font-size:1.2em;margin-bottom:.25rem}.font-label{font-size:.8em;color:var(--text-primary);font-weight:500;text-align:center}body.dark-mode .font-btn{background:#2a2a2a;border-color:#404040}body.dark-mode .font-btn:hover{background:#333;border-color:var(--primary-blue)}body.dark-mode .font-btn.font-active{background:#1a3a5c;border-color:var(--primary-blue)}.fullscreen-size-btn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;background-color:var(--settings-card-bg-color);border:1px solid var(--border-color);border-radius:var(--element-border-radius);padding:.75rem .5rem;cursor:pointer;transition:all .2s ease;gap:.5rem;color:var(--text-primary)}.fullscreen-size-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px var(--shadow-color-rgba)}.fullscreen-size-btn.fullscreen-size-active{border-color:var(--primary-blue);background-color:rgba(var(--shadow-r),var(--shadow-g),var(--shadow-b),0.05);box-shadow:0 2px 8px var(--shadow-color-rgba)}.fullscreen-size-icon{font-size:1.2em;display:block}.fullscreen-size-label{font-size:.8em;font-weight:500;text-align:center}body.dark-mode .fullscreen-size-btn{background-color:#3c3c3c;border-color:#505050;color:silver}body.dark-mode .fullscreen-size-btn:hover{background-color:#4a4a4a;border-color:#606060}body.dark-mode .fullscreen-size-btn.fullscreen-size-active{background-color:#505050;border-color:var(--primary-blue);color:#e0e0e0}body[data-theme=custom] .fullscreen-size-btn{background-color:var(--settings-card-bg-color);border-color:var(--border-color);color:var(--text-primary)}body[data-theme=custom] .fullscreen-size-btn:hover{background-color:var(--ultra-light-blue);border-color:var(--primary-blue)}body[data-theme=custom] .fullscreen-size-btn.fullscreen-size-active{background-color:rgba(var(--shadow-r),var(--shadow-g),var(--shadow-b),0.1);border-color:var(--primary-blue);color:var(--primary-blue)}#fullscreen-size-slider,#sticker-size-slider{-webkit-appearance:none;appearance:none;height:.25rem;background:#ddd;border-radius:.125rem;outline:none;flex:1}#fullscreen-size-slider::-webkit-slider-thumb,#sticker-size-slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:1rem;height:1rem;border-radius:50%;background:var(--primary-blue);cursor:pointer;border:2px solid #fff;box-shadow:0 1px 3px rgba(0,0,0,.2)}#fullscreen-size-slider::-moz-range-thumb,#sticker-size-slider::-moz-range-thumb{width:1rem;height:1rem;border-radius:50%;background:var(--primary-blue);cursor:pointer;border:2px solid #fff;box-shadow:0 1px 3px rgba(0,0,0,.2)}#fullscreen-size-input,#sticker-size-input{width:4rem;padding:.25rem .5rem;border:1px solid #ddd;border-radius:.25rem;text-align:center;font-size:.85em;background:#fff;color:var(--text-primary)}#fullscreen-size-input:focus,#sticker-size-input:focus{outline:none;border-color:var(--primary-blue);box-shadow:0 0 0 2px rgba(114,173,243,.2)}body.dark-mode #fullscreen-size-slider,body.dark-mode #sticker-size-slider{background:#404040}body.dark-mode #fullscreen-size-slider::-webkit-slider-thumb,body.dark-mode #sticker-size-slider::-webkit-slider-thumb{border-color:#2a2a2a}body.dark-mode #fullscreen-size-slider::-moz-range-thumb,body.dark-mode #sticker-size-slider::-moz-range-thumb{border-color:#2a2a2a}body.dark-mode #fullscreen-size-input,body.dark-mode #sticker-size-input{background:#2a2a2a;border-color:#404040;color:#fff}body.dark-mode #fullscreen-size-input:focus,body.dark-mode #sticker-size-input:focus{border-color:var(--primary-blue)}#moments-view{background:linear-gradient(180deg,#ffffff 0%,var(--ultra-light-blue) 100%);color:var(--text-primary)}.moments-header{display:flex;justify-content:space-between;align-items:center;padding:.5rem .75rem;background:var(--header-bg);border-bottom:1px solid var(--border-color);padding-top:2.8125rem;flex-shrink:0;position:relative}.moments-header .title{font-weight:600;font-size:1em;color:var(--primary-blue);position:absolute;left:50%;transform:translateX(-50%)}.moments-header .back-btn{color:var(--primary-blue);font-size:1.2em;cursor:pointer;z-index:1}.moments-header .header-action{color:var(--primary-blue);font-size:1.2em;cursor:pointer;z-index:1;transition:all .2s ease}.moments-body{flex-grow:1;overflow-y:auto;background-color:#fff}.moments-feed-header{position:relative;margin-bottom:1.5625rem}.moments-cover-photo{width:100%;height:14.0625rem;object-fit:cover;display:block;cursor:pointer}.moments-user-info{position:absolute;bottom:-0.75rem;right:.75rem;display:flex;align-items:flex-end;gap:.5rem}.moments-user-name{color:#fff;font-size:1.1em;font-weight:bold;text-shadow:0 .0625rem .1875rem rgba(0,0,0,.5);position:relative;bottom:1.75rem;cursor:pointer}.moments-user-avatar{width:4.25rem;height:4.25rem;border-radius:.5rem;object-fit:cover;cursor:pointer;box-shadow:0 1px 3px rgba(0,0,0,.2)}.user-signature{position:absolute;bottom:-2.5rem;right:.75rem;width:12rem;text-align:right;word-wrap:break-word;line-height:1.4;color:#8a8a8a;font-size:.8em;cursor:pointer;margin-top:.5rem}.moments-feed-list{padding:0 .75rem;list-style:none}.moment-post{display:flex;gap:.625rem;padding:1.125rem 0;border-bottom:.0625rem solid #f0f0f0}.moment-post:last-child{border-bottom:none}.post-author-avatar{width:2.375rem;height:2.375rem;border-radius:50%;flex-shrink:0;object-fit:cover;cursor:pointer}.post-details{display:flex;flex-direction:column;gap:.4375rem;flex-grow:1}.post-author-name,.likes-section .liker-name,.comment-author,.delete-moment-btn,.post-meta .comment-button{color:var(--primary-blue)}.post-content{font-size:.9em;line-height:1.5;white-space:pre-wrap;word-wrap:break-word;color:var(--text-primary)}.post-media{margin-top:.25rem}.post-media-image{max-width:10rem;max-height:10rem;object-fit:contain;border-radius:.25rem}.post-media .image-desc-content{background-color:rgba(240,250,255,.8);border:1px solid rgba(74,149,237,.1);width:10rem;height:10rem;font-size:.9em;color:var(--text-primary);display:flex;align-items:center;justify-content:center;text-align:center;font-weight:normal}.post-meta{display:flex;justify-content:space-between;align-items:center;color:#888;font-size:.8em}.post-meta .post-time{color:#888}.post-meta .post-actions{display:flex;gap:1rem}.post-meta .like-button,.post-meta .comment-button{background:#f7f7f7;border-radius:.1875rem;padding:.125rem .4375rem;cursor:pointer;font-size:1.1em;transition:all .2s ease}.post-meta .like-button:hover,.post-meta .comment-button:hover{color:var(--primary-blue)}.post-interactions{background:#f8faff;border-radius:.5rem;margin-top:.5rem;font-size:.85em;position:relative;border:1px solid rgba(74,149,237,.08)}.post-interactions::before{content:"";position:absolute;top:-0.375rem;left:.9375rem;width:0;height:0;border-left:.375rem solid rgba(0,0,0,0);border-right:.375rem solid rgba(0,0,0,0);border-bottom:.375rem solid #f8faff}.likes-section{padding:.4375rem .625rem;background:rgba(248,250,255,.6);display:flex;align-items:center;gap:.4375rem;flex-wrap:wrap;font-size:.8em}.likes-section .likes-list{display:flex;flex-wrap:wrap;gap:.25rem}.likes-section .liker-name{cursor:pointer}.likes-section .liker-name:not(:last-child)::after{content:", ";color:#888}.likes-section .fa-heart{color:var(--primary-blue)}.comments-section{padding:0 .625rem .4375rem;list-style:none;border-top:.0625rem solid #eaeaea}.likes-section+.comments-section{margin-top:-0.0625rem}.comments-section li{padding:.1875rem 0}.comment-author{font-weight:500;cursor:pointer}.comment-content{color:var(--text-primary);margin-top:.25rem}.delete-moment-btn{cursor:pointer;font-size:.8em;transition:all .2s ease}.delete-moment-btn:hover{color:var(--deep-blue)}.wechat-home-header{display:flex;align-items:center;justify-content:space-between;padding:.5rem .75rem;padding-top:2.8125rem;color:var(--text-primary);font-weight:600;position:relative;z-index:2}.wechat-home-title{font-size:1.05rem;flex:1;text-align:center}.wechat-home-actions{display:flex;align-items:center;gap:.75rem;color:var(--primary-blue);justify-content:flex-end}.wechat-home-actions i{font-size:1.2em;color:var(--primary-blue);display:flex;align-items:center;justify-content:center;width:1.5rem;height:1.5rem}.wechat-home-header .wechat-home-back{font-size:1.2em;color:var(--primary-blue);cursor:pointer;width:1.5rem;height:1.5rem;display:flex;align-items:center;justify-content:center}.wechat-home-body{flex:1;display:flex;flex-direction:column;padding:0 .75rem .5rem;gap:.5rem;position:relative;z-index:1}.wechat-home-section{display:none;flex:1;overflow-y:auto;padding-bottom:.5rem}.wechat-home-section.active{display:block}.conversation-list,.contacts-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:.5rem}.conv-item,.contact-item,.shortcut-item,.profile-card{padding:.75rem .9rem;border:1px solid var(--border-color);border-radius:var(--element-border-radius);background:var(--wechat-bubble-them-bg,rgba(255,255,255,0.8));box-shadow:0 1px 4px rgba(0,0,0,.04);color:var(--text-primary);font-size:.95rem;display:flex;align-items:center;gap:.75rem}.placeholder{color:var(--text-secondary);font-size:.9rem}.contacts-shortcuts{display:flex;flex-direction:column;gap:.5rem;margin-bottom:.5rem}.wechat-home-tabbar{display:grid;grid-template-columns:repeat(4,1fr);gap:.1rem;padding:.35rem .25rem .6rem;border-top:1px solid var(--border-color);background:#fff;width:calc(100% + .8rem);margin-left:-0.4rem;margin-right:-0.4rem;border-bottom-left-radius:1.2rem;border-bottom-right-radius:1.2rem;margin-top:auto}.wechat-tab-btn{border:none;background:rgba(0,0,0,0);color:var(--text-secondary);padding:.2rem .1rem .15rem;border-radius:.75rem;font-size:.85rem;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:.1rem}.wechat-tab-btn.active{color:var(--primary-blue);background:rgba(0,0,0,0);font-weight:600}.tab-icon{width:24px;height:24px;background-size:cover;background-repeat:no-repeat;background-position:center;filter:grayscale(1) opacity(0.9)}.wechat-tab-btn.active .tab-icon{filter:grayscale(0) opacity(1)}.tab-icon-wechat{background-image:url("https://files.catbox.moe/io8orb.png")}.tab-icon-contacts{background-image:url("https://files.catbox.moe/atop6m.png")}.tab-icon-discover{background-image:url("https://files.catbox.moe/jr13tf.png")}.tab-icon-me{background-image:url("https://files.catbox.moe/yer0ly.png")}.tab-label{font-size:.8rem}.profile-card{display:flex;align-items:center;gap:.75rem}.conv-item{cursor:pointer}.conv-avatar{width:44px;height:44px;border-radius:12px;background:#e8edf3 center/cover no-repeat;flex-shrink:0}.conv-main{flex:1;display:flex;flex-direction:column;gap:.2rem}.conv-row{display:flex;align-items:center;justify-content:space-between;gap:.35rem}.conv-name{font-weight:600;color:var(--text-primary)}.conv-time{font-size:.8rem;color:var(--text-secondary);white-space:nowrap}.conv-desc{font-size:.88rem;color:var(--text-secondary);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1}.conv-unread{min-width:1.25rem;padding:0 .45rem;height:1.25rem;border-radius:.75rem;background:#ff4d4f;color:#fff;font-size:.75rem;text-align:center;line-height:1.25rem;margin-left:.4rem;flex-shrink:0}.profile-avatar{width:52px;height:52px;border-radius:var(--small-border-radius);background:#f2f4f7 center/cover no-repeat}.profile-name{font-weight:600;color:var(--text-primary)}.profile-signature{font-size:.9rem;color:var(--text-secondary);margin-top:.2rem}.wechat-home-back{position:static}body.dark-mode{background-color:rgba(0,0,0,0);--input-bg:#2a2a2a}body.dark-mode .app-view{background-color:var(--app-bg-color)}body.dark-mode .settings-card{background-color:var(--settings-card-bg-color)}body.dark-mode .settings-card p,body.dark-mode .settings-card a{color:var(--text-primary)}body.dark-mode .settings-card li{border-bottom-color:var(--border-color)}body.dark-mode .settings-card li a{color:var(--text-primary)}body.dark-mode #show-last-ai-response-btn,body.dark-mode #show-last-sent-prompt-btn{background-color:var(--settings-card-bg-color);color:var(--text-primary)}body.dark-mode .message-row.them .message-bubble{background:linear-gradient(315deg,#2a2a2a 0%,#333333 100%);border-color:#3c3c3c}body.dark-mode .voice-text-content{background-color:#2c2c2c;border-color:#3c3c3c;color:#f0f0f0;box-shadow:0 .0625rem .125rem rgba(0,0,0,.3)}body.dark-mode .image-desc-content{background-color:rgba(30,30,30,.7);border:.0625rem solid rgba(60,60,60,.4);color:#f0f0f0;box-shadow:0 4px 12px rgba(0,0,0,.25),0 2px 6px rgba(0,0,0,.2)}body.dark-mode .location-bubble .location-card{background-color:#2c2c2c;box-shadow:0 4px 12px rgba(0,0,0,.25),0 2px 6px rgba(0,0,0,.15)}body.dark-mode .location-content .location-title{color:#f0f0f0}body.dark-mode .location-content .location-subtitle{color:#aaa}body.dark-mode .file-bubble .file-card{background-color:#2c2c2c;box-shadow:0 4px 12px rgba(0,0,0,.25),0 2px 6px rgba(0,0,0,.15)}body.dark-mode .file-details .file-name{color:#f0f0f0}body.dark-mode .file-footer{background-color:#232323;color:#aaa;border-top:.0625rem solid #3c3c3c}body.dark-mode .event-description.expanded{background-color:rgba(50,50,50,.9);color:#f0f0f0;box-shadow:0 1px 4px rgba(0,0,0,.3)}.custom-dialog-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0);display:flex;justify-content:center;align-items:center;z-index:1000;animation:fadeIn .2s ease}.custom-dialog{background:var(--header-bg);border-radius:var(--dialog-border-radius);box-shadow:0 25px 50px rgba(0,0,0,.25),0 15px 30px rgba(0,0,0,.15),0 8px 16px rgba(0,0,0,.1),0 4px 8px rgba(0,0,0,.05);width:85%;max-width:18rem;overflow:hidden;display:flex;flex-direction:column;animation:dialogSlideIn .3s ease;border:1px solid var(--border-color);transform:translateY(0)}.dialog-header{padding:1rem;text-align:center;border-bottom:1px solid var(--border-color);background:var(--header-bg)}.dialog-title{margin:0;font-size:1.1rem;font-weight:500;color:var(--text-primary)}.dialog-body{padding:1.25rem 1rem;color:var(--text-primary);font-size:.9rem;line-height:1.5;text-align:center}.dialog-input-container{margin-top:.75rem}.dialog-input-container input,.dialog-input-container textarea{width:100%;padding:.75rem;border:1px solid var(--border-color);border-radius:var(--input-border-radius);font-size:.9rem;color:var(--text-primary);background-color:var(--input-bg);outline:none}.dialog-input-container input:focus,.dialog-input-container textarea:focus{border-color:var(--primary-blue);box-shadow:0 0 0 2px rgba(114,173,243,.2)}.dialog-footer{display:flex;border-top:1px solid var(--border-color)}.dialog-button{flex:1;padding:.875rem;border:none;background:rgba(0,0,0,0);font-size:.95rem;font-weight:500;cursor:pointer;transition:background-color .2s ease;color:var(--primary-blue)}.dialog-button:not(:last-child){border-right:1px solid var(--border-color)}.dialog-button:hover{background-color:rgba(114,173,243,.1)}.dialog-button:active{background-color:rgba(114,173,243,.2)}.dialog-button.primary-button{color:var(--primary-blue);font-weight:600}.dialog-button.cancel-button{color:var(--text-secondary)}@keyframes dialogSlideIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes dialogSlideOut{from{opacity:1;transform:translateY(0)}to{opacity:0;transform:translateY(20px)}}.dialog-closing{animation:dialogSlideOut .2s ease forwards}.overlay-closing{animation:fadeOut .2s ease forwards}.mobile-dialog-overlay{position:absolute;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0);display:flex;justify-content:center;align-items:center;z-index:1000;animation:fadeIn .2s ease}body.dark-mode .mobile-dialog,body.dark-mode .custom-dialog,body.dark-mode .sticker-manager-container{box-shadow:0 30px 60px rgba(0,0,0,.5),0 20px 40px rgba(0,0,0,.3),0 10px 20px rgba(0,0,0,.2),0 5px 10px rgba(0,0,0,.15)}body[data-theme=pink] .mobile-dialog,body[data-theme=pink] .custom-dialog,body[data-theme=pink] .sticker-manager-container{box-shadow:0 30px 60px rgba(216,51,132,.3),0 20px 40px rgba(216,51,132,.2),0 10px 20px rgba(0,0,0,.15),0 5px 10px rgba(0,0,0,.1)}body[data-theme=white] .mobile-dialog,body[data-theme=white] .custom-dialog,body[data-theme=white] .sticker-manager-container{box-shadow:0 30px 60px rgba(0,0,0,.2),0 20px 40px rgba(0,0,0,.15),0 10px 20px rgba(0,0,0,.1),0 5px 10px rgba(0,0,0,.05)}.mobile-dialog{background:var(--header-bg);border-radius:var(--dialog-border-radius);box-shadow:0 30px 60px rgba(0,0,0,.3),0 20px 40px rgba(0,0,0,.2),0 10px 20px rgba(0,0,0,.15),0 5px 10px rgba(0,0,0,.1);overflow:hidden;display:flex;flex-direction:column;animation:dialogSlideIn .3s ease;border:1px solid var(--border-color);transform:translateY(0);position:relative}.moment-dialog{width:90%;max-width:20rem}.time-jump-dialog{width:85%;max-width:18rem}.mobile-dialog .dialog-header{padding:1.2rem 1rem 1rem;text-align:center;border-bottom:1px solid var(--border-color);background:var(--header-bg)}.mobile-dialog .dialog-header h3{margin:0;font-size:1.1rem;font-weight:600;color:var(--text-primary);letter-spacing:.3px}.mobile-dialog .dialog-body{padding:1.25rem 1rem;color:var(--text-primary);font-size:.9rem;line-height:1.5;max-height:60vh;overflow-y:auto}.mobile-dialog .dialog-footer{display:flex;border-top:1px solid var(--border-color)}.mobile-dialog .form-group{margin-bottom:.75rem}.mobile-dialog .form-group:last-child{margin-bottom:0}.mobile-dialog .form-group label{display:block;margin-bottom:.5rem;font-weight:500;color:var(--text-primary);font-size:.9rem}.mobile-dialog .form-group input[type=text],.mobile-dialog .form-group input[type=url],.mobile-dialog .form-group textarea{width:100%;padding:.75rem;border:1px solid var(--border-color);border-radius:var(--input-border-radius);font-size:.9rem;color:var(--text-primary);background-color:#fff;outline:none;box-sizing:border-box}.mobile-dialog .form-group input[type=text]:focus,.mobile-dialog .form-group input[type=url]:focus,.mobile-dialog .form-group textarea:focus{border-color:var(--primary-blue);box-shadow:0 0 0 2px rgba(114,173,243,.2)}.mobile-dialog .form-group textarea{resize:vertical;min-height:4rem;font-family:inherit}.mobile-dialog .form-group input[type=checkbox]{margin-right:.5rem;transform:scale(1.1)}.mobile-dialog .radio-group{display:flex;margin-top:.5rem;border-radius:var(--element-border-radius);overflow:hidden;border:1px solid var(--border-color)}.mobile-dialog .radio-group label{flex:1;display:flex;align-items:center;justify-content:center;margin-bottom:0;font-weight:500;cursor:pointer;font-size:.85rem;padding:.5rem .75rem;background:#fff;color:var(--text-secondary);transition:all .2s ease;border-right:1px solid var(--border-color);position:relative}.mobile-dialog .radio-group label:last-child{border-right:none}.mobile-dialog .radio-group label input[type=radio]{position:absolute;opacity:0;width:0;height:0}.mobile-dialog .radio-group label:has(input[type=radio]:checked){background:var(--primary-blue);color:#fff;font-weight:600}.mobile-dialog .radio-group label:hover:not(:has(input[type=radio]:checked)){background:var(--ultra-light-blue);color:var(--primary-blue)}.mobile-dialog .image-options{background:var(--ultra-light-blue);padding:.75rem;border-radius:var(--element-border-radius);margin-top:.5rem;border:1px solid var(--border-color)}.mobile-dialog .image-options .form-group{margin-bottom:.5rem}.mobile-dialog .image-options .form-group:last-child{margin-bottom:0}.mobile-dialog .description-group{background:var(--ultra-light-blue);padding:.75rem;border-radius:var(--element-border-radius);margin-top:.5rem;border:1px solid var(--border-color)}.mobile-dialog .description-group .form-group{margin-bottom:0}.mobile-dialog .dialog-btn{flex:1;padding:.875rem;border:none;background:rgba(0,0,0,0);font-size:.95rem;font-weight:500;cursor:pointer;transition:background-color .2s ease;color:var(--primary-blue)}.mobile-dialog .dialog-btn:not(:last-child){border-right:1px solid var(--border-color)}.mobile-dialog .dialog-btn:hover{background-color:var(--ultra-light-blue)}.mobile-dialog .dialog-btn:active{background-color:var(--soft-blue)}.mobile-dialog .dialog-btn.dialog-btn-cancel,.mobile-dialog .dialog-btn.dialog-btn-confirm{border-radius:0}.mobile-dialog .dialog-btn:last-child{border-bottom-right-radius:1rem}.mobile-dialog .dialog-btn:first-child{border-bottom-left-radius:1rem}.mobile-dialog.dialog-closing{animation:dialogSlideOut .3s ease forwards}body.dark-mode .mobile-dialog{background:linear-gradient(135deg,#2c2c2c 0%,#1a1a1a 100%);border-color:#3c3c3c;box-shadow:0 8px 24px rgba(0,0,0,.4),0 4px 12px rgba(0,0,0,.3)}body.dark-mode .mobile-dialog .dialog-header{background:linear-gradient(135deg,#2c2c2c 0%,#1a1a1a 100%);border-bottom-color:#3c3c3c}body.dark-mode .mobile-dialog .dialog-header h3{color:#e0e0e0}body.dark-mode .mobile-dialog .dialog-body{color:silver}body.dark-mode .mobile-dialog .form-group label{color:silver}body.dark-mode .mobile-dialog .form-group input[type=text],body.dark-mode .mobile-dialog .form-group input[type=url],body.dark-mode .mobile-dialog .form-group textarea{background-color:#2a2a2a;border-color:#3c3c3c;color:#e0e0e0}body.dark-mode .mobile-dialog .form-group input[type=text]:focus,body.dark-mode .mobile-dialog .form-group input[type=url]:focus,body.dark-mode .mobile-dialog .form-group textarea:focus{border-color:var(--primary-blue);box-shadow:0 0 0 2px rgba(114,173,243,.3)}body.dark-mode .mobile-dialog .form-group input[type=text]::placeholder,body.dark-mode .mobile-dialog .form-group input[type=url]::placeholder,body.dark-mode .mobile-dialog .form-group textarea::placeholder{color:#888}body.dark-mode .mobile-dialog .image-options,body.dark-mode .mobile-dialog .description-group{background:#1a1a1a;border-color:#3c3c3c}body.dark-mode .mobile-dialog .radio-group{border-color:#3c3c3c}body.dark-mode .mobile-dialog .radio-group label{background:#2a2a2a;color:#a0a0a0;border-right-color:#3c3c3c}body.dark-mode .mobile-dialog .radio-group label:has(input[type=radio]:checked){background:var(--primary-blue);color:#fff}body.dark-mode .mobile-dialog .radio-group label:hover:not(:has(input[type=radio]:checked)){background:#3c3c3c;color:silver}body.dark-mode .mobile-dialog .dialog-btn{color:var(--primary-blue)}body.dark-mode .mobile-dialog .dialog-btn:hover{background-color:#3c3c3c}body.dark-mode .mobile-dialog .dialog-btn:active{background-color:#505050}body[data-theme=pink] .mobile-dialog .dialog-header h3{color:#d63384}body[data-theme=pink] .mobile-dialog .image-options,body[data-theme=pink] .mobile-dialog .description-group{background:#fdf2f8;border-color:#f8bbd9}body[data-theme=pink] .mobile-dialog .dialog-body{color:#333}body[data-theme=pink] .mobile-dialog .radio-group label:has(input[type=radio]:checked){background:#d63384;color:#fff}body[data-theme=pink] .mobile-dialog .btn-primary{background:#d63384;border-color:#d63384}body[data-theme=pink] .mobile-dialog .btn-primary:hover{background:rgb(178.187755102,35.812244898,106.5632653061);border-color:rgb(178.187755102,35.812244898,106.5632653061)}body[data-theme=pink] .mobile-dialog .input-field:focus{border-color:#d63384;box-shadow:0 0 0 2px rgba(214,51,132,.2)}body[data-theme=pink] .mobile-dialog .radio-group label:hover:not(:has(input[type=radio]:checked)){background:#fdf2f8;color:#d63384}body[data-theme=white] .mobile-dialog .dialog-header h3{color:#333}body[data-theme=white] .mobile-dialog .image-options,body[data-theme=white] .mobile-dialog .description-group{background:#f8f8f8;border-color:#e0e0e0}body[data-theme=white] .mobile-dialog .dialog-body{color:#333}body[data-theme=white] .mobile-dialog .radio-group label:has(input[type=radio]:checked){background:#333;color:#fff}body[data-theme=white] .mobile-dialog .btn-primary{background:#333;border-color:#333}body[data-theme=white] .mobile-dialog .btn-primary:hover{background:hsl(0,0%,10%);border-color:hsl(0,0%,10%)}body[data-theme=white] .mobile-dialog .input-field:focus{border-color:#a0e75a;box-shadow:0 0 0 2px rgba(160,231,90,.2)}body[data-theme=white] .mobile-dialog .form-group label{color:#333}body[data-theme=white] .mobile-dialog .form-group input[type=text],body[data-theme=white] .mobile-dialog .form-group input[type=url],body[data-theme=white] .mobile-dialog .form-group textarea{background:#fff;border:1px solid #e0e0e0}body[data-theme=white] .mobile-dialog .form-group input[type=text]:focus,body[data-theme=white] .mobile-dialog .form-group input[type=url]:focus,body[data-theme=white] .mobile-dialog .form-group textarea:focus{border-color:#a0e75a;box-shadow:0 0 0 2px rgba(160,231,90,.2);outline:none}body[data-theme=white] .mobile-dialog .form-group input[type=text]::placeholder,body[data-theme=white] .mobile-dialog .form-group input[type=url]::placeholder,body[data-theme=white] .mobile-dialog .form-group textarea::placeholder{color:#fff}body[data-theme=white] .mobile-dialog .form-group input[type=text],body[data-theme=white] .mobile-dialog .form-group input[type=url],body[data-theme=white] .mobile-dialog .form-group textarea{color:#333}body[data-theme=white] .mobile-dialog .form-group input[type=text]::placeholder,body[data-theme=white] .mobile-dialog .form-group input[type=url]::placeholder,body[data-theme=white] .mobile-dialog .form-group textarea::placeholder{color:#999}body[data-theme=white] .mobile-dialog .radio-group label:has(input[type=radio]:checked){background:#a0e75a;color:#333}body[data-theme=white] .mobile-dialog .radio-group label:hover:not(:has(input[type=radio]:checked)){background:#f8f8f8;color:#666}body[data-theme=custom] .mobile-dialog .image-options,body[data-theme=custom] .mobile-dialog .description-group{background:var(--settings-card-bg-color);border-color:var(--border-color)}body[data-theme=custom] .mobile-dialog .radio-group{border-color:var(--border-color)}body[data-theme=custom] .mobile-dialog .radio-group label{background:var(--settings-card-bg-color);color:var(--text-primary);border-right-color:var(--border-color)}body[data-theme=custom] .mobile-dialog .radio-group label:has(input[type=radio]:checked){background:var(--primary-blue);color:#fff}body[data-theme=custom] .mobile-dialog .radio-group label:hover:not(:has(input[type=radio]:checked)){background:var(--ultra-light-blue);color:var(--primary-blue)}body[data-theme=custom] .mobile-dialog .dialog-btn{color:var(--primary-blue)}body[data-theme=custom] .mobile-dialog .dialog-btn:hover{background-color:var(--ultra-light-blue)}body[data-theme=custom] .mobile-dialog .dialog-btn:active{background-color:var(--light-blue)}body.dark-mode[data-theme=custom] .mobile-dialog .image-options,body.dark-mode[data-theme=custom] .mobile-dialog .description-group{background:var(--settings-card-bg-color);border-color:var(--border-color)}body.dark-mode[data-theme=custom] .mobile-dialog .radio-group{border-color:var(--border-color)}body.dark-mode[data-theme=custom] .mobile-dialog .radio-group label{background:var(--settings-card-bg-color);color:var(--text-primary);border-right-color:var(--border-color)}body.dark-mode[data-theme=custom] .mobile-dialog .radio-group label:has(input[type=radio]:checked){background:var(--primary-blue);color:#fff}body.dark-mode[data-theme=custom] .mobile-dialog .radio-group label:hover:not(:has(input[type=radio]:checked)){background:var(--ultra-light-blue);color:var(--primary-blue)}body.dark-mode[data-theme=custom] .mobile-dialog .dialog-btn{color:var(--primary-blue)}body.dark-mode[data-theme=custom] .mobile-dialog .dialog-btn:hover{background-color:var(--ultra-light-blue)}body.dark-mode[data-theme=custom] .mobile-dialog .dialog-btn:active{background-color:var(--light-blue)}@media (prefers-contrast:high){.mobile-dialog{border-width:2px}.mobile-dialog .dialog-btn{border:1px solid var(--border-color)}.mobile-dialog .dialog-btn:focus{outline:2px solid var(--primary-blue);outline-offset:2px}.mobile-dialog .form-group input[type=text],.mobile-dialog .form-group textarea{border-width:2px}.mobile-dialog .radio-group{border-width:2px}.mobile-dialog .radio-group label{border-right-width:2px}}@media (prefers-reduced-motion:reduce){.mobile-dialog{animation:none}.mobile-dialog .dialog-btn,.mobile-dialog .form-group input,.mobile-dialog .form-group textarea,.mobile-dialog .radio-group label{transition:none}.mobile-dialog.dialog-closing{animation:none}}.mobile-dialog .dialog-header h3{text-shadow:0 1px 2px rgba(0,0,0,.1)}.mobile-dialog .dialog-body{background:hsla(0,0%,100%,.02);backdrop-filter:blur(1px)}.mobile-dialog .dialog-btn{backdrop-filter:blur(2px)}.mobile-dialog .dialog-btn:hover{backdrop-filter:blur(4px)}.mobile-dialog .form-group input[type=text],.mobile-dialog .form-group textarea{backdrop-filter:blur(1px)}.mobile-dialog .form-group input[type=text]:focus,.mobile-dialog .form-group textarea:focus{backdrop-filter:blur(2px)}@media (max-height:600px){.mobile-dialog{max-height:90% !important}.mobile-dialog .dialog-body{padding:12px 16px}.mobile-dialog .form-group{margin-bottom:10px}}.transfer-dialog .form-group,.red-packet-dialog .form-group,.gift-dialog .form-group,.comment-dialog .form-group{position:relative}.transfer-dialog .form-group label,.red-packet-dialog .form-group label,.gift-dialog .form-group label,.comment-dialog .form-group label{display:block;margin-bottom:.5rem;font-weight:600;color:var(--text-primary);font-size:.9rem}.transfer-dialog .form-group input,.transfer-dialog .form-group textarea,.red-packet-dialog .form-group input,.red-packet-dialog .form-group textarea,.gift-dialog .form-group input,.gift-dialog .form-group textarea,.comment-dialog .form-group input,.comment-dialog .form-group textarea{width:100%;padding:.75rem 1rem;border:2px solid var(--border-color);border-radius:var(--input-border-radius);font-size:1rem;color:var(--text-primary);background-color:var(--input-bg);transition:all .2s ease;box-sizing:border-box;font-family:inherit}.transfer-dialog .form-group input:focus,.transfer-dialog .form-group textarea:focus,.red-packet-dialog .form-group input:focus,.red-packet-dialog .form-group textarea:focus,.gift-dialog .form-group input:focus,.gift-dialog .form-group textarea:focus,.comment-dialog .form-group input:focus,.comment-dialog .form-group textarea:focus{outline:none;border-color:var(--primary-blue);box-shadow:0 0 0 3px rgba(114,173,243,.1);background-color:#fff}.transfer-dialog .form-group input::placeholder,.transfer-dialog .form-group textarea::placeholder,.red-packet-dialog .form-group input::placeholder,.red-packet-dialog .form-group textarea::placeholder,.gift-dialog .form-group input::placeholder,.gift-dialog .form-group textarea::placeholder,.comment-dialog .form-group input::placeholder,.comment-dialog .form-group textarea::placeholder{color:var(--text-secondary);opacity:.7}.transfer-dialog .form-group input[type=url],.red-packet-dialog .form-group input[type=url],.gift-dialog .form-group input[type=url],.comment-dialog .form-group input[type=url]{font-family:"Consolas","Monaco","Courier New",monospace;font-size:.9rem;background:linear-gradient(135deg,#f8faff 0%,#eef4ff 100%);border:2px solid #e3f2fd}.transfer-dialog .form-group input[type=url]:focus,.red-packet-dialog .form-group input[type=url]:focus,.gift-dialog .form-group input[type=url]:focus,.comment-dialog .form-group input[type=url]:focus{background:#fff;border-color:var(--primary-blue);box-shadow:0 0 0 3px rgba(114,173,243,.1)}.transfer-dialog .form-group input[type=url]::placeholder,.red-packet-dialog .form-group input[type=url]::placeholder,.gift-dialog .form-group input[type=url]::placeholder,.comment-dialog .form-group input[type=url]::placeholder{color:#90a4ae;font-style:italic}.transfer-dialog .form-group input[type=number],.transfer-dialog .form-group input[type=text],.transfer-dialog .form-group input[type=email],.transfer-dialog .form-group input[type=url],.red-packet-dialog .form-group input[type=number],.red-packet-dialog .form-group input[type=text],.red-packet-dialog .form-group input[type=email],.red-packet-dialog .form-group input[type=url],.gift-dialog .form-group input[type=number],.gift-dialog .form-group input[type=text],.gift-dialog .form-group input[type=email],.gift-dialog .form-group input[type=url],.comment-dialog .form-group input[type=number],.comment-dialog .form-group input[type=text],.comment-dialog .form-group input[type=email],.comment-dialog .form-group input[type=url]{-webkit-appearance:none;appearance:none}.transfer-dialog .form-group input[type=number]::-webkit-outer-spin-button,.transfer-dialog .form-group input[type=number]::-webkit-inner-spin-button,.transfer-dialog .form-group input[type=text]::-webkit-outer-spin-button,.transfer-dialog .form-group input[type=text]::-webkit-inner-spin-button,.transfer-dialog .form-group input[type=email]::-webkit-outer-spin-button,.transfer-dialog .form-group input[type=email]::-webkit-inner-spin-button,.transfer-dialog .form-group input[type=url]::-webkit-outer-spin-button,.transfer-dialog .form-group input[type=url]::-webkit-inner-spin-button,.red-packet-dialog .form-group input[type=number]::-webkit-outer-spin-button,.red-packet-dialog .form-group input[type=number]::-webkit-inner-spin-button,.red-packet-dialog .form-group input[type=text]::-webkit-outer-spin-button,.red-packet-dialog .form-group input[type=text]::-webkit-inner-spin-button,.red-packet-dialog .form-group input[type=email]::-webkit-outer-spin-button,.red-packet-dialog .form-group input[type=email]::-webkit-inner-spin-button,.red-packet-dialog .form-group input[type=url]::-webkit-outer-spin-button,.red-packet-dialog .form-group input[type=url]::-webkit-inner-spin-button,.gift-dialog .form-group input[type=number]::-webkit-outer-spin-button,.gift-dialog .form-group input[type=number]::-webkit-inner-spin-button,.gift-dialog .form-group input[type=text]::-webkit-outer-spin-button,.gift-dialog .form-group input[type=text]::-webkit-inner-spin-button,.gift-dialog .form-group input[type=email]::-webkit-outer-spin-button,.gift-dialog .form-group input[type=email]::-webkit-inner-spin-button,.gift-dialog .form-group input[type=url]::-webkit-outer-spin-button,.gift-dialog .form-group input[type=url]::-webkit-inner-spin-button,.comment-dialog .form-group input[type=number]::-webkit-outer-spin-button,.comment-dialog .form-group input[type=number]::-webkit-inner-spin-button,.comment-dialog .form-group input[type=text]::-webkit-outer-spin-button,.comment-dialog .form-group input[type=text]::-webkit-inner-spin-button,.comment-dialog .form-group input[type=email]::-webkit-outer-spin-button,.comment-dialog .form-group input[type=email]::-webkit-inner-spin-button,.comment-dialog .form-group input[type=url]::-webkit-outer-spin-button,.comment-dialog .form-group input[type=url]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.transfer-dialog .form-group label:has(+input[required])::after,.transfer-dialog .form-group label:has(+textarea[required])::after,.red-packet-dialog .form-group label:has(+input[required])::after,.red-packet-dialog .form-group label:has(+textarea[required])::after,.gift-dialog .form-group label:has(+input[required])::after,.gift-dialog .form-group label:has(+textarea[required])::after,.comment-dialog .form-group label:has(+input[required])::after,.comment-dialog .form-group label:has(+textarea[required])::after{content:" *";color:#e74c3c;font-weight:bold}.transfer-dialog .dialog-body,.red-packet-dialog .dialog-body,.gift-dialog .dialog-body,.comment-dialog .dialog-body{padding:1.5rem 1.25rem}.comment-dialog{width:92%;max-width:22rem}.comment-dialog textarea{min-height:4rem;resize:vertical;font-family:inherit;line-height:1.4}.transfer-dialog{width:90%;max-width:20rem}.transfer-dialog .form-group{margin-bottom:1rem}.transfer-dialog .form-group:last-child{margin-bottom:0}.transfer-dialog input[type=number]{font-size:1.1rem;font-weight:600;text-align:center}.transfer-dialog input[type=number]:focus{color:var(--primary-blue)}.transfer-dialog input[type=text]{font-size:.95rem}.user-profile-dialog .dialog-input-container{margin-bottom:.75rem}.user-profile-dialog .dialog-input-container:last-child{margin-bottom:0}.user-profile-dialog .dialog-input-container input[type=url]{font-family:monospace;font-size:.85rem}.red-packet-dialog{width:90%;max-width:20rem}.red-packet-dialog .dialog-header h3{color:#e74c3c}.red-packet-dialog .form-group{margin-bottom:1rem}.red-packet-dialog .form-group:last-child{margin-bottom:0}.red-packet-dialog input[type=number]{font-size:1.1rem;font-weight:600;text-align:center;color:#e74c3c}.red-packet-dialog input[type=number]:focus{border-color:#e74c3c;box-shadow:0 0 0 2px rgba(231,76,60,.2)}.red-packet-dialog input[type=text]{font-size:.95rem;text-align:center}.gift-dialog{width:90%;max-width:20rem}.gift-dialog .form-group{margin-bottom:1rem}.gift-dialog .form-group:last-child{margin-bottom:0}.gift-dialog input[type=text]{font-size:1rem;font-weight:500}.gift-dialog input[type=number]{font-size:1rem;text-align:center}.comment-dialog .dialog-footer{display:flex;border-top:1px solid var(--border-color)}.comment-dialog .dialog-button{flex:1;padding:.875rem;border:none;background:rgba(0,0,0,0);font-size:.95rem;font-weight:500;cursor:pointer;transition:background-color .2s ease;color:var(--primary-blue)}.comment-dialog .dialog-button:not(:last-child){border-right:1px solid var(--border-color)}.comment-dialog .dialog-button:hover{background-color:var(--ultra-light-blue)}.comment-dialog .dialog-button:active{background-color:var(--soft-blue)}body.dark-mode .transfer-dialog .form-group input,body.dark-mode .transfer-dialog .form-group textarea,body.dark-mode .red-packet-dialog .form-group input,body.dark-mode .red-packet-dialog .form-group textarea,body.dark-mode .gift-dialog .form-group input,body.dark-mode .gift-dialog .form-group textarea,body.dark-mode .comment-dialog .form-group input,body.dark-mode .comment-dialog .form-group textarea{background-color:#2a2a2a;border-color:#3c3c3c;color:#e0e0e0}body.dark-mode .transfer-dialog .form-group input:focus,body.dark-mode .transfer-dialog .form-group textarea:focus,body.dark-mode .red-packet-dialog .form-group input:focus,body.dark-mode .red-packet-dialog .form-group textarea:focus,body.dark-mode .gift-dialog .form-group input:focus,body.dark-mode .gift-dialog .form-group textarea:focus,body.dark-mode .comment-dialog .form-group input:focus,body.dark-mode .comment-dialog .form-group textarea:focus{background-color:#333;border-color:var(--primary-blue);box-shadow:0 0 0 3px rgba(114,173,243,.2)}body.dark-mode .transfer-dialog .form-group input::placeholder,body.dark-mode .transfer-dialog .form-group textarea::placeholder,body.dark-mode .red-packet-dialog .form-group input::placeholder,body.dark-mode .red-packet-dialog .form-group textarea::placeholder,body.dark-mode .gift-dialog .form-group input::placeholder,body.dark-mode .gift-dialog .form-group textarea::placeholder,body.dark-mode .comment-dialog .form-group input::placeholder,body.dark-mode .comment-dialog .form-group textarea::placeholder{color:#888}body.dark-mode .transfer-dialog .form-group input[type=url],body.dark-mode .red-packet-dialog .form-group input[type=url],body.dark-mode .gift-dialog .form-group input[type=url],body.dark-mode .comment-dialog .form-group input[type=url]{background:#1a1a1a;border-color:#3c3c3c;color:#e0e0e0}body.dark-mode .transfer-dialog .form-group input[type=url]:focus,body.dark-mode .red-packet-dialog .form-group input[type=url]:focus,body.dark-mode .gift-dialog .form-group input[type=url]:focus,body.dark-mode .comment-dialog .form-group input[type=url]:focus{background:#2a2a2a;border-color:var(--primary-blue)}body.dark-mode .transfer-dialog .form-group input[type=url]::placeholder,body.dark-mode .red-packet-dialog .form-group input[type=url]::placeholder,body.dark-mode .gift-dialog .form-group input[type=url]::placeholder,body.dark-mode .comment-dialog .form-group input[type=url]::placeholder{color:#888}body.dark-mode .red-packet-dialog input[type=number]:focus{border-color:#e74c3c;box-shadow:0 0 0 3px rgba(231,76,60,.2)}body[data-theme=pink] .transfer-dialog input[type=number]:focus{color:#d63384;border-color:#d63384;box-shadow:0 0 0 3px rgba(216,51,132,.1)}body[data-theme=pink] .red-packet-dialog .dialog-header h3{color:#d63384}body[data-theme=pink] .input-dialog input[type=url]{background:linear-gradient(135deg,#fdf2f8 0%,#fce7f3 100%);border-color:#f8bbd9}body[data-theme=pink] .input-dialog input[type=url]:focus{border-color:#d63384;box-shadow:0 0 0 3px rgba(216,51,132,.1)}body[data-theme=white] .transfer-dialog input[type=number]:focus{color:#689f38;border-color:#689f38;box-shadow:0 0 0 3px rgba(104,159,56,.1)}body[data-theme=white] .red-packet-dialog .dialog-header h3{color:#f44336}body[data-theme=white] .input-dialog input[type=url]{background:linear-gradient(135deg,#f8f8f8 0%,#f0f0f0 100%);border-color:#e0e0e0;color:#333}body[data-theme=white] .input-dialog input[type=url]:focus{border-color:#689f38;box-shadow:0 0 0 3px rgba(104,159,56,.1)}body[data-theme=white] .input-dialog input[type=url]::placeholder{color:#999}.input-dialog{width:90%;max-width:20rem}.voice-dialog{width:90%;max-width:22rem}.voice-dialog .dialog-header h3{display:flex;align-items:center;justify-content:center;gap:.5rem}.voice-dialog .form-group{margin-bottom:1rem}.voice-dialog .form-group:last-child{margin-bottom:0}.voice-dialog .form-group label{display:block;margin-bottom:.5rem;font-weight:600;color:var(--text-primary);font-size:.9rem}.voice-dialog .form-group textarea{width:100%;min-height:80px;padding:.75rem 1rem;border:2px solid var(--border-color);border-radius:var(--input-border-radius);font-size:1rem;color:var(--text-primary);background-color:var(--input-bg);transition:all .2s ease;box-sizing:border-box;font-family:inherit;resize:vertical}.voice-dialog .form-group textarea:focus{outline:none;border-color:var(--primary-blue);box-shadow:0 0 0 3px rgba(114,173,243,.1);background-color:#fff}.voice-dialog .form-group textarea::placeholder{color:var(--text-secondary);opacity:.7}.voice-dialog .form-group input[type=number]{width:100%;padding:.75rem 1rem;border:2px solid var(--border-color);border-radius:var(--input-border-radius);font-size:1rem;color:var(--text-primary);background-color:var(--input-bg);transition:all .2s ease;box-sizing:border-box;font-family:inherit}.voice-dialog .form-group input[type=number]:focus{outline:none;border-color:var(--primary-blue);box-shadow:0 0 0 3px rgba(114,173,243,.1);background-color:#fff}.voice-dialog .form-group input[type=number]::placeholder{color:var(--text-secondary);opacity:.7}.voice-dialog .form-group input[type=number]::-webkit-outer-spin-button,.voice-dialog .form-group input[type=number]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.voice-dialog .form-group input[type=number]{-webkit-appearance:none;appearance:none}.receive-dialog{width:85%;max-width:18rem}.receive-dialog .receive-content{display:flex;align-items:center;gap:1rem;padding:.5rem 0}.receive-dialog .receive-icon{font-size:2.5rem;flex-shrink:0}.receive-dialog .receive-info{flex:1}.receive-dialog .receive-title{font-size:1rem;font-weight:500;color:var(--text-primary);margin-bottom:.25rem}.receive-dialog .receive-price{font-size:1.2rem;font-weight:600;color:var(--primary-blue);margin-bottom:.25rem}.receive-dialog .receive-note{font-size:.85rem;color:var(--text-secondary);font-style:italic}.receive-dialog .dialog-footer{display:flex;border-top:1px solid var(--border-color)}.receive-dialog .dialog-footer .dialog-button{flex:1;padding:.875rem;border:none;background:rgba(0,0,0,0);font-size:.95rem;font-weight:500;cursor:pointer;transition:background-color .2s ease;color:var(--primary-blue)}.receive-dialog .dialog-footer .dialog-button:not(:last-child){border-right:1px solid var(--border-color)}.receive-dialog .dialog-footer .dialog-button:hover{background-color:var(--ultra-light-blue)}.receive-dialog .dialog-footer .dialog-button:active{background-color:var(--soft-blue)}.sticker-manager-modal{position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0);display:flex;justify-content:center;align-items:center;z-index:1000;animation:fadeIn .2s ease}.sticker-manager-container{background:var(--header-bg);border-radius:var(--dialog-border-radius);box-shadow:0 35px 70px rgba(0,0,0,.35),0 25px 50px rgba(0,0,0,.25),0 15px 30px rgba(0,0,0,.2),0 8px 16px rgba(0,0,0,.15);width:90%;max-width:28rem;max-height:80vh;overflow:hidden;display:flex;flex-direction:column;animation:dialogSlideIn .3s ease;border:1px solid var(--border-color)}.sticker-manager-container h2{margin:0;padding:1rem;text-align:center;border-bottom:1px solid var(--border-color);background:var(--header-bg);font-size:1.1rem;font-weight:600;color:var(--text-primary)}.sticker-manager-container .sticker-manager-tabs{display:flex;border-bottom:1px solid var(--border-color);background:var(--header-bg)}.sticker-manager-container .sticker-manager-tabs .tab-button{flex:1;padding:.75rem 1rem;text-align:center;cursor:pointer;font-size:.9rem;font-weight:500;color:var(--text-secondary);border-bottom:2px solid rgba(0,0,0,0);transition:all .2s ease}.sticker-manager-container .sticker-manager-tabs .tab-button:hover{background-color:var(--ultra-light-blue);color:var(--text-primary)}.sticker-manager-container .sticker-manager-tabs .tab-button.active{color:var(--primary-blue);border-bottom-color:var(--primary-blue);font-weight:600}.sticker-manager-container .sticker-manager-tabs .tab-button:not(:last-child){border-right:1px solid var(--border-color)}.sticker-manager-container .sticker-manager-content{overflow-y:auto;flex:1}.sticker-manager-container .sticker-manager-content .tab-content{display:none;padding:1.5rem 1.25rem}.sticker-manager-container .sticker-manager-content .tab-content.active{display:block}.sticker-manager-container .sticker-manager-content .form-group{display:flex;flex-direction:column;gap:.5rem;margin-bottom:1rem}.sticker-manager-container .sticker-manager-content .form-group label{font-size:.9rem;font-weight:500;color:var(--text-primary)}.sticker-manager-container .sticker-manager-content .form-group input,.sticker-manager-container .sticker-manager-content .form-group textarea{width:100%;padding:.75rem 1rem;border:2px solid var(--border-color);border-radius:var(--input-border-radius);font-size:1rem;color:var(--text-primary);background-color:var(--input-bg);transition:all .2s ease;box-sizing:border-box}.sticker-manager-container .sticker-manager-content .form-group input:focus,.sticker-manager-container .sticker-manager-content .form-group textarea:focus{outline:none;border-color:var(--primary-blue);box-shadow:0 0 0 3px rgba(114,173,243,.1);background-color:#fff}.sticker-manager-container .sticker-manager-content .form-group input::placeholder,.sticker-manager-container .sticker-manager-content .form-group textarea::placeholder{color:var(--text-secondary);opacity:.7}.sticker-manager-container .sticker-manager-content .form-group textarea{min-height:120px;resize:vertical;font-family:inherit}.sticker-manager-container .sticker-manager-content .add-sticker-section .add-sticker-form{display:flex;flex-direction:column;gap:1rem}.sticker-manager-container .sticker-manager-content .add-sticker-section .add-sticker-form .preview-container{display:flex;flex-direction:column;align-items:center;gap:.5rem;margin:1rem 0}.sticker-manager-container .sticker-manager-content .add-sticker-section .add-sticker-form .preview-container .preview-label{font-size:.9rem;color:var(--text-secondary)}.sticker-manager-container .sticker-manager-content .add-sticker-section .add-sticker-form .preview-container .preview-img{max-width:150px;max-height:150px;border:1px dashed var(--border-color);padding:.5rem;border-radius:var(--element-border-radius);background:var(--input-bg)}.sticker-manager-container .sticker-manager-content .add-sticker-section .add-sticker-form .add-sticker-btn{padding:.75rem 1.5rem;background:var(--primary-blue);color:#fff;border:none;border-radius:var(--button-border-radius);font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s ease}.sticker-manager-container .sticker-manager-content .add-sticker-section .add-sticker-form .add-sticker-btn:hover{background:var(--soft-blue)}.sticker-manager-container .sticker-manager-content .add-sticker-section .add-sticker-form .add-sticker-btn:active{transform:translateY(1px)}.sticker-manager-container .sticker-manager-content .batch-add-section .batch-instructions{margin-bottom:1rem;padding:1rem;background:var(--input-bg);border-radius:var(--element-border-radius);border-left:4px solid var(--primary-blue)}.sticker-manager-container .sticker-manager-content .batch-add-section .batch-instructions p{margin:0 0 .5rem 0;font-size:.9rem;font-weight:600;color:var(--text-primary)}.sticker-manager-container .sticker-manager-content .batch-add-section .batch-instructions ul{margin:0;padding-left:1.5rem}.sticker-manager-container .sticker-manager-content .batch-add-section .batch-instructions ul li{font-size:.85rem;color:var(--text-secondary);line-height:1.4;margin-bottom:.25rem}.sticker-manager-container .sticker-manager-content .batch-add-section .batch-instructions ul li strong{color:var(--text-primary)}.sticker-manager-container .sticker-manager-content .batch-add-section .batch-instructions ul li code{background:rgba(114,173,243,.1);padding:.2rem .4rem;border-radius:var(--small-border-radius);font-family:"Consolas","Monaco","Courier New",monospace;font-size:.8rem}.sticker-manager-container .sticker-manager-content .batch-add-section .batch-add-btn{width:100%;padding:.75rem;background:var(--primary-blue);color:#fff;border:none;border-radius:var(--button-border-radius);font-size:.95rem;font-weight:600;cursor:pointer;transition:all .2s ease}.sticker-manager-container .sticker-manager-content .batch-add-section .batch-add-btn:hover{background:var(--soft-blue)}.sticker-manager-container .sticker-manager-content .batch-add-section .batch-add-btn:active{transform:translateY(1px)}.sticker-manager-container .sticker-manager-content .delete-manage-section .control-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}.sticker-manager-container .sticker-manager-content .delete-manage-section .control-bar .selection-controls{display:flex;gap:.5rem}.sticker-manager-container .sticker-manager-content .delete-manage-section .control-bar .selection-controls button{padding:.5rem .75rem;background:var(--input-bg);border:1px solid var(--border-color);border-radius:var(--element-border-radius);font-size:.85rem;cursor:pointer;transition:all .2s ease;color:var(--text-primary)}.sticker-manager-container .sticker-manager-content .delete-manage-section .control-bar .selection-controls button:hover{background:var(--ultra-light-blue);border-color:var(--primary-blue)}.sticker-manager-container .sticker-manager-content .delete-manage-section .control-bar .delete-selected-btn{padding:.5rem .75rem;background:#e74c3c;color:#fff;border:none;border-radius:var(--button-border-radius);font-size:.85rem;cursor:pointer;transition:all .2s ease}.sticker-manager-container .sticker-manager-content .delete-manage-section .control-bar .delete-selected-btn:hover{background:#c0392b}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container{max-height:400px;overflow-y:auto;border:1px solid var(--border-color);border-radius:var(--element-border-radius);padding:1rem;background:var(--input-bg)}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:1rem}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .sticker-item{display:flex;flex-direction:column;align-items:center;padding:.75rem;border:1px solid var(--border-color);border-radius:var(--element-border-radius);background:#fff;transition:all .2s ease;position:relative}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .sticker-item:hover{border-color:var(--primary-blue);box-shadow:0 2px 8px rgba(114,173,243,.2)}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .sticker-item:has(.sticker-checkbox:checked){border:2px solid var(--checkbox-border-checked);box-shadow:0 0 0 2px var(--shadow-color-rgba);background:var(--checkbox-hover-bg)}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .sticker-item:has(.sticker-checkbox:checked) .sticker-label{color:var(--checkbox-border-checked);font-weight:600}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .sticker-item:has(.sticker-checkbox:checked) .sticker-preview{opacity:.8}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .sticker-item .sticker-checkbox{position:absolute;opacity:0;width:0;height:0;pointer-events:none}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .sticker-item .sticker-checkbox-button{position:absolute;top:.5rem;right:.5rem;width:1.25rem;height:1.25rem;border:1px solid var(--checkbox-border-unchecked);border-radius:var(--small-border-radius);background:var(--checkbox-bg-unchecked);cursor:pointer;transition:all .2s ease;z-index:10}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .sticker-item .sticker-checkbox-button.checked{border:2px solid var(--checkbox-border-checked)}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .sticker-item .sticker-checkbox-button.checked::after{content:"âœ“";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:.7rem;font-weight:bold;color:var(--checkbox-border-checked)}@media (hover:hover){.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .sticker-item .sticker-checkbox-button:hover{border-color:var(--checkbox-border-checked);background:var(--checkbox-hover-bg)}}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .sticker-item .sticker-preview{width:60px;height:60px;object-fit:contain;margin-bottom:.5rem}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .sticker-item .sticker-label{font-size:.8rem;color:var(--text-secondary);text-align:center;word-break:break-all;line-height:1.2}.sticker-manager-container .sticker-manager-content .delete-manage-section .sticker-list-container .sticker-grid .no-stickers-msg{grid-column:1/-1;text-align:center;color:var(--text-secondary);padding:2rem;font-style:italic}.sticker-manager-container .sticker-manager-footer{display:flex;border-top:1px solid var(--border-color)}.sticker-manager-container .sticker-manager-footer .dialog-button{flex:1;padding:.875rem;border:none;background:rgba(0,0,0,0);font-size:.95rem;font-weight:500;cursor:pointer;transition:background-color .2s ease;color:var(--primary-blue)}.sticker-manager-container .sticker-manager-footer .dialog-button:hover{background-color:var(--ultra-light-blue)}.sticker-manager-container .sticker-manager-footer .dialog-button:active{background-color:var(--soft-blue)}.scrollable-text-dialog{width:85%;max-width:18rem;max-height:70vh}.scrollable-text-dialog .dialog-header{padding:1.2rem 1rem 1rem;text-align:center;border-bottom:1px solid var(--border-color);background:var(--header-bg)}.scrollable-text-dialog .dialog-header h3{margin:0;font-size:1.1rem;font-weight:600;color:var(--text-primary);letter-spacing:.3px}.scrollable-text-dialog .dialog-body.scrollable-content{max-height:50vh;overflow-y:auto;padding:1.25rem 1rem;color:var(--text-primary);font-size:.9rem;line-height:1.5;background:rgba(0,0,0,0)}.scrollable-text-dialog .dialog-body.scrollable-content .scrollable-text{margin:0;padding:0;font-family:"Consolas","Monaco","Courier New",monospace;font-size:.8rem;line-height:1.4;white-space:pre-wrap;word-wrap:break-word;color:var(--text-primary);background:rgba(0,0,0,0);border:none}.scrollable-text-dialog .dialog-footer{display:flex;border-top:1px solid var(--border-color)}.scrollable-text-dialog .dialog-footer .dialog-button{flex:1;padding:.875rem;border:none;background:rgba(0,0,0,0);font-size:.95rem;font-weight:500;cursor:pointer;transition:background-color .2s ease;color:var(--primary-blue)}.scrollable-text-dialog .dialog-footer .dialog-button:hover{background:var(--ultra-light-blue)}.scrollable-text-dialog .dialog-footer .dialog-button:active{background:var(--light-blue)}.scrollable-text-dialog .dialog-footer .dialog-button:not(:last-child){border-right:1px solid var(--border-color)}.scrollable-text-dialog .dialog-footer .dialog-button:first-child{border-bottom-left-radius:1rem}.scrollable-text-dialog .dialog-footer .dialog-button:last-child{border-bottom-right-radius:1rem}.scrollable-text-dialog .dialog-footer .dialog-button.copy-btn{color:var(--text-secondary)}.scrollable-text-dialog .dialog-footer .dialog-button.primary-button{color:var(--primary-blue);font-weight:600}input[type=checkbox]{position:absolute;opacity:0;width:0;height:0;pointer-events:none}.checkbox-button{display:inline-flex;align-items:center;justify-content:center;min-height:44px;padding:.75rem 1.25rem;margin:.25rem;border:1px solid var(--checkbox-border-unchecked);border-radius:var(--dialog-border-radius);background:var(--checkbox-bg-unchecked);color:var(--checkbox-text-unchecked);font-size:.9rem;font-weight:500;text-align:center;cursor:pointer;-webkit-user-select:none;user-select:none;transition:all .2s ease;box-shadow:var(--checkbox-shadow-unchecked);position:relative}@media (hover:hover){.checkbox-button:hover{background:var(--checkbox-hover-bg);border-color:var(--primary-blue);transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,.15)}}.checkbox-button.checked{background:var(--checkbox-bg-unchecked);border:2px solid var(--checkbox-border-checked);color:var(--checkbox-border-checked);box-shadow:var(--checkbox-shadow-checked);font-weight:600}@media (hover:hover){.checkbox-button.checked:hover{background:var(--checkbox-hover-bg);border-color:var(--checkbox-border-checked);transform:translateY(-1px);box-shadow:0 6px 16px var(--checkbox-shadow-checked)}}.checkbox-button.checked::after{content:"âœ“";position:absolute;right:.5rem;top:50%;transform:translateY(-50%);font-size:.9rem;font-weight:bold;color:var(--checkbox-border-checked);opacity:1}.checkbox-button:disabled,.checkbox-button.disabled{opacity:.5;cursor:not-allowed;pointer-events:none}.checkbox-button:focus-within{outline:2px solid var(--primary-blue);outline-offset:2px}.checkbox-button.size-small{min-height:36px;padding:.5rem 1rem;font-size:.8rem;border-radius:var(--element-border-radius)}.checkbox-button.size-large{min-height:52px;padding:1rem 1.5rem;font-size:1rem;border-radius:var(--dialog-border-radius)}.checkbox-button.full-width{width:100%;margin:.25rem 0}.checkbox-group{display:flex;flex-wrap:wrap;gap:.5rem;margin:.5rem 0}.checkbox-group.vertical{flex-direction:column}.checkbox-group.vertical .checkbox-button{margin:.25rem 0}.checkbox-group.horizontal{flex-direction:row}.checkbox-group.horizontal .checkbox-button{flex:1;min-width:0}.checkbox-group.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:.5rem}body[data-theme=pink] .checkbox-button{--checkbox-border-checked:#f372ad;--checkbox-text-unchecked:rgb(186,139,162);--checkbox-border-unchecked:#e1cbd5;--checkbox-hover-bg:#fde8f4;--checkbox-shadow-checked:0 4px 12px rgba(226,74,144,0.3)}body[data-theme=white] .checkbox-button{--checkbox-border-checked:#666666;--checkbox-text-unchecked:#333333;--checkbox-border-unchecked:#e0e0e0;--checkbox-hover-bg:#f8f8f8;--checkbox-shadow-checked:0 4px 12px rgba(102,102,102,0.3)}body[data-theme=custom] .checkbox-button{--checkbox-border-checked:var(--primary-blue);--checkbox-text-unchecked:var(--text-primary);--checkbox-border-unchecked:var(--border-color);--checkbox-hover-bg:var(--ultra-light-blue);--checkbox-shadow-checked:0 4px 12px var(--shadow-color-rgba)}body.dark-mode .checkbox-button{--checkbox-bg-unchecked:#374151;--checkbox-border-unchecked:#6b7280;--checkbox-text-unchecked:#d1d5db;--checkbox-hover-bg:#4b5563;--checkbox-shadow-unchecked:0 2px 4px rgba(0,0,0,0.3)}@media (prefers-color-scheme:dark){.checkbox-button{--checkbox-bg-unchecked:#374151;--checkbox-border-unchecked:#6b7280;--checkbox-text-unchecked:#d1d5db;--checkbox-hover-bg:#4b5563;--checkbox-shadow-unchecked:0 2px 4px rgba(0,0,0,0.3)}}body.dark-mode[data-theme=pink] .checkbox-button{--checkbox-bg-unchecked:#4c1d3d;--checkbox-border-unchecked:#8b647a;--checkbox-border-checked:#f372ad;--checkbox-text-unchecked:#f3d5e7;--checkbox-hover-bg:#5d2449}body.dark-mode[data-theme=white] .checkbox-button{--checkbox-bg-unchecked:#2a2a2a;--checkbox-border-unchecked:#3c3c3c;--checkbox-border-checked:#cccccc;--checkbox-text-unchecked:#e0e0e0;--checkbox-hover-bg:#3c3c3c}.sticker-checkbox-button{border:1px solid var(--checkbox-border-unchecked,#e0e0e0);border-radius:var(--element-border-radius);background:var(--checkbox-bg-unchecked,#ffffff);cursor:pointer;transition:all .2s ease;display:inline-block;pointer-events:auto;-webkit-user-select:none;user-select:none}body[data-theme=white] .sticker-checkbox-button{--checkbox-border-checked:#666666;--checkbox-border-unchecked:#e0e0e0;--checkbox-bg-unchecked:#ffffff;--checkbox-hover-bg:#f8f8f8}body[data-theme=pink] .sticker-checkbox-button{--checkbox-border-checked:#f372ad;--checkbox-border-unchecked:#e1cbd5;--checkbox-bg-unchecked:#ffffff;--checkbox-hover-bg:#fde8f4}body[data-theme=custom] .sticker-checkbox-button{--checkbox-border-checked:var(--primary-blue);--checkbox-border-unchecked:var(--border-color);--checkbox-bg-unchecked:#ffffff;--checkbox-hover-bg:var(--ultra-light-blue)}.sticker-checkbox-button.checked{border:2px solid var(--checkbox-border-checked,#007aff);background:var(--checkbox-bg-unchecked,#ffffff)}.sticker-checkbox-button.checked::after{content:"âœ“";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:.75rem;font-weight:bold;color:var(--checkbox-border-checked,#007aff)}@media (hover:hover){.sticker-checkbox-button:hover{border-color:var(--checkbox-border-checked);background:var(--checkbox-hover-bg)}}.feature-item:has(.sticker-checkbox:checked),.sticker-item:has(.sticker-checkbox:checked){border-color:var(--checkbox-border-checked);box-shadow:0 0 0 2px var(--shadow-color-rgba);background:var(--checkbox-hover-bg)}.feature-item:has(.sticker-checkbox:checked) .feature-label,.feature-item:has(.sticker-checkbox:checked) .sticker-label,.sticker-item:has(.sticker-checkbox:checked) .feature-label,.sticker-item:has(.sticker-checkbox:checked) .sticker-label{color:var(--checkbox-border-checked)}@media (max-width:768px){.checkbox-button{min-height:48px;padding:.875rem 1.5rem;font-size:.95rem}.checkbox-group.horizontal{flex-direction:column}.checkbox-group.horizontal .checkbox-button{width:100%}.sticker-checkbox-button{width:1.75rem;height:1.75rem;top:.125rem;right:.125rem}}*{box-sizing:border-box}*{transition-timing-function:ease}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:rgba(0,0,0,0)}::-webkit-scrollbar-thumb{background:var(--border-color);border-radius:2px}::-webkit-scrollbar-thumb:hover{background:var(--text-secondary)}.wechat-body::-webkit-scrollbar,.moments-body::-webkit-scrollbar,.settings-body::-webkit-scrollbar,.panel-view::-webkit-scrollbar,.app-screen::-webkit-scrollbar,.file-content::-webkit-scrollbar,.message-bubble::-webkit-scrollbar,.voice-text-content::-webkit-scrollbar,.image-desc-content::-webkit-scrollbar,.event-description::-webkit-scrollbar,.recall-content::-webkit-scrollbar{display:none}.wechat-body,.moments-body,.settings-body,.panel-view,.app-screen,.file-content,.message-bubble,.voice-text-content,.image-desc-content,.event-description,.recall-content{scrollbar-width:none}::selection{background:var(--primary-blue);color:#fff}::-moz-selection{background:var(--primary-blue);color:#fff}:focus{outline:none}.no-select{-webkit-user-select:none;user-select:none}@media (max-width:360px){body{padding:.5rem}.phone-frame{max-width:100%;width:100%}.wechat-body,.settings-body,.moments-body,.app-screen{-webkit-overflow-scrolling:touch}input,textarea{font-size:16px}}

/*# sourceMappingURL=main.css.map*/</style></head><body><div class="phone-frame"><div class="phone-screen"><div id="delete-mode-trigger"></div><div id="hidden-send-trigger"></div><div class="phone-status-bar"><div class="status-left"><span id="current-time">00:00</span> <i class="fas fa-moon moon-icon"></i></div><div class="status-right"><div class="signal-bars"><i class="fas fa-signal"></i></div><i class="fas fa-wifi wifi-icon"></i> <i class="fas fa-battery-three-quarters battery-icon"></i></div></div><div class="dynamic-island"></div><div class="app-view app-screen active" id="app-homescreen"><div class="app-grid"><div class="app-icon" id="app-wechat"><div class="icon-image icon-wechat"><i class="fab fa-weixin"></i></div><span class="app-name">WeChat</span></div><div class="app-icon" id="app-settings"><div class="icon-image icon-settings"><i class="fas fa-cog"></i></div><span class="app-name">è®¾ç½®</span></div></div></div><div class="app-view" id="wechat-home"><header class="wechat-home-header"><i class="fas fa-chevron-left wechat-home-back" id="wechat-home-back"></i><div class="wechat-home-title">å¾®ä¿¡</div><div class="wechat-home-actions"><i class="fas fa-search"></i> <i class="fas fa-plus"></i></div></header><main class="wechat-home-body"><section class="wechat-home-section active" id="wechat-tab-conv"><ul id="conversation-list" class="conversation-list"><li class="conv-item placeholder">æš‚æ— ä¼šè¯ï¼Œåç»­å±•ç¤ºå•èŠ/ç¾¤èŠ/å…¬ä¼—å·</li></ul></section><section class="wechat-home-section" id="wechat-tab-contacts"><div class="shortcut-item">æ·»åŠ æœ‹å‹ï¼ˆå ä½ï¼‰</div><div class="shortcut-item">ç¾¤èŠåˆ—è¡¨ï¼ˆå ä½ï¼‰</div><ul id="contacts-list" class="contacts-list"><li class="contact-item placeholder">è”ç³»äººåˆ—è¡¨å ä½</li></ul></section><section class="wechat-home-section" id="wechat-tab-discover"><p class="placeholder">å‘ç°/æœ‹å‹åœˆå·²åœ¨ç°æœ‰ç•Œé¢å®ç°ï¼Œç‚¹å‡»å³ä¸Šè§’æˆ–åç»­å…¥å£è¿›å…¥ã€‚</p></section><section class="wechat-home-section" id="wechat-tab-me"><div class="profile-card"><div class="profile-avatar" id="profile-avatar"></div><div class="profile-info"><div class="profile-name" id="profile-name">ç”¨æˆ·æ˜µç§°</div><div class="profile-signature" id="profile-signature">ä¸ªæ€§ç­¾åå ä½</div></div></div></section></main><nav class="wechat-home-tabbar"><button class="wechat-tab-btn active" data-target="conv"><span class="tab-icon tab-icon-wechat"></span> <span class="tab-label">å¾®ä¿¡</span></button> <button class="wechat-tab-btn" data-target="contacts"><span class="tab-icon tab-icon-contacts"></span> <span class="tab-label">é€šè®¯å½•</span></button> <button class="wechat-tab-btn" data-target="discover"><span class="tab-icon tab-icon-discover"></span> <span class="tab-label">å‘ç°</span></button> <button class="wechat-tab-btn" data-target="me"><span class="tab-icon tab-icon-me"></span> <span class="tab-label">æˆ‘</span></button></nav></div><div class="app-view" id="wechat-view"><div class="wechat-header"><i class="fas fa-chevron-left back-btn" id="wechat-back-btn-dummy"></i> <span class="contact-name" id="contact-name-header">Character</span> <i class="fas fa-ellipsis-h options-btn" id="wechat-options-btn"><div class="notification-dot" id="moments-notification" style="display:none"></div></i></div><div class="wechat-body" id="wechat-body"></div><div class="wechat-input-area"><footer class="wechat-footer"><i id="microphone-btn" class="fas fa-microphone footer-icon"></i> <input id="wechat-input-field" class="text-input" placeholder="å‘é€ä¿¡æ¯" autocomplete="off" autocapitalize="off" spellcheck="false"/> <i id="smile-btn" class="far fa-smile footer-icon"></i> <i id="plus-btn" class="fas fa-plus-circle footer-icon"></i> <button id="send-btn" class="send-btn"><i class="fas fa-paper-plane"></i></button></footer><div id="panel-container" class="panel-container"><div id="sticker-panel" class="panel-view"><div id="sticker-grid" class="features-grid"></div></div><div id="char-sticker-panel" class="panel-view"><div id="char-sticker-grid" class="features-grid"></div></div><div id="plus-panel" class="panel-view"><div id="plus-grid" class="features-grid"></div></div></div></div></div><div id="settings-view" class="app-view"><header class="settings-header"><i class="fas fa-chevron-left back-btn" id="settings-back-btn"></i> <span class="title">å…³äº</span></header><main class="settings-body"><div class="settings-card"><p>æœ¬åŒå±‚æ‰‹æœº<span class="highlight">ã€å…è´¹ã€‘</span>å‘å¸ƒäºdiscordçš„å°¾å·´é•‡ç¤¾åŒºå’Œæ—…ç¨‹ç¤¾åŒºï¼Œä½œè€…ï¼š<span class="highlight">æš´åŠ›ç¾å­¦BLMX</span>ï¼Œç‚¹å‡»å³å¯è·³è½¬åˆ°ç¤¾åŒº <a href="https://discord.com/channels/1379304008157499423/1388180976873766973" target="_blank">https://discord.com/...</a>ã€‚<a href="https://discord.com/channels/1291925535324110879/1388182155707814009" target="_blank">https://discord.com/...</a>ã€‚</p><p>å¦‚æœä½ æ˜¯é€šè¿‡ä»»ä½•<span class="highlight">ä»˜è´¹é€”å¾„</span>è·å–ï¼Œè¯·å¸¦ç€è´­ä¹°è®°å½•æ¥æ‰¾ä½œè€…ï¼Œ<span class="highlight">é‡é‡æœ‰èµ</span>ã€‚æŠµåˆ¶ä»»ä½•çªƒå–åˆ›ä½œè€…åŠ³åŠ¨æˆæœçš„å•†ä¸šåŒ–è¡Œä¸ºï¼Œä»ä½ æˆ‘åšèµ·TvT</p><p><span class="highlight">ç¦æ­¢</span>åœ¨é…’é¦†ä»¥å¤–çš„å¹³å°ä½¿ç”¨ï¼<span class="highlight">ç¦æ­¢</span>æœªç»æˆæƒçš„äºŒä¼ äºŒæ”¹ï¼<span class="highlight">ç¦æ­¢</span>ä»»ä½•è¡Œä¸ºçš„å€’å–å’Œå•†ä¸šåŒ–è¡Œä¸ºï¼</p><p>åç»­æ›´æ–°å†…å®¹ä¹Ÿä¼šå‘åœ¨discordçš„å°¾å·´é•‡ç¤¾åŒºå’Œæ—…ç¨‹ç¤¾åŒºï¼Œæœ‰é—®é¢˜æ¬¢è¿æ¥æé—®å“¦ï¼æœ‰æƒ³ç©çš„åŠŸèƒ½ã€æƒ³æå‡ºçš„å»ºè®®ä¹Ÿå¯ä»¥åœ¨å¸–å­ä¸‹è¯„è®ºã€‚</p></div><div class="settings-card" style="margin-top:1rem;padding:0"><ul style="list-style:none;margin:0;padding:0"><li style="border-bottom:1px solid #efefef"><a href="#" id="change-chat-wallpaper-btn" style="text-decoration:none;color:#8ba2ba;display:flex;justify-content:space-between;align-items:center;padding:1rem"><span>æ›´æ¢èŠå¤©å£çº¸</span> <i class="fas fa-chevron-right"></i></a></li><li style="border-bottom:1px solid #efefef"><a href="#" id="change-home-wallpaper-btn" style="text-decoration:none;color:#8ba2ba;display:flex;justify-content:space-between;align-items:center;padding:1rem"><span>æ›´æ¢ä¸»å±å¹•å£çº¸</span> <i class="fas fa-chevron-right"></i></a></li><li><a href="#" id="change-settings-wallpaper-btn" style="text-decoration:none;color:#8ba2ba;display:flex;justify-content:space-between;align-items:center;padding:1rem"><span>æ›´æ¢è®¾ç½®å£çº¸</span> <i class="fas fa-chevron-right"></i></a></li></ul></div><div class="settings-card" style="margin-top:1rem;padding:0"><div style="padding:1rem;border-bottom:1px solid #efefef"><h3 style="margin:0;font-size:1rem;color:var(--text-primary)">ä¸»é¢˜é…è‰²</h3></div><div class="theme-options" style="padding:1rem;display:flex;flex-wrap:wrap;gap:1rem;justify-content:space-between"></div><div style="padding:1rem;border-top:1px solid #efefef"><button id="custom-theme-btn" style="width:100%;padding:.75rem;background:var(--primary-blue);color:#fff;border:none;border-radius:.5rem;font-weight:500;cursor:pointer">è‡ªå®šä¹‰ä¸»é¢˜</button></div></div><div class="settings-card" style="margin-top:1rem;padding:0"><div style="padding:1rem;border-bottom:1px solid #efefef"><h3 style="margin:0;font-size:1rem;color:var(--text-primary)">ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3></div><div style="padding:1rem"><div style="margin-bottom:.75rem"><h4 style="margin:0 0 .5rem 0;font-size:.9rem;color:var(--text-primary);font-weight:600">ğŸ“± æ¶ˆæ¯æ’¤å›åŠŸèƒ½</h4><p style="margin:0;font-size:.85rem;color:var(--text-secondary);line-height:1.4"><strong>é•¿æŒ‰æ’¤å›ï¼š</strong>é•¿æŒ‰è‡ªå·±å‘é€çš„æ¶ˆæ¯æ°”æ³¡600æ¯«ç§’å³å¯æ’¤å›<br/><strong>åŒå‡»æ’¤å›ï¼š</strong>å¿«é€ŸåŒå‡»è‡ªå·±çš„æ¶ˆæ¯æ°”æ³¡ä¹Ÿå¯ä»¥æ’¤å›ï¼ˆå…¨å±æ¨¡å¼æ¨èï¼‰<br/><span style="color:var(--primary-blue)">ğŸ’¡ æç¤ºï¼šå…¨å±æ¨¡å¼ä¸‹é•¿æŒ‰å¯èƒ½å¤±æ•ˆï¼Œå»ºè®®ä½¿ç”¨åŒå‡»æ’¤å›</span></p></div><div style="margin-bottom:.75rem"><h4 style="margin:0 0 .5rem 0;font-size:.9rem;color:var(--text-primary);font-weight:600">ğŸ¨ ä¸»é¢˜è‡ªå®šä¹‰</h4><p style="margin:0;font-size:.85rem;color:var(--text-secondary);line-height:1.4">é€‰æ‹©é¢„è®¾ä¸»é¢˜åç‚¹å‡»"è‡ªå®šä¹‰ä¸»é¢˜"æŒ‰é’®ï¼Œå¯ä»¥åŸºäºå½“å‰ä¸»é¢˜è¿›è¡Œä¸ªæ€§åŒ–è°ƒæ•´</p></div></div></div><div class="settings-card" style="margin-top:1rem;padding:1rem"><p style="font-weight:500;margin:0 0 .75rem .25rem;color:var(--text-primary);font-size:.9em">è°ƒè¯•å·¥å…·</p><ul style="list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:.5rem"><li><a href="#" id="show-last-ai-response-btn" style="text-decoration:none;display:block;text-align:center;background-color:#eef4fd;padding:.6rem 1rem;border-radius:.6rem;color:var(--text-primary);font-weight:500"><span>æ˜¾ç¤ºAIæœ€æ–°åŸå§‹å›å¤</span></a></li><li><a href="#" id="show-last-sent-prompt-btn" style="text-decoration:none;display:block;text-align:center;background-color:#eef4fd;padding:.6rem 1rem;border-radius:.6rem;color:var(--text-primary);font-weight:500"><span>æ˜¾ç¤ºå‘é€ç»™AIçš„æç¤º</span></a></li></ul></div><div class="settings-card" style="margin-top:1rem;padding:1rem"><p style="font-weight:500;margin:0 0 .75rem .25rem;color:var(--text-primary);font-size:.9em">æ‰‹æœºå°ºå¯¸è°ƒæ•´</p><div style="display:flex;flex-direction:column;gap:.75rem"><div style="display:flex;justify-content:space-between;align-items:center;gap:.5rem"><button id="phone-size-default" class="phone-size-btn phone-size-active"><span class="size-icon" style="height:24px"></span> <span class="size-label">é»˜è®¤å°ºå¯¸</span></button> <button id="phone-size-medium" class="phone-size-btn"><span class="size-icon" style="height:20px"></span> <span class="size-label">ä¸­ç­‰å°ºå¯¸</span></button> <button id="phone-size-small" class="phone-size-btn"><span class="size-icon" style="height:16px"></span> <span class="size-label">å°å°ºå¯¸</span></button></div><div style="font-size:.8em;color:var(--text-secondary);text-align:center">è°ƒæ•´æ‰‹æœºå±å¹•çš„é«˜åº¦å¤§å°</div></div></div><div class="settings-card" style="margin-top:1rem;padding:1rem"><p style="font-weight:500;margin:0 0 .75rem .25rem;color:var(--text-primary);font-size:.9em">å…¨å±æ¨¡å¼æ‰‹æœºå¤§å°</p><div style="display:flex;flex-direction:column;gap:.75rem"><div style="display:flex;flex-direction:column;gap:.5rem"><div style="display:flex;justify-content:space-between;align-items:center"><span style="font-size:.9em;color:var(--text-secondary)">å°</span> <input type="range" id="fullscreen-size-slider" min="50" max="200" step="5" value="100" style="flex-grow:1;margin:0 10px;accent-color:var(--primary-blue)"/> <span style="font-size:.9em;color:var(--text-secondary)">å¤§</span></div><div style="display:flex;justify-content:center;align-items:center;gap:.5rem"><input type="number" id="fullscreen-size-input" value="100" min="50" max="200" step="5" style="width:70px;padding:.25rem .5rem;border:1px solid var(--border-color);border-radius:var(--element-border-radius);text-align:center;font-size:.85em;background:var(--settings-card-bg-color);color:var(--text-primary)"/> <span style="font-size:.85em;color:var(--text-secondary)">%</span></div></div><div style="display:flex;justify-content:space-between;gap:.5rem;margin-top:.5rem"><button id="fullscreen-size-default" class="fullscreen-size-btn fullscreen-size-active"><span class="fullscreen-size-icon">ğŸ“²</span> <span class="fullscreen-size-label">é»˜è®¤ (100%)</span></button> <button id="fullscreen-size-large" class="fullscreen-size-btn"><span class="fullscreen-size-icon">ğŸ“º</span> <span class="fullscreen-size-label">å¤§ (130%)</span></button> <button id="fullscreen-size-xlarge" class="fullscreen-size-btn"><span class="fullscreen-size-icon">ğŸ–¥ï¸</span> <span class="fullscreen-size-label">è¶…å¤§ (160%)</span></button></div><div style="font-size:.8em;color:var(--text-secondary);text-align:center">è°ƒæ•´å…¨å±æ¨¡å¼ä¸‹æ‰‹æœºçš„æ˜¾ç¤ºå¤§å°</div></div></div><div class="settings-card" style="margin-top:1rem;padding:1rem"><p style="font-weight:500;margin:0 0 .75rem .25rem;color:var(--text-primary);font-size:.9em">å­—ä½“è®¾ç½®</p><div style="display:flex;flex-direction:column;gap:.75rem"><div style="display:flex;justify-content:space-between;align-items:center;gap:.5rem"><button id="font-default" class="font-btn font-active"><span class="font-icon">ğŸ¨</span> <span class="font-label">è‡ªå®šä¹‰å­—ä½“</span></button> <button id="font-system" class="font-btn"><span class="font-icon">ğŸ“±</span> <span class="font-label">ç³»ç»Ÿå­—ä½“</span></button></div><div style="font-size:.8rem;color:var(--text-secondary);text-align:center;margin-top:.25rem">é€‰æ‹©åº”ç”¨ä½¿ç”¨çš„å­—ä½“æ ·å¼</div></div></div><div class="settings-card" style="margin-top:1rem;padding:1rem"><p style="font-weight:500;margin:0 0 .75rem .25rem;color:var(--text-primary);font-size:.9em">è¡¨æƒ…åŒ…å¤§å°è®¾ç½®</p><div style="display:flex;flex-direction:column;gap:.75rem"><div style="display:flex;flex-direction:column;gap:.5rem"><div style="display:flex;justify-content:space-between;align-items:center"><span style="font-size:.9em;color:var(--text-secondary)">å°</span> <input type="range" id="sticker-size-slider" min="40" step="5" max="200" value="120" style="flex-grow:1;margin:0 10px;accent-color:var(--primary-blue)"/> <span style="font-size:.9em;color:var(--text-secondary)">å¤§</span></div><div style="display:flex;justify-content:center;align-items:center;gap:.5rem"><input type="number" id="sticker-size-input" value="120" min="40" max="200" step="5" style="width:70px;padding:.25rem .5rem;border:1px solid var(--border-color);border-radius:var(--element-border-radius);text-align:center;font-size:.85em;background:var(--settings-card-bg-color);color:var(--text-primary)"/> <span style="font-size:.9em;color:var(--text-secondary)">åƒç´ </span></div></div><div style="display:flex;justify-content:space-between;gap:.5rem;margin-top:.5rem"><button id="sticker-size-small" class="sticker-size-btn"><span class="sticker-size-icon" style="height:16px"></span> <span class="sticker-size-label">å° (80px)</span></button> <button id="sticker-size-medium" class="sticker-size-btn sticker-size-active"><span class="sticker-size-icon" style="height:20px"></span> <span class="sticker-size-label">ä¸­ (120px)</span></button></div><div style="font-size:.8em;color:var(--text-secondary);text-align:center">è°ƒæ•´èŠå¤©ä¸­è¡¨æƒ…åŒ…çš„æ˜¾ç¤ºå¤§å°</div></div></div></main></div><div id="moments-view" class="app-view"><header class="moments-header"><i class="fas fa-chevron-left header-action" id="moments-back-btn"></i> <span class="title">æœ‹å‹åœˆ</span> <i class="fas fa-camera header-action" id="post-moment-btn"></i></header><main class="moments-body"><div class="moments-feed-header"><img src="https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/wallpaper/ç™½è‰²_1.jpg" alt="æœ‹å‹åœˆå°é¢" class="moments-cover-photo" id="moments-cover-photo"/><div class="moments-user-info"><span class="moments-user-name" id="moments-user-name">ç”¨æˆ·å</span> <img src="https://gitgud.io/lolodesu/lolobabytutorial/-/raw/master/lologame/ç´ æ/å¤´åƒ/é»˜è®¤å¤´åƒ.jpg" alt="ç”¨æˆ·å¤´åƒ" class="moments-user-avatar" id="moments-user-avatar"/></div><div class="user-signature" id="user-signature-display">è¿™é‡Œæ˜¯ä¸ªæ€§ç­¾å...</div></div><ul class="moments-feed-list" id="moments-feed-list"></ul></main></div></div></div><input type="file" id="image-upload-input" accept="image/*" style="display:none"/><div id="theme-editor-modal" class="modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:1000;overflow-y:auto"><div class="modal-content" style="background-color:#fff;margin:10% auto;padding:20px;width:80%;max-width:500px;border-radius:10px;box-shadow:0 4px 20px rgba(0,0,0,.2)"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px"><h2 style="margin:0;color:var(--text-primary);font-size:1.2rem">è‡ªå®šä¹‰ä¸»é¢˜</h2><button id="close-theme-editor" style="background:0 0;border:none;font-size:1.5rem;cursor:pointer;color:var(--text-secondary)">&times;</button></div><div style="margin-bottom:15px"><label style="display:block;margin-bottom:5px;color:var(--text-primary);font-weight:500">ä¸»é¢˜åç§°</label> <input id="theme-name-input" style="width:100%;padding:8px;border:1px solid var(--border-color);border-radius:5px;box-sizing:border-box" placeholder="æˆ‘çš„è‡ªå®šä¹‰ä¸»é¢˜"/></div><div style="max-height:400px;overflow-y:auto;padding-right:10px"><div style="margin-bottom:20px"><h3 style="margin:0 0 10px 0;color:var(--text-primary);font-size:1rem">ä¸»é¢˜è‰²</h3><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px"><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">ä¸»è‰²è°ƒ</label> <input type="color" id="primary-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">æ¬¡è¦å¼ºè°ƒè‰²</label> <input type="color" id="light-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div></div><div style="font-size:.8rem;color:var(--text-secondary);margin-top:5px">ä¸»é¢˜è‰²ç”¨äºæŒ‰é’®ã€å›¾æ ‡ã€é“¾æ¥ç­‰äº¤äº’å…ƒç´ </div></div><div style="margin-bottom:20px"><h3 style="margin:0 0 10px 0;color:var(--text-primary);font-size:1rem">èƒŒæ™¯è‰²</h3><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px"><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">åº”ç”¨èƒŒæ™¯è‰²</label> <input type="color" id="ultra-light-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">å¡ç‰‡èƒŒæ™¯è‰²</label> <input type="color" id="deep-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div></div></div><div style="margin-bottom:20px"><h3 style="margin:0 0 10px 0;color:var(--text-primary);font-size:1rem">æ–‡å­—é¢œè‰²</h3><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px"><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">ä¸»è¦æ–‡å­—</label> <input type="color" id="text-primary-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">æ¬¡è¦æ–‡å­—</label> <input type="color" id="text-secondary-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div></div></div><div style="margin-bottom:20px"><h3 style="margin:0 0 10px 0;color:var(--text-primary);font-size:1rem">è¾¹æ¡†ä¸é˜´å½±</h3><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px"><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">è¾¹æ¡†é¢œè‰²</label> <input type="color" id="border-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">é˜´å½±é¢œè‰²</label> <input type="color" id="shadow-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div></div></div><div style="margin-bottom:20px"><h3 style="margin:0 0 10px 0;color:var(--text-primary);font-size:1rem">çŠ¶æ€æ ä¸çµåŠ¨å²›</h3><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px"><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">çŠ¶æ€æ é¢œè‰²</label> <input type="color" id="status-bar-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">çµåŠ¨å²›é¢œè‰²</label> <input type="color" id="dynamic-island-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div></div></div><div style="margin-bottom:20px"><h3 style="margin:0 0 10px 0;color:var(--text-primary);font-size:1rem">æˆ‘çš„æ¶ˆæ¯æ°”æ³¡</h3><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px"><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">èƒŒæ™¯é¢œè‰²</label> <input type="color" id="bubble-me-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">æ–‡å­—é¢œè‰²</label> <input type="color" id="bubble-me-text-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div></div></div><div style="margin-bottom:20px"><h3 style="margin:0 0 10px 0;color:var(--text-primary);font-size:1rem">AIæ¶ˆæ¯æ°”æ³¡</h3><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px"><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">èƒŒæ™¯é¢œè‰²</label> <input type="color" id="bubble-them-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div><div><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">æ–‡å­—é¢œè‰²</label> <input type="color" id="bubble-them-text-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div></div></div><div style="margin-bottom:20px"><h3 style="margin:0 0 10px 0;color:var(--text-primary);font-size:1rem">æ‰‹æœºè¾¹æ¡†</h3><div style="display:flex;gap:10px;margin-bottom:10px"><div style="flex:1"><label style="display:block;margin-bottom:5px;font-size:.9rem;color:var(--text-secondary)">è¾¹æ¡†é¢œè‰²</label> <input type="color" id="phone-frame-color" style="width:100%;height:40px;border:none;border-radius:5px;cursor:pointer"/></div></div></div><div style="margin-bottom:20px"><h3 style="margin:0 0 10px 0;color:var(--text-primary);font-size:1rem">ä¸»é¢˜æ¨¡å¼</h3><div style="display:flex;align-items:center;position:relative"><input type="checkbox" id="dark-mode-toggle" class="sticker-checkbox" style="position:absolute;opacity:0;width:0;height:0;pointer-events:none"/><div class="sticker-checkbox-button" id="dark-mode-checkbox-button" style="position:relative;width:18px;height:18px;margin-left:2px;margin-right:12px;display:block;border:1px solid #ccc;background:#fff;cursor:pointer"></div><label for="dark-mode-toggle" style="color:var(--text-primary);font-size:.9rem">å¯ç”¨å¤œé—´æ¨¡å¼</label></div><div style="font-size:.8rem;color:var(--text-secondary);margin-top:5px">å¤œé—´æ¨¡å¼ä¼šå°†åº”ç”¨èƒŒæ™¯ã€è®¾ç½®é¡µé¢å’Œå¡ç‰‡ç­‰å…ƒç´ å˜ä¸ºæ·±è‰²</div></div><div style="margin-bottom:20px"><h3 style="margin:0 0 10px 0;color:var(--text-primary);font-size:1rem">å›¾æ ‡æ ·å¼</h3><div style="display:flex;align-items:center;position:relative"><input type="checkbox" id="single-color-icons-toggle" class="sticker-checkbox" style="position:absolute;opacity:0;width:0;height:0;pointer-events:none"/><div class="sticker-checkbox-button" id="single-color-icons-checkbox-button" style="position:relative;width:18px;height:18px;margin-left:2px;margin-right:12px;display:block;border:1px solid #ccc;background:#fff;cursor:pointer"></div><label for="single-color-icons-toggle" style="color:var(--text-primary);font-size:.9rem">ä½¿ç”¨å•ä¸€é¢œè‰²å›¾æ ‡</label></div><div style="font-size:.8rem;color:var(--text-secondary);margin-top:5px">å¯ç”¨åï¼Œå¾®ä¿¡å›¾æ ‡å’Œè®¾ç½®å›¾æ ‡å°†ä½¿ç”¨ä¸»é¢˜è‰²ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ç»¿è‰²å’Œç°è‰²</div></div></div><div style="display:flex;gap:10px;justify-content:center;margin-top:15px;padding:15px;background:#f8f9fa;border-radius:8px"><button id="import-theme-btn" style="padding:10px 20px;background:var(--primary-blue);color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:500" title="å¯¼å…¥JSONä¸»é¢˜æ–‡ä»¶">å¯¼å…¥</button> <button id="export-json-btn" style="padding:10px 20px;background:var(--primary-blue);color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:500" title="å¯¼å‡ºä¸ºJSONæ ¼å¼">å¯¼å‡º</button></div><div style="display:flex;justify-content:space-between;margin-top:20px"><button id="reset-theme-btn" style="padding:10px 15px;background:#f1f5f9;color:var(--text-primary);border:none;border-radius:5px;cursor:pointer;font-weight:500">é‡ç½®</button> <button id="save-theme-btn" style="padding:10px 20px;background:var(--primary-blue);color:#fff;border:none;border-radius:5px;cursor:pointer;font-weight:500">ä¿å­˜ä¸»é¢˜</button></div></div></div></body></html>