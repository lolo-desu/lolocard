<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>回合制战斗界面</title><style>.battle-container{font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;background-color:#252526;color:#e0e0e0;padding:10px;border:1px solid #404040;border-radius:4px;max-width:600px;margin:auto;display:flex;flex-direction:column;gap:10px}.battle-container .battle-scene{display:flex;justify-content:space-around;gap:10px}.battle-container .battle-scene .character-area{flex:1;padding:10px;border:1px solid #404040;border-radius:4px;min-height:100px}.battle-container .battle-scene .character-info h3{margin-top:0;margin-bottom:5px;font-size:16.8px}.battle-container .battle-scene .character-info .status-bar{width:100%;background-color:rgb(89.5,89.5,89.5);border-radius:2px;margin-bottom:5px;height:10px;overflow:hidden}.battle-container .battle-scene .character-info .status-bar .bar-fill{height:100%;transition:width .3s ease-in-out}.battle-container .battle-scene .character-info .status-bar.hp .bar-fill{background-color:#4caf50}.battle-container .battle-scene .character-info .status-bar.mp .bar-fill{background-color:#2196f3}.battle-container .battle-scene .character-info .status-effects{font-size:12.6px;color:#b0b0b0}.battle-container .battle-log-container{border:1px solid #404040;border-radius:4px;padding:10px;height:150px;overflow-y:auto;background-color:rgb(49.58,49.58,50.92)}.battle-container .battle-log-container .battle-log .log-entry{padding:5px 0;border-bottom:1px dashed rgb(51.25,51.25,51.25)}.battle-container .battle-log-container .battle-log .log-entry:last-child{border-bottom:none}.battle-container .battle-log-container .battle-log .log-entry.player-action{color:#64b5f6}.battle-container .battle-log-container .battle-log .log-entry.enemy-action{color:#e57373}.battle-container .battle-log-container .battle-log .log-entry.system-message{color:#ffd54f;font-style:italic}.battle-container .battle-log-container .battle-log .log-entry .damage{color:#f44336;font-weight:bold}.battle-container .battle-log-container .battle-log .log-entry .heal{color:#81c784;font-weight:bold}.battle-container .battle-log-container .battle-log .log-entry .critical{color:gold;font-weight:bold;animation:flash .5s infinite alternate}.battle-container .battle-controls{display:flex;flex-direction:column;gap:10px}.battle-container .battle-controls .skill-list{display:flex;flex-wrap:wrap;gap:5px}.battle-container .battle-controls .action-buttons{display:flex;justify-content:center;gap:5px}.battle-container .battle-controls .action-button,.battle-container .battle-controls .skill-button{padding:6.6666666667px 10px;background-color:rgb(62.16,62.16,63.84);border:1px solid #404040;color:#e0e0e0;border-radius:4px;cursor:pointer;transition:background-color .2s ease}.battle-container .battle-controls .action-button:hover,.battle-container .battle-controls .skill-button:hover{background-color:rgb(87.32,87.32,89.68)}.battle-container .battle-controls .action-button:active,.battle-container .battle-controls .skill-button:active{background-color:rgb(24.42,24.42,25.08)}.battle-container .battle-result{padding:10px;text-align:center;border:1px solid #404040;border-radius:4px}.battle-container .battle-result h2{margin-top:0}.battle-container .battle-result #continue-plot-button{padding:6.6666666667px 10px;background-color:#64b5f6;border:1px solid rgb(51.7987804878,157.987804878,243.2012195122);color:#fff;border-radius:4px;cursor:pointer;transition:background-color .2s ease;font-size:15.4px;margin-top:10px}.battle-container .battle-result #continue-plot-button:hover{background-color:rgb(148.2012195122,204.012195122,248.7987804878)}@keyframes flash{0%{opacity:1}50%{opacity:.6}100%{opacity:1}}
</style></head><body><div id="battle-root"><div id="battle-container" class="battle-container"><div class="battle-scene"><div class="character-area player-area"><div class="character-info" id="player-info"></div></div><div class="character-area enemy-area"><div class="character-info" id="enemy-info"></div></div></div><div class="battle-log-container"><div class="battle-log" id="battle-log"></div></div><div class="battle-controls"><div class="skill-list" id="skill-list"></div><div class="action-buttons"><button class="action-button" data-action="attack">攻击</button> <button class="action-button" data-action="defend">防御</button> <button class="action-button" data-action="escape">逃跑</button></div></div><div class="battle-result" id="battle-result" style="display:none"><button id="continue-plot-button">继续剧情</button></div></div></div><script>function t(t,e){const a=$(`#${t}-info`);if(0===a.length)return;const n=e.attributes,i=e.status.map((t=>t.name)).join(', ');a.html(`\n        <h3>${e.name}</h3>\n        <div class="status-bar hp">\n            <div class="bar-fill" style="width: ${n.hp/n.maxHp*100}%;"></div>\n        </div>\n        <span>HP: ${n.hp} / ${n.maxHp}</span>\n        <div class="status-bar mp">\n            <div class="bar-fill" style="width: ${n.mp/n.maxMp*100}%;"></div>\n        </div>\n        <span>MP: ${n.mp} / ${n.maxMp}</span>\n        <div class="status-effects">\n            状态: ${i||'无'}\n        </div>\n    `)}function e(t){const e=$('#battle-log');if(0===e.length)return;let a='log-entry';'system'===t.actionType?a+=' system-message':'player'===t.actorId?a+=' player-action':a+=' enemy-action';let n=`[回合 ${t.turn}] ${t.description}`;t.damageDealt&&(n=n.replace(t.damageDealt.toString(),`<span class="damage">${t.damageDealt}</span>`)),t.healingDone&&(n=n.replace(t.healingDone.toString(),`<span class="heal">${t.healingDone}</span>`)),t.isCritical&&(n=n.replace('暴击','<span class="critical">暴击</span>'));const i=$(`<div class="${a}"></div>`).html(n);e.append(i),e.scrollTop(e[0].scrollHeight)}function a(t){const e=$('#battle-result');0!==e.length&&(e.html(`<h2>${t}</h2><button id="continue-plot-button">继续剧情</button>`),e.show(),$('.battle-controls').hide())}const n=[{id:'sk001',name:'火焰球',description:'造成少量火属性伤害',mpCost:10,type:'attack',targetType:'single',effects:[{type:'damage',value:15}]},{id:'sk002',name:'治疗术',description:'恢复少量HP',mpCost:15,type:'heal',targetType:'single',effects:[{type:'heal',value:20}]},{id:'sk003',name:'英勇打击',description:'造成物理伤害',mpCost:5,type:'attack',targetType:'single',effects:[{type:'damage',value:10}]}],i={id:'player',name:'英雄',type:'player',attributes:{hp:85,maxHp:100,mp:40,maxMp:50,strength:12,defense:8,speed:10,intelligence:9},skills:n,status:[{id:'s001',name:'力量提升',description:'攻击力少量上升',duration:3}]},s={id:'enemy01',name:'史莱姆王',type:'enemy',attributes:{hp:120,maxHp:120,mp:20,maxMp:20,strength:10,defense:10,speed:5,intelligence:3},skills:[],status:[{id:'s002',name:'中毒',description:'每回合损失少量HP',duration:5}]},l=[{turn:1,actorId:'system',actorName:'系统',actionType:'system',description:'战斗开始！史莱姆王出现了！'},{turn:1,actorId:'player',actorName:'英雄',actionType:'skill',skillName:'火焰球',targetId:'enemy01',targetName:'史莱姆王',description:'英雄对史莱姆王使用了火焰球，造成 15 点伤害。',damageDealt:15},{turn:1,actorId:'enemy01',actorName:'史莱姆王',actionType:'attack',targetId:'player',targetName:'英雄',description:'史莱姆王撞向英雄，造成 8 点伤害。',damageDealt:8},{turn:2,actorId:'player',actorName:'英雄',actionType:'attack',targetId:'enemy01',targetName:'史莱姆王',description:'英雄发动了攻击，造成 18 点<span class="critical">暴击</span>伤害！',damageDealt:18,isCritical:!0},{turn:2,actorId:'enemy01',actorName:'史莱姆王',actionType:'system',description:'史莱姆王因为中毒，受到了 5 点伤害。',damageDealt:5},{turn:2,actorId:'player',actorName:'英雄',actionType:'skill',skillName:'治疗术',targetId:'player',targetName:'英雄',description:'英雄对自己使用了治疗术，恢复了 20 点HP。',healingDone:20}];$(document).ready((()=>{t('player',i),t('enemy',s),function(t){const e=$('#skill-list');0!==e.length&&(e.empty(),t.forEach((t=>{const a=$(`<button class="skill-button" data-skill-id="${t.id}">${t.name} (MP: ${t.mpCost})</button>`);e.append(a)})))}(n),l.forEach((t=>e(t))),$('.battle-controls').on('click','.action-button',(function(){e({turn:3,actorId:'player',actorName:'英雄',actionType:$(this).data('action'),description:`英雄选择了 ${$(this).text()}`}),setTimeout((()=>{e({turn:3,actorId:'enemy01',actorName:'史莱姆王',actionType:'attack',targetId:'player',targetName:'英雄',description:'史莱姆王发动了最终一击！',damageDealt:50,isCritical:!0}),Math.random()>.3?a('胜利！'):a('失败...')}),1e3)})),$('.battle-controls').on('click','.skill-button',(function(){const t=$(this).data('skill-id'),i=n.find((e=>e.id===t));if(!i)return;e({turn:3,actorId:'player',actorName:'英雄',actionType:'skill',skillName:i.name,description:`英雄使用了技能：${i.name}`}),setTimeout((()=>{e({turn:3,actorId:'enemy01',actorName:'史莱姆王',actionType:'attack',targetId:'player',targetName:'英雄',description:'史莱姆王发动了反击！',damageDealt:12}),a('战斗结束！')}),1e3)})),$('#battle-result').on('click','#continue-plot-button',(function(){toastr.info('继续剧情...（此处将与SillyTavern交互）'),$('#battle-container').hide()}))})),console.log('回合制战斗系统组件已加载');</script></body></html>