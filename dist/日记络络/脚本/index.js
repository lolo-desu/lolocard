import{waitUntil as e}from'https://testingcf.jsdelivr.net/npm/async-wait-until/+esm';import{createPinia as t,defineStore as n,getActivePinia as o,setActivePinia as a}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';import{klona as r}from'https://testingcf.jsdelivr.net/npm/klona/+esm';import{partialParse as i}from'https://testingcf.jsdelivr.net/npm/openai-partial-json-parser/+esm';import{gsap as s}from'https://testingcf.jsdelivr.net/npm/gsap/+esm';import{SplitText as p}from'https://testingcf.jsdelivr.net/npm/gsap/SplitText/+esm';import'https://testingcf.jsdelivr.net/gh/MagicalAstrogy/MagVarUpdate/artifact/bundle.js';import'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/é…’é¦†åŠ©æ‰‹/ä¸–ç•Œä¹¦å¼ºåˆ¶è‡ªå®šä¹‰æ’åº/index.js';import{registerMvuSchema as l}from'https://testingcf.jsdelivr.net/gh/StageDog/tavern_resource/dist/util/mvu_zod.js';import{compare as c}from'https://testingcf.jsdelivr.net/npm/compare-versions/+esm';var d={324(e,t,n){var o=n(396);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,n(424).A)('4faf3044',o,!1,{ssrId:!0})},341(e,t,n){n.r(t),n.d(t,{default:()=>s});var o=n(492),a=n.n(o),r=n(748),i=n.n(r)()(a());i.push([e.id,'.choice-fade-enter-active[data-v-3c0e23ae],.choice-fade-leave-active[data-v-3c0e23ae]{transition:transform 220ms cubic-bezier(0.2,0.8,0.2,1)}.choice-fade-enter-from[data-v-3c0e23ae],.choice-fade-leave-to[data-v-3c0e23ae]{transform:translateY(10px) scale(0.985)}.choice-fade-enter-to[data-v-3c0e23ae],.choice-fade-leave-from[data-v-3c0e23ae]{transform:translateY(0) scale(1)}@media (prefers-reduced-motion:reduce){.choice-fade-enter-active[data-v-3c0e23ae],.choice-fade-leave-active[data-v-3c0e23ae]{transition:none}}\n','',{version:3,sources:['webpack://./src/æ—¥è®°ç»œç»œ/è„šæœ¬/galgame/components/ChoiceBox.vue'],names:[],mappings:'AAsDA,sFAEE,sDACF,CAEA,gFAEE,uCACF,CAEA,gFAEE,gCACF,CAEA,uCACE,sFAEE,eACF,CACF',sourcesContent:['<template>\n  <Transition name="choice-fade" appear>\n    <div\n      v-if="store.options.length > 0"\n      class="absolute inset-x-0 top-0 bottom-[80px] z-40 flex items-center justify-center px-[6%] max-md:bottom-[120px]"\n      @click.stop\n    >\n      <div class="w-full max-w-[680px] space-y-3 max-md:space-y-2 md:space-y-4">\n        <button\n          v-for="(option, index) in store.options"\n          :key="`${index}-${option}`"\n          type="button"\n          class="group relative w-full cursor-pointer overflow-hidden rounded-[14px] border border-white/85 bg-white/55 px-[16px] py-[10px] text-center backdrop-blur-md transition-[background-color,border-color,transform] duration-150 hover:border-white/95 hover:bg-white/70 active:scale-[0.99] active:border-white/95 active:bg-white/75 max-md:px-[16px] max-md:py-[6px]"\n          @click.stop="() => onSelect(option)"\n        >\n          <div\n            class="c absolute inset-0 bg-[linear-gradient(135deg,rgba(255,208,216,0.55)_0%,rgba(255,187,200,0.25)_40%,rgba(255,255,255,0.0)_100%)] opacity-70 transition-opacity duration-150 group-hover:opacity-90 group-active:opacity-100"\n          />\n          <div class="relative flex items-center justify-center">\n            <div\n              class="text-[18px] leading-tight font-bold tracking-[0.06em] text-[#4d2b35] [text-shadow:0_1px_1px_rgba(255,255,255,0.92),0_6px_18px_rgba(0,0,0,0.06)]"\n            >\n              {{ option }}\n            </div>\n          </div>\n        </button>\n      </div>\n    </div>\n  </Transition>\n</template>\n\n<script setup lang="ts">\nimport { useGalgameStore } from \'../store\';\nimport { Data } from \'../type\';\n\nconst data = inject<Data>(\'data\', Data.parse({}));\nconst store = useGalgameStore();\n\nfunction onSelect(option: string) {\n  if (data.messageId !== getLastMessageId()) {\n    return;\n  }\n  switch (data.inputMethod) {\n    case \'ç›´æ¥å‘é€\':\n      triggerSlash(`/send ${option} || /trigger`);\n      break;\n    case \'è¦†ç›–è¾“å…¥\':\n      triggerSlash(`/setinput ${option}`);\n      break;\n  }\n}\n<\/script>\n\n<style scoped>\n.choice-fade-enter-active,\n.choice-fade-leave-active {\n  transition: transform 220ms cubic-bezier(0.2, 0.8, 0.2, 1);\n}\n\n.choice-fade-enter-from,\n.choice-fade-leave-to {\n  transform: translateY(10px) scale(0.985);\n}\n\n.choice-fade-enter-to,\n.choice-fade-leave-from {\n  transform: translateY(0) scale(1);\n}\n\n@media (prefers-reduced-motion: reduce) {\n  .choice-fade-enter-active,\n  .choice-fade-leave-active {\n    transition: none;\n  }\n}\n</style>\n'],sourceRoot:''}]);const s=i},396(e,t,n){n.r(t),n.d(t,{default:()=>s});var o=n(492),a=n.n(o),r=n(748),i=n.n(r)()(a());i.push([e.id,'.bg-instant-enter-active[data-v-e2db30e0],.bg-instant-leave-active[data-v-e2db30e0]{transition:none}.bg-instant-enter-from[data-v-e2db30e0],.bg-instant-enter-to[data-v-e2db30e0],.bg-instant-leave-from[data-v-e2db30e0],.bg-instant-leave-to[data-v-e2db30e0]{opacity:1}.bg-fade-enter-active[data-v-e2db30e0],.bg-fade-leave-active[data-v-e2db30e0]{transition:opacity 1.2s ease-in-out}.bg-fade-enter-from[data-v-e2db30e0],.bg-fade-leave-to[data-v-e2db30e0]{opacity:0}.bg-fade-enter-to[data-v-e2db30e0],.bg-fade-leave-from[data-v-e2db30e0]{opacity:1}\n','',{version:3,sources:['webpack://./src/æ—¥è®°ç»œç»œ/è„šæœ¬/galgame/components/SceneStage.vue'],names:[],mappings:'AA6BA,oFAEE,eACF,CAEA,4JAIE,SACF,CAEA,8EAEE,mCACF,CAEA,wEAEE,SACF,CAEA,wEAEE,SACF',sourcesContent:['<template>\n  <div class="absolute inset-0">\n    <Transition :name="store.current_index > 0 ? \'bg-fade\' : \'bg-instant\'">\n      <img\n        v-if="background_url"\n        :key="background_id"\n        :src="background_url"\n        class="absolute inset-0 h-full w-full object-cover"\n      />\n    </Transition>\n\n    <div class="pointer-events-none absolute inset-0">\n      <CharacterLayer />\n    </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { getImageUrl } from \'../../../image\';\nimport { useGalgameStore } from \'../store\';\nimport CharacterLayer from \'./CharacterLayer.vue\';\n\nconst store = useGalgameStore();\n\nconst background_id = computed(() => store.current_dialog.background);\nconst background_url = computed(() => getImageUrl(background_id.value) ?? \'\');\n<\/script>\n\n<style scoped>\n.bg-instant-enter-active,\n.bg-instant-leave-active {\n  transition: none;\n}\n\n.bg-instant-enter-from,\n.bg-instant-enter-to,\n.bg-instant-leave-from,\n.bg-instant-leave-to {\n  opacity: 1;\n}\n\n.bg-fade-enter-active,\n.bg-fade-leave-active {\n  transition: opacity 1.2s ease-in-out;\n}\n\n.bg-fade-enter-from,\n.bg-fade-leave-to {\n  opacity: 0;\n}\n\n.bg-fade-enter-to,\n.bg-fade-leave-from {\n  opacity: 1;\n}\n</style>\n'],sourceRoot:''}]);const s=i},424(e,t,n){function o(e,t){for(var n=[],o={},a=0;a<t.length;a++){var r=t[a],i=r[0],s={id:e+':'+a,css:r[1],media:r[2],sourceMap:r[3]};o[i]?o[i].parts.push(s):n.push(o[i]={id:i,parts:[s]})}return n}n.d(t,{A:()=>f});var a='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!a)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var r={},i=a&&(document.head||document.getElementsByTagName('head')[0]),s=null,p=0,l=!1,c=function(){},d=null,g='data-vue-ssr-id',u='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function f(e,t,n,a){l=n,d=a||{};var i=o(e,t);return m(i),function(t){for(var n=[],a=0;a<i.length;a++){var s=i[a];(p=r[s.id]).refs--,n.push(p)}t?m(i=o(e,t)):i=[];for(a=0;a<n.length;a++){var p;if(0===(p=n[a]).refs){for(var l=0;l<p.parts.length;l++)p.parts[l]();delete r[p.id]}}}}function m(e){for(var t=0;t<e.length;t++){var n=e[t],o=r[n.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](n.parts[a]);for(;a<n.parts.length;a++)o.parts.push(b(n.parts[a]));o.parts.length>n.parts.length&&(o.parts.length=n.parts.length)}else{var i=[];for(a=0;a<n.parts.length;a++)i.push(b(n.parts[a]));r[n.id]={id:n.id,refs:1,parts:i}}}}function h(){var e=document.createElement('style');return e.type='text/css',i.appendChild(e),e}function b(e){var t,n,o=document.querySelector('style['+g+'~="'+e.id+'"]');if(o){if(l)return c;o.parentNode.removeChild(o)}if(u){var a=p++;o=s||(s=h()),t=y.bind(null,o,a,!1),n=y.bind(null,o,a,!0)}else o=h(),t=j.bind(null,o),n=function(){o.parentNode.removeChild(o)};return t(e),function(o){if(o){if(o.css===e.css&&o.media===e.media&&o.sourceMap===e.sourceMap)return;t(e=o)}else n()}}var v,x=(v=[],function(e,t){return v[e]=t,v.filter(Boolean).join('\n')});function y(e,t,n,o){var a=n?'':o.css;if(e.styleSheet)e.styleSheet.cssText=x(t,a);else{var r=document.createTextNode(a),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(r,i[t]):e.appendChild(r)}}function j(e,t){var n=t.css,o=t.media,a=t.sourceMap;if(o&&e.setAttribute('media',o),d.ssrId&&e.setAttribute(g,t.id),a&&(n+='\n/*# sourceURL='+a.sources[0]+' */',n+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+' */'),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},455(e,t){t.A=(e,t)=>{const n=e.__vccOpts||e;for(const[e,o]of t)n[e]=o;return n}},492(e){e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if('function'==typeof btoa){var o=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),a='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(o),r='/*# '.concat(a,' */');return[t].concat([r]).join('\n')}return[t].join('\n')}},733(e,t,n){var o=n(341);o.__esModule&&(o=o.default),'string'==typeof o&&(o=[[e.id,o,'']]),o.locals&&(e.exports=o.locals);(0,n(424).A)('1731f885',o,!1,{ssrId:!0})},748(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n='',o=void 0!==t[5];return t[4]&&(n+='@supports ('.concat(t[4],') {')),t[2]&&(n+='@media '.concat(t[2],' {')),o&&(n+='@layer'.concat(t[5].length>0?' '.concat(t[5]):'',' {')),n+=e(t),o&&(n+='}'),t[2]&&(n+='}'),t[4]&&(n+='}'),n}).join('')},t.i=function(e,n,o,a,r){'string'==typeof e&&(e=[[null,e,void 0]]);var i={};if(o)for(var s=0;s<this.length;s++){var p=this[s][0];null!=p&&(i[p]=!0)}for(var l=0;l<e.length;l++){var c=[].concat(e[l]);o&&i[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]='@layer'.concat(c[5].length>0?' '.concat(c[5]):'',' {').concat(c[1],'}')),c[5]=r),n&&(c[2]?(c[1]='@media '.concat(c[2],' {').concat(c[1],'}'),c[2]=n):c[2]=n),a&&(c[4]?(c[1]='@supports ('.concat(c[4],') {').concat(c[1],'}'),c[4]=a):c[4]=''.concat(a)),t.push(c))}},t}}},g={};function u(e){var t=g[e];if(void 0!==t)return t.exports;var n=g[e]={id:e,exports:{}};return d[e](n,n.exports,u),n.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var n in t)u.o(t,n)&&!u.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const f='ä¸Šé”çš„æ—¥è®°æœ¬',m=z,h=Vue,b=m.z.object({ä¸»è§’æ€§åˆ«:m.z.enum(['ç”·','å¥³']).prefault('ç”·'),æ ·å¼ä¸»é¢˜:m.z.enum(['æš—è‰²','äº®è‰²']).prefault('æš—è‰²'),é€‰æ‹©æ¡†è§¦å‘æ–¹å¼:m.z.enum(['ç›´æ¥å‘é€','è¦†ç›–è¾“å…¥']).prefault('ç›´æ¥å‘é€'),å§‹ç»ˆä½¿ç”¨galgameç•Œé¢:m.z.boolean().prefault(!1)}),v=n('config',errorCatched(()=>{const e=(0,h.ref)(b.parse({})),t=async()=>{const t=await getWorldbook(f),n=e=>t.find(t=>t.name.includes(e))?.enabled??!1,o=r(e.value),a=b.parse({ä¸»è§’æ€§åˆ«:n('ä¸»è§’æ€§åˆ«')?'ç”·':'å¥³',æ ·å¼ä¸»é¢˜:n('æ ·å¼ä¸»é¢˜')?'æš—è‰²':'äº®è‰²',é€‰æ‹©æ¡†è§¦å‘æ–¹å¼:n('é€‰æ‹©æ¡†è§¦å‘æ–¹å¼')?'ç›´æ¥å‘é€':'è¦†ç›–è¾“å…¥',å§‹ç»ˆä½¿ç”¨galgameç•Œé¢:!!n('å§‹ç»ˆä½¿ç”¨galgameç•Œé¢')});_.isEqual(a,o)||(e.value=r(a)),insertOrAssignVariables(r(a),{type:'chat'})},n=t();return eventOn(tavern_events.WORLDINFO_UPDATED,async e=>{e===f&&await t()}),eventOn(tavern_events.CHAT_CHANGED,async()=>{await t()}),{config:(0,h.readonly)(e),_wait_init:n}})),x=m.z.object({id:m.z.string(),tachie:m.z.string()}),y=m.z.object({speaker:m.z.string(),speech:m.z.string(),background:m.z.string(),tachie:m.z.string()}).transform(e=>({..._.omit(e,'tachie'),characters:[{id:'ç»œç»œ',tachie:e.tachie}]})),j=m.z.union([y,m.z.object({speaker:m.z.string(),speech:m.z.string(),background:m.z.string(),characters:m.z.array(x).prefault([]).catch([])})]).transform(e=>('ç‹¬ç™½'===e.speaker&&(e.speech=`ï¼ˆ${e.speech}ï¼‰`),'ç‹¬ç™½'!==e.speaker&&'æ—ç™½'!==e.speaker||(e.speaker=''),e)),C=m.z.object({messageId:m.z.number().prefault(0),message:m.z.string().prefault(''),duringStreaming:m.z.boolean().prefault(!1),inputMethod:m.z.enum(['ç›´æ¥å‘é€','è¦†ç›–è¾“å…¥']).prefault('ç›´æ¥å‘é€')}).prefault({});const S=n('galgame',()=>{const e=(0,h.ref)([{speaker:'ç³»ç»Ÿæç¤º',speech:'å°šæœªåŠ è½½æ¶ˆæ¯',background:'',characters:[]}]),t=(0,h.ref)([]),n=(0,h.ref)(0),o=(0,h.ref)(!1),a=(0,h.ref)(!1),r=(0,h.computed)(()=>e.value[n.value]),s=(0,h.computed)(()=>e.value.slice(0,n.value+1)),p=(0,h.ref)(!0),l=(0,h.ref)(!1);return{dialogs:e,options:t,loadMessage:n=>{const{dialogs:a,type:r}=function(e){const t=(e=e.replace('<StatusPlaceHolderImpl/>','')).match(/<(galgame)>\s*(?:```.*\n)?((?:(?!<\1>)[\s\S])*?)(?:\n```)?\s*<\/\1>/im),n=e.match(/<(galgame)>(?!.*<\/\1>)\s*(?:```[^\n]*\n)?(.*?)\s*(?:```.*)?$/is),o=t?.[2]??n?.[2]??'';let a;try{a=i(o)}catch(e){try{a=YAML.parse(o)}catch(t){return{dialogs:[{speaker:'ç³»ç»Ÿæç¤º',speech:`æ•°æ®è§£æå¤±è´¥: æ—¢ä¸æ˜¯æœ‰æ•ˆçš„ JSON ä¹Ÿä¸æ˜¯æœ‰æ•ˆçš„ YAML.\nå†…å®¹: ${o}\nJSON é”™è¯¯: ${e instanceof Error?e.message:String(e)}\nYAML é”™è¯¯: ${t instanceof Error?t.message:String(t)}`,background:'',characters:[]}],type:'error'}}}try{return{dialogs:m.z.array(j.or(m.z.literal('failed')).catch('failed')).min(1).parse(a,{reportInput:!0}).filter(e=>'failed'!==e),type:t?'full':'partial'}}catch(e){return{dialogs:[{speaker:'ç³»ç»Ÿæç¤º',speech:`åŠ è½½å¯¹è¯æ•°æ®å¤±è´¥ï¼š${e instanceof Error?e.message:String(e)}`,background:'',characters:[]}],type:'error'}}}(n);o.value&&'error'===r||(o.value||'partial'!==r||a.push({speaker:'ç³»ç»Ÿæç¤º',speech:'æ¶ˆæ¯æˆªæ–­äº†â€¦â€¦è¯·é‡æ–°ç”Ÿæˆ',background:'',characters:[]}),e.value=a,t.value=function(e){return[...(e.match(/<(roleplay_options)>\s*(?:```.*\n)?((?:(?!<\1>)[\s\S])*?)(?:\n```)?\s*<\/\1>/im)?.[2]??e.match(/<(roleplay_options)>(?!.*<\/\1>)\s*(?:```[^\n]*\n)?(.*?)\s*(?:```.*)?$/is)?.[2]??'').matchAll(/(.+?)[:ï¼š]\s*(.+)/gm)].map(e=>e[2].replace(/^\$\{(.+)\}$/,'$1').replace(/^ã€Œ(.+)ã€$/,'$1'))}(n))},current_index:n,during_streaming:o,has_ended:a,current_dialog:r,history_dialogs:s,advance:function(){if(a.value)return;const t=n.value+1;t>=e.value.length?o.value||(a.value=!0):n.value=t},restart:function(){n.value=0,a.value=!1},dialog_opened:p,history_opened:l}}),w={class:'w-full max-w-[680px] space-y-3 max-md:space-y-2 md:space-y-4'},N=['onClick'],k={class:'relative flex items-center justify-center'},E={class:'text-[18px] leading-tight font-bold tracking-[0.06em] text-[#4d2b35] [text-shadow:0_1px_1px_rgba(255,255,255,0.92),0_6px_18px_rgba(0,0,0,0.06)]'},G=(0,h.defineComponent)({__name:'ChoiceBox',setup(e){const t=(0,h.inject)('data',C.parse({})),n=S();return(e,o)=>((0,h.openBlock)(),(0,h.createBlock)(h.Transition,{name:'choice-fade',appear:''},{default:(0,h.withCtx)(()=>[(0,h.unref)(n).options.length>0?((0,h.openBlock)(),(0,h.createElementBlock)('div',{key:0,class:'absolute inset-x-0 top-0 bottom-[80px] z-40 flex items-center justify-center px-[6%] max-md:bottom-[120px]',onClick:o[0]||(o[0]=(0,h.withModifiers)(()=>{},['stop']))},[(0,h.createElementVNode)('div',w,[((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)((0,h.unref)(n).options,(e,n)=>((0,h.openBlock)(),(0,h.createElementBlock)('button',{key:`${n}-${e}`,type:'button',class:'group relative w-full cursor-pointer overflow-hidden rounded-[14px] border border-white/85 bg-white/55 px-[16px] py-[10px] text-center backdrop-blur-md transition-[background-color,border-color,transform] duration-150 hover:border-white/95 hover:bg-white/70 active:scale-[0.99] active:border-white/95 active:bg-white/75 max-md:px-[16px] max-md:py-[6px]',onClick:(0,h.withModifiers)(()=>function(e){if(t.messageId===getLastMessageId())switch(t.inputMethod){case'ç›´æ¥å‘é€':triggerSlash(`/send ${e} || /trigger`);break;case'è¦†ç›–è¾“å…¥':triggerSlash(`/setinput ${e}`)}}(e),['stop'])},[o[1]||(o[1]=(0,h.createElementVNode)('div',{class:'c absolute inset-0 bg-[linear-gradient(135deg,rgba(255,208,216,0.55)_0%,rgba(255,187,200,0.25)_40%,rgba(255,255,255,0.0)_100%)] opacity-70 transition-opacity duration-150 group-hover:opacity-90 group-active:opacity-100'},null,-1)),(0,h.createElementVNode)('div',k,[(0,h.createElementVNode)('div',E,(0,h.toDisplayString)(e),1)])],8,N))),128))])])):(0,h.createCommentVNode)('v-if',!0)]),_:1}))}});u(733);var F=u(455);const A=(0,F.A)(G,[['__scopeId','data-v-3c0e23ae']]);const W='undefined'!=typeof window&&'undefined'!=typeof document;'undefined'!=typeof WorkerGlobalScope&&(globalThis,WorkerGlobalScope),Object.prototype.toString;function M(e){const t=Object.create(null);return n=>t[n]||(t[n]=e(n))}const B=/\B([A-Z])/g,V=(M(e=>e.replace(B,'-$1').toLowerCase()),/-(\w)/g),T=M(e=>e.replace(V,(_,e)=>e?e.toUpperCase():''));function I(e,t,n){return(0,h.watch)(e,t,{...n,immediate:!0})}function D(e={}){const{inheritAttrs:t=!0}=e,n=(0,h.shallowRef)(),o=(0,h.defineComponent)({setup:(_,{slots:e})=>()=>{n.value=e.default}}),a=(0,h.defineComponent)({inheritAttrs:t,props:e.props,setup:(o,{attrs:a,slots:r})=>()=>{var i;n.value;const s=null==(i=n.value)?void 0:i.call(n,{...null==e.props?O(a):o,$slots:r});return t&&1===(null==s?void 0:s.length)?s[0]:s}});return function(e,t){if('undefined'!=typeof Symbol){const n={...e};return Object.defineProperty(n,Symbol.iterator,{enumerable:!1,value(){let e=0;return{next:()=>({value:t[e++],done:e>t.length})}}}),n}return Object.assign([...t],e)}({define:o,reuse:a},[o,a])}function O(e){const t={};for(const n in e)t[T(n)]=e[n];return t}W&&window,W&&window.document,W&&window.navigator,W&&window.location;Symbol('vueuse-ssr-width');'undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:'undefined'!=typeof globalThis?globalThis:'undefined'!=typeof self&&self;Number.POSITIVE_INFINITY;const R={type:'button',class:'text-16px rounded-lg border border-white/70 bg-white/85 px-3 py-1.5 font-bold tracking-[0.15em] text-[#7d5b65] shadow-[0_6px_16px_rgba(0,0,0,0.10)] transition-[transform,opacity,background-color] duration-200 hover:-translate-y-0.5 hover:bg-white/95 active:translate-y-0'},L=(0,h.defineComponent)({__name:'ControlBar',setup(e){const[t,n]=D(),o=S();return(e,a)=>((0,h.openBlock)(),(0,h.createElementBlock)('div',{class:'absolute top-4 right-4 z-40 flex items-center gap-2',onClick:a[3]||(a[3]=(0,h.withModifiers)(()=>{},['stop']))},[(0,h.createVNode)((0,h.unref)(t),null,{default:(0,h.withCtx)(({text:e})=>[(0,h.createElementVNode)('button',R,(0,h.toDisplayString)(e),1)]),_:1}),(0,h.createVNode)((0,h.unref)(n),{text:(0,h.unref)(o).has_ended?'é‡æ’­':`${(0,h.unref)(o).current_index+1}/${(0,h.unref)(o).dialogs.length}${(0,h.unref)(o).during_streaming?'?':''}`,onClick:a[0]||(a[0]=(0,h.withModifiers)(e=>(0,h.unref)(o).restart(),['stop']))},null,8,['text']),(0,h.createVNode)((0,h.unref)(n),{text:'æ—¥å¿—',onClick:a[1]||(a[1]=(0,h.withModifiers)(e=>(0,h.unref)(o).history_opened=!0,['stop']))}),(0,h.createVNode)((0,h.unref)(n),{text:(0,h.unref)(o).dialog_opened?'éšè—UI':'æ˜¾ç¤ºUI',onClick:a[2]||(a[2]=(0,h.withModifiers)(e=>(0,h.unref)(o).dialog_opened=!(0,h.unref)(o).dialog_opened,['stop']))},null,8,['text'])]))}}),P={class:'absolute inset-x-0 bottom-0 z-30 w-full'},U={class:'relative px-[6%] pt-[44px] pb-[4%]'},H={class:'flex items-end justify-between'},Y={class:'min-h-[33px] text-[22px] font-extrabold tracking-[0.08em] text-[#4d2b35] [text-shadow:0_1px_1px_rgba(255,255,255,0.92),0_3px_10px_rgba(0,0,0,0.08)]'},J=(0,h.defineComponent)({__name:'DialogBox',setup(e,{expose:t}){const n=S(),o=(0,h.useTemplateRef)('box'),a=(0,h.useTemplateRef)('content'),r=(0,h.ref)(38);function i(){if(!o.value||!a.value)return;const e=o.value.getBoundingClientRect(),t=a.value.getBoundingClientRect();r.value=Math.max(0,Math.round(t.top-e.top))}(0,h.watch)(()=>n.current_index,i);const l=new ResizeObserver(i);(0,h.onMounted)(()=>{i(),o.value&&l.observe(o.value),a.value&&l.observe(a.value)}),(0,h.onBeforeUnmount)(()=>{l.disconnect()});const c=(0,h.ref)(!1);let d,g;async function u(){f(),await(0,h.nextTick)(),c.value=!0,d=p.create(a.value,{type:'chars'}),g=s.from(d.chars,{opacity:0,duration:.1,ease:'power4',stagger:.04,onComplete:()=>{c.value=!1}})}function f(){c.value=!1,d?.revert(),d?.kill(),g?.revert(),g?.kill()}return s.registerPlugin(p),(0,h.watch)(()=>n.current_index,u),(0,h.onMounted)(()=>{u()}),t({is_typing:c,stopTyping:f}),(e,t)=>((0,h.openBlock)(),(0,h.createElementBlock)('div',P,[(0,h.createElementVNode)('div',{ref:'box',class:'relative w-full',style:(0,h.normalizeStyle)({'--dialog-fade-end':`${(0,h.unref)(r)}px`})},[t[1]||(t[1]=(0,h.createElementVNode)('div',{class:'absolute inset-0 bg-[linear-gradient(to_bottom,rgba(255,240,245,0)_0px,rgba(255,240,245,0.93)_var(--dialog-fade-end,38px),rgba(255,240,245,0.93)_100%)]'},null,-1)),(0,h.createElementVNode)('div',U,[(0,h.createElementVNode)('div',H,[(0,h.createElementVNode)('div',Y,(0,h.toDisplayString)((0,h.unref)(n).current_dialog.speaker),1)]),t[0]||(t[0]=(0,h.createElementVNode)('div',{class:'mt-2 mb-3 h-px w-full bg-[#c18e98]/70'},null,-1)),(0,h.createElementVNode)('div',{ref:'content',class:'relative min-h-[3.5em] text-[16px] leading-[1.65] tracking-[0.25px] text-[#4d2b35] [text-shadow:0_1px_1px_rgba(255,255,255,0.92)]'},(0,h.toDisplayString)((0,h.unref)(n).current_dialog.speech),513)])],4)]))}}),q={class:'flex items-center justify-between border-b border-white/50 bg-linear-to-r from-[#ffd0d8]/80 to-[#ffbbc8]/80 px-5 py-3 font-bold text-[#7d5b65] [text-shadow:0_1px_1px_rgba(255,255,255,0.6)]'},X={ref:'content',class:'flex-1 overflow-y-auto p-5 text-[#4d2b35]'},K={key:0,class:'py-5 text-center text-[#7d5b65]'},Z={key:0,class:'mb-2 inline-flex items-center gap-1 font-bold text-[#c18e98]'},Q={class:'text-[18px]'},ee={class:'text-[16px] leading-6 tracking-[0.3px] wrap-anywhere text-[#4d2b35]'},te=(0,h.defineComponent)({__name:'HistoryPanel',setup(e){const t=S(),n=(0,h.useTemplateRef)('content');return(0,h.onMounted)(()=>{n.value&&$(n.value).scrollTop($(n.value).prop('scrollHeight'))}),(e,n)=>((0,h.openBlock)(),(0,h.createElementBlock)('div',{class:'fixed top-[5%] left-[5%] z-1000 flex h-[90%] w-[90%] flex-col overflow-hidden rounded-[15px] border border-white/80 bg-linear-to-br from-rose-50/95 to-rose-100/95 shadow-[0_8px_30px_rgba(145,125,138,0.25),0_0_0_1px_rgba(255,255,255,0.6)_inset] backdrop-blur-lg',onClick:n[1]||(n[1]=(0,h.withModifiers)(()=>{},['stop']))},[(0,h.createElementVNode)('div',q,[n[2]||(n[2]=(0,h.createElementVNode)('h3',{class:'m-0 text-base'},'ğ•ƒğ•†ğ”¾',-1)),(0,h.createElementVNode)('button',{type:'button',class:'text-2xl text-[#c18e98] transition-transform hover:scale-110 hover:text-[#a16e78]',onClick:n[0]||(n[0]=(0,h.withModifiers)(e=>(0,h.unref)(t).history_opened=!1,['stop']))},' âŠ— ')]),(0,h.createElementVNode)('div',X,[0===(0,h.unref)(t).history_dialogs.length?((0,h.openBlock)(),(0,h.createElementBlock)('div',K,'æš‚æ— å¯¹è¯å†å²')):(0,h.createCommentVNode)('v-if',!0),((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)((0,h.unref)(t).history_dialogs,(e,t)=>((0,h.openBlock)(),(0,h.createElementBlock)('div',{key:t,class:'mb-4 rounded-xl bg-white/60 p-4 shadow-[0_2px_8px_rgba(0,0,0,0.05),0_0_0_1px_rgba(255,255,255,0.7)_inset] transition-transform duration-200 hover:-translate-y-0.5'},[e.speaker?((0,h.openBlock)(),(0,h.createElementBlock)('div',Z,[n[3]||(n[3]=(0,h.createElementVNode)('span',{class:'text-sm text-[#ffb0c0]'},'â€',-1)),(0,h.createElementVNode)('span',Q,(0,h.toDisplayString)(e.speaker),1)])):(0,h.createCommentVNode)('v-if',!0),(0,h.createElementVNode)('div',ee,(0,h.toDisplayString)(e.speech),1)]))),128))],512)]))}}),ne=['CG/å‚æ™šæˆ·å¤–æµ·è¾¹å ¤åä¸Šç«™ç€è„¸çº¢çœ‹å‘æ—è¾¹.jpg','CG/å¤œæ™šæˆ·å¤–æ‹¿å†°å¯ä¹è§¦ç¢°ç»œç»œè„¸é¢Šå¬‰ç¬‘.jpg','CG/å¤œæ™šæˆ·å¤–æ—é—´ç«™ç€æŠ¬å¤´çœ‹å¤œç©º.jpg','CG/ç™½å¤©å®¤å†…å®¢å…åç€è¢«ä¸»è§†è§’å–‚é£Ÿè„¸çº¢åœ°çœ‹ç€å‰æ–¹.jpg','CG/ç™½å¤©å®¤å†…æ•™å®¤é‡Œååœ¨é’¢ç´å‰çœ‹å‘æ—è¾¹è¡¨æƒ…å¹³é™åŒ…å«å¹»æƒ³å‡ºçš„é²¸é±¼ä¸äº‘æœµ.jpg','CG/ç™½å¤©å®¤å†…é¤å…ååœ¨æ¡Œå­å‰ç”¨å‹ºå­åƒé¥­.jpg','CG/ç™½å¤©æˆ·å¤–å­¦æ ¡å¤©å°çœºæœ›ç­‰å¾….jpg','CG/ç™½å¤©æˆ·å¤–å­¦æ ¡èµ°å»Šç«™ç€æ‹¿ç€ä¹¦åŒ…å›å¤´è„¸çº¢å¾®ç¬‘.jpg','CG/ç™½å¤©æˆ·å¤–å­¦æ ¡é“è·¯ä¸Šè„¸çº¢å›å¤´çœ‹.jpg','CG/ç™½å¤©æˆ·å¤–æµ·è¾¹ååœ¨é˜²æ³¢å ¤ä¸Šçœ‹ç€çŒ«å’ªè¡¨æƒ…æ¸©æŸ”.jpg','CG/ç™½å¤©æˆ·å¤–æµ·è¾¹æµ·é¸¥åŒæ‰‹åˆåçœºæœ›è¿œæ–¹.jpg','CG/ç™½å¤©æˆ·å¤–è¡—é“ä¸ŠåŒæ‰‹é è¿‘è„¸é¢Šè„¸çº¢å¾®ç¬‘.jpg','CG/ç™½å¤©æˆ·å¤–èººåœ¨èŠ±æµ·å¾®ç¬‘.jpg','CG/ç®€å•èƒŒæ™¯åŒæ‰‹å¼ å¼€æŠ¬å¤´ç­‰å¾…äº²å»æ‹¥æŠ±.jpg','CG/é»„æ˜æˆ·å¤–æ—¥è½æµ·è¾¹ç«™ç«‹è„¸çº¢ç›´è§†ç©å®¶.jpg','NSFWCG/å§å®¤åºŠä¸Šå£äº¤ä¸»è§’ä¸»åŠ¨.jpg','NSFWCG/å§å®¤åºŠä¸ŠæŒ‡äº¤ä¸»è§’ä¸»åŠ¨.jpg','NSFWCG/å§å®¤åºŠä¸ŠæŒ‡äº¤ä¸»è§’ä¸»åŠ¨POVè§†è§’.jpg','NSFWCG/å§å®¤åºŠä¸ŠæŒ‡äº¤ç»œç»œä¸»åŠ¨.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šå£äº¤é¢„å¤‡å¾®å¾®åç¬‘.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šå±•ç¤ºå°ç©´è¶³äº¤.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šå±•ç¤ºå°ç©´è¶³äº¤å°„ç²¾.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šæ‰‘å€’ç»œç»œä¸»åŠ¨.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šæ‰¶è…¿æ’å…¥å›å¤´æœ›.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šæ‰¶è…¿æ’å…¥å›å¤´æœ›å°„ç²¾.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸ŠæŒ‡äº¤ä¸»è§’ä¸»åŠ¨.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸ŠæŒ‡äº¤ä¸»è§’ä¸»åŠ¨2.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸ŠæŒ‡äº¤ç»œç»œä¸Šä½ä¸»è§’ä¸»åŠ¨.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šæ­£é¢å£äº¤é¢„å¤‡å«ç¾å¾®ç¬‘è„¸.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šæ­£é¢å£äº¤é¢„å¤‡æ„‰æ‚¦è„¸.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šæ­£é¢æ’å…¥Må­—è…¿.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šæ­£é¢æ’å…¥Må­—è…¿2.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šæ­£é¢æ’å…¥Må­—è…¿å°„ç²¾æ„‰æ‚¦è„¸.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šæ­£é¢æ’å…¥å‰å€¾Må­—è…¿é€†æ¨å¥³ä¸»åŠ¨.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šæ­£é¢æ’å…¥å‰å€¾Må­—è…¿é€†æ¨å¥³ä¸»åŠ¨è„¸çº¢å°„ç²¾.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸ŠèƒŒå¯¹é«˜ä¸¾å±è‚¡è„¸ä¸‹è¶´å°„ç²¾.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸ŠèƒŒèº«æ’…å±è‚¡åå…¥.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸ŠèƒŒèº«æ’…å±è‚¡åå…¥å°„ç²¾.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šè¶´ç”·èº«ä¸Šå£äº¤æ·±å–‰.jpg','NSFWCG/å¤œæ™šå§å®¤åºŠä¸Šè¶´ç”·èº«ä¸Šå£äº¤æ·±å–‰å°„ç²¾.jpg','NSFWCG/å¤œæ™šå§å®¤æŒ‡äº¤ç»œç»œä¸»åŠ¨.jpg','NSFWCG/å¤œæ™šå§å®¤æŒ‡äº¤ç»œç»œç«™ç«‹ä¸»è§’ååºŠä¸»åŠ¨.jpg','NSFWCG/å¤œæ™šå§å®¤æŒ‡æ•™ç»œç»œä¸Šä½ä¸»è§’ä¸»åŠ¨.jpg','NSFWCG/å¤œæ™šå§å®¤ç»œç»œæ‰¶å¢™è‡ªæ…°.jpg','NSFWCG/å¤œæ™šå­¦æ ¡äº²å».jpg','NSFWCG/å¤œæ™šå­¦æ ¡å¤©å°äº²å».jpg','NSFWCG/å¤œæ™šå­¦æ ¡å®¤å†…äº²å».jpg','NSFWCG/å¤œæ™šå­¦æ ¡å±‹é¡¶æ‰¶è…¿æ’å…¥å›å¤´æœ›.jpg','NSFWCG/å¤œæ™šå­¦æ ¡å±‹é¡¶è¶´æ æ†åå…¥.jpg','NSFWCG/å¤œæ™šå­¦æ ¡å±‹é¡¶è¶´æ æ†åå…¥å°„ç²¾.jpg','NSFWCG/å¤œæ™šå­¦æ ¡å±‹é¡¶è¶´æ æ†åå…¥å°„ç²¾è„¸çº¢.jpg','NSFWCG/å¤œæ™šæˆ·å¤–äº²å».jpg','NSFWCG/å¤œæ™šæˆ·å¤–æ€è£™æŒ‡äº¤ä¸»è§’ä¸»åŠ¨.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šä¸‹åŠèº«è£¸Må­—è…¿åç”·ä¸Šæœªæ€§äº¤.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šå…¨è£¸åå…¥1.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šå…¨è£¸åå…¥2.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šå£äº¤ä¸»è§’ä¸»åŠ¨.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šå£äº¤æ·±å–‰é—­çœ¼.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šå£äº¤ç”·èºº1.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šå£äº¤ç”·èºº2.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šå£äº¤ç”·èºº3.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šåå…¥åŒæ‰‹æŠ“èƒ³è†Š.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šåå…¥å¥³è¶´.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸ŠæŒ‡äº¤ä¸»è§’ä¸»åŠ¨POVè§†è§’.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸ŠæŒ‡äº¤ç»œç»œä¸Šä½ä¸»è§’ä¸»åŠ¨.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸ŠæŒ‡äº¤ç»œç»œä¸»åŠ¨.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šæ­£é¢Mè…¿.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šæ­£é¢Vè…¿.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šè¶³äº¤.jpg','NSFWCG/ç™½å¤©å§å®¤åºŠä¸Šéª‘ä¹˜å‰æˆ.jpg','NSFWCG/ç™½å¤©å§å®¤æ€§çˆ±åæ‹¥æŠ±.jpg','NSFWCG/ç™½å¤©å­¦æ ¡å¤©å°æŒ‡æ•™ä¸»è§’ä¸»åŠ¨.jpg','NSFWCG/ç™½å¤©å­¦æ ¡å±‹é¡¶æ­£é¢ç«™ç«‹.jpg','NSFWCG/ç™½å¤©å­¦æ ¡å±‹é¡¶è¶´å›´æ åå…¥1.jpg','NSFWCG/ç™½å¤©å­¦æ ¡å±‹é¡¶è¶´å›´æ åå…¥2.jpg','NSFWCG/ç™½å¤©å®¤å†…æ³•å¼èˆŒå».jpg','NSFWCG/ç™½å¤©å··å­å…¨è£¸æ­£é¢Mè…¿.jpg','NSFWCG/ç™½å¤©å··å­åå…¥æ‰¯èƒ³è†Šè·ªåœ°.jpg','NSFWCG/ç™½å¤©å··å­åå…¥ç‰µæ‰‹.jpg','NSFWCG/ç™½å¤©å··å­æ‰¶å¢™åå…¥1.jpg','NSFWCG/ç™½å¤©å··å­æ‰¶å¢™åå…¥2.jpg','NSFWCG/ç™½å¤©å··å­æ­£é¢Mè…¿èººåœ°.jpg','NSFWCG/ç™½å¤©æ•™å®¤åå…¥Mè…¿æ‰¶æ¡Œ.jpg','NSFWCG/ç™½å¤©æ•™å®¤åå…¥æ‰¶å¢™.jpg','NSFWCG/ç™½å¤©æ•™å®¤åå…¥æ‰¶æ¡Œ.jpg','NSFWCG/ç™½å¤©æ•™å®¤åæ¡Œæ‰¶å•è…¿æ­£é¢.jpg','NSFWCG/ç™½å¤©æ•™å®¤æ­£é¢Vè…¿.jpg','NSFWCG/ç™½å¤©æ•™å®¤æ­£é¢å.jpg','NSFWCG/ç™½å¤©æ— äººæ²™æ»©å•è…¿ç«™ç«‹.jpg','NSFWCG/ç™½å¤©æ²™æ»©åŒè…¿ç«–ç›´å‘ä¸Šæ­£é¢.jpg','NSFWCG/ç™½å¤©æ²™æ»©å²©çŸ³æ‰¶è…¿æ­£é¢.jpg','NSFWCG/ç™½å¤©æ²™æ»©æ­£é¢æ€è£™.jpg','ä¸Šå­¦è·¯ä¸Š/å¤œæ™šå…³ç¯.jpg','ä¸Šå­¦è·¯ä¸Š/å¤œæ™šå¼€ç¯.jpg','ä¸Šå­¦è·¯ä¸Š/ç™½å¤©.jpg','ä¸Šå­¦è·¯ä¸Š/é»„æ˜.jpg','ä¹¦åº—.jpg','ä¹¦åº—å†….jpg','ä¹¦åº—å†…/ä¹¦åº—.jpg','ä¹¦åº—å†…/ä¹¦åº—å†….jpg','ä½å®…è¡—/å¤œæ™šå…³ç¯.jpg','ä½å®…è¡—/å¤œæ™šå¼€ç¯.jpg','ä½å®…è¡—/ç™½å¤©.jpg','ä½å®…è¡—/é»„æ˜.jpg','ä½æ‰€å®¢å…/å¤œæ™šå…³ç¯.jpg','ä½æ‰€å®¢å…/å¤œæ™šå¼€ç¯.jpg','ä½æ‰€å®¢å…/ç™½å¤©.jpg','ä½æ‰€å®¢å…/é»„æ˜.jpg','ä½æ‰€ç„å…³/å¤œæ™šå…³ç¯.jpg','ä½æ‰€ç„å…³/å¤œæ™šå¤œç¯.jpg','ä½æ‰€ç„å…³/å¤œæ™šå¼€ç¯.jpg','ä½æ‰€ç„å…³/ç™½å¤©.jpg','ä½æ‰€ç„å…³/é»„æ˜.jpg','ä¾¿åˆ©åº—å†….jpg','ä¾¿åˆ©åº—å†…/ä¾¿åˆ©åº—.jpg','ä¾¿åˆ©åº—å†…/ä¾¿åˆ©åº—å†….jpg','å…¬å›­/å¤œæ™šå¼€ç¯.jpg','å…¬å›­/ç™½å¤©.jpg','å…¬å›­/é»„æ˜.jpg','å…¬å›­å‡‰äº­/å¤œæ™šå¼€ç¯.jpg','å…¬å›­å‡‰äº­/ç™½å¤©.jpg','å…¬å›­å‡‰äº­/é»„æ˜.jpg','å…¬å›­å•†åº—äº­/å¤œæ™šå¼€ç¯.jpg','å…¬å›­å•†åº—äº­/ç™½å¤©.jpg','å…¬å›­å•†åº—äº­/é»„æ˜.jpg','å’–å•¡å…/å¤œæ™šå¼€ç¯.jpg','å’–å•¡å…/ç™½å¤©.jpg','å’–å•¡å…/é»„æ˜.jpg','å•†åº—è¡—/å¤œæ™šå¼€ç¯.jpg','å•†åº—è¡—/ç™½å¤©.jpg','å•†åº—è¡—/é»„æ˜.jpg','å›¾ä¹¦é¦†.jpg','å›¾ä¹¦é¦†/å›¾ä¹¦é¦†.jpg','å›¾ä¹¦é¦†/å›¾ä¹¦é¦†å†….jpg','å›¾ä¹¦é¦†/æ™šä¸Š.jpg','å›¾ä¹¦é¦†/ç™½å¤©.jpg','å›¾ä¹¦é¦†å†….jpg','å›¾ä¹¦é¦†å†…/å›¾ä¹¦é¦†.jpg','å›¾ä¹¦é¦†å†…/å›¾ä¹¦é¦†å†….jpg','å›¾ä¹¦é¦†å†…/æ™šä¸Š.jpg','å›¾ä¹¦é¦†å†…/ç™½å¤©.jpg','åœ°é“å†…/å¤œæ™šå¼€ç¯.jpg','åœ°é“å†…/ç™½å¤©.jpg','åœ°é“å†…/é»„æ˜.jpg','åœ°é“ç«™.jpg','åœ°é“ç«™å†….jpg','åœ°é“ç«™å†…/åœ°é“ç«™.jpg','åœ°é“ç«™å†…/åœ°é“ç«™å†….jpg','åŸå¸‚ä¸­çš„é“è·¯é“å£/å¤œæ™šå¼€ç¯.jpg','åŸå¸‚ä¸­çš„é“è·¯é“å£/ç™½å¤©.jpg','åŸå¸‚ä¸­çš„é“è·¯é“å£/é»„æ˜.jpg','åŸé•‡è¡—é“ä¸Š/å¤œæ™šå…³ç¯.jpg','åŸé•‡è¡—é“ä¸Š/å¤œæ™šå¼€ç¯.jpg','åŸé•‡è¡—é“ä¸Š/ç™½å¤©.jpg','åŸé•‡è¡—é“ä¸Š/é»„æ˜.jpg','å¥³ç”Ÿæˆ¿é—´/å¤œæ™šå…³ç¯.jpg','å¥³ç”Ÿæˆ¿é—´/å¤œæ™šå¤œç¯.jpg','å¥³ç”Ÿæˆ¿é—´/å¤œæ™šå¼€ç¯.jpg','å¥³ç”Ÿæˆ¿é—´/ç™½å¤©.jpg','å¥³ç”Ÿæˆ¿é—´/é»„æ˜.jpg','å­¦æ ¡ä¸­åº­/å¤œæ™šå…³ç¯.jpg','å­¦æ ¡ä¸­åº­/å¤œæ™šå¼€ç¯.jpg','å­¦æ ¡ä¸­åº­/ç™½å¤©.jpg','å­¦æ ¡ä¸­åº­/é»„æ˜.jpg','å­¦æ ¡å¤–ä¾§æ¥¼æ¢¯/å¤œæ™šå…³ç¯.jpg','å­¦æ ¡å¤–ä¾§æ¥¼æ¢¯/å¤œæ™šå¼€ç¯.jpg','å­¦æ ¡å¤–ä¾§æ¥¼æ¢¯/ç™½å¤©.jpg','å­¦æ ¡å¤–ä¾§æ¥¼æ¢¯/é»„æ˜.jpg','å­¦æ ¡å¤©å°/å¤œæ™šå…³ç¯.jpg','å­¦æ ¡å¤©å°/ç™½å¤©.jpg','å­¦æ ¡å¤©å°/é»„æ˜.jpg','å­¦æ ¡å±‹é¡¶/å¤œæ™šå…³ç¯.jpg','å­¦æ ¡å±‹é¡¶/ç™½å¤©.jpg','å­¦æ ¡å±‹é¡¶/é»„æ˜.jpg','å­¦æ ¡æ•™å­¦æ¥¼æ­£é—¨å‰/å¤œæ™šå…³ç¯.jpg','å­¦æ ¡æ•™å­¦æ¥¼æ­£é—¨å‰/å¤œæ™šå¼€ç¯.jpg','å­¦æ ¡æ•™å­¦æ¥¼æ­£é—¨å‰/ç™½å¤©.jpg','å­¦æ ¡æ•™å­¦æ¥¼æ­£é—¨å‰/é»„æ˜.jpg','å­¦æ ¡æ•™å®¤/å¤œæ™šå…³ç¯.jpg','å­¦æ ¡æ•™å®¤/å¤œæ™šå¼€ç¯.jpg','å­¦æ ¡æ•™å®¤/ç™½å¤©.jpg','å­¦æ ¡æ•™å®¤/é»„æ˜.jpg','å­¦æ ¡æ¥¼æ¢¯/å¤œæ™šå…³ç¯.jpg','å­¦æ ¡æ¥¼æ¢¯/å¤œæ™šå¼€ç¯.jpg','å­¦æ ¡æ¥¼æ¢¯/ç™½å¤©.jpg','å­¦æ ¡æ¥¼æ¢¯/é»„æ˜.jpg','å­¦æ ¡æ­£é—¨å‰/å¤œæ™šå…³ç¯.jpg','å­¦æ ¡æ­£é—¨å‰/å¤œæ™šå¼€ç¯.jpg','å­¦æ ¡æ­£é—¨å‰/ç™½å¤©.jpg','å­¦æ ¡æ­£é—¨å‰/é»„æ˜.jpg','åº™ä¼šå°åƒè¡—/å¤œæ™šå¼€ç¯.jpg','åº™ä¼šå°åƒè¡—/ç™½å¤©.jpg','åº™ä¼šå°åƒè¡—/é»„æ˜.jpg','æ‹±å»Šå•†åº—è¡—/å¤œæ™šå¼€ç¯.jpg','æ‹±å»Šå•†åº—è¡—/ç™½å¤©.jpg','æ‹±å»Šå•†åº—è¡—/é»„æ˜.jpg','æ•™å®¤/å¤œæ™šå…³ç¯.jpg','æ•™å®¤/å¤œæ™šå¼€ç¯.jpg','æ•™å®¤/ç™½å¤©.jpg','æ•™å®¤/é»„æ˜.jpg','æ²³æ—/å¤œæ™šå…³ç¯.jpg','æ²³æ—/ç™½å¤©.jpg','æ²³æ—/é»„æ˜.jpg','æµ·æ»©/å¤œæ™šå…³ç¯.jpg','æµ·æ»©/ç™½å¤©.jpg','æµ·æ»©/é»„æ˜.jpg','ç”·ç”Ÿæˆ¿é—´/å¤œæ™šå…³ç¯.jpg','ç”·ç”Ÿæˆ¿é—´/å¤œæ™šå¼€ç¯.jpg','ç”·ç”Ÿæˆ¿é—´/ç™½å¤©.jpg','ç”·ç”Ÿæˆ¿é—´/é»„æ˜.jpg','ç¹åå•†ä¸šè¡—/å¤œæ™šå¼€ç¯.jpg','ç¹åå•†ä¸šè¡—/ç™½å¤©.jpg','ç¹åå•†ä¸šè¡—/é»„æ˜.jpg','ç¾æœ¯é¦†/å¤œæ™šå…³ç¯.jpg','ç¾æœ¯é¦†/ç™½å¤©.jpg','è´­ç‰©ä¸­å¿ƒ/å¤œæ™šå…³ç¯.jpg','è´­ç‰©ä¸­å¿ƒ/ç™½å¤©.jpg','è´­ç‰©ä¸­å¿ƒ/é»„æ˜.jpg','è´­ç‰©ä¸­å¿ƒäºŒå±‚/è´­ç‰©ä¸­å¿ƒäºŒå±‚.jpg','é¤é¦†/å¤œæ™šå¼€ç¯.jpg','é¤é¦†/ç™½å¤©.jpg','é¤é¦†/é»„æ˜.jpg'],oe=['æ— äºº.png','å¼€è¡«/æ— äºº.png','å¼€è¡«/æ“¦çœ¼æ³ª.png','å¼€è¡«/å¾®ç¬‘.png','å¼€è¡«/ç¨å¾®è„¸çº¢.png','å¼€è¡«/é‚ªæ¶çš„ç¬‘å®¹.png','å¼€è¡«/ç­‰å¾…å».png','å¼€è¡«/æ‰‹æ‰˜ä¸‹å·´æ€è€ƒ.png','å¼€è¡«/å“­æ³£.png','å¼€è¡«/æµ…ç¬‘.png','å¼€è¡«/æµå£æ°´.png','å¼€è¡«/çœ‹é€ä¸€åˆ‡çš„åç¬‘.png','å¼€è¡«/æ˜Ÿæ˜Ÿçœ¼.png','å¼€è¡«/çŒ«çˆªç”Ÿæ°”.png','å¼€è¡«/æ— è¡¨æƒ….png','å¼€è¡«/å®³ç¾.png','å¼€è¡«/æ™•æ™•çœ¼.png','å¼€è¡«/æƒŠè®¶.png','å¼€è¡«/æ€§é«˜æ½®.png','å¼€è¡«/ç”Ÿæ°”.png','æ°´æ‰‹æœ/æ— äºº.png','æ°´æ‰‹æœ/æ“¦çœ¼æ³ª.png','æ°´æ‰‹æœ/å¾®ç¬‘.png','æ°´æ‰‹æœ/ç¨å¾®è„¸çº¢.png','æ°´æ‰‹æœ/ç­‰å¾…å».png','æ°´æ‰‹æœ/æ‰‹æ‰˜ä¸‹å·´æ€è€ƒ.png','æ°´æ‰‹æœ/å“­æ³£.png','æ°´æ‰‹æœ/æµ…ç¬‘.png','æ°´æ‰‹æœ/æµå£æ°´.png','æ°´æ‰‹æœ/é‚ªæ¶çš„åç¬‘.png','æ°´æ‰‹æœ/çœ‹é€ä¸€åˆ‡çš„åç¬‘.png','æ°´æ‰‹æœ/æ˜Ÿæ˜Ÿçœ¼.png','æ°´æ‰‹æœ/çŒ«çˆªç”Ÿæ°”.png','æ°´æ‰‹æœ/æ— è¡¨æƒ….png','æ°´æ‰‹æœ/å®³ç¾.png','æ°´æ‰‹æœ/æ™•æ™•çœ¼.png','æ°´æ‰‹æœ/æƒŠè®¶.png','æ°´æ‰‹æœ/çœ¼ç¥ç©ºæ´çš„å‚¬çœ çŠ¶æ€.png','æ°´æ‰‹æœ/æ€§é«˜æ½®.png','æ°´æ‰‹æœ/ç”Ÿæ°”.png','æ ¼çº¹è¡«/æ— äºº.png','æ ¼çº¹è¡«/æ“¦çœ¼æ³ª.png','æ ¼çº¹è¡«/å¾®ç¬‘.png','æ ¼çº¹è¡«/ç¨å¾®è„¸çº¢.png','æ ¼çº¹è¡«/ç­‰å¾…å».png','æ ¼çº¹è¡«/æ‰‹æ‰˜ä¸‹å·´æ€è€ƒ.png','æ ¼çº¹è¡«/å“­æ³£.png','æ ¼çº¹è¡«/æµ…ç¬‘.png','æ ¼çº¹è¡«/æµå£æ°´.png','æ ¼çº¹è¡«/é‚ªæ¶çš„åç¬‘.png','æ ¼çº¹è¡«/çœ‹é€ä¸€åˆ‡çš„åç¬‘.png','æ ¼çº¹è¡«/æ˜Ÿæ˜Ÿçœ¼.png','æ ¼çº¹è¡«/çŒ«çˆªç”Ÿæ°”.png','æ ¼çº¹è¡«/å®³ç¾.png','æ ¼çº¹è¡«/æ™•æ™•çœ¼.png','æ ¼çº¹è¡«/æƒŠè®¶.png','æ ¼çº¹è¡«/çœ¼ç¥ç©ºæ´çš„å‚¬çœ çŠ¶æ€.png','æ ¼çº¹è¡«/æ€§é«˜æ½®.png','æ ¼çº¹è¡«/ç”Ÿæ°”.png','ç¡è¡£/æ— äºº.png','ç¡è¡£/å¾®ç¬‘.png','ç¡è¡£/ç¨å¾®è„¸çº¢.png','ç¡è¡£/ç­‰å¾…å».png','ç¡è¡£/å“­æ³£.png','ç¡è¡£/æµ…ç¬‘.png','ç¡è¡£/æµå£æ°´.png','ç¡è¡£/é‚ªæ¶çš„åç¬‘.png','ç¡è¡£/çœ‹é€ä¸€åˆ‡çš„åç¬‘.png','ç¡è¡£/æ˜Ÿæ˜Ÿçœ¼.png','ç¡è¡£/çŒ«çˆªç”Ÿæ°”.png','ç¡è¡£/å®³ç¾.png','ç¡è¡£/æ™•æ™•çœ¼.png','ç¡è¡£/æƒŠè®¶.png','ç¡è¡£/çœ¼ç¥ç©ºæ´çš„å‚¬çœ çŠ¶æ€.png','ç¡è¡£/æ€§é«˜æ½®.png','ç¡è¡£/ç”Ÿæ°”.png','å…¨è£¸/æ— äºº.png','å…¨è£¸/åç¬‘.png','å…¨è£¸/ç¨å¾®è„¸çº¢.png','å…¨è£¸/å“­æ³£.png','å…¨è£¸/æµ…ç¬‘.png','å…¨è£¸/æµå£æ°´.png','å…¨è£¸/é‚ªæ¶çš„åç¬‘.png','å…¨è£¸/çœ‹é€ä¸€åˆ‡çš„åç¬‘.png','å…¨è£¸/æ˜Ÿæ˜Ÿçœ¼.png','å…¨è£¸/ç­‰å¾…æ¥å».png','å…¨è£¸/å®³ç¾.png','å…¨è£¸/æ™•æ™•çœ¼.png','å…¨è£¸/æƒŠè®¶.png','å…¨è£¸/çœ¼ç¥ç©ºæ´çš„å‚¬çœ çŠ¶æ€.png','å…¨è£¸/æ€§é«˜æ½®.png','å…¨è£¸/ç”Ÿæ°”.png'];function ae(e){const t='https://testingcf.jsdelivr.net/gh/lolo-desu/lolocard/src/æ—¥è®°ç»œç»œ/å›¾ç‰‡';return oe.includes(e)?`${t}/ç«‹ç»˜/${e}`:ne.includes(e)?`${t}/èƒŒæ™¯/${e}`:null}const re=['src'],ie=(0,h.defineComponent)({__name:'CharacterLayer',setup(e){const t=S(),n=(0,h.computed)(()=>{const e=t.current_dialog.characters;return e.map((n,o)=>({id:n.id,url:ae(n.tachie)??'',is_speaking:t.current_dialog.speaker===n.id,position:`${Math.round((o+1)/(e.length+1)*100)}%`})).filter(e=>e.url)});return(e,t)=>((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)((0,h.unref)(n),e=>((0,h.openBlock)(),(0,h.createElementBlock)('img',{key:e.id,class:(0,h.normalizeClass)(['absolute bottom-0 h-[95%] max-h-[95%] w-auto -translate-x-1/2 object-contain drop-shadow-[0_0_5px_rgba(0,0,0,0.2)] transition-[opacity,transform,filter,left,right] duration-500 ease-out',[{'brightness-[0.85] contrast-[0.95]':!e.is_speaking},`left-[${e.position}]`]]),src:e.url},null,10,re))),128))}}),se=ie,pe={class:'absolute inset-0'},le=['src'],ce={class:'pointer-events-none absolute inset-0'},de=(0,h.defineComponent)({__name:'SceneStage',setup(e){const t=S(),n=(0,h.computed)(()=>t.current_dialog.background),o=(0,h.computed)(()=>ae(n.value)??'');return(e,a)=>((0,h.openBlock)(),(0,h.createElementBlock)('div',pe,[(0,h.createVNode)(h.Transition,{name:(0,h.unref)(t).current_index>0?'bg-fade':'bg-instant'},{default:(0,h.withCtx)(()=>[(0,h.unref)(o)?((0,h.openBlock)(),(0,h.createElementBlock)('img',{key:(0,h.unref)(n),src:(0,h.unref)(o),class:'absolute inset-0 h-full w-full object-cover'},null,8,le)):(0,h.createCommentVNode)('v-if',!0)]),_:1},8,['name']),(0,h.createElementVNode)('div',ce,[(0,h.createVNode)(se)])]))}});u(324);const ge=(0,F.A)(de,[['__scopeId','data-v-e2db30e0']]),ue={class:'relative flex h-full w-full flex-col overflow-hidden rounded-xl'},fe={class:'relative flex flex-1 flex-col overflow-hidden rounded-lg bg-white'},me={class:'relative flex-1 overflow-hidden bg-black'},he=(0,h.defineComponent)({__name:'App',setup(e){const t=(0,h.inject)('data',C.parse({})),n=S();I(()=>t.duringStreaming,e=>{n.during_streaming=e}),I(()=>t.message,e=>{n.loadMessage(e)});const o=(0,h.useTemplateRef)('dialog_box');function a(){n.history_opened||n.has_ended||(o.value?.is_typing?o.value.stopTyping():n.advance())}return(e,t)=>((0,h.openBlock)(),(0,h.createElementBlock)('div',{class:'mx-auto aspect-video w-full max-w-[1200px] select-none max-md:aspect-3/4',onClick:a},[(0,h.createElementVNode)('div',ue,[(0,h.createElementVNode)('div',fe,[t[3]||(t[3]=(0,h.createElementVNode)('div',{class:'relative flex h-[5.5%] items-center justify-center rounded-t-lg bg-linear-to-r from-[#ffd0d8] to-[#ffbbc8] text-[12px] font-bold text-[#7d6b6e] [text-shadow:0px_1px_1px_rgba(255,255,255,0.5)] max-md:h-5'},[(0,h.createElementVNode)('span',{class:'absolute left-4 text-[18px] text-[#c18e98]'},'â€'),(0,h.createTextVNode)(' ã€âºâŠ¹ğ’ğ’¢ğ’¯ğ’¾ğ“‚â„¯Êšà·†Éâ‚Šã€ '),(0,h.createElementVNode)('span',{class:'absolute right-4 text-[14px] text-[#c18e98]'},'âœ§*:ï½¥ï¾Ÿâœ§')],-1)),(0,h.createElementVNode)('div',me,[(0,h.createVNode)(ge),t[1]||(t[1]=(0,h.createElementVNode)('div',{class:'pointer-events-none absolute top-4 right-4 z-20 hidden h-12 w-12 items-center justify-center text-2xl text-[#ffb0c0] opacity-80 md:flex'},' â™¡ ',-1)),t[2]||(t[2]=(0,h.createElementVNode)('div',{class:'pointer-events-none absolute bottom-20 left-4 z-20 hidden h-12 w-12 items-center justify-center text-2xl text-[#ffb0c0] opacity-80 md:flex'},' âœ¿ ',-1)),(0,h.unref)(n).has_ended?((0,h.openBlock)(),(0,h.createBlock)(A,{key:0})):(0,h.createCommentVNode)('v-if',!0),(0,h.withDirectives)((0,h.createVNode)(J,{ref:'dialog_box'},null,512),[[h.vShow,(0,h.unref)(n).dialog_opened]]),(0,h.unref)(n).history_opened?((0,h.openBlock)(),(0,h.createElementBlock)(h.Fragment,{key:1},[(0,h.createElementVNode)('div',{class:'fixed inset-0 z-900 bg-black/35 transition-opacity duration-200',onClick:t[0]||(t[0]=(0,h.withModifiers)(()=>{},['stop']))}),(0,h.createVNode)(te)],64)):(0,h.createCommentVNode)('v-if',!0),(0,h.createVNode)(L)])])])]))}}),be=new Map,ve='mes_galgame';async function xe(e,n){const o=$(`.mes[mesid='${e}']`),a=Number(o.attr('mesid'));a>getLastMessageId()&&(be.get(a)?.destroy(),be.delete(a));const r=n??getChatMessages(a)[0].message??'';if(!r.match(/<galgame>\s*```/im))return;const i=o.find('.mes_text');i.addClass('hidden!');let s=o.find(`.${ve}`);if(s.length>0){const e=be.get(a);if(e)return s.removeClass('hidden!'),e.data.duringStreaming=Boolean(n),void(e.data.message=r)}be.get(a)?.destroy(),be.delete(a),s.remove(),s=$(`<iframe class="${ve} w-full">`).attr({id:`stream-${a}`,frameborder:0,srcdoc:'<head>\n<link rel="stylesheet" href="https://testingcf.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"></link>\n<script src="https://testingcf.jsdelivr.net/gh/n0vi028/JS-Slash-Runner/lib/tailwindcss.min.js"><\/script>\n<script src="https://testingcf.jsdelivr.net/npm/jquery"><\/script>\n<script src="https://testingcf.jsdelivr.net/npm/lodash"><\/script>\n<script src="https://testingcf.jsdelivr.net/gh/n0vi028/JS-Slash-Runner/src/iframe/adjust_iframe_height.js"><\/script>\n<style>\n*,*::before,*::after{box-sizing:border-box;}\nhtml,body{margin:0!important;padding:0;overflow:hidden!important;max-width:100%!important;}\n</style>\n</head>'}).insertAfter(i);const p=(0,h.reactive)({messageId:a,message:r,duringStreaming:Boolean(n),inputMethod:v().config.é€‰æ‹©æ¡†è§¦å‘æ–¹å¼}),l=(0,h.createApp)(he).provide('data',p).use(t());s.on('load',function(){const e=this.contentDocument;!function(e){const t=getScriptId();e.head.querySelector(`div[script_id="${t}"]`)?.remove();const n=e.createElement('div');n.setAttribute('script_id',t);for(const e of Array.from(window.document.head.querySelectorAll(':scope > style')))n.append(e.cloneNode(!0));e.head.append(n)}(e),l.mount(e.body)});const c=new MutationObserver(()=>{$('#curEditTextarea').parent().is(i)&&(i.removeClass('hidden!'),s.addClass('hidden!'))});c.observe(i[0],{childList:!0,subtree:!0,characterData:!0});const d=(0,h.watch)(()=>v().config.é€‰æ‹©æ¡†è§¦å‘æ–¹å¼,e=>{p.inputMethod=e});be.set(a,{app:l,data:p,destroy:()=>{i.removeClass('hidden!'),l.unmount(),s.remove(),c.disconnect(),d()}})}async function _e(){!function(){const e=getLastMessageId(),t=be.entries().filter(([t])=>t>e);t.forEach(([,{destroy:e}])=>e()),t.forEach(([e])=>be.delete(e))}(),$('#chat').children('.mes[is_user=\'false\'][is_system=\'false\']').each((e,t)=>{const n=$(t).attr('mesid');try{n&&xe(parseInt(n))}catch(e){}})}const ye=m.z.object({ä¸–ç•Œ:m.z.object({å½“å‰æ—¶é—´:m.z.templateLiteral([m.z.coerce.number(),':',m.z.coerce.number()]),_å½“å‰æ—¶é—´é˜¶æ®µ:m.z.enum(['å‡Œæ™¨','æ—©æ™¨','ä¸Šåˆ','ä¸­åˆ','ä¸‹åˆ','æ™šä¸Š','æ·±å¤œ']).optional(),å½“å‰æ—¥æœŸ:m.z.string(),å½“å‰æ˜ŸæœŸ:m.z.templateLiteral([m.z.literal('æ˜ŸæœŸ'),m.z.enum(['ä¸€','äºŒ','ä¸‰','å››','äº”','å…­','æ—¥'])]),æ˜¯å¦éœ€è¦ä¸Šå­¦:m.z.boolean().prefault(!0),æ˜¯å¦å¤„äºNSFWåœºæ™¯:m.z.boolean().prefault(!1),ä¸‹ä¸€å›åˆç•Œé¢é€‰æ‹©:m.z.enum(['çº¯æ–‡å­—å°¾é™„ç«‹ç»˜','å±•ç¤ºæ—¥è®°','galgame']).prefault('çº¯æ–‡å­—å°¾é™„ç«‹ç»˜')}).transform(e=>{const t=e.å½“å‰æ—¶é—´.split(':').map(Number).reduce((e,t)=>60*e+t,0);return e._å½“å‰æ—¶é—´é˜¶æ®µ=t<300?'å‡Œæ™¨':t<360?'æ—©æ™¨':t<720?'ä¸Šåˆ':t<840?'ä¸­åˆ':t<1020?'ä¸‹åˆ':t<1200?'æ™šä¸Š':'æ·±å¤œ','æ˜ŸæœŸå…­'!==e.å½“å‰æ˜ŸæœŸ&&'æ˜ŸæœŸæ—¥'!==e.å½“å‰æ˜ŸæœŸ||(e.æ˜¯å¦éœ€è¦ä¸Šå­¦=!1),e}),ä¸»çº¿äº‹ä»¶:m.z.discriminatedUnion('å½“å‰çŠ¶æ€',[m.z.object({å½“å‰çŠ¶æ€:m.z.literal('æ— æ³•è§¦å‘')}),m.z.object({å½“å‰çŠ¶æ€:m.z.literal('å†·å´ä¸­'),å‰©ä½™å†·å´å›åˆæ•°:m.z.coerce.number().nonnegative().prefault(20)}),m.z.object({å½“å‰çŠ¶æ€:m.z.literal('è¿›è¡Œä¸­'),å½“å‰é˜¶æ®µ:m.z.enum(['å¼•å…¥','å‘å±•','é«˜æ½®','ç»“å±€']).prefault('å¼•å…¥'),ä¸»é¢˜:m.z.string(),æè¿°:m.z.string(),å¤§çº²:m.z.object({å¼•å…¥:m.z.string(),å‘å±•:m.z.string(),é«˜æ½®:m.z.string(),ç»“å±€:m.z.string()})})]).prefault({å½“å‰çŠ¶æ€:'æ— æ³•è§¦å‘'}),ç»œç»œ:m.z.object({äº²å¯†åº¦:m.z.coerce.number().transform(e=>_.clamp(e,0,100)),é˜…è¯»æ—¥è®°æ•°é‡:m.z.coerce.number().nonnegative().prefault(0),æ‹¥æœ‰è”ç³»æ–¹å¼:m.z.boolean().prefault(!1)})}).transform(e=>(e.ç»œç»œ.äº²å¯†åº¦<50?e.ä¸»çº¿äº‹ä»¶.å½“å‰çŠ¶æ€='æ— æ³•è§¦å‘':'æ— æ³•è§¦å‘'===e.ä¸»çº¿äº‹ä»¶.å½“å‰çŠ¶æ€&&(e.ä¸»çº¿äº‹ä»¶={å½“å‰çŠ¶æ€:'å†·å´ä¸­',å‰©ä½™å†·å´å›åˆæ•°:0}),e));$(()=>{l(ye)});const je=[{name:'ğŸ•›åº¦è¿‡',function:async()=>{const e={æ™¨é—´:'å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ä¸‹ä¸ªæ™¨é—´',è¯¾ä¸Š:'å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ä¸‹ä¸ªè¯¾ä¸Š',åˆä¼‘:'å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ä¸‹ä¸ªåˆä¼‘',æ”¾å­¦å:'å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ä¸‹ä¸ªæ”¾å­¦å',å¤œé—´:'å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ä¸‹ä¸ªå¤œé—´',å‡æ—¥:'å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ä¸‹ä¸ªå‡æ—¥',ç¬¬äºŒå¤©:'å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ç¬¬äºŒå¤©ï¼Œå¹¶è°ƒæ•´å½“å‰æ—¶é—´é˜¶æ®µå˜é‡åˆ°æ¥ä¸‹æ¥æ•…äº‹æƒ…èŠ‚æœ€æœ‰æ„ä¹‰çš„æ—¶é—´ï¼Œä¸‹ä¸€æ¬¡å“åº”çš„æ—¶é—´é˜¶æ®µå˜é‡è°ƒæ•´æ²¡æœ‰ä»»ä½•é™åˆ¶'},t=await triggerSlash(`/buttons labels=${JSON.stringify(Object.keys(e))} æ—¶é—´æ¥åˆ°äº†...`);_.has(e,t)&&await triggerSlash(`/send ${e[t]} || /trigger`)}},{name:'ğŸ—ºï¸åœ°ç‚¹',function:async()=>{const e={ä½å®…:{æ—ç™½:'å›å®¶ï¼',åœ°ç‚¹:['ä½æ‰€ç„å…³','ä½æ‰€å®¢å…','æˆ¿é—´']},å­¦æ ¡:{æ—ç™½:'å»å­¦æ ¡å—...',åœ°ç‚¹:['ä¸Šå­¦è·¯ä¸Š','å­¦æ ¡æ•™å­¦æ¥¼æ­£é—¨å‰','æ•™å®¤','å­¦æ ¡ä¸­åº­','å­¦æ ¡å¤–ä¾§æ¥¼æ¢¯','å­¦æ ¡å±‹é¡¶']},åŸé•‡ä¸è¡—é“:{æ—ç™½:'å»é€›é€›å‘¢...',åœ°ç‚¹:['åŸé•‡è¡—é“ä¸Š','ä½å®…è¡—','å•†åº—è¡—','æ‹±å»Šå•†åº—è¡—','ç¹åå•†ä¸šè¡—','åŸå¸‚ä¸­çš„é“è·¯é“å£']},å•†ä¸šè®¾æ–½:{æ—ç™½:'å»çº¦ä¼šå—w...',åœ°ç‚¹:['ä¾¿åˆ©åº—å†…','ä¹¦åº—å†…','å’–å•¡å…','å®¶åº­é¤å…','è´­ç‰©ä¸­å¿ƒ','è´­ç‰©ä¸­å¿ƒäºŒå±‚','ç¾æœ¯é¦†','åœ°é“ç«™å†…','åœ°é“å†…','åº™ä¼šå°åƒè¡—']},æˆ·å¤–:{æ—ç™½:'é”»ç‚¼èº«ä½“...?',åœ°ç‚¹:['å…¬å›­','å…¬å›­å‡‰äº­','å…¬å›­å•†åº—äº­','æ²³æ—','æµ·æ»©']}},t=await triggerSlash(`/buttons labels=${JSON.stringify(Object.keys(e))} {{user}}å°†åŠ¨èº«å‰å¾€...`);if(!_.has(e,t))return;const{æ—ç™½:n,åœ°ç‚¹:o}=e[t],a=await triggerSlash(`/buttons labels=${JSON.stringify(o)} <small>${n}<small>`);o.includes(a)&&triggerSlash(`/send \x3c!--äºæœ¬æ¬¡å“åº”éœ€è¦æå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å†™å‡ºç†ç”±å‰å¾€ä¸‹ä¸€ä¸ªåœ°ç‚¹--\x3e[ç§»åŠ¨] {{user}}å‰å¾€äº†${a} || /trigger`)}}];function Ce(){return async function(){const e='çº¯ç™½è‰²çš„å›å“';JSON.parse(await triggerSlash('/qr-set-list')).includes(e)&&triggerSlash(`/qr-set-delete ${e}`)}(),je.forEach(e=>eventOn(getButtonEvent(e.name),e.function)),appendInexistentScriptButtons(je.map(e=>({name:e.name,visible:!0}))),{destroy:()=>replaceScriptButtons(getScriptButtons().filter(e=>je.some(t=>t.name===e.name)))}}const Se={class:'roleplay_options'},we={class:'roleplay_options_back'},Ne=['onClick'],ke={class:'roleplay_options_title'},Ee={class:'roleplay_options_content'},Ge=(0,h.defineComponent)({__name:'App',props:{messageId:{},options:{}},setup(e){const t=e,n=v();return(o,a)=>((0,h.openBlock)(),(0,h.createElementBlock)('div',Se,[(0,h.createElementVNode)('div',we,[((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)(e.options,e=>((0,h.openBlock)(),(0,h.createElementBlock)('div',{key:e.title,class:'roleplay_options_item',tabindex:'1',onClick:o=>async function(e){if(getLastMessageId()===t.messageId)switch(n.config.é€‰æ‹©æ¡†è§¦å‘æ–¹å¼){case'ç›´æ¥å‘é€':triggerSlash(`/send ${e.content} || /trigger`);break;case'è¦†ç›–è¾“å…¥':triggerSlash(`/setinput ${e.content}`)}}(e)},[(0,h.createElementVNode)('span',ke,[(0,h.createElementVNode)('strong',null,(0,h.toDisplayString)(e.title),1)]),a[0]||(a[0]=(0,h.createElementVNode)('hr',{class:'roleplay_options_hr'},null,-1)),(0,h.createElementVNode)('span',Ee,(0,h.toDisplayString)(e.content),1)],8,Ne))),128))])]))}});const Fe=new Map,Ae='<roleplay_options>',ze=/<(roleplay_options)>\s*(?:```.*\n)?((?:(?!<\1>)[\s\S])*?)(?:\n```)?\s*<\/\1>/im;async function We(e){const t=getChatMessages(e);if(0===t.length)return;const n=(t[0].message??'').match(ze);if(!n)return;const a=Number(e);Fe.get(a)?.unmount(),Fe.delete(a);const r=retrieveDisplayedMessage(a),i=r.find(`pre:contains("${Ae}")`);if(i.length>0){const e=i.parent('.TH-render');e.length>0?e.addClass('hidden!'):i.addClass('hidden!');const t=(0,h.createApp)(Ge,{messageId:a,options:[...n[2].matchAll(/(.+?)[:ï¼š]\s*(.+)/gm)].map(e=>({title:e[1],content:e[2].replace(/^\$\{(.+)\}$/,'$1').replace(/^ã€Œ(.+)ã€$/,'$1')}))}).use(o());Fe.set(a,t);const s=r.find(`div[script_id="${getScriptId()}"]`);t.mount(s.length>0?s[0]:$('<div>').attr('script_id',getScriptId()).appendTo(r)[0])}}async function $e(){Fe.forEach(e=>{e.unmount()}),Fe.clear(),$('#chat').children('.mes[is_user=\'false\'][is_system=\'false\']').each((e,t)=>{const n=$(t).attr('mesid');try{n&&We(parseInt(n))}catch(e){}})}function Me(){const{destroy:e}=function(){const e=v(),t=()=>'æš—è‰²'===e.config.æ ·å¼ä¸»é¢˜?'.roleplay_options_hr{display:none}.roleplay_options_back{background:#332d30;border-radius:16px;box-shadow:0 8px 20px rgba(20,18,19,0.25);padding:22px 24px;display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;border:1px solid #4a4447;width:90%;max-width:740px;margin:24px auto}.roleplay_options_item{position:relative;background:#403a3d;border-radius:12px;box-shadow:0 5px 15px rgba(20,18,19,0.2);padding:18px 20px;cursor:default;border:1px solid #4a4447;transition:all 0.28s cubic-bezier(0.22,1,0.36,1);overflow:hidden;display:flex;flex-direction:column;z-index:1;margin:0;color:#ffd0d8;font-weight:400;line-height:1.6;height:100%;font-family:\'Microsoft YaHei\',Arial,sans-serif}.last_mes .roleplay_options_item{cursor:pointer}.last_mes .roleplay_options_item::after{content:\'\';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(140deg,transparent 0%,transparent 50%,rgba(255,204,214,0.15) 150%);opacity:0;transition:opacity 0.35s ease;z-index:-1}.last_mes .roleplay_options_item:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(20,18,19,0.3);background:#4a4447;border-color:rgba(255,204,214,0.3)}.last_mes .roleplay_options_item:hover::after{opacity:1}.last_mes .roleplay_options_item:hover .roleplay_options_content{color:#ffe5ea}.last_mes .roleplay_options_item:active{transform:translateY(-2px);box-shadow:0 4px 12px rgba(20,18,19,0.2)}.roleplay_options_item:before{content:\'\';position:absolute;top:0;left:0;width:100%;height:3px;background:linear-gradient(90deg,#ffd0d8,#ffbbc8);transform:scaleX(0);transform-origin:0 0;transition:transform 0.35s cubic-bezier(0.4,0,0.2,1)}.last_mes .roleplay_options_item:hover:before{transform:scaleX(1)}.roleplay_options_title{font-size:0.95em;font-weight:600;color:#ffd0d8;margin-bottom:12px;letter-spacing:0.04em;text-align:left;padding-bottom:10px;border-bottom:1px solid rgba(80,74,77,0.3);text-shadow:0 1px 1px rgba(20,18,19,0.5);line-height:1.4;position:relative;display:flex;align-items:center}.roleplay_options_title::before{content:\'\';display:inline-block;width:6px;height:6px;background:#ffd0d8;border-radius:50%;margin-right:10px;box-shadow:0 0 0 2px rgba(255,204,214,0.2)}.roleplay_options_content{font-size:0.95em;line-height:1.65;color:#e0a7b5;font-weight:normal;transition:color 0.25s ease;text-align:left;flex:1;text-shadow:0 1px 1px rgba(20,18,19,0.5);letter-spacing:0.018em}.roleplay_options_item.selected{background:rgba(64,58,61,0.7);border-color:rgba(255,204,214,0.5)}.roleplay_options_item.selected:before{background:linear-gradient(90deg,#ffd0d8,#ffbbc8);transform:scaleX(1)}.roleplay_options_item.selected .roleplay_options_title::before{background:#ffd0d8;box-shadow:0 0 0 2px rgba(255,204,214,0.3)}@media (max-width:999px){.roleplay_options_back{padding:18px;gap:14px;grid-template-columns:1fr;width:100%;max-width:none;margin:24px 0;background:#332d30;border:1px solid #4a4447}.roleplay_options_item{padding:16px;background:#403a3d;border:1px solid #4a4447}.roleplay_options_title{font-size:0.9em;padding-bottom:8px;margin-bottom:10px}.roleplay_options_content{font-size:0.92em;line-height:1.6}}@media (prefers-reduced-motion:reduce){.roleplay_options_item,.roleplay_options_item::before,.roleplay_options_item::after,.roleplay_options_content,.roleplay_options_title{transition:none}}\n':'*{-webkit-tap-highlight-color:transparent}.roleplay_options_hr{display:none}.roleplay_options_back{background:#fff0f3;border-radius:16px;box-shadow:0 8px 20px rgba(145,125,138,0.15);padding:22px 24px;display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;border:1px solid #ffe5ea;width:90%;max-width:740px;margin:24px auto}.roleplay_options_item{position:relative;background:#fffafb;border-radius:12px;box-shadow:0 5px 15px rgba(145,125,138,0.1);padding:18px 20px;cursor:default;border:1px solid #ffe5ea;transition:all 0.28s cubic-bezier(0.22,1,0.36,1);overflow:hidden;display:flex;flex-direction:column;z-index:1;margin:0;color:#7d6b6e;font-weight:400;line-height:1.6;height:100%;font-family:\'Microsoft YaHei\',Arial,sans-serif}.last_mes .roleplay_options_item{cursor:pointer}.last_mes .roleplay_options_item::after{content:\'\';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(140deg,transparent 0%,transparent 50%,rgba(255,204,214,0.15) 150%);opacity:0;transition:opacity 0.35s ease;z-index:-1}.last_mes .roleplay_options_item:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(145,125,138,0.2);background:#fff5f7;border-color:rgba(255,204,214,0.3)}.last_mes .roleplay_options_item:hover::after{opacity:1}.last_mes .roleplay_options_item:hover .roleplay_options_content{color:#635759}.last_mes .roleplay_options_item:active{transform:translateY(-2px);box-shadow:0 4px 12px rgba(145,125,138,0.1)}.roleplay_options_item:before{content:\'\';position:absolute;top:0;left:0;width:100%;height:3px;background:linear-gradient(90deg,#ffd0d8,#ffbbc8);transform:scaleX(0);transform-origin:0 0;transition:transform 0.35s cubic-bezier(0.4,0,0.2,1)}.last_mes .roleplay_options_item:hover:before{transform:scaleX(1)}.roleplay_options_title{font-size:0.95em;font-weight:600;color:#7d6b6e;margin-bottom:12px;letter-spacing:0.04em;text-align:left;padding-bottom:10px;border-bottom:1px solid rgba(200,200,200,0.3);text-shadow:0 1px 1px rgba(255,255,255,0.5);line-height:1.4;position:relative;display:flex;align-items:center}.roleplay_options_title::before{content:\'\';display:inline-block;width:6px;height:6px;background:#ffd0d8;border-radius:50%;margin-right:10px;box-shadow:0 0 0 2px rgba(255,204,214,0.2)}.roleplay_options_content{font-size:0.95em;line-height:1.65;color:#8e7478;font-weight:normal;transition:color 0.25s ease;text-align:left;flex:1;text-shadow:0 1px 1px rgba(255,255,255,0.5);letter-spacing:0.018em}.roleplay_options_item.selected{background:rgba(255,235,240,0.7);border-color:rgba(255,204,214,0.5)}.roleplay_options_item.selected:before{background:linear-gradient(90deg,#ffd0d8,#ffbbc8);transform:scaleX(1)}.roleplay_options_item.selected .roleplay_options_title::before{background:#ffd0d8;box-shadow:0 0 0 2px rgba(255,204,214,0.3)}@media (max-width:999px){.roleplay_options_back{padding:18px;gap:14px;grid-template-columns:1fr;width:100%;max-width:none;margin:24px 0;background:#fff0f3;border:1px solid #ffe5ea}.roleplay_options_item{padding:16px;background:#fffafb;border:1px solid #ffe5ea}.roleplay_options_title{font-size:0.9em;padding-bottom:8px;margin-bottom:10px}.roleplay_options_content{font-size:0.92em;line-height:1.6}}@media (prefers-reduced-motion:reduce){.roleplay_options_item,.roleplay_options_item::before,.roleplay_options_item::after,.roleplay_options_content,.roleplay_options_title{transition:none}}\n';$('<div>').attr('script_id',getScriptId()).append(`<style roleplay_options>${t()}</style>`).appendTo('head');const n=(0,h.watch)(()=>e.config.æ ·å¼ä¸»é¢˜,()=>$(`head > div[script_id="${getScriptId()}"]`).find('style[roleplay_options]').text(t()));return{destroy:()=>{n(),$(`head > div[script_id="${getScriptId()}"]`).remove()}}}();return $e(),eventOn(tavern_events.CHAT_CHANGED,errorCatched($e)),eventOn(tavern_events.CHARACTER_MESSAGE_RENDERED,errorCatched(We)),eventOn(tavern_events.MESSAGE_UPDATED,errorCatched(We)),eventOn(tavern_events.MESSAGE_SWIPED,errorCatched(We)),eventOn(tavern_events.MESSAGE_DELETED,()=>setTimeout(errorCatched($e),1e3)),{destroy:()=>{$(`pre:contains("${Ae}")`).each(function(){const e=$(this).parent('.TH-render');e.length>0?e.removeClass('hidden!'):$(this).removeClass('hidden!')}),Fe.forEach(e=>{e?.unmount()}),Fe.clear(),e()}}}a(t()),$(async()=>{await e(()=>null!==getCharWorldbookNames('current').primary),await async function(){const e=(await getWorldbook(f)).find(e=>'ç‰ˆæœ¬å·'===e.name)?.content.trim()??'0.0.0';c(e,await fetch('https://testingcf.jsdelivr.net/gh/lolo-desu/lolocard/src/æ—¥è®°ç»œç»œ/ä¸–ç•Œä¹¦/ç‰ˆæœ¬å·.txt').then(e=>e.text()).then(e=>e.trim()).catch(()=>'0.0.0'),'>=')||(await importRawCharacter('ç™½åŒ–è“æŸ“çš„æ—¥è®°æœ¬',await fetch('https://testingcf.jsdelivr.net/gh/lolo-desu/lolocard/src/æ—¥è®°ç»œç»œ/ç™½åŒ–è“æŸ“çš„æ—¥è®°æœ¬.png').then(e=>e.blob())),c(getTavernVersion(),'4.3.18','<')&&SillyTavern.saveWorldInfo(f,JSON.parse(await fetch('https://testingcf.jsdelivr.net/gh/lolo-desu/lolocard/src/æ—¥è®°ç»œç»œ/ä¸–ç•Œä¹¦/æ—¥è®°ç»œç»œ.json').then(e=>e.text())),!0),toastr.success('è§’è‰²å¡è‡ªåŠ¨æ›´æ–°æˆåŠŸ, å‡†å¤‡åˆ·æ–°é¡µé¢ä»¥ç”Ÿæ•ˆ...','ç™½åŒ–è“æŸ“çš„æ—¥è®°æœ¬'),setTimeout(()=>triggerSlash('/reload-page'),3e3))}(),await v()._wait_init;const t=[];t.push((_e(),eventOn(tavern_events.CHAT_CHANGED,errorCatched(_e)),eventOn(tavern_events.CHARACTER_MESSAGE_RENDERED,errorCatched(xe)),eventOn(tavern_events.MESSAGE_UPDATED,errorCatched(xe)),eventOn(tavern_events.MESSAGE_SWIPED,errorCatched(e=>{const t=Number(e);be.get(t)?.destroy(),be.delete(t),xe(t)})),eventOn(tavern_events.MESSAGE_DELETED,()=>setTimeout(errorCatched(_e),1e3)),eventOn(tavern_events.STREAM_TOKEN_RECEIVED,errorCatched(e=>{const t=$('#chat').children('.mes.last_mes').attr('mesid');try{t&&xe(parseInt(t),e)}catch(e){}})),{destroy:()=>{$('.mes_text').removeClass('hidden!'),be.forEach(({destroy:e})=>e()),be.clear(),$(`.${ve}`).remove()}}).destroy),t.push((waitGlobalInitialized('Mvu').then(()=>{eventOn(Mvu.events.VARIABLE_UPDATE_ENDED,e=>{v().config.å§‹ç»ˆä½¿ç”¨galgameç•Œé¢&&_.set(e,'stat_data.ä¸–ç•Œ.ä¸‹ä¸€å›åˆç•Œé¢é€‰æ‹©','galgame')}),eventOn(tavern_events.GENERATION_STARTED,async()=>{v().config.å§‹ç»ˆä½¿ç”¨galgameç•Œé¢&&updateVariablesWith(e=>_.set(e,'stat_data.ä¸–ç•Œ.ä¸‹ä¸€å›åˆç•Œé¢é€‰æ‹©','galgame'),{type:'message'})})}),{destroy:()=>{}}).destroy),t.push(Ce().destroy),t.push(($('<div>').attr('script_id',getScriptId()).append($('<style>').text('@import url("https://static.zeoseven.com/zsft/510/main/result.css");:root{--lolo-font:"PING FANG SAN SHENG"}')).appendTo('head'),{destroy:()=>$(`head > div[script_id=${getScriptId()}]`).remove()}).destroy),t.push((Promise.allSettled([...ne,...oe].map(e=>new Promise(t=>{const n=ae(e);if(!n)return void t(null);const o=new Image;o.onload=t,o.onerror=t,o.src=n}))),{destroy:()=>{}}).destroy),t.push(Me().destroy),$(window).on('pagehide',()=>t.forEach(e=>e()))});
//# sourceMappingURL=index.js.map