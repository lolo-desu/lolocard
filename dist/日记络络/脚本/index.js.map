{"version":3,"file":"index.js","mappings":"yFAUAA,eAAe,IACb,MAAMC,EAAO,CACX,GAAI,2FACJ,GAAI,4FACJ,GAAI,4FACJ,IACE,6FACF,GAAI,4FACJ,GAAI,4FACJ,IACE,2IAGEC,QAAaC,aAAa,mBAAmBC,KAAKC,UAAUC,OAAOC,KAAKN,gBACzEO,EAAEC,IAAIR,EAAMC,UAIXC,aAAa,SAASF,EAAKC,iBACnC,CAEAF,eAAe,IACb,MAAMC,EAAqD,CACzD,GAAI,CAAE,GAAI,MAAO,GAAI,CAAC,OAAQ,OAAQ,OACtC,GAAI,CACF,GAAI,UACJ,GAAI,CAAC,OAAQ,WAAY,KAAM,OAAQ,SAAU,SAEnD,MAAO,CACL,GAAI,UACJ,GAAI,CAAC,QAAS,MAAO,MAAO,QAAS,QAAS,aAEhD,KAAM,CACJ,GAAI,WACJ,GAAI,CACF,OACA,MACA,MACA,OACA,OACA,SACA,MACA,OACA,MACA,UAGJ,GAAI,CACF,GAAI,WACJ,GAAI,CAAC,KAAM,OAAQ,QAAS,KAAM,QAIhCS,QAAcP,aAAa,mBAAmBC,KAAKC,UAAUC,OAAOC,KAAKN,wBAC/E,IAAKO,EAAEC,IAAIR,EAAMS,GACf,OAGF,MAAM,GAAE,EAAE,GAAE,GAAOT,EAAKS,GAClBC,QAAiBR,aAAa,mBAAmBC,KAAKC,UAAU,aAAc,YAC/E,EAAGO,SAASD,IAIjBR,aACE,oEAA8DQ,iFAElE,CAEA,SAAS,IACPE,QAAQC,IAAI,QACZX,aACE,gPAEJ,CAEAY,EAAE,MApFFf,iBACE,MACMgB,EAAc,SADEZ,KAAKa,YAAYd,aAAa,iBAE5CS,SAASI,IACfb,aAAa,kBAAkBa,IAEnC,CA+EEE,GACAC,cAAc,OAAQ,GACtBA,cAAc,QAAS,GACvBA,cAAc,OAAQ,KCxFxBJ,EAAE,MAIFf,iBACE,MAAMoB,EAA+C,CACnDC,WAAY,EACZC,mBAAoB,IACpBC,WAAY,EACZC,gBAAiB,EACjBC,UAAW,EACXC,oBAAqB,EAErBC,mBAAoB,kBAEpBC,eAAe,EACfC,WAAW,EACXC,gBAAgB,EAChBC,mBAAmB,EACnBC,mBAAmB,EACnBC,gBAAgB,GAEZC,EAAWC,sBACZ3B,EAAE4B,QAAQ5B,EAAE6B,MAAM,CAAC,EAAGH,EAAUd,GAAoBc,IACvDI,oBAAoBlB,EAExB,CAzBEmB,KCDFxB,EAAE,KACAyB,YAAYC,YAAY,CACpBC,SAAS,EAETC,kBAAkB,EAClBC,yBAAyB,EACzBC,uBAAuB,EAEvBC,gBAAgB,EAChBC,uBAAuB,EACvBC,qBAAqB,EACrBC,gCAAgC,EAChCC,wBAAwB,EACxBC,aAAc,EAEdC,kBAAkB,EAClBC,2BAA2B,EAC3BC,uBAAuB,EACvBC,eAAe,EACfC,gBAAgB,MCPtBxD,eAAeyD,EAAsBC,EAAmBC,GACtD,MAAMC,EAAYC,aAAa,CAAEC,KAAM,UAAWH,eAClDnD,EAAEuD,IAAIH,EAAWI,iBAAiB,uBAAwBN,SACpDO,iBAAiBL,EAAW,CAAEE,KAAM,UAAWH,cACvD,CAEA5C,EAAEf,UACAkE,QAAQC,cAAcC,aAAcpE,MAAM2D,IACxC,GAAmB,IAAfA,EAAkB,CACpB,MAAMD,QAnBZ1D,iBACE,MAAMqE,SAAiBC,mBAHH,WAIjBC,OAAOC,GAASA,EAAMC,QAAQC,WAAW,UAAYF,EAAM9B,SAC3DiC,IAAIH,GAASA,EAAMC,QAAQG,QAAQ,QAAS,KAC/C,OAAuB,IAAnBP,EAAQQ,OACH,IAEFR,EAAQ,EACjB,CAW2BS,SACfrB,EAAsBC,EAAQ,SAC9BD,EAAsBC,EAAQ,EACtC,M,MCtBE,EAAgB,SAEhBqB,EAAyB,iFAG/B,IAAUC,EAwCAC,EA6DVjF,eAAekF,EAAiBvB,GAC9B,MACMwB,EADkBC,gBAAgBzB,GAAY,GAAG0B,QACjCF,MAAMJ,GAC5B,IAAKI,EACH,OAEF,MAAMG,EAA4BL,EAAeM,wBAAwBJ,EAAM,IAEzEK,EAAYC,yBAAyB9B,GACrC+B,EAAYF,EAAUG,KAAK,yDAC7BD,EAAUb,OAAS,IACrBa,EAAUE,SACVJ,EAAUK,OAAOP,GAErB,CAEAtF,eAAe8F,IACb/E,EAAE,SACCgF,SAAS,gDACTC,KAAK,CAACC,EAAQC,KACb,MAAMvC,EAAa5C,EAAEmF,GAAMC,KAAK,SAChC,IACMxC,GACFuB,EAAiBkB,SAASzC,GAE9B,CAAE,MAAO0C,GAET,GAEN,EAlIA,SAAUrB,GAIR,MAAMsB,EAAyB,CAC7BC,WAAY,QA2BQ,EAAAC,OAAfxG,iBACL,MAAMyG,EAAa,EAAAC,OAEnB,OADA,EAAAA,aAxBF1G,iBACE,MAAMqE,EAAkC7D,EAAE6B,MACxC,CAAC,YACSiC,mBAAmB,IAC1BC,OAAOC,GAASA,EAAMC,QAAQC,WAAW,WAAaF,EAAM9B,SAC5DiC,IAAIH,IACH,MAAMmC,EAAQnC,EAAMC,QAAQG,QAAQ,SAAU,IAC9C,MAAO,CAAE,CAAC+B,GAAQnC,EAAMoC,YAIxBC,EAASP,EAQf,OAPI9F,EAAEC,IAAI4D,EAAS,QACjBwC,EAAON,WAAa,OACX/F,EAAEC,IAAI4D,EAAS,QACxBwC,EAAON,WAAa,OACX/F,EAAEC,IAAI4D,EAAS,UACxBwC,EAAON,WAAa,QAEfM,CACT,CAIiBC,IACPtG,EAAE4B,QAAQ,EAAAsE,OAAQD,EAC5B,CACD,CArCD,CAAUzB,IAAAA,EAAc,KAwCxB,SAAUC,GAiBR,IAAI8B,EAYkB,EAAAP,OAAfxG,iBACL,MAAMgH,EAAYD,EAElB,OADAA,QAZF/G,iBACE,MAAMiH,SAAiB3C,mBAAmB,IAAgBC,OACxDC,GAASA,EAAMC,QAAQC,WAAW,WAAaF,EAAM9B,SAEvD,OAAuB,IAAnBuE,EAAQpC,OACH,s1GAEFoC,EAAQ,GAAGL,OACpB,CAIgBM,IACN1G,EAAE4B,QAAQ2E,EAAOC,EAC3B,EAEgB,EAAAzB,wBAAhB,SAAwC4B,GACtC,MAAMC,EAAOrG,EAAE,kCAoBf,OAnBAqG,EAAKvB,OAAOkB,GACZK,EAAKvB,OACF9E,EAAE,uCAAkE8E,OACnE,IAAIsB,EAAKE,SAAS,uBACf1C,IAAIQ,IAAS,CACZmC,MAAOnC,EAAM,GACbyB,QAASzB,EAAM,GAAGP,QAAQ,eAAgB,MAAMA,QAAQ,WAAY,SAErED,IAAI,EAAG2C,QAAOV,aACb7F,EAAE,oDACCwG,GAAG,QAAS,YA9CzBvH,eAAwBwH,GACtB,GAAIA,EAASC,QAAQ,aAAa5C,OAAS,EAAG,CAC5C,MAAM+B,EAAUY,EAAS7B,KAAK,6BAA6BwB,OAAOO,OAClE,GAAyC,SAArC1C,EAAe0B,OAAOH,WACxBpG,aAAa,SAASyG,sBACjB,GAAyC,SAArC5B,EAAe0B,OAAOH,WAC/BpG,aAAa,aAAayG,UACrB,GAAyC,SAArC5B,EAAe0B,OAAOH,WAAuB,CACtD,MAAMoB,EAAc5G,EAAE,kBAAkB6G,MACxC7G,EAAE,kBACC6G,IAAI,CAACD,EAAaf,GAASiB,KAAK,OAAS,IAAI,GAC7CC,cAAc,IAAIC,MAAM,QAAS,CAAEC,SAAS,IACjD,CACF,CACF,CAiCcC,CAASlH,EAAEmH,MACb,GACCrC,OAAO,gDAAgDyB,qBACvDzB,OAAO,oCACPA,OAAO,0CAA0Ce,eAIrDQ,CACT,CACD,CA1DD,CAAUnC,IAAAA,EAAc,KA4FxBlE,EAAEf,gBACMmI,aAAanD,EAAewB,OAA5B2B,SACAA,aAAalD,EAAeuB,OAA5B2B,SACArC,IACN5B,QAAQC,cAAciE,aAAcD,aAAarC,IACjD5B,QAAQC,cAAckE,2BAA4BF,aAAajD,IAC/DhB,QAAQC,cAAcmE,gBAAiBH,aAAajD,IACpDhB,QAAQC,cAAcoE,eAAgBJ,aAAajD,IACnDhB,QAAQC,cAAcqE,gBAAiB,IAAMC,WAAWN,aAAarC,GAAmB,MACxF5B,QACEC,cAAcuE,kBACdP,aAAanI,MAAM2I,IACbA,IAAa,UAGL3D,EAAewB,gBAAqBvB,EAAeuB,iBAGzDV,SC/IZ/E,EAAE,KACA,MACM6H,EAZR,SAA4B7B,GAC1B,OAAOhG,EAAE,WAAWoF,KAAK,KAAM,uBAAuB0C,iBAAiB1B,KAAKJ,EAC9E,CAUqB+B,CAfZtI,EAAEuI,IAAIlF,aAAa,CAAEC,KAAM,SAAUkF,UAAWH,gBAAkB,OAAQ,MAOnF,SAAyB3C,GACvB,MAAM+C,EAAQlI,EAAE,QAChBkI,EAAMtD,KAAK,wBAAwBkD,iBAAiBjD,SACpDqD,EAAMpD,OAAOK,EACf,CAKEgD,CAAgBN,KCDlB7H,EAAE,KACA,MACMoI,EAdR,SAA+BC,GAC7B,OAAOrI,EAAE,SACNoF,KAAK,KAAM,kBAAkB0C,iBAC7BhD,OAAOuD,EAASzE,IAAI0E,GAAWtI,EAAE,UAAUoF,KAAK,MAAO,WAAWA,KAAK,OAAQkD,GAASlD,KAAK,KAAM,UACxG,CAUwBmD,CAjBf9I,EAAEuI,IAAIlF,aAAa,CAAEC,KAAM,SAAUkF,UAAWH,gBAAkB,OAAQ,MASnF,SAA2B3C,GACzB,MAAM+C,EAAQlI,EAAE,QAChBkI,EAAMtD,KAAK,mBAAmBkD,iBAAiBjD,SAC/CqD,EAAMpD,OAAOK,EACf,CAKEqD,CAAkBJ,KCuBpBpI,EAAE,KACA0H,WAAWzI,UACT,MAAMwJ,EAAalJ,OAAO2G,QACxBzG,EAAEuI,IAAIlF,aAAa,CAAEC,KAAM,SAAUkF,UAAWH,gBAAkB,SAAU,CAAC,IAE5ElE,IAAI,EAAE8E,EAAMC,MACX,IAAIC,EAAMD,EAAI9E,QAAQ,cAAe,IAErC,OADA+E,EAAMA,EAAIC,UAAUD,EAAIE,YAAY,KAAO,GACpC,CACL,CAACF,GAAM,CACLF,OACAC,UAILI,OAAO,CAACC,EAAUC,IAAYxJ,EAAEyJ,SAASF,EAAUC,GAAU,CAAC,GAE3DE,QA3DVlK,iBACE,IACE,MAAMmK,QAAiBC,MAAM,4BAE7B,OAAID,EAASE,UAC4EF,EAASG,QAE7F/F,OAAOgG,GAAgC,WAAnBA,EAAUzG,MAC9Ba,IAAI4F,GAAaA,EAAUd,KAAK7E,QAAQ,eAAgB,KAEpD,EAEX,CAAE,MAAO4F,GAEP,OADA3J,QAAQwF,MAAMmE,GACP,EACT,CACF,CA2CqCC,GAC3BC,EAA2BlK,EAAEmK,WAAWrK,OAAOC,KAAKiJ,GAAaU,GAC/B,IAApCQ,EAAyB7F,cAKnB+F,YAAYC,iBAClB,yBACEH,EAAyB/F,IAAIgF,GAAO,KAAKH,EAAWG,GAAKF,QAAQ5B,KAAK,QACxE+C,YAAYE,WAAWC,QACvB,GACA,CAAEC,WAAW,YAMXC,QAAQC,WAAWR,EAAyB/F,IAAIgF,GA3D1D3J,eAAiC0J,GAC/B,MAAMyB,QAAgBf,MAAM,0BAA2B,CACrDgB,OAAQ,OACRC,QAAST,YAAYU,oBACrBC,KAAMnL,KAAKC,UAAU,CACnBqJ,UAGJ,IAAKyB,EAAQd,GAAI,CACf,MAAMlD,QAAagE,EAAQhE,OAG3B,OAFAqE,OAAOC,QAAQ,GAAGtE,GAAQgE,EAAQO,aAAc,UAChD7K,QAAQwF,MAAM,SAAU8E,EAAQQ,OAAQR,EAAQO,WAAYvE,IACrD,CACT,CAEA,MAAMgD,QAAiBgB,EAAQb,OAM/B,OALAkB,OAAOI,QACL,WAAWzB,EAAS0B,gBAAgB1B,EAAS2B,qBAAqB3B,EAAS4B,YAC3E,UAEFlL,QAAQmL,MAAM,SAAS7B,EAAS2B,qBAAqB3B,EAAS8B,kBACvD,CACT,CAqCiEC,CAAkB1C,EAAWG,GAAKD,OAC/FjB,WAAW,IAAMtI,aAAa,gBAAiB,OAC9C,OCpEL,MAAMgM,EAAgC3L,EAAE4L,SAXxC,WACE,MAAMC,EAAc,IACdnK,EAAW0I,YAAY0B,wBACS,IAAlCpK,EAASqK,sBAAiCrK,EAASsK,qBAAuBH,IAI9EtL,EAAE,6BAA6B0L,KAAK,WAAW,GAAMC,QAAQ,SAC7D3L,EAAE,+BAA+B6G,IAAIyE,GACrCtL,EAAE,uBAAuB6G,IAAIyE,GAAaK,QAAQ,SACpD,EACsE,KAEtE3L,EAAE,KACAmD,QAAQC,cAAcwI,iBAAkBR","sources":["src://tavern_helper_template/src/æ—¥è®°ç»œç»œ/è„šæœ¬/æŒ‰é’®.ts","src://tavern_helper_template/src/æ—¥è®°ç»œç»œ/è„šæœ¬/è°ƒæ•´ä¸–ç•Œä¹¦å…¨å±€è®¾ç½®.ts","src://tavern_helper_template/src/æ—¥è®°ç»œç»œ/è„šæœ¬/æç¤ºè¯æ¨¡æ¿è®¾ç½®.ts","src://tavern_helper_template/src/æ—¥è®°ç»œç»œ/è„šæœ¬/æ€§åˆ«è®¾ç½®.ts","src://tavern_helper_template/src/æ—¥è®°ç»œç»œ/è„šæœ¬/é€‰æ‹©æ¡†.ts","src://tavern_helper_template/src/æ—¥è®°ç»œç»œ/è„šæœ¬/æ ·å¼åŠ è½½.ts","src://tavern_helper_template/src/æ—¥è®°ç»œç»œ/è„šæœ¬/èµ„æºé¢„è½½.ts","src://tavern_helper_template/src/æ—¥è®°ç»œç»œ/è„šæœ¬/è‡ªåŠ¨å®‰è£…æ’ä»¶.ts","src://tavern_helper_template/src/æ—¥è®°ç»œç»œ/è„šæœ¬/æœ€å¤§åŒ–é¢„è®¾ä¸Šä¸‹æ–‡é•¿åº¦.ts"],"sourcesContent":["export {};\n\nasync function delete_qr() {\n  const qrs: string[] = JSON.parse(await triggerSlash('/qr-set-list'));\n  const expected_qr = 'çº¯ç™½è‰²çš„å›å“';\n  if (qrs.includes(expected_qr)) {\n    triggerSlash(`/qr-set-delete ${expected_qr}`);\n  }\n}\n\nasync function handle_åº¦è¿‡() {\n  const data = {\n    æ™¨é—´: \"å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ä¸‹ä¸ªæ™¨é—´\\n<UpdateVariable>\\n_.set('ä¸–ç•Œ.å½“å‰æ—¶é—´é˜¶æ®µ', 1);\\n</UpdateVariable>\",\n    è¯¾ä¸Š: \"å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ä¸‹ä¸ªè¯¾ä¸Š\\n<UpdateVariable>\\n_.set('ä¸–ç•Œ.å½“å‰æ—¶é—´é˜¶æ®µ', 18);\\n</UpdateVariable>\",\n    åˆä¼‘: \"å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ä¸‹ä¸ªåˆä¼‘\\n<UpdateVariable>\\n_.set('ä¸–ç•Œ.å½“å‰æ—¶é—´é˜¶æ®µ', 32);\\n</UpdateVariable>\",\n    æ”¾å­¦å:\n      \"å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ä¸‹ä¸ªæ”¾å­¦å\\n<UpdateVariable>\\n_.set('ä¸–ç•Œ.å½“å‰æ—¶é—´é˜¶æ®µ', 49);\\n</UpdateVariable>\",\n    å¤œé—´: \"å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ä¸‹ä¸ªå¤œé—´\\n<UpdateVariable>\\n_.set('ä¸–ç•Œ.å½“å‰æ—¶é—´é˜¶æ®µ', 66);\\n</UpdateVariable>\",\n    å‡æ—¥: \"å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ä¸‹ä¸ªå‡æ—¥\\n<UpdateVariable>\\n_.set('ä¸–ç•Œ.å½“å‰æ—¶é—´é˜¶æ®µ', 83);\\n</UpdateVariable>\",\n    ç¬¬äºŒå¤©:\n      \"å…ˆæå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å¿«é€Ÿå°†æ—¶é—´è°ƒæ•´åˆ°ç¬¬äºŒå¤©ï¼Œå¹¶è°ƒæ•´å½“å‰æ—¶é—´é˜¶æ®µå˜é‡åˆ°æ¥ä¸‹æ¥æ•…äº‹æƒ…èŠ‚æœ€æœ‰æ„ä¹‰çš„æ—¶é—´ï¼Œä¸‹ä¸€æ¬¡å“åº”çš„æ—¶é—´é˜¶æ®µå˜é‡è°ƒæ•´æ²¡æœ‰ä»»ä½•é™åˆ¶\\n<UpdateVariable>\\n_.set('ä¸–ç•Œ.å½“å‰æ—¶é—´é˜¶æ®µ', 1);\\n</UpdateVariable>\",\n  };\n\n  const time = await triggerSlash(`/buttons labels=${JSON.stringify(Object.keys(data))} æ—¶é—´æ¥åˆ°äº†...`);\n  if (!_.has(data, time)) {\n    return;\n  }\n\n  await triggerSlash(`/send ${data[time as keyof typeof data]} || /trigger`);\n}\n\nasync function handle_åœ°ç‚¹() {\n  const data: Record<string, { æ—ç™½: string; åœ°ç‚¹: string[] }> = {\n    ä½å®…: { æ—ç™½: 'å›å®¶ï¼', åœ°ç‚¹: ['ä½æ‰€ç„å…³', 'ä½æ‰€å®¢å…', 'æˆ¿é—´'] },\n    å­¦æ ¡: {\n      æ—ç™½: 'å»å­¦æ ¡å—...',\n      åœ°ç‚¹: ['ä¸Šå­¦è·¯ä¸Š', 'å­¦æ ¡æ•™å­¦æ¥¼æ­£é—¨å‰', 'æ•™å®¤', 'å­¦æ ¡ä¸­åº­', 'å­¦æ ¡å¤–ä¾§æ¥¼æ¢¯', 'å­¦æ ¡å±‹é¡¶'],\n    },\n    åŸé•‡ä¸è¡—é“: {\n      æ—ç™½: 'å»é€›é€›å‘¢...',\n      åœ°ç‚¹: ['åŸé•‡è¡—é“ä¸Š', 'ä½å®…è¡—', 'å•†åº—è¡—', 'æ‹±å»Šå•†åº—è¡—', 'ç¹åå•†ä¸šè¡—', 'åŸå¸‚ä¸­çš„é“è·¯é“å£'],\n    },\n    å•†ä¸šè®¾æ–½: {\n      æ—ç™½: 'å»çº¦ä¼šå—w...',\n      åœ°ç‚¹: [\n        'ä¾¿åˆ©åº—å†…',\n        'ä¹¦åº—å†…',\n        'å’–å•¡å…',\n        'å®¶åº­é¤å…',\n        'è´­ç‰©ä¸­å¿ƒ',\n        'è´­ç‰©ä¸­å¿ƒäºŒå±‚',\n        'ç¾æœ¯é¦†',\n        'åœ°é“ç«™å†…',\n        'åœ°é“å†…',\n        'åº™ä¼šå°åƒè¡—',\n      ],\n    },\n    æˆ·å¤–: {\n      æ—ç™½: 'é”»ç‚¼èº«ä½“...?',\n      åœ°ç‚¹: ['å…¬å›­', 'å…¬å›­å‡‰äº­', 'å…¬å›­å•†åº—äº­', 'æ²³æ—', 'æµ·æ»©'],\n    },\n  };\n\n  const place = await triggerSlash(`/buttons labels=${JSON.stringify(Object.keys(data))} {{user}}å°†åŠ¨èº«å‰å¾€...`);\n  if (!_.has(data, place)) {\n    return;\n  }\n\n  const { æ—ç™½, åœ°ç‚¹ } = data[place];\n  const subplace = await triggerSlash(`/buttons labels=${JSON.stringify(åœ°ç‚¹)} <small>${æ—ç™½}<small>`);\n  if (!åœ°ç‚¹.includes(subplace)) {\n    return;\n  }\n\n  triggerSlash(\n    `/send <!--äºæœ¬æ¬¡å“åº”éœ€è¦æå†™ç»“æŸå½“å‰åœºæ™¯çš„å‰§æƒ…å†å†™å‡ºç†ç”±å‰å¾€ä¸‹ä¸€ä¸ªåœ°ç‚¹-->[ç§»åŠ¨] {{user}}å‰å¾€äº†${subplace}\\n<UpdateVariable>\\n_.set('ä¸–ç•Œ.ä¸‹æ¬¡å“åº”ç•Œé¢é€‰æ‹©åˆ¤æ–­', 0);\\n</UpdateVariable> || /trigger`,\n  );\n}\n\nfunction handle_è®¡æ•°() {\n  console.log('ğŸ“Šè®¡æ•°');\n  triggerSlash(\n    `/ejs ä¸Šæ¬¡å‘é€äº†ï¼š<%- variables.LAST_SEND_TOKENS %> è¯ç¬¦(tokens), å…±è®¡ <%- variables.LAST_SEND_CHARS %> å­—ç¬¦ã€‚<br/>æ”¶åˆ°çš„æ¶ˆæ¯å¤„ç†åï¼š<%- variables.LAST_RECEIVE_TOKENS %> è¯ç¬¦(tokens), å…±è®¡ <%- variables.LAST_RECEIVE_CHARS %> å­—ç¬¦ã€‚ | /popup <h4>æç¤ºè¯è®¡æ•°</h4><br>{{pipe}}`,\n  );\n}\n\n$(() => {\n  delete_qr();\n  eventOnButton('ğŸ•›åº¦è¿‡', handle_åº¦è¿‡);\n  eventOnButton('ğŸ—ºï¸åœ°ç‚¹', handle_åœ°ç‚¹);\n  eventOnButton('ğŸ“Šè®¡æ•°', handle_è®¡æ•°);\n});\n","export {};\n\n$(() => {\n  sync_lorebook_settings();\n});\n\nasync function sync_lorebook_settings() {\n  const EXPECTED_SETTINGS: Partial<LorebookSettings> = {\n    scan_depth: 2,\n    context_percentage: 100,\n    budget_cap: 0,\n    min_activations: 0,\n    max_depth: 0,\n    max_recursion_steps: 0,\n\n    insertion_strategy: 'character_first',\n\n    include_names: false,\n    recursive: true,\n    case_sensitive: false,\n    match_whole_words: false,\n    use_group_scoring: false,\n    overflow_alert: false,\n  };\n  const settings = getLorebookSettings();\n  if (!_.isEqual(_.merge({}, settings, EXPECTED_SETTINGS), settings)) {\n    setLorebookSettings(EXPECTED_SETTINGS);\n  }\n}\n","export {};\n\n$(() => {\n  EjsTemplate.setFeatures({\n      enabled: true,\n\n      generate_enabled: true,\n      generate_loader_enabled: true,\n      inject_loader_enabled: true,\n\n      render_enabled: false,\n      render_loader_enabled: false,\n      code_blocks_enabled: false,\n      raw_message_evaluation_enabled: false,\n      filter_message_enabled: false,\n      depth_limit: -1,\n\n      autosave_enabled: false,\n      preload_worldinfo_enabled: false,\n      with_context_disabled: false,\n      debug_enabled: false,\n      invert_enabled: true,\n  });\n});\n","export {};\n\nconst lorebook_name = 'ä¸Šé”çš„æ—¥è®°æœ¬' as const;\n\nasync function get_gender_option(): Promise<'ç”·' | 'å¥³'> {\n  const options = (await getLorebookEntries(lorebook_name))\n    .filter(entry => entry.comment.startsWith('æ€§åˆ«è®¾ç½®-') && entry.enabled)\n    .map(entry => entry.comment.replace('æ€§åˆ«è®¾ç½®-', ''));\n  if (options.length === 0) {\n    return 'ç”·';\n  }\n  return options[0] as 'ç”·' | 'å¥³';\n}\n\nasync function set_gender_on_message(gender: 'ç”·' | 'å¥³', message_id: number) {\n  const variables = getVariables({ type: 'message', message_id });\n  _.set(variables, substitudeMacros('stat_data.<user>.æ€§åˆ«'), gender);\n  await replaceVariables(variables, { type: 'message', message_id });\n}\n\n$(async () => {\n  eventOn(tavern_events.MESSAGE_SENT, async message_id => {\n    if (message_id === 1) {\n      const gender = await get_gender_option();\n      await set_gender_on_message(gender, 0);\n      await set_gender_on_message(gender, 1);\n    }\n  });\n});\n","export {};\n\nimport default_css from './é€‰æ‹©æ¡†é»˜è®¤æ ·å¼.css?raw';\n\nconst lorebook_name = 'ä¸Šé”çš„æ—¥è®°æœ¬' as const;\nconst roleplay_options_tag = '<roleplay_options>' as const;\nconst roleplay_options_regex = /<(roleplay_options)>\\s*(?:```.*\\n)?((?:(?!<\\1>)[\\s\\S])*?)(?:\\n```)?\\s*<\\/\\1>/mi;\n\n//----------------------------------------------------------------------------------------------------------------------\nnamespace option_section {\n  interface Option {\n    input_mode: 'ç›´æ¥å‘é€' | 'è¦†ç›–è¾“å…¥' | 'å°¾é™„è¾“å…¥' | 'è‡ªåŠ¨æ¨è¿›';\n  }\n  const default_option: Option = {\n    input_mode: 'ç›´æ¥å‘é€',\n  };\n\n  export let option: Option;\n\n  async function parse_option(): Promise<Option> {\n    const options: Record<string, string> = _.merge(\n      {},\n      ...(await getLorebookEntries(lorebook_name))\n        .filter(entry => entry.comment.startsWith('é€‰æ‹©æ¡†è®¾ç½®-') && entry.enabled)\n        .map(entry => {\n          const value = entry.comment.replace('é€‰æ‹©æ¡†è®¾ç½®-', '');\n          return { [value]: entry.content };\n        }),\n    );\n\n    const result = default_option;\n    if (_.has(options, 'ç›´æ¥å‘é€')) {\n      result.input_mode = 'ç›´æ¥å‘é€';\n    } else if (_.has(options, 'è¦†ç›–è¾“å…¥')) {\n      result.input_mode = 'è¦†ç›–è¾“å…¥';\n    } else if (_.has(options, 'å°¾é™„è¾“å…¥')) {\n      result.input_mode = 'å°¾é™„è¾“å…¥';\n    }\n    return result;\n  }\n\n  export async function update(): Promise<boolean> {\n    const old_option = option;\n    option = await parse_option();\n    return !_.isEqual(option, old_option);\n  }\n}\n\n//----------------------------------------------------------------------------------------------------------------------\nnamespace render_section {\n  async function divclick($element: JQuery<HTMLDivElement>) {\n    if ($element.parents('.last_mes').length > 0) {\n      const content = $element.find('.roleplay_options_content').text().trim();\n      if (option_section.option.input_mode === 'ç›´æ¥å‘é€') {\n        triggerSlash(`/send ${content} || /trigger`);\n      } else if (option_section.option.input_mode === 'è¦†ç›–è¾“å…¥') {\n        triggerSlash(`/setinput ${content}`);\n      } else if (option_section.option.input_mode === 'å°¾é™„è¾“å…¥') {\n        const old_content = $('#send_textarea').val();\n        $('#send_textarea')\n          .val([old_content, content].join('\\n') || '')[0]\n          .dispatchEvent(new Event('input', { bubbles: true }));\n      }\n    }\n  }\n\n  let style: string;\n\n  async function extract_style(): Promise<string> {\n    const entries = (await getLorebookEntries(lorebook_name)).filter(\n      entry => entry.comment.startsWith('é€‰æ‹©æ¡†æ ·å¼-') && entry.enabled,\n    );\n    if (entries.length === 0) {\n      return `<style>${default_css}</style>`;\n    }\n    return entries[0].content;\n  }\n\n  export async function update(): Promise<boolean> {\n    const old_style = style;\n    style = await extract_style();\n    return !_.isEqual(style, old_style);\n  }\n\n  export function extract_options_element(text: string): JQuery<HTMLDivElement> {\n    const $div = $('<div class=\"roleplay_options\">') as JQuery<HTMLDivElement>;\n    $div.append(style);\n    $div.append(\n      ($('<div class=\"roleplay_options_back\">') as JQuery<HTMLDivElement>).append(\n        [...text.matchAll(/(.+?)[:ï¼š]\\s*(.+)/gm)]\n          .map(match => ({\n            title: match[1],\n            content: match[2].replace(/^\\$\\{(.+)\\}$/, '$1').replace(/^ã€Œ(.+)ã€$/, '$1'),\n          }))\n          .map(({ title, content }) =>\n            $('<div class=\"roleplay_options_item\" tabindex=\"1\">')\n              .on('click', function (this: HTMLDivElement) {\n                divclick($(this));\n              })\n              .append(`<span class=\"roleplay_options_title\"><strong>${title}</strong></span>`)\n              .append('<hr class=\"roleplay_options_hr\">')\n              .append(`<span class=\"roleplay_options_content\">${content}</span>`),\n          ),\n      ),\n    );\n    return $div;\n  }\n}\n\n//----------------------------------------------------------------------------------------------------------------------\nasync function renderOneMessage(message_id: number) {\n  const message: string = getChatMessages(message_id)[0].message;\n  const match = message.match(roleplay_options_regex);\n  if (!match) {\n    return;\n  }\n  const $roleplay_options_element = render_section.extract_options_element(match[2]);\n\n  const $mes_text = retrieveDisplayedMessage(message_id);\n  const to_render = $mes_text.find(`.roleplay_options, pre:contains(\"${roleplay_options_tag}\")`);\n  if (to_render.length > 0) {\n    to_render.remove();\n    $mes_text.append($roleplay_options_element);\n  }\n}\n\nasync function renderAllMessage() {\n  $('#chat')\n    .children(\".mes[is_user='false'][is_system='false']\")\n    .each((_index, node) => {\n      const message_id = $(node).attr('mesid');\n      try {\n        if (message_id) {\n          renderOneMessage(parseInt(message_id));\n        }\n      } catch (error) {\n        /** empty */\n      }\n    });\n}\n\n$(async () => {\n  await errorCatched(option_section.update)();\n  await errorCatched(render_section.update)();\n  await renderAllMessage();\n  eventOn(tavern_events.CHAT_CHANGED, errorCatched(renderAllMessage));\n  eventOn(tavern_events.CHARACTER_MESSAGE_RENDERED, errorCatched(renderOneMessage));\n  eventOn(tavern_events.MESSAGE_UPDATED, errorCatched(renderOneMessage));\n  eventOn(tavern_events.MESSAGE_SWIPED, errorCatched(renderOneMessage));\n  eventOn(tavern_events.MESSAGE_DELETED, () => setTimeout(errorCatched(renderAllMessage), 1000));\n  eventOn(\n    tavern_events.WORLDINFO_UPDATED,\n    errorCatched(async lorebook => {\n      if (lorebook !== lorebook_name) {\n        return;\n      }\n      if (!(await option_section.update()) && !(await render_section.update())) {\n        return;\n      }\n      await renderAllMessage();\n    }),\n  );\n});\n","export {};\n\nfunction get_style(): string {\n  return _.get(getVariables({ type: 'script', script_id: getScriptId() }), 'æ ·å¼åŠ è½½', '');\n}\n\nfunction extract_style_node(style: string) {\n  return $('<style>').attr('id', `script_custom_style-${getScriptId()}`).text(style);\n}\n\nfunction reappend_styles(node: JQuery) {\n  const $head = $('head');\n  $head.find(`#script_custom_style-${getScriptId()}`).remove();\n  $head.append(node);\n}\n\n$(() => {\n  const style = get_style();\n  const style_node = extract_style_node(style);\n  reappend_styles(style_node);\n});\n","export {};\n\nfunction get_preloads(): string[] {\n  return _.get(getVariables({ type: 'script', script_id: getScriptId() }), 'èµ„æºé¢„è½½', []);\n}\n\nfunction extract_preloads_node(preloads: string[]) {\n  return $('<div>')\n    .attr('id', `script_preload-${getScriptId()}`)\n    .append(preloads.map(preload => $('<link>').attr('rel', 'preload').attr('href', preload).attr('as', 'image')));\n}\n\nfunction reappend_preloads(node: JQuery) {\n  const $head = $('head');\n  $head.find(`#script_preload-${getScriptId()}`).remove();\n  $head.append(node);\n}\n\n$(() => {\n  const preloads = get_preloads();\n  const preloads_node = extract_preloads_node(preloads);\n  reappend_preloads(preloads_node);\n});\n","export {};\n\nasync function get_third_party_extension_names(): Promise<string[]> {\n  try {\n    const response = await fetch('/api/extensions/discover');\n\n    if (response.ok) {\n      const extensions: Array<{ type: 'lcoal' | 'global' | 'system'; name: string }> = await response.json();\n      return extensions\n        .filter(extension => extension.type !== 'system')\n        .map(extension => extension.name.replace('third-party/', ''));\n    } else {\n      return [];\n    }\n  } catch (err) {\n    console.error(err);\n    return [];\n  }\n}\n\nasync function install_extension(url: string): Promise<boolean> {\n  const request = await fetch('/api/extensions/install', {\n    method: 'POST',\n    headers: SillyTavern.getRequestHeaders(),\n    body: JSON.stringify({\n      url,\n    }),\n  });\n  if (!request.ok) {\n    const text = await request.text();\n    toastr.warning(`${text || request.statusText}`, 'æ‰©å±•å®‰è£…å¤±è´¥');\n    console.error('æ‰©å±•å®‰è£…å¤±è´¥', request.status, request.statusText, text);\n    return false;\n  }\n\n  const response = await request.json();\n  toastr.success(\n    `å·²æˆåŠŸå®‰è£…ç”± '${response.author}' ç¼–å†™çš„ '${response.display_name}' (ç‰ˆæœ¬ ${response.version})!`,\n    'æ‰©å±•å®‰è£…æˆåŠŸ',\n  );\n  console.debug(`å·²æˆåŠŸå°† '${response.display_name}' å®‰è£…åˆ° ${response.extensionPath}`);\n  return true;\n}\n\n$(() => {\n  setTimeout(async () => {\n    const extensions = Object.entries<string>(\n      _.get(getVariables({ type: 'script', script_id: getScriptId() }), 'è‡ªåŠ¨å®‰è£…æ’ä»¶', {}) as Record<string, string>,\n    )\n      .map(([name, url]) => {\n        let tag = url.replace(/(\\.git|\\/)$/, '');\n        tag = tag.substring(tag.lastIndexOf('/') + 1);\n        return {\n          [tag]: {\n            name,\n            url,\n          },\n        };\n      })\n      .reduce((previous, current) => _.defaults(previous, current), {});\n\n    const current_extensions = await get_third_party_extension_names();\n    const uninstall_extension_tags = _.difference(Object.keys(extensions), current_extensions);\n    if (uninstall_extension_tags.length === 0) {\n      return;\n    }\n\n    if (\n      !(await SillyTavern.callGenericPopup(\n        'ä»¥ä¸‹éœ€è¦çš„æ’ä»¶å°šæœªå®‰è£…, æ˜¯å¦å®‰è£…?<br>' +\n          uninstall_extension_tags.map(tag => `- ${extensions[tag].name}`).join('<br>'),\n        SillyTavern.POPUP_TYPE.CONFIRM,\n        '',\n        { leftAlign: true },\n      ))\n    ) {\n      return;\n    }\n\n    await Promise.allSettled(uninstall_extension_tags.map(tag => install_extension(extensions[tag].url)));\n    setTimeout(() => triggerSlash('/reload-page'), 3000);\n  }, 10000);\n});\n","export {};\n\nfunction unlock_token_length() {\n  const MAX_CONTEXT = 2000000;\n  const settings = SillyTavern.chatCompletionSettings;\n  if (settings.max_context_unlocked === true && settings.openai_max_context === MAX_CONTEXT) {\n    return;\n  }\n\n  $('#oai_max_context_unlocked').prop('checked', true).trigger('input');\n  $('#openai_max_context_counter').val(MAX_CONTEXT);\n  $('#openai_max_context').val(MAX_CONTEXT).trigger('input');\n}\nconst unlock_token_length_debounced = _.debounce(unlock_token_length, 1000);\n\n$(() => {\n  eventOn(tavern_events.SETTINGS_UPDATED, unlock_token_length_debounced);\n});\n"],"names":["async","data","time","triggerSlash","JSON","stringify","Object","keys","_","has","place","subplace","includes","console","log","$","expected_qr","parse","delete_qr","eventOnButton","EXPECTED_SETTINGS","scan_depth","context_percentage","budget_cap","min_activations","max_depth","max_recursion_steps","insertion_strategy","include_names","recursive","case_sensitive","match_whole_words","use_group_scoring","overflow_alert","settings","getLorebookSettings","isEqual","merge","setLorebookSettings","sync_lorebook_settings","EjsTemplate","setFeatures","enabled","generate_enabled","generate_loader_enabled","inject_loader_enabled","render_enabled","render_loader_enabled","code_blocks_enabled","raw_message_evaluation_enabled","filter_message_enabled","depth_limit","autosave_enabled","preload_worldinfo_enabled","with_context_disabled","debug_enabled","invert_enabled","set_gender_on_message","gender","message_id","variables","getVariables","type","set","substitudeMacros","replaceVariables","eventOn","tavern_events","MESSAGE_SENT","options","getLorebookEntries","filter","entry","comment","startsWith","map","replace","length","get_gender_option","roleplay_options_regex","option_section","render_section","renderOneMessage","match","getChatMessages","message","$roleplay_options_element","extract_options_element","$mes_text","retrieveDisplayedMessage","to_render","find","remove","append","renderAllMessage","children","each","_index","node","attr","parseInt","error","default_option","input_mode","update","old_option","option","value","content","result","parse_option","style","old_style","entries","extract_style","text","$div","matchAll","title","on","$element","parents","trim","old_content","val","join","dispatchEvent","Event","bubbles","divclick","this","errorCatched","CHAT_CHANGED","CHARACTER_MESSAGE_RENDERED","MESSAGE_UPDATED","MESSAGE_SWIPED","MESSAGE_DELETED","setTimeout","WORLDINFO_UPDATED","lorebook","style_node","getScriptId","extract_style_node","get","script_id","$head","reappend_styles","preloads_node","preloads","preload","extract_preloads_node","reappend_preloads","extensions","name","url","tag","substring","lastIndexOf","reduce","previous","current","defaults","current_extensions","response","fetch","ok","json","extension","err","get_third_party_extension_names","uninstall_extension_tags","difference","SillyTavern","callGenericPopup","POPUP_TYPE","CONFIRM","leftAlign","Promise","allSettled","request","method","headers","getRequestHeaders","body","toastr","warning","statusText","status","success","author","display_name","version","debug","extensionPath","install_extension","unlock_token_length_debounced","debounce","MAX_CONTEXT","chatCompletionSettings","max_context_unlocked","openai_max_context","prop","trigger","SETTINGS_UPDATED"],"ignoreList":[],"sourceRoot":""}