<html><head><style>*{-webkit-tap-highlight-color:rgba(0,0,0,0);margin:0;padding:0;box-sizing:border-box;font-family:"Microsoft YaHei","Hiragino Sans GB",sans-serif;scrollbar-width:none !important;user-select:none !important;-webkit-user-select:none !important;-moz-user-select:none !important;-ms-user-select:none !important}::-webkit-scrollbar{width:0 !important;display:none !important}body,html{width:100%;aspect-ratio:16/9;overflow:hidden;background-color:rgba(1,1,1,0);margin:0 !important;padding:0 !important;-ms-overflow-style:none !important;scrollbar-width:none !important}.main-container{width:100%;max-width:1200px;aspect-ratio:16/9;position:relative;margin:0 auto;background:linear-gradient(135deg, #fff0f3, #ffe5ea);border:1px solid #fff;border-radius:12px;box-shadow:0 0 20px rgba(145,125,138,.15);overflow:hidden;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);max-height:95%;display:flex;flex-direction:column;box-sizing:border-box}.main-container::after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;border:1px solid #fff;border-radius:12px;pointer-events:none;z-index:100;box-sizing:border-box}.inner-container{position:relative;width:97%;height:97%;margin:1.5% auto;background:#fff;border-radius:8px;box-shadow:0 5px 15px rgba(145,125,138,.15);overflow:hidden;display:flex;flex-direction:column;flex:1;box-sizing:border-box}.title-bar{position:relative;height:5.5%;background:linear-gradient(to right, #ffd0d8, #ffbbc8);display:flex;align-items:center;justify-content:center;color:#7d6b6e;font-weight:bold;font-size:clamp(10px,1.5vw,16px);text-shadow:0px 1px 1px hsla(0,0%,100%,.5);border-radius:8px 8px 0 0}.icon-left{position:absolute;left:15px;font-size:18px;color:#c18e98}.icon-right{position:absolute;right:15px;font-size:14px;color:#c18e98}.scene-area{position:relative;flex:1;overflow:hidden;background-color:#000;min-height:0}#cg-container{position:absolute;top:0;left:0;width:100%;height:100%;z-index:1;display:flex;align-items:center;justify-content:center}.background-image{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;transition:opacity 1.2s cubic-bezier(0.4, 0, 0.2, 1);z-index:2;background-color:#000}#background-image-current{opacity:1;z-index:3}#background-image-next{opacity:0;z-index:4}#character-container{position:absolute;width:100%;height:100%;z-index:2;pointer-events:none;overflow:hidden}.character-sprite{position:absolute;bottom:0;height:95%;max-height:95%;width:auto;object-fit:contain;transition:opacity .8s ease,transform .5s ease,filter .5s ease,left .8s ease,right .8s ease;filter:drop-shadow(0 0 5px rgba(0, 0, 0, 0.2));transform-origin:bottom center}.character-left{left:30%;transform:translateX(-50%)}.character-right{right:30%;transform:translateX(50%)}.character-center{position:absolute;left:50%;transform:translateX(-50%);bottom:0;height:98%;max-height:98%;width:auto;object-fit:contain}.character-enter{transform:scale(0.95);filter:blur(2px)}.character-exit{transform:scale(0.9);filter:blur(3px);transition:transform .5s ease,filter .5s ease}.character-active{opacity:1;transform:scale(1)}.character-speaking{filter:drop-shadow(0 0 8px rgba(0, 0, 0, 0.3));transform:scale(1.05);z-index:3}.character-dimmed{filter:brightness(0.85) contrast(0.95)}#dialog-box{position:absolute;bottom:4%;left:50%;transform:translateX(-50%);width:50%;max-width:600px;background:linear-gradient(135deg, rgba(255, 235, 240, 0.8), rgba(255, 202, 215, 0.8));-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);border-radius:10px;padding:clamp(6px,1.5%,12px) clamp(10px,2%,20px);color:#7d5b65;z-index:10;box-shadow:0 4px 12px rgba(145,125,138,.15),0 0 0 1px hsla(0,0%,100%,.4) inset;border:1px solid hsla(0,0%,100%,.7);transition:transform .3s ease,opacity .3s ease}#dialog-box:hover{transform:translateX(-50%) translateY(-2px);box-shadow:0 6px 15px rgba(145,125,138,.2),0 0 0 1px hsla(0,0%,100%,.5) inset}#character-name{font-size:16px;font-weight:bold;color:#c18e98;margin-bottom:4px;text-shadow:0 0 5px hsla(0,0%,100%,.7);position:relative;display:inline-block;padding-right:16px}#character-name:after{content:"❀";position:absolute;right:0;top:50%;transform:translateY(-50%);font-size:14px;color:#ffb0c0}#dialog-text{font-size:14px;line-height:1.4;min-height:50px;margin-bottom:8px;color:#4d2b35;text-shadow:0 1px 1px hsla(0,0%,100%,.9);letter-spacing:.2px;position:relative;padding:0 2px}#dialog-text:before,#dialog-text:after{content:"";position:absolute;height:80%;width:1px;background:linear-gradient(to bottom, rgba(255, 180, 190, 0), rgba(255, 180, 190, 0.5), rgba(255, 180, 190, 0));top:10%}#dialog-text:before{left:0}#dialog-text:after{right:0}#next-hint{text-align:right;font-size:12px;color:rgba(193,142,152,.8);animation:pulse 1.5s infinite;position:relative;padding-right:16px}#next-hint:after{content:"✿";position:absolute;right:0;top:50%;transform:translateY(-50%) rotate(5deg);font-size:14px;animation:float 2s ease-in-out infinite}@keyframes pulse{0%{opacity:.4}50%{opacity:1}100%{opacity:.4}}@keyframes float{0%,100%{transform:translateY(-50%) rotate(5deg)}50%{transform:translateY(-65%) rotate(10deg)}}.bottom-area{position:absolute;bottom:15px;right:15px;display:flex;align-items:center;z-index:900}.sweet-memories{display:flex;align-items:center}.history-button{display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg, #ffb5c5, #ffd6e0);border:none;padding:10px;border-radius:50%;color:#7d5b65;font-size:16px;cursor:pointer;margin-right:10px;width:40px;height:40px;transition:transform .3s ease,opacity .3s ease,background .3s ease;box-shadow:0 2px 5px rgba(0,0,0,.1)}.history-button:hover{transform:scale(1.1);opacity:.9;background:linear-gradient(135deg, #ffd6e0, #ffb5c5)}.restart-button{display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg, #ffb5c5, #ffd6e0);border:none;padding:10px;border-radius:50%;color:#7d5b65;font-size:16px;cursor:pointer;margin-right:10px;width:40px;height:40px;transition:transform .3s ease,opacity .3s ease,background .3s ease;box-shadow:0 2px 5px rgba(0,0,0,.1);line-height:1;text-align:center;padding:0}.restart-button:hover{transform:scale(1.1);opacity:.9;background:linear-gradient(135deg, #ffd6e0, #ffb5c5)}#toggle-ui-btn{display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg, #ffb5c5, #ffd6e0);border:none;padding:10px;border-radius:50%;color:#7d5b65;font-size:16px;cursor:pointer;width:40px;height:40px;transition:transform .3s ease,opacity .3s ease,background .3s ease;box-shadow:0 2px 5px rgba(0,0,0,.1)}#toggle-ui-btn:hover{transform:scale(1.1);opacity:.9;background:linear-gradient(135deg, #ffd6e0, #ffb5c5)}body.ui-hidden #dialog-box{display:none !important}body.ui-hidden #toggle-ui-btn{background:linear-gradient(135deg, #ffadc0, #ff8da0) !important}body.ui-hidden .restart-button{opacity:1;visibility:visible}body.ui-hidden #character-container{z-index:3}body.ui-hidden .character-dimmed{filter:none !important}.decoration-sticker{position:absolute;width:50px;height:50px;background-size:contain;background-repeat:no-repeat;z-index:15;opacity:.8;pointer-events:none}.sticker-1{top:15px;right:15px;transform:rotate(10deg);font-size:24px;color:#ffb0c0;display:flex;align-items:center;justify-content:center}.sticker-2{bottom:80px;left:15px;transform:rotate(-5deg);font-size:24px;color:#ffb0c0;display:flex;align-items:center;justify-content:center}body.transitioning .character-sprite{transition:opacity 1s ease,transform 1s ease,filter 1s ease,left 1s ease,right 1s ease}body.transitioning #next-hint{opacity:0;transition:opacity .6s ease}body.transitioning #dialog-box{opacity:.7;transition:opacity 1.2s ease,transform 1.2s ease}body.transitioning .decoration-sticker{opacity:.5;transition:opacity 1.2s ease}.narrator-mode #character-container,.protagonist-mode #character-container{opacity:0;pointer-events:none}.narrator-mode #dialog-box{background:linear-gradient(135deg, rgba(255, 235, 254, 0.895), rgba(250, 222, 255, 0.9))}.protagonist-mode #dialog-box{background:linear-gradient(135deg, rgba(245, 225, 235, 0.9), rgba(235, 215, 230, 0.9))}.narrator-mode #character-name{opacity:0;height:0;margin:0;overflow:hidden}@media(max-width: 768px){body,html{aspect-ratio:3/4}#dialog-box{position:absolute;left:50%;bottom:-100%;width:100%;max-width:none;z-index:25;transition:none}#dialog-box:hover{box-shadow:0 4px 12px rgba(145,125,138,.15),0 0 0 1px hsla(0,0%,100%,.4) inset}body.transitioning #dialog-box{opacity:1;transition:none;transform:translateX(-50%)}.main-container{top:25%;overflow:visible}.inner-container{overflow:visible}.scene-area{overflow:visible}.title-bar{height:20px}.bottom-area{z-index:15;bottom:10px;right:10px}.decoration-sticker{display:none}#toggle-ui-btn{display:none !important}.history-button,#toggle-ui-btn{width:35px;height:35px;font-size:14px}#history-panel{width:96%;height:240% !important;max-height:300% !important;top:120% !important;border-radius:12px}#history-header{padding:12px 15px;font-size:16px;border-radius:12px 12px 0 0}#close-history{font-size:22px}#history-content::-webkit-scrollbar{width:6px !important}#history-content::-webkit-scrollbar-thumb{border:none}.history-item{padding:12px !important;margin-bottom:12px !important;border-radius:10px}.history-name{font-size:14px !important;margin-bottom:6px !important;padding-left:16px}.history-name::before{font-size:12px}.history-text{font-size:13px !important;line-height:1.5}}#history-panel{position:fixed;top:25%;left:5%;width:90%;height:90%;max-height:90%;background:linear-gradient(135deg, rgba(255, 240, 245, 0.95), rgba(255, 225, 235, 0.95));-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:15px;box-shadow:0 8px 30px rgba(145,125,138,.25),0 0 0 1px hsla(0,0%,100%,.6) inset;border:1px solid hsla(0,0%,100%,.8);z-index:1000;display:none;flex-direction:column;box-sizing:border-box;transform:none;margin:0;overflow:hidden}#history-header{flex-shrink:0;display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background:linear-gradient(to right, rgba(255, 208, 216, 0.8), rgba(255, 187, 200, 0.8));border-bottom:1px solid hsla(0,0%,100%,.5);border-radius:15px 15px 0 0;color:#7d5b65;font-weight:bold;font-size:clamp(14px,1.8vw,18px);text-shadow:0 1px 1px hsla(0,0%,100%,.6)}#close-history{background:none;border:none;font-size:24px;color:#c18e98;cursor:pointer;padding:5px;line-height:1;transition:color .2s ease,transform .2s ease}#close-history:hover{color:#a16e78;transform:scale(1.1)}#history-content{flex-grow:1;overflow-y:auto;padding:20px;color:#4d2b35;scrollbar-width:thin;scrollbar-color:#ffb0c0 #fff0f3}#history-content::-webkit-scrollbar{width:8px !important;display:block !important}#history-content::-webkit-scrollbar-track{background:rgba(255,240,243,.5);border-radius:4px}#history-content::-webkit-scrollbar-thumb{background-color:rgba(255,176,192,.8);border-radius:4px;border:1px solid hsla(0,0%,100%,.3)}#history-content::-webkit-scrollbar-thumb:hover{background-color:#ffa0b4}.history-item{margin-bottom:15px;padding:15px;border-radius:12px;background:hsla(0,0%,100%,.6);box-shadow:0 2px 8px rgba(0,0,0,.05),0 0 0 1px hsla(0,0%,100%,.7) inset;transition:transform .2s ease,box-shadow .2s ease}.history-item:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.08),0 0 0 1px hsla(0,0%,100%,.8) inset}.history-name{font-weight:bold;color:#c18e98;margin-bottom:8px;position:relative;padding-left:18px;font-size:15px}.history-name::before{content:"❀";position:absolute;left:0;top:50%;transform:translateY(-50%);color:#ffb0c0;font-size:13px}.history-text{line-height:1.6;letter-spacing:.3px;font-size:14px;color:#4d2b35}.history-item.narrator{font-style:italic;background:rgba(245,235,235,.8);border-left:3px solid #ffcad5}
</style></head><body><div class="main-container"><div class="inner-container"><div class="title-bar"><span class="icon-left">❀</span> 『⁺⊹𝒞𝒢𝒯𝒾𝓂ℯʚෆɞ₊』 <span class="icon-right">✧*:･ﾟ✧</span></div><div class="scene-area"><div id="cg-container"><img id="background-image-current" class="background-image" alt="当前背景CG"/> <img id="background-image-next" class="background-image" style="opacity:0" alt="下一个背景CG"/></div><div class="decoration-sticker sticker-1">♡</div><div class="decoration-sticker sticker-2">✿</div><div id="character-container"></div><div id="dialog-box"><div id="character-name">角色名称</div><div id="dialog-text">这里是对话内容...</div><div id="next-hint">点击或按空格继续</div></div><div id="history-panel" style="display:none;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;height:80%;background:rgba(255,240,243,.95);z-index:1001;border-radius:15px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.25),0 0 10px rgba(0,0,0,.1);backdrop-filter:blur(5px)"><div style="position:sticky;top:0;background:linear-gradient(to right,#ffd0d8,#ffbbc8);padding:5px 10px;border-bottom:1px solid rgba(255,255,255,.5);display:flex;justify-content:space-between;align-items:center;z-index:10;box-shadow:0 1px 3px rgba(0,0,0,.05);height:30px;box-sizing:border-box"><h3 style="margin:0;color:#7d5b65;font-size:12px;text-shadow:0 1px 1px rgba(255,255,255,.7)">𝕃𝕆𝔾</h3><button id="close-history" style="font-size:12px">⊗</button></div><div id="history-content" style="padding:20px;height:calc(100% - 60px);overflow-y:auto;scrollbar-width:thin;box-sizing:border-box"></div></div></div><div class="bottom-area"><button id="history-btn" class="history-button">📜</button> <button id="restart-btn" class="restart-button" style="display:none">📖</button> <button id="toggle-ui-btn">🎮</button></div></div></div><script>class t{constructor(){this.currentIndex=0,this.isAnimating=!1,this.activeCharacters={},this.isTransitioning=!1,this.currentBgPath='',this.dialogHistory=[],this.dialogBox=document.getElementById('dialog-box'),this.characterName=document.getElementById('character-name'),this.dialogText=document.getElementById('dialog-text'),this.currentImage=document.getElementById('background-image-current'),this.nextImage=document.getElementById('background-image-next'),this.characterContainer=document.getElementById('character-container'),this.historyPanel=document.getElementById('history-panel'),this.historyContent=document.getElementById('history-content'),this.imageBaseUrl='https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/背景/';try{const t=SillyTavern.chat[getCurrentMessageId()].mes.match(/<galgame>\s*```(?:json|yaml)?(.*)```\s*<\/galgame>/is)[1];if(!t)throw new Error('游戏数据 <Galgame> 为空。');let e=null;try{e=JSON.parse(t),console.log('游戏数据加载成功 (JSON 格式)')}catch(o){console.warn('JSON 解析失败，尝试解析为 YAML:',o.message);try{e=YAML.parse(t)}catch(t){throw console.error('YAML 解析也失败:',t),new Error(`数据解析失败：既不是有效的 JSON 也不是有效的 YAML。JSON 错误: ${o.message} | YAML 错误: ${t.message}`)}}Array.isArray(e)&&0!==e.length?(this.dialogData=e,console.log('最终使用的游戏数据:',this.dialogData)):(console.warn('加载的对话数据为空或格式无效 (预期为非空数组)，将加载默认提示信息。'),this.dialogData=[{name:'系统提示',text:'加载的对话数据为空或格式无效。',characters:'narrator'}])}catch(t){console.error('加载或解析游戏数据时出错:',t),this.dialogData=[{name:'系统提示',text:`加载对话数据失败：${t.message}`,characters:'narrator'}]}this.characterSprites={络络:{水手服:{'微笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/微笑.png','浅笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/浅笑.png','生气.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/生气.png','惊讶.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/惊讶.png','害羞.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/害羞.png','稍微脸红.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/稍微脸红.png','手托下巴思考.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/手托下巴思考.png','看透一切的坏笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/看透一切的坏笑.png','邪恶的坏笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/邪恶的坏笑.png','星星眼.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/星星眼.png','晕晕眼.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/晕晕眼.png','猫爪生气.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/猫爪生气.png','流口水.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/流口水.png','哭泣.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/哭泣.png','擦眼泪.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/擦眼泪.png','等待吻.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/等待吻.png','性高潮.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/性高潮.png','眼神空洞的催眠状态.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/眼神空洞的催眠状态.png','无表情.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/无表情.png','无人.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/水手服/无人.png'},格纹衫:{'微笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/微笑.png','浅笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/浅笑.png','生气.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/生气.png','惊讶.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/惊讶.png','害羞.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/害羞.png','稍微脸红.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/稍微脸红.png','手托下巴思考.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/手托下巴思考.png','看透一切的坏笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/看透一切的坏笑.png','邪恶的坏笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/邪恶的坏笑.png','星星眼.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/星星眼.png','晕晕眼.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/晕晕眼.png','猫爪生气.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/猫爪生气.png','流口水.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/流口水.png','哭泣.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/哭泣.png','擦眼泪.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/擦眼泪.png','等待吻.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/等待吻.png','性高潮.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/性高潮.png','眼神空洞的催眠状态.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/眼神空洞的催眠状态.png','无人.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/格纹衫/无人.png'},开衫:{'微笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/微笑.png','浅笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/浅笑.png','生气.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/生气.png','惊讶.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/惊讶.png','害羞.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/害羞.png','稍微脸红.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/稍微脸红.png','手托下巴思考.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/手托下巴思考.png','看透一切的坏笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/看透一切的坏笑.png','邪恶的笑容.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/邪恶的笑容.png','星星眼.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/星星眼.png','晕晕眼.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/晕晕眼.png','猫爪生气.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/猫爪生气.png','流口水.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/流口水.png','哭泣.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/哭泣.png','擦眼泪.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/擦眼泪.png','等待吻.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/等待吻.png','性高潮.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/性高潮.png','无表情.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/无表情.png','无人.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/开衫/无人.png'},睡衣:{'微笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/微笑.png','浅笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/浅笑.png','生气.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/生气.png','惊讶.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/惊讶.png','害羞.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/害羞.png','稍微脸红.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/稍微脸红.png','看透一切的坏笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/看透一切的坏笑.png','邪恶的坏笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/邪恶的坏笑.png','星星眼.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/星星眼.png','晕晕眼.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/晕晕眼.png','猫爪生气.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/猫爪生气.png','流口水.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/流口水.png','哭泣.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/哭泣.png','等待吻.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/等待吻.png','性高潮.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/性高潮.png','眼神空洞的催眠状态.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/眼神空洞的催眠状态.png','无人.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/睡衣/无人.png'},全裸:{'浅笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/浅笑.png','生气.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/生气.png','惊讶.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/惊讶.png','害羞.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/害羞.png','稍微脸红.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/稍微脸红.png','看透一切的坏笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/看透一切的坏笑.png','邪恶的坏笑.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/邪恶的坏笑.png','星星眼.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/星星眼.png','晕晕眼.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/晕晕眼.png','流口水.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/流口水.png','哭泣.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/哭泣.png','性高潮.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/性高潮.png','眼神空洞的催眠状态.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/眼神空洞的催眠状态.png','无人.png':'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/立绘/全裸/无人.png'}}},this.initEventListeners(),this.initializeBackground(),this.showDialog(0)}initializeBackground(){if(this.dialogData&&this.dialogData.length>0&&this.dialogData[0].background){const t=this.dialogData[0].background,e=this.getFullImageUrl(t);if(console.log('初始化背景图片:',e),!this.currentImage)return void console.error('背景图片元素不存在!');this.currentBgPath=t,this.currentImage.src=e,this.currentImage.style.opacity='1',this.currentImage.onerror=()=>{console.error('背景图片加载失败:',e),this.currentImage.src='https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/背景/商店街/黄昏.jpg'},this.currentImage.complete?console.log('背景图片已加载完成'):this.currentImage.onload=()=>{console.log('背景图片加载完成')}}}getFullImageUrl(t){if(!t)return'';if('商店街/黄昏.jpg'===t)return'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/背景/商店街/黄昏.jpg';if('商店街/夜晚开灯.jpg'===t)return'https://gitgud.io/lolodesu/lolocard/-/raw/ebf826c38410ee0b35111f9a982063ab291b88c9/src/日记络络/图片/背景/商店街/夜晚开灯.jpg';try{const e=t.split('/'),o=e.map((t=>encodeURIComponent(t))).join('/');return this.imageBaseUrl+o}catch(e){return console.error('URL编码失败:',e,'原始路径:',t),''}}initEventListeners(){document.addEventListener('click',(()=>{this.nextDialog()})),document.addEventListener('keydown',(t=>{'Space'===t.code&&(t.preventDefault(),this.nextDialog())}))}showDialog(t){if(t>=this.dialogData.length)return console.log('对话结束，重新开始'),this.currentIndex=0,void this.showDialog(0);this.currentIndex=t;const e=this.dialogData[t];if(!e)return void console.error('对话数据不存在:',t);const o=e.background||'',a=o&&this.currentBgPath!==o;if(console.log(`显示对话 #${t}`,e.name,'当前背景:',this.currentBgPath||'(无)','新背景:',o||'(无)','需要转场:',a),a){if(console.log('执行背景转场 - 从',this.currentBgPath||'(无)','到',o),'narrator'===e.characters||'protagonist'===e.characters||!e.characters){for(const t in this.activeCharacters)this.hideCharacter(t);this.activeCharacters={}}this.currentBgPath=o,this.fadeOutIn((()=>o),e)}else this.updateDialogContent(e)}updateDialogContent(t){t?(console.log('更新对话内容:',t.name,t.text),this.updateCharacters(t),this.characterName.textContent=t.name,this.applyTypingEffect(t.text),this.addToHistory(t)):console.error('更新对话内容失败: 对话数据为空')}applyTypingEffect(t){this.isAnimating=!0,this.dialogText.textContent='',document.getElementById('next-hint').style.opacity='0';const e=Math.max(.5,Math.min(1.5,300/t.length)),o=Math.floor(30*e);let a=0;const s=()=>{if(a<t.length&&this.isAnimating){const e=t.charAt(a);this.dialogText.textContent+=e,a++,setTimeout(s,o)}else this.isAnimating=!1,document.getElementById('next-hint').style.opacity='1'};s()}updateCharacters(t){if(this.isTransitioning)return void console.log('正在转场中，延迟更新角色显示');const e={};if(document.body.classList.remove('narrator-mode','protagonist-mode'),t.characters)if('narrator'!==t.characters)if('protagonist'!==t.characters){if('object'!=typeof t.characters||!t.characters.id||t.characters.left||t.characters.right){if('object'==typeof t.characters){const o=!!t.characters.left,a=!!t.characters.right;if(o&&!a){const o=t.characters.left.id,a=t.characters.left.expression||'默认.png',s=t.characters.left.costume||'水手服';e[o]={position:'center',expression:a,costume:s},this.showCharacter(o,'center',t.name===o,a,s)}else if(!o&&a){const o=t.characters.right.id,a=t.characters.right.expression||'默认.png',s=t.characters.right.costume||'水手服';e[o]={position:'center',expression:a,costume:s},this.showCharacter(o,'center',t.name===o,a,s)}else{if(t.characters.left&&t.characters.left.id){const o=t.characters.left.id,a=t.characters.left.expression||'默认.png',s=t.characters.left.costume||'水手服';e[o]={position:'left',expression:a,costume:s},this.showCharacter(o,'left',t.name===o,a,s)}if(t.characters.right&&t.characters.right.id){const o=t.characters.right.id,a=t.characters.right.expression||'默认.png',s=t.characters.right.costume||'水手服';e[o]={position:'right',expression:a,costume:s},this.showCharacter(o,'right',t.name===o,a,s)}}}}else{const o=t.characters.id,a=t.characters.expression||'默认.png',s=t.characters.costume||'水手服';e[o]={position:'center',expression:a,costume:s},this.showCharacter(o,'center',t.name===o,a,s)}for(const t in this.activeCharacters)e[t]||this.hideCharacter(t);this.activeCharacters=e}else{document.body.classList.add('protagonist-mode');for(const t in this.activeCharacters)this.hideCharacter(t);this.activeCharacters={}}else{document.body.classList.add('narrator-mode');for(const t in this.activeCharacters)this.hideCharacter(t);this.activeCharacters={}}else{for(const t in this.activeCharacters)this.hideCharacter(t);this.activeCharacters={}}}showCharacter(t,e,o,a='默认',s='水手服'){if(this.isTransitioning)return void console.log('正在转场中，跳过显示角色:',t);if(!this.characterSprites[t])return;const r=this.characterSprites[t];let c=s;r[c]||(c=Object.keys(r)[0]);const i=r[c];let n=a;i[n]||(n=Object.keys(i)[0]||'默认.png');const l=i[n];if(!l)return;const g=`character-${t}`,d=this.activeCharacters[t]?.position;let h=document.getElementById(g);h?(h.dataset.expression!==n&&(h.src=l,h.dataset.expression=n),h.dataset.position!==e&&setTimeout((()=>{this.isTransitioning||(h.classList.remove(`character-${h.dataset.position}`),h.classList.add(`character-${e}`),h.dataset.position=e,this.applyPositionStyle(h,e))}),50)):(h=document.createElement('img'),h.id=g,h.className='character-sprite character-enter',h.src=l,h.dataset.expression=n,h.dataset.position=e,h.alt=`${t}的立绘`,d&&d!==e?h.classList.add(`character-${d}`):h.classList.add(`character-${e}`),this.characterContainer.appendChild(h),setTimeout((()=>{this.isTransitioning?h&&h.parentNode&&h.parentNode.removeChild(h):(h.classList.remove('character-enter'),h.classList.add('character-active'),d&&d!==e&&setTimeout((()=>{h.classList.remove(`character-${d}`),h.classList.add(`character-${e}`),h.dataset.position=e}),50),this.applyPositionStyle(h,e))}),50)),o?(h.classList.add('character-speaking'),h.classList.remove('character-dimmed'),h.style.opacity='1',h.style.zIndex='10'):(h.classList.remove('character-speaking'),h.classList.add('character-dimmed'),h.style.opacity='1',h.style.zIndex='5')}applyPositionStyle(t,e){'center'===e?(t.style.left='50%',t.style.right='auto',t.style.transform='translateX(-50%)',t.style.bottom='0',t.style.height='98%',t.style.maxHeight='98%'):'left'===e?(t.style.left='30%',t.style.right='auto',t.style.transform='translateX(-50%)',t.style.bottom='0',t.style.height='95%',t.style.maxHeight='95%'):'right'===e&&(t.style.right='30%',t.style.left='auto',t.style.transform='translateX(50%)',t.style.bottom='0',t.style.height='95%',t.style.maxHeight='95%')}hideCharacter(t){const e=document.getElementById(`character-${t}`);if(e){if(e.classList.contains('character-exit'))return;e.classList.add('character-exit'),e.classList.remove('character-active','character-speaking'),setTimeout((()=>{e&&e.parentNode&&e.parentNode.removeChild(e)}),800)}}nextDialog(){if(this.isAnimating){this.isAnimating=!1;const t=this.dialogData[this.currentIndex];return this.dialogText.textContent=t.text,void(document.getElementById('next-hint').style.opacity='1')}if(this.currentIndex++,this.currentIndex>=this.dialogData.length){console.log('对话已全部播放完毕。'),this.currentIndex=this.dialogData.length-1;const t=document.getElementById('next-hint');t&&(t.style.display='none');const e=document.getElementById('restart-btn');e&&(e.style.display='block')}else this.showDialog(this.currentIndex)}restartDialog(){console.log('重新开始对话播放'),this.currentIndex=0;for(const t in this.activeCharacters)this.hideCharacter(t);if(this.activeCharacters={},this.dialogData&&this.dialogData.length>0&&this.dialogData[0].background){this.currentBgPath=this.dialogData[0].background;const t=this.getFullImageUrl(this.currentBgPath);this.currentImage.src=t}const t=document.getElementById('next-hint');t&&(t.style.display='block',t.style.opacity='1');const e=document.getElementById('restart-btn');e&&(e.style.display='none'),this.showDialog(0)}fadeOutIn(t,e){if(this.isTransitioning)return void console.log('已在转场中，忽略新的转场请求');this.isTransitioning=!0,console.log('开始背景转场');const o=t();if(!o)return console.log('背景路径为空，跳过转场'),this.isTransitioning=!1,void(e&&this.updateDialogContent(e));const a=this.getFullImageUrl(o);if(console.log('切换背景图片:',o,'->',a),!a||a===this.currentImage.src)return console.log('跳过背景转场: URL为空或相同'),this.isTransitioning=!1,void(e&&this.updateDialogContent(e));const s=()=>{console.log('执行背景转场动画'),document.body.classList.add('transitioning'),this.nextImage.style.opacity='1',setTimeout((()=>{this.currentImage.src=this.nextImage.src,console.log('背景转场完成，当前背景:',this.currentImage.src),this.nextImage.style.opacity='0',document.body.classList.remove('transitioning'),this.isTransitioning=!1,e&&(console.log('转场完成，更新对话内容:',e.name),setTimeout((()=>{this.updateDialogContent(e)}),50))}),1200)};this.nextImage.src=a,this.nextImage.onerror=()=>{console.error('背景图片加载失败:',a),this.isTransitioning=!1,e&&this.updateDialogContent(e)},this.nextImage.onload=()=>{console.log('背景图片加载完成'),s()}}addToHistory(t){this.dialogHistory.some((e=>e.name===t.name&&e.text===t.text))||(this.dialogHistory.push({name:t.name,text:t.text,background:t.background||''}),this.updateHistoryPanel())}updateHistoryPanel(){if(this.historyContent.innerHTML='',0===this.dialogHistory.length){const t=document.createElement('div');return t.textContent='暂无对话历史',t.style.textAlign='center',t.style.color='#7D5B65',t.style.padding='20px',void this.historyContent.appendChild(t)}this.dialogHistory.forEach(((t,e)=>{const o=document.createElement('div');if(o.className='history-item',o.style.marginBottom='15px',o.style.padding='15px',o.style.borderRadius='12px',o.style.background='rgba(255, 255, 255, 0.5)',o.style.boxShadow='0 2px 8px rgba(0,0,0,0.05), 0 0 0 1px rgba(255,255,255,0.7) inset',o.style.transition='transform 0.2s ease, box-shadow 0.2s ease',o.onmouseover=function(){this.style.transform='translateY(-2px)',this.style.boxShadow='0 4px 12px rgba(0,0,0,0.08), 0 0 0 1px rgba(255,255,255,0.8) inset'},o.onmouseout=function(){this.style.transform='none',this.style.boxShadow='0 2px 8px rgba(0,0,0,0.05), 0 0 0 1px rgba(255,255,255,0.7) inset'},t.name&&'旁白'!==t.name){const e=document.createElement('div');e.className='history-name',e.textContent=t.name,e.style.fontWeight='bold',e.style.color='#C18E98',e.style.marginBottom='8px',e.style.position='relative',e.style.paddingLeft='15px';const a=document.createElement('span');a.textContent='❀',a.style.position='absolute',a.style.left='0',a.style.top='50%',a.style.transform='translateY(-50%)',a.style.color='#FFB0C0',a.style.fontSize='12px',e.appendChild(a),o.appendChild(e)}else'旁白'===t.name&&(o.style.fontStyle='italic',o.style.background='rgba(245, 235, 235, 0.7)',o.style.borderLeft='3px solid #FFCAD5');const a=document.createElement('div');a.className='history-text',a.textContent=t.text,a.style.color='#4D2B35',a.style.lineHeight='1.5',a.style.letterSpacing='0.3px',o.appendChild(a),this.historyContent.appendChild(o)})),setTimeout((()=>{this.historyContent.scrollTop=this.historyContent.scrollHeight}),100)}toggleHistoryPanel(t){t?(this.updateHistoryPanel(),this.historyPanel.style.display='block',this.historyPanel.style.opacity='0',this.historyPanel.style.transition='opacity 0.3s ease',setTimeout((()=>{this.historyPanel.style.opacity='1'}),10)):(this.historyPanel.style.opacity='0',setTimeout((()=>{this.historyPanel.style.display='none'}),300))}}$((()=>{const e=new t;!function(){const t=document.getElementById('toggle-ui-btn');t&&(t.addEventListener('click',(function(o){if(o.stopPropagation(),document.body.classList.toggle('ui-hidden'),document.body.classList.contains('ui-hidden')){t.textContent='💬',t.title='显示界面';document.querySelectorAll('.character-sprite').forEach((t=>{t.classList.remove('character-speaking','character-dimmed')}))}else t.textContent='💭',t.title='隐藏界面',e.updateCharacters(e.dialogData[e.currentIndex])})),t.textContent='💭',t.title='隐藏界面')}();const o=document.getElementById('history-btn'),a=document.getElementById('close-history');o&&a&&(o.addEventListener('click',(function(t){t.stopPropagation(),e.toggleHistoryPanel(!0)})),a.addEventListener('click',(function(t){t.stopPropagation(),e.toggleHistoryPanel(!1)})),document.getElementById('history-panel').addEventListener('click',(function(t){t.stopPropagation()})),document.addEventListener('keydown',(function(t){'Escape'===t.key&&'block'===e.historyPanel.style.display&&e.toggleHistoryPanel(!1)})));const s=document.getElementById('restart-btn');s&&(s.addEventListener('click',(function(t){t.stopPropagation(),e.restartDialog()})),s.title='重新开始')}));</script></body></html>