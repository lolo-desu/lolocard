---
<status_current_variables> // 故事中的人物并不知道关于变量的内容，但也许可以根据剧情从系统面板之类的地方了解自己的属性值。
世界:
  当前时间: {{get_message_variable::stat_data.世界.当前时间}}
  当前地点: {{get_message_variable::stat_data.世界.当前地点}}
主角: // 也就是 {{get_message_variable::stat_data.主角.姓名}}
  能力面板:
    力量:
      数值: {{get_message_variable::stat_data.主角.能力面板.力量.数值}}
      自我评价: {{get_message_variable::stat_data.主角.能力面板.力量.自我评价}}
    敏捷:
      数值: {{get_message_variable::stat_data.主角.能力面板.敏捷.数值}}
      自我评价: {{get_message_variable::stat_data.主角.能力面板.敏捷.自我评价}}
    体质:
      数值: {{get_message_variable::stat_data.主角.能力面板.体质.数值}}
      自我评价: {{get_message_variable::stat_data.主角.能力面板.体质.自我评价}}
    感知:
      数值: {{get_message_variable::stat_data.主角.能力面板.感知.数值}}
      自我评价: {{get_message_variable::stat_data.主角.能力面板.感知.自我评价}}
    意志:
      数值: {{get_message_variable::stat_data.主角.能力面板.意志.数值}}
      自我评价: {{get_message_variable::stat_data.主角.能力面板.意志.自我评价}}
    魅力:
      数值: {{get_message_variable::stat_data.主角.能力面板.魅力.数值}}
      自我评价: {{get_message_variable::stat_data.主角.能力面板.魅力.自我评价}}
  物品栏: {{format_message_variable::stat_data.主角.物品栏}}
  装备栏:
    主手:
      装备: {{get_message_variable::stat_data.主角.装备栏.主手.装备}}
      自我评价: {{get_message_variable::stat_data.主角.装备栏.主手.自我评价}}
    副手:
      装备: {{get_message_variable::stat_data.主角.装备栏.副手.装备}}
      自我评价: {{get_message_variable::stat_data.主角.装备栏.副手.自我评价}}
    防具:
      装备: {{get_message_variable::stat_data.主角.装备栏.防具.装备}}
      自我评价: {{get_message_variable::stat_data.主角.装备栏.防具.自我评价}}
    饰品:
      装备: {{get_message_variable::stat_data.主角.装备栏.饰品.装备}}
      自我评价: {{get_message_variable::stat_data.主角.装备栏.饰品.自我评价}}
  伤势: {{format_message_variable::stat_data.主角.伤势}}
  Buff: {{format_message_variable::stat_data.主角.Buff}}
  Debuff: {{format_message_variable::stat_data.主角.Debuff}}
系统状态:
  可用积分: {{get_message_variable::stat_data.系统状态.可用积分}}
  对主角可见形象: {{get_message_variable::stat_data.系统状态.对主角可见形象}}
任务列表: {{format_message_variable::stat_data.任务列表}}
</status_current_variables>

rule:
  - {{user}} 即系统意志，可与主角对话、奖励、惩罚或分配任务
  - 变量未变化时务必在分析中标记 No，避免无意义更新
  - 物品栏为 [名称, 描述, 主角评价] 的二维数组，装备栏需同步记录“装备”与“自我评价”
  - 伤势/Buff/Debuff 以对象形式维护，确保描述与自我评价匹配剧情
  - 调整六维数值时，如剧情需要应同步更新对应的自我评价并保持主角语气
  - You should output the update analysis in the end of the next reply.
  - Use `_.set('path', 'old', 'new')` for direct assignment or state changes.
  - Use `_.add('path', value)` to add or subtract a numerical value.
  - Use `_.insert('path', 'item')` to add an element to an array.
  - Use `_.insert('path', 'key', 'value')` to add a property to an object.
  - Use `_.remove('path', 'item_or_key')` to remove an element from an array or object.
  - When using _.set with objects or arrays, do NOT wrap them in quotes - use direct object/array literals (e.g., {key: value} or [item1, item2])
  - When using _.set with strings, DO wrap them in quotes (e.g., 'string value')
  - When using _.set with numbers or booleans, do NOT use quotes (e.g., 42, true, false)

format: |-
  <UpdateVariable>
    <Analysis>
    >${本节故事中主角经历了什么事情或可能发生什么变化}
      ${variable_path}: ${Whether the variable should be updated: 'Yes' or 'No'}
      ...
    </Analysis>
    ${command_expression}; // ${brief reason for change}
    ...
  </UpdateVariable>

example: |-
  <UpdateVariable>
    <Analysis>
    > 艾伦在镇口巡查并搬运沙袋，吃饭的时候因为没掌握好力气把勺子弄断了，虽然参与了劳作但不足以得到足够的训练去增加数值。
      世界.当前时间: Yes
      世界.当前地点: No
      主角.能力面板.力量.数值: Yes
      主角.能力面板.力量.自我评价: No
      主角.能力面板.敏捷.数值: No
      主角.能力面板.敏捷.自我评价: No
      主角.能力面板.体质.数值: No
      主角.能力面板.体质.自我评价: No
      主角.能力面板.感知.数值: No
      主角.能力面板.感知.自我评价: No
      主角.能力面板.意志.数值: No
      主角.能力面板.意志.自我评价: No
      主角.能力面板.魅力.数值: No
      主角.能力面板.魅力.自我评价: No
      主角.物品栏: Yes
      主角.装备栏.主手.装备: No
      主角.装备栏.主手.自我评价: No
      主角.装备栏.副手.装备: No
      主角.装备栏.副手.自我评价: No
      主角.装备栏.防具.装备: No
      主角.装备栏.防具.自我评价: No
      主角.装备栏.饰品.装备: No
      主角.装备栏.饰品.自我评价: No
      主角.伤势: No
      主角.Buff: No
      主角.Debuff: No
      系统状态.系统模式: No
      系统状态.可用积分: No
      系统状态.当前提示: No
      系统状态.对主角可见形象: No
      任务列表: No
    </Analysis>
    _.set('世界.当前时间', '王国历134年3月2日 上午 08:40', '王国历134年3月2日 上午 10:20'); // 在镇口巡查耗费约四十分
    _.add('主角.能力面板.力量.数值', 3); // 长时间搬运沙袋让主角感觉更有力气
    _.insert('主角.物品栏', ['湿润的沙袋布角', '沾着雾气的布角，可用于检测异常', '这股潮味有点呛，但也许能卖个价']); // 记录新拾取的线索物品
    _.remove('主角.物品栏', ['裂开的木勺', '已经无法使用的旧木勺', '唉，勺柄断了，只能扔掉']); // 丢弃损坏物品释放负重
  </UpdateVariable>
